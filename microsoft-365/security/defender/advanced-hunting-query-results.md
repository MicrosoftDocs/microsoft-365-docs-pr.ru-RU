---
title: Работа с расширенным запросом на охоту приводит к microsoft 365 Defender
description: Сделайте большую часть результатов запроса, возвращенных расширенным поиском в Microsoft 365 Defender
keywords: расширенный поиск, охота на угрозы, поиск киберугроз, Microsoft 365 Defender, Microsoft 365, m365, поиск, запрос, телеметрия, настраиваемые обнаружения, схема, кусто, визуализация, диаграмма, фильтры, сверла
search.product: eADQiWindows 10XVcnh
search.appverid: met150
ms.prod: m365-security
ms.mktglfcycl: deploy
ms.sitesec: library
ms.pagetype: security
f1.keywords:
- NOCSH
ms.author: maccruz
author: schmurky
localization_priority: Normal
manager: dansimp
audience: ITPro
ms.collection:
- M365-security-compliance
- m365initiative-m365-defender
ms.topic: article
ms.technology: m365d
ms.openlocfilehash: eccf93b019baa240a46260a28f3f0bc109345dd4
ms.sourcegitcommit: 7cc2be0244fcc30049351e35c25369cacaaf4ca9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/22/2021
ms.locfileid: "51952600"
---
# <a name="work-with-advanced-hunting-query-results"></a>Работа с расширенными результатами запроса на охоту

[!INCLUDE [Microsoft 365 Defender rebranding](../includes/microsoft-defender.md)]


**Область применения:**
- Microsoft 365 Defender
- Microsoft Defender для конечной точки

[!INCLUDE [Prerelease information](../includes/prerelease.md)]

В то время [](advanced-hunting-overview.md) как вы можете создавать расширенные запросы для получения очень точных сведений, вы также можете работать с результатами запроса, чтобы получить дополнительные сведения и изучить конкретные действия и индикаторы. В результатах запроса можно принять следующие действия:

- Просмотр результатов в таблице или диаграмме
- Экспорт таблиц и диаграмм
- Детализация подробных сведений об объектах
- Настройка запросов непосредственно из результатов или применение фильтров

## <a name="view-query-results-as-a-table-or-chart"></a>Просмотр результатов запроса в таблице или диаграмме
По умолчанию расширенный режим охоты отображает результаты запроса в качестве табулярных данных. Вы также можете отобразить те же данные, что и диаграмма. Расширенный поиск поддерживает следующие представления:

| Тип представления | Описание |
| -- | -- |
| **Table** | Отображает результаты запроса в табулярном формате |
| **Диаграмма столбца** | Отрисовка ряда уникальных элементов на оси x-axis в качестве вертикальных баров, высоты которых представляют числимые значения из другого поля |
| **Сложенная диаграмма столбцов** | Отрисовка ряда уникальных элементов на x-axis в качестве сложенных вертикальных баров, высоты которых представляют числовые значения из одного или более других полей. |
| **Диаграмма пирога** | Отрисовка раздельных пирогов, представляющих уникальные элементы. Размер каждого пирога представляет численное значение из другого поля. |
| **Пончиная диаграмма** | Отрисовка раздельных дуг, представляющих уникальные элементы. Длина каждой дуги представляет численное значение из другого поля. |
| **График** | Графики числимые значения для ряда уникальных элементов и соединяет замещенные значения |
| **Диаграмма scatter** | Графики числимые значения для ряда уникальных элементов |
| **Диаграмма области** | Графики числимых значений для ряда уникальных элементов и заполняют разделы ниже замещенных значений |

### <a name="construct-queries-for-effective-charts"></a>Создание запросов для эффективных диаграмм
При отрисовывии диаграмм передовая охота автоматически определяет столбцы, интересующие, и числимые значения для совокупного значения. Чтобы получить значимые диаграммы, состройте запросы для возврата определенных значений, которые необходимо увидеть визуализированными. Вот некоторые примеры запросов и итоговая диаграмма.

#### <a name="alerts-by-severity"></a>Оповещений по строгости
С помощью `summarize` оператора можно получить числовую цифру значений, которые необходимо наметить. В приведенной ниже области запрос использует оператора для получения количества предупреждений `summarize` по строгости.

```kusto
AlertInfo
| summarize Total = count() by Severity
```
При отрисовывии результатов диаграмма столбца отображает каждое значение серьезности в качестве отдельного столбца:

![Изображение результатов расширенных запросов охоты, отображаемого в качестве результатов запроса диаграммы столбцов для оповещений по степени серьезности, отображаемой ](../../media/advanced-hunting-column-chart.jpg)
 *в качестве диаграммы столбца*

#### <a name="alert-severity-by-operating-system"></a>Серьезность оповещений с помощью операционной системы
Можно также использовать оператора для подготовки `summarize` результатов для наметки значений из нескольких полей. Например, вам может потребоваться понять, как распределяются степени серьезности оповещения по операционным системам (ОС). 

В приведенной ниже области запрос использует оператора для получения сведений об ОС из таблицы, а затем для подсчета значений как в столбцах, так `join` `DeviceInfo` и в `summarize` `OSPlatform` `Severity` столбцах:

```kusto
AlertInfo
| join AlertEvidence on AlertId
| join DeviceInfo on DeviceId
| summarize Count = count() by OSPlatform, Severity 
```
Эти результаты лучше всего визуализировать с помощью диаграммы сложенных столбцов:

![Изображение результатов расширенных запросов охоты, отображаемого в качестве сложенных результатов запроса диаграммы для оповещений оси и строгости, отображаемой в качестве ](../../media/advanced-hunting-stacked-chart.jpg)
 *сложенной диаграммы*

#### <a name="phishing-emails-across-top-ten-sender-domains"></a>Фишинговые сообщения электронной почты в десяти доменах отправитель
Если вы имеете дело со списком значений, который не является конечным, оператор может использовать для диаграммы только значения с `Top` большинством экземпляров. Например, чтобы получить десять доменов отправитель с самыми фишинговыми электронными письмами, используйте запрос ниже:

```kusto
EmailEvents
| where ThreatTypes has "Phish" 
| summarize Count = count() by SenderFromDomain 
| top 10 by Count
```
Используйте представление диаграммы пирога, чтобы эффективно показывать распределение по верхним доменам:

![Изображение результатов расширенных запросов на охоту, отображаемого в диаграмме пирога, показывающая распространение фишинговых сообщений электронной почты в ](../../media/advanced-hunting-pie-chart.jpg)
 *верхних доменах отправитель*

#### <a name="file-activities-over-time"></a>Действия файла со временем
С помощью оператора с функцией можно проверить события, связанные с определенным `summarize` `bin()` индикатором с течением времени. В нижеупромянутом запросе учитываются события, связанные с файлом с интервалом в 30 минут, чтобы показать всплески активности, связанные `invoice.doc` с этим файлом:

```kusto
AppFileEvents
| union DeviceFileEvents
| where FileName == "invoice.doc"
| summarize FileCount = count() by bin(Timestamp, 30m)
```
На приведенной ниже строке четко выделены периоды времени с дополнительными действиями с `invoice.doc` участием: 

![Изображение расширенных результатов запроса охоты, отображаемого в качестве диаграммы строки line, показывающая количество событий, связанных ](../../media/advanced-hunting-line-chart.jpg)
 *с файлом с течением времени*


## <a name="export-tables-and-charts"></a>Экспорт таблиц и диаграмм
После выполнения запроса выберите **Экспорт,** чтобы сохранить результаты в локальном файле. Выбранное представление определяет, как экспортируются результаты:

- **Представление таблицы** — результаты запроса экспортируются в табулярной форме в виде книги Microsoft Excel
- **Любая диаграмма** — результаты запроса экспортируются как изображение JPEG отрисовки диаграммы

## <a name="drill-down-from-query-results"></a>Сверлить из результатов запроса
Чтобы быстро проверить запись в результатах запроса, выберите соответствующую строку, чтобы открыть панель **записей Inspect.** Панель предоставляет следующую информацию на основе выбранной записи:

- **Активы** — краткое представление основных активов (почтовых ящиков, устройств и пользователей), найденных в записи, обогащенных доступной информацией, например уровнями риска и экспозиции.
- **Дерево процесса** — создается для записей с информацией о процессе и обогащено с помощью доступной контекстной информации; как правило, запросы, возвращая больше столбцов, могут привести к более богатым деревьям процесса.
- **Все сведения** — все значения столбцов в записи  

![Изображение выбранной записи с панелью для проверки записи](../../media/mtp-ah/inspect-record.png)

Чтобы просмотреть дополнительные сведения о конкретном объекте в результатах запроса, таких как машина, файл, пользователь, IP-адрес или URL-адрес, выберите идентификатор сущности, чтобы открыть страницу подробного профиля для этого объекта.

## <a name="tweak-your-queries-from-the-results"></a>Регулирование запросов на основе результатов
Чтобы оперативно улучшить свой запрос, нужно щелкнуть правой кнопкой мыши одно из значений в полученном наборе результатов. Предлагаемые варианты можно использовать для

- открытого поиска избранного значения (`==`)
- исключения избранного значения из запроса (`!=`)
- Чтобы добавить к своему запросу определенное значение, можно использовать дополнительные операторы, например, `contains`, `starts with` и`ends with` 

![Изображение набора расширенных результатов охоты](../../media/advanced-hunting-results-filter.png)

## <a name="filter-the-query-results"></a>Фильтрация результатов запроса
Используя отображаемые справа фильтры, можно сформировать сводку о полученном наборе результатов. В каждом столбце есть раздел, в котором приводятся уникальные обнаруженные для этого столбца значения и количество экземпляров.

Уточнение запроса путем выбора кнопок или значений, которые необходимо включить или исключить, а затем выбрать `+` `-` запрос **Run**.

![Изображение фильтра расширенного выслеживания](../../media/advanced-hunting-filter.png)

Использование фильтра с целью изменения запроса и отправка этого запроса позволяют получить новые соответствующие результаты.

>[!NOTE]
>Некоторые таблицы в этой статье могут быть недоступны в Microsoft Defender для конечной точки. [Включи Microsoft 365 Defender для](m365d-enable.md) охоты на угрозы с помощью дополнительных источников данных. Вы можете переместить расширенные процессы охоты из Microsoft Defender для конечной точки в Microsoft 365 Defender, следуя шагам в миграции расширенных запросов охоты из [Microsoft Defender для конечной](advanced-hunting-migrate-from-mde.md)точки .

## <a name="related-topics"></a>Похожие темы
- [Обзор расширенной охоты](advanced-hunting-overview.md)
- [Изучение языка запросов](advanced-hunting-query-language.md)
- [Использование общих запросов](advanced-hunting-shared-queries.md)
- [Охота на различных устройствах, в письмах, приложениях и удостоверениях](advanced-hunting-query-emails-devices.md)
- [Сведения о схеме](advanced-hunting-schema-tables.md)
- [Применение рекомендаций по использованию запросов](advanced-hunting-best-practices.md)
- [Обзор настраиваемых обнаружений](custom-detections-overview.md)
