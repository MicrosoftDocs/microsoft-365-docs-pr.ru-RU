---
title: Работа с результатами запросов на расширенный поиск в Microsoft 365 Defender
description: Как получить большую часть результатов запроса, возвращаемого расширенным поиском в Microsoft 365 Defender
keywords: advanced hunting, threat hunting, cyber threat hunting, microsoft threat protection, microsoft 365, mtp, m365, search, query, telemetry, custom detections, schema, kusto, microsoft 365, Microsoft Threat Protection, visualization, chart, filters, drill-down
search.product: eADQiWindows 10XVcnh
search.appverid: met150
ms.prod: m365-security
ms.mktglfcycl: deploy
ms.sitesec: library
ms.pagetype: security
f1.keywords:
- NOCSH
ms.author: lomayor
author: lomayor
ms.localizationpriority: medium
manager: dansimp
audience: ITPro
ms.collection:
- M365-security-compliance
- m365initiative-m365-defender
ms.topic: article
ms.technology: m365d
ms.openlocfilehash: 462ba35f584b45bbfeb0d8a3de3b118ba1c9e17c
ms.sourcegitcommit: 855719ee21017cf87dfa98cbe62806763bcb78ac
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/22/2021
ms.locfileid: "49932326"
---
# <a name="work-with-advanced-hunting-query-results"></a>Работа с результатами запросов на расширенный поиск

[!INCLUDE [Microsoft 365 Defender rebranding](../includes/microsoft-defender.md)]


**Область применения:**
- Microsoft 365 Defender

[!INCLUDE [Prerelease information](../includes/prerelease.md)]

Вы можете создавать [](advanced-hunting-overview.md) расширенные поисковые запросы для получения очень точной информации, но вы также можете работать с результатами запроса, чтобы получить дополнительную информацию и изучить конкретные действия и индикаторы. С результатами запроса можно воспользоваться следующими действиями:

- Просмотр результатов в таблице или диаграмме
- Экспорт таблиц и диаграмм
- Детализация до подробных сведений об объектах
- Настройка запросов непосредственно из результатов или применение фильтров

## <a name="view-query-results-as-a-table-or-chart"></a>Просмотр результатов запроса в таблице или диаграмме
По умолчанию расширенный поиск отображает результаты запроса в качестве табличные данные. Вы также можете отобразить те же данные, что и диаграмму. Расширенный поиск поддерживает следующие представления:

| Тип представления | Описание |
| -- | -- |
| **Table** | Отображает результаты запроса в табулярном формате |
| **Диаграмма столбца** | Отрисовка ряда уникальных элементов на оси X в качестве вертикальных полос, высота которых представляет числимые значения из другого поля |
| **Диаграмма с стопкой столбца** | Отрисовка ряда уникальных элементов на оси X в качестве стеков вертикальных полос, высоты которых представляют числовые значения из одного или более других полей |
| **Круговая диаграмма** | Отрисовка секциональных кругов, представляющих уникальные элементы. Размер каждого кругового поля представляет числимые значения из другого поля. |
| **Диаграмма Donut** | Отрисовка секциональных дуг, представляющих уникальные элементы. Длина каждой дуги представляет числимые значения из другого поля. |
| **График** | Строит числимые значения для ряда уникальных элементов и связывает их |
| **Точечная диаграмма** | Строит числимые значения для ряда уникальных элементов |
| **Диаграмма области** | Занося числимые значения для ряда уникальных элементов и заполняя разделы под замещенными значениями |

### <a name="construct-queries-for-effective-charts"></a>Создание запросов для эффективных диаграмм
При отрисовки диаграмм расширенный поиск автоматически определяет интересующие столбцы и числовую сумму значений. Чтобы получить осмысленные диаграммы, соберите запросы, чтобы получить конкретные значения, которые вы хотите увидеть в визуализации. Вот несколько примеров запросов и итогов диаграмм.

#### <a name="alerts-by-severity"></a>Оповещения по степени серьезности
Используйте `summarize` оператор, чтобы получить числовую сумму значений, которые вы хотите отметить. В приведенной ниже запросе используется оператор для получения количества оповещений `summarize` по степени серьезности.

```kusto
AlertInfo
| summarize Total = count() by Severity
```
При отрисовки результатов диаграмма столбца отображает каждое значение серьезности как отдельный столбец:

![Изображение результатов запроса на расширенный поиск, отображаемого в качестве результатов запроса диаграммы столбца для оповещений по степени серьезности, отображаемого ](../../media/advanced-hunting-column-chart.jpg)
 *в качестве диаграммы столбца*

#### <a name="alert-severity-by-operating-system"></a>Серьезность оповещений операционной системой
Оператор также можно использовать для подготовки результатов для значений диаграммы `summarize` из нескольких полей. Например, вам может потребоваться понять, как уровень серьезности оповещений распространяется между операционными системами (ОС). 

В приведенного ниже запросе используется оператор для получения сведений об ОС из таблицы, а затем используется для подсчета значений как в столбцах, так и `join` `DeviceInfo` в `summarize` `OSPlatform` `Severity` столбцах:

```kusto
AlertInfo
| join AlertEvidence on AlertId
| join DeviceInfo on DeviceId
| summarize Count = count() by OSPlatform, Severity 
```
Эти результаты лучше всего визуализируются с помощью диаграммы с стопкой:

![Изображение результатов запроса на расширенный поиск, отображаемого в качестве стека результатов запроса диаграммы для оповещений по ОС и степени серьезности, отображаемой в качестве ](../../media/advanced-hunting-stacked-chart.jpg)
 *стека диаграммы*

#### <a name="phishing-emails-across-top-ten-sender-domains"></a>Фишинговые сообщения электронной почты в десяти верхних доменах отправитель
Если вы имеете дело со списком значений, который не является конечным, можно использовать оператор для диаграммы только значения с большинством `Top` экземпляров. Например, чтобы получить десять доменов отправитель с наиболее фишинговыми электронными письмами, используйте запрос ниже:

```kusto
EmailEvents
| where PhishFilterVerdict == "Phish"
| summarize Count = count() by SenderFromDomain
| top 10 by Count
```
Используйте круговую диаграмму для эффективного показа распределения по верхним доменам:

![Изображение результатов запроса на расширенный поиск в круговой диаграмме с распределением фишинговых сообщений по доменам ](../../media/advanced-hunting-pie-chart.jpg)
 *отправитель*

#### <a name="file-activities-over-time"></a>Действия с файлами со временем
Используя оператор с функцией, вы можете проверять события, включающие `summarize` `bin()` определенный индикатор, с течением времени. В приведенного ниже запросе учитываются события, включающие файл с 30-минутными интервалами, для показа пиков активности, связанных `invoice.doc` с этим файлом:

```kusto
AppFileEvents
| union DeviceFileEvents
| where FileName == "invoice.doc"
| summarize FileCount = count() by bin(Timestamp, 30m)
```
На приведенной ниже графике четко выделены периоды времени с дополнительными действиями, связанными `invoice.doc` с: 

![Изображение результатов запроса на расширенный поиск, отображаемая в качестве графиковой графики, показывающая количество событий, связанных ](../../media/advanced-hunting-line-chart.jpg)
 *с файлом с течением времени*


## <a name="export-tables-and-charts"></a>Экспорт таблиц и диаграмм
После выполнения запроса выберите **"Экспорт",** чтобы сохранить результаты в локальный файл. Выбранное вами представление определяет, как экспортируются результаты:

- **Представление таблицы** — результаты запроса экспортируются в виде табулярной книги Microsoft Excel
- **Любая диаграмма** — результаты запроса экспортируются в формате JPEG отрисовки диаграммы

## <a name="drill-down-from-query-results"></a>Drill down from query results
Чтобы быстро проверить запись в результатах запроса, выберите соответствующую строку, чтобы открыть панель записей **inspect.** Панель предоставляет следующие сведения на основе выбранной записи:

- **Ресурсы —** обзор основных активов (почтовых ящиков, устройств и пользователей), найденных в записи, доставка доступной информации, например уровней риска и экспозиции
- **Дерево процессов** — создается для записей с информацией о процессе и обогащено с использованием доступной контекстной информации; Как правило, запросы, возвращая больше столбцов, могут привести к более богатым деревьям процессов.
- **Все сведения** — все значения из столбцов в записи  

![Изображение выбранной записи с панелью для проверки записи](../../media/mtp-ah/inspect-record.png)

Чтобы просмотреть дополнительные сведения об определенной сущности в результатах запроса, например компьютере, файле, пользователе, IP-адресе или URL-адресе, выберите идентификатор сущности, чтобы открыть подробную страницу профиля для этой сущности.

## <a name="tweak-your-queries-from-the-results"></a>Регулирование запросов на основе результатов
Чтобы оперативно улучшить свой запрос, нужно щелкнуть правой кнопкой мыши одно из значений в полученном наборе результатов. Предлагаемые варианты можно использовать для

- открытого поиска избранного значения (`==`)
- исключения избранного значения из запроса (`!=`)
- Чтобы добавить к своему запросу определенное значение, можно использовать дополнительные операторы, например, `contains`, `starts with` и`ends with` 

![Изображение набора результатов "Расширенный поиск"](../../media/advanced-hunting-results-filter.png)

## <a name="filter-the-query-results"></a>Фильтрация результатов запроса
Используя отображаемые справа фильтры, можно сформировать сводку о полученном наборе результатов. В каждом столбце есть раздел, в котором приводятся уникальные обнаруженные для этого столбца значения и количество экземпляров.

Уточните запрос, выбрав кнопки или кнопки для значений, которые вы хотите включить или исключить, а затем выбрав запрос `+` `-` **"Выполнить".**

![Изображение фильтра расширенного выслеживания](../../media/advanced-hunting-filter.png)

Использование фильтра с целью изменения запроса и отправка этого запроса позволяют получить новые соответствующие результаты.

## <a name="related-topics"></a>См. также
- [Обзор расширенной охоты на угрозы](advanced-hunting-overview.md)
- [Изучение языка запросов](advanced-hunting-query-language.md)
- [Использование общих запросов](advanced-hunting-shared-queries.md)
- [Охота на различных устройствах, в письмах, приложениях и удостоверениях](advanced-hunting-query-emails-devices.md)
- [Сведения о схеме](advanced-hunting-schema-tables.md)
- [Рекомендации по применению запросов](advanced-hunting-best-practices.md)
- [Обзор настраиваемых обнаружений](custom-detections-overview.md)
