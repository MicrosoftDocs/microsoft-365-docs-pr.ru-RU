---
title: Обнаружение и исправление нелегальных разрешений на согласие
f1.keywords:
- NOCSH
ms.author: tracyp
author: MSFTTracyp
manager: dansimp
ms.date: ''
audience: ITPro
ms.topic: article
ms.collection:
- o365_security_incident_response
- M365-security-compliance
ms.service: O365-seccomp
localization_priority: Normal
search.appverid:
- MET150
description: Сведения о том, как распознать и исправить незаконное согласие на атаку в Microsoft Office 365.
ms.custom: seo-marvel-apr2020
ms.openlocfilehash: a324c4427046480fe81f58fc810f020c87247032
ms.sourcegitcommit: df6cc8c2eb2a65c7668f2953b0f7ec783a596d15
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/13/2020
ms.locfileid: "44726804"
---
# <a name="detect-and-remediate-illicit-consent-grants"></a><span data-ttu-id="a5c9c-103">Обнаружение и исправление нелегальных разрешений на согласие</span><span class="sxs-lookup"><span data-stu-id="a5c9c-103">Detect and Remediate Illicit Consent Grants</span></span>

<span data-ttu-id="a5c9c-104">**Сводка**  Сведения о том, как распознать и исправить незаконное согласие на атаку в Office 365.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-104">**Summary**  Learn how to recognize and remediate the illicit consent grants attack in Office 365.</span></span>

## <a name="what-is-the-illicit-consent-grant-attack-in-office-365"></a><span data-ttu-id="a5c9c-105">Что такое незаконная атака на предоставление согласия в Office 365?</span><span class="sxs-lookup"><span data-stu-id="a5c9c-105">What is the illicit consent grant attack in Office 365?</span></span>

<span data-ttu-id="a5c9c-106">При атаке с незаконным предоставлением согласия злоумышленник создает приложение, зарегистрированное в Azure, которое запрашивает доступ к данным, например контактной информации, электронной почте или документам.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-106">In an illicit consent grant attack, the attacker creates an Azure-registered application that requests access to data such as contact information, email, or documents.</span></span> <span data-ttu-id="a5c9c-107">Затем злоумышленник выдает конечному пользователю разрешение на доступ к данным приложения через фишинг или путем добавления нелегального кода в доверенный веб-сайт.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-107">The attacker then tricks an end user into granting that application consent to access their data either through a phishing attack, or by injecting illicit code into a trusted website.</span></span> <span data-ttu-id="a5c9c-108">После получения согласия у нелегального приложения ему предоставляется доступ к данным на уровне учетной записи без необходимости в Организации.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-108">After the illicit application has been granted consent, it has account-level access to data without the need for an organizational account.</span></span> <span data-ttu-id="a5c9c-109">Обычные действия по исправлению, такие как сброс паролей для нарушений учетных записей или требование многофакторной проверки подлинности (MFA) для учетных записей, не являются эффективными при атаках этого типа, так как они являются сторонними приложениями и являются внешними по отношению к Организации.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-109">Normal remediation steps, like resetting passwords for breached accounts or requiring Multi-Factor Authentication (MFA) on accounts, are not effective against this type of attack, since these are third-party applications and are external to the organization.</span></span>

<span data-ttu-id="a5c9c-110">Эти атаки используют модель взаимодействия, которая предполагает, что объект, вызывающий эту информацию, является автоматизацией, а не человеком.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-110">These attacks leverage an interaction model which presumes the entity that is calling the information is automation and not a human.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="a5c9c-111">Вы считаете, что у вас возникли проблемы с незаконным согласием на предоставление разрешений из приложения, прямо сейчас?</span><span class="sxs-lookup"><span data-stu-id="a5c9c-111">Do you suspect you're experiencing problems with illicit consent-grants from an app, right now?</span></span> <span data-ttu-id="a5c9c-112">Microsoft Cloud App Security (МКАС) содержит средства для обнаружения, проверки и исправления приложений OAuth.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-112">Microsoft Cloud App Security (MCAS) has tools to detect, investigate, and remediate your OAuth apps.</span></span> <span data-ttu-id="a5c9c-113">В этой статье МКАС представлено руководство по [исследованию рискованных приложений OAuth](https://docs.microsoft.com/cloud-app-security/investigate-risky-oauth).</span><span class="sxs-lookup"><span data-stu-id="a5c9c-113">This MCAS article has a tutorial that outlines how to go about [investigating risky OAuth apps](https://docs.microsoft.com/cloud-app-security/investigate-risky-oauth).</span></span> <span data-ttu-id="a5c9c-114">Вы также можете задать [политики приложений OAuth](https://docs.microsoft.com/cloud-app-security/app-permission-policy) для исследования разрешений, запрошенных приложением, которые пользователи будут выполнять авторизацию для этих приложений, и при этом будут утверждать или отменять эти запросы разрешений.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-114">You can also set [OAuth app policies](https://docs.microsoft.com/cloud-app-security/app-permission-policy) to investigate app-requested permissions, which users are authorizing these apps, and widely approve or ban these permissions requests.</span></span>

## <a name="what-does-an-illicit-consent-grant-attack-look-like-in-office-365"></a><span data-ttu-id="a5c9c-115">Как выглядит незаконная атака на предоставление согласия в Office 365?</span><span class="sxs-lookup"><span data-stu-id="a5c9c-115">What does an illicit consent grant attack look like in Office 365?</span></span>

<span data-ttu-id="a5c9c-116">Необходимо выполнить поиск в **журнале аудита** , чтобы найти знаки, также называемые индикаторами нарушения безопасности (IOC) данной атаки.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-116">You need to search the **audit log** to find signs, also called Indicators of Compromise (IOC) of this attack.</span></span> <span data-ttu-id="a5c9c-117">Для организаций с множеством приложений, зарегистрированных с помощью Azure, и большим числом пользователей рекомендуется проанализировать предоставление разрешений в организациях еженедельно.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-117">For organizations with many Azure-registered applications and a large user base, the best practice is to review your organizations consent grants on a weekly basis.</span></span>

### <a name="steps-for-finding-signs-of-this-attack"></a><span data-ttu-id="a5c9c-118">Действия по поиску подписывания этой атаки</span><span class="sxs-lookup"><span data-stu-id="a5c9c-118">Steps for finding signs of this attack</span></span>

1. <span data-ttu-id="a5c9c-119">Откройте **центр соответствия требованиям по безопасности &** по адресу <https://protection.office.com> .</span><span class="sxs-lookup"><span data-stu-id="a5c9c-119">Open the **Security & Compliance Center** at <https://protection.office.com>.</span></span>

2. <span data-ttu-id="a5c9c-120">Перейдите к разделу **Поиск** и выберите пункт **Поиск в журнале аудита**.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-120">Navigate to **Search** and select **Audit log search**.</span></span>

3. <span data-ttu-id="a5c9c-121">Выполните поиск (все действия и все пользователи) и введите начальную и конечную даты, если необходимо, и нажмите кнопку **Поиск**.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-121">Search (all activities and all users) and enter the start date and end date if required and then click **Search**.</span></span>

4. <span data-ttu-id="a5c9c-122">Нажмите кнопку **фильтровать результаты** и введите согласие для приложения в поле **действие** .</span><span class="sxs-lookup"><span data-stu-id="a5c9c-122">Click **Filter results** and enter Consent to application in the **Activity** field.</span></span>

5. <span data-ttu-id="a5c9c-123">Щелкните результат, чтобы просмотреть сведения о действии.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-123">Click on the result to see the details of the activity.</span></span> <span data-ttu-id="a5c9c-124">Щелкните **Дополнительные сведения** , чтобы получить сведения о действии.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-124">Click **More Information** to get details of the activity.</span></span> <span data-ttu-id="a5c9c-125">Убедитесь, что для Исадминконтент задано значение true.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-125">Check to see if IsAdminContent is set to True.</span></span>

> [!NOTE]
> 
> <span data-ttu-id="a5c9c-126">Это может занять от 30 минут до 24 часов, чтобы соответствующая запись журнала аудита отображалась в результатах поиска после возникновения события.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-126">It can take from 30 minutes up to 24 hours for the corresponding audit log entry to be displayed in the search results after an event occurs.</span></span>
> 
> <span data-ttu-id="a5c9c-127">Время, в течение которого запись аудита сохраняется и может быть найдена в журнале аудита, зависит от подписки на Microsoft 365, а именно от типа лицензии, назначенной определенному пользователю.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-127">The length of time that an audit record is retained and searchable in the audit log depends on your Microsoft 365 subscription, and specifically the type of the license that is assigned to a specific user.</span></span> <span data-ttu-id="a5c9c-128">Дополнительные сведения см в разделе [журнал аудита](../../compliance/search-the-audit-log-in-security-and-compliance.md).</span><span class="sxs-lookup"><span data-stu-id="a5c9c-128">For more information, see [Audit log](../../compliance/search-the-audit-log-in-security-and-compliance.md).</span></span>
> 
> <span data-ttu-id="a5c9c-129">Если это значение равно true, это указывает на то, что кто с глобальным администратором может получить доступ к данным.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-129">If this value is true, it indicates that someone with Global Administrator access may have granted broad access to data.</span></span> <span data-ttu-id="a5c9c-130">Если это не предусмотрено, выполните действия для [подтверждения атаки](#how-to-confirm-an-attack).</span><span class="sxs-lookup"><span data-stu-id="a5c9c-130">If this is unexpected, take steps to [confirm an attack](#how-to-confirm-an-attack).</span></span>

## <a name="how-to-confirm-an-attack"></a><span data-ttu-id="a5c9c-131">Как проверить атаку</span><span class="sxs-lookup"><span data-stu-id="a5c9c-131">How to confirm an attack</span></span>

<span data-ttu-id="a5c9c-132">Если у вас есть один или несколько экземпляров Иокс, указанных выше, необходимо провести дальнейшее исследование, чтобы подтвердить возникновение атаки.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-132">If you have one or more instances of the IOCs listed above, you need to do further investigation to positively confirm that the attack occurred.</span></span> <span data-ttu-id="a5c9c-133">Вы можете использовать любой из этих трех методов для подтверждения атаки:</span><span class="sxs-lookup"><span data-stu-id="a5c9c-133">You can use any of these three methods to confirm the attack:</span></span>

- <span data-ttu-id="a5c9c-134">Приложения инвентаризации и их разрешения с помощью портала Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-134">Inventory applications and their permissions using the Azure Active Directory portal.</span></span> <span data-ttu-id="a5c9c-135">Этот метод является исчерпывающим, но вы можете проверять только одного пользователя за раз, что может занять много времени, если у вас много пользователей для проверки.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-135">This method is thorough, but you can only check one user at a time which can be very time consuming if you have many users to check.</span></span>

- <span data-ttu-id="a5c9c-136">Приложения инвентаризации и их разрешения с помощью PowerShell.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-136">Inventory applications and their permissions using PowerShell.</span></span> <span data-ttu-id="a5c9c-137">Это самый быстрый и наиболее тщательный метод, с минимальным количеством издержек.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-137">This is the fastest and most thorough method, with the least amount of overhead.</span></span>

- <span data-ttu-id="a5c9c-138">Попросите пользователей проверить свои приложения и разрешения и отправить результаты обратно администраторам для исправления.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-138">Have your users individually check their apps and permissions and report the results back to the administrators for remediation.</span></span>

## <a name="inventory-apps-with-access-in-your-organization"></a><span data-ttu-id="a5c9c-139">Инвентаризация приложений с доступом в Организации</span><span class="sxs-lookup"><span data-stu-id="a5c9c-139">Inventory apps with access in your organization</span></span>

<span data-ttu-id="a5c9c-140">Это можно сделать для пользователей с помощью портала Azure Active Directory или с помощью PowerShell или попросите пользователей отдельно перечислить доступ к приложениям.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-140">You can do this for your users with either the Azure Active Directory Portal, or PowerShell or have your users individually enumerate their application access.</span></span>

### <a name="steps-for-using-the-azure-active-directory-portal"></a><span data-ttu-id="a5c9c-141">Действия по использованию портала Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="a5c9c-141">Steps for using the Azure Active Directory Portal</span></span>

<span data-ttu-id="a5c9c-142">Вы можете найти приложения, которым любой отдельный пользователь предоставил разрешения с помощью [портала Azure Active Directory](https://portal.azure.com/).</span><span class="sxs-lookup"><span data-stu-id="a5c9c-142">You can look up the applications to which any individual user has granted permissions by using the [Azure Active Directory Portal](https://portal.azure.com/).</span></span>

1. <span data-ttu-id="a5c9c-143">Войдите на портал Azure с правами администратора.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-143">Sign in to the Azure Portal with administrative rights.</span></span>

2. <span data-ttu-id="a5c9c-144">Выберите колонку Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-144">Select the Azure Active Directory blade.</span></span>

3. <span data-ttu-id="a5c9c-145">Выберите пункт **Пользователи**.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-145">Select **Users**.</span></span>

4. <span data-ttu-id="a5c9c-146">Выберите пользователя, которого вы хотите просмотреть.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-146">Select the user that you want to review.</span></span>

5. <span data-ttu-id="a5c9c-147">Выберите пункт **приложения**.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-147">Select **Applications**.</span></span>

<span data-ttu-id="a5c9c-148">Отобразятся приложения, назначенные пользователю, и разрешения, доступные приложениям.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-148">This will show you the apps that are assigned to the user and what permissions the applications have.</span></span>

### <a name="steps-for-having-your-users-enumerate-their-application-access"></a><span data-ttu-id="a5c9c-149">Действия по перечислению доступа пользователей к приложениям</span><span class="sxs-lookup"><span data-stu-id="a5c9c-149">Steps for having your users enumerate their application access</span></span>

<span data-ttu-id="a5c9c-150">Попросите пользователей перейти на https://myapps.microsoft.com свой собственный доступ к приложениям и просмотреть их.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-150">Have your users go to https://myapps.microsoft.com and review their own application access there.</span></span> <span data-ttu-id="a5c9c-151">Они должны иметь возможность просматривать все приложения с доступом, просматривать подробные сведения о них (в том числе область доступа), а также отменять права на подозрительные или незаконные приложения.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-151">They should be able to see all the apps with access, view details about them (including the scope of access), and be able to revoke privileges to suspicious or illicit apps.</span></span>

### <a name="steps-for-doing-this-with-powershell"></a><span data-ttu-id="a5c9c-152">Действия для этого с помощью PowerShell</span><span class="sxs-lookup"><span data-stu-id="a5c9c-152">Steps for doing this with PowerShell</span></span>

<span data-ttu-id="a5c9c-153">Самый простой способ проверить, может ли атака с незаконным предоставлением согласия выполнить [Get-AzureADPSPermissions.ps1](https://gist.github.com/psignoret/41793f8c6211d2df5051d77ca3728c09), в результате чего будут выведены все разрешения OAuth и приложения OAuth для всех пользователей в вашей организации в один CSV-файл.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-153">The simplest way to verify the Illicit Consent Grant attack is to run [Get-AzureADPSPermissions.ps1](https://gist.github.com/psignoret/41793f8c6211d2df5051d77ca3728c09), which will dump all the OAuth consent grants and OAuth apps for all users in your tenancy into one .csv file.</span></span>

#### <a name="pre-requisites"></a><span data-ttu-id="a5c9c-154">Необходимые условия</span><span class="sxs-lookup"><span data-stu-id="a5c9c-154">Pre-requisites</span></span>

- <span data-ttu-id="a5c9c-155">Библиотека Azure AD PowerShell установлена.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-155">The Azure AD PowerShell library installed.</span></span>

- <span data-ttu-id="a5c9c-156">Права глобального администратора клиента, для которого будет выполняться скрипт.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-156">Global administrator rights on the tenant that the script will be run against.</span></span>

- <span data-ttu-id="a5c9c-157">Локальный администратор компьютера, на котором будут выполняться сценарии.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-157">Local Administrator on the computer from which will run the scripts.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="a5c9c-158">***Настоятельно рекомендуется*** требовать многофакторную проверку подлинности для учетной записи администратора.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-158">We ***highly recommend*** that you require multi-factor authentication on your administrative account.</span></span> <span data-ttu-id="a5c9c-159">Этот скрипт поддерживает проверку подлинности MFA.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-159">This script supports MFA authentication.</span></span>

1. <span data-ttu-id="a5c9c-160">Войдите на компьютер, на котором будет выполняться сценарий с правами локального администратора.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-160">Sign in to the computer that you will run the script from with local administrator rights.</span></span>

2. <span data-ttu-id="a5c9c-161">Скачайте или скопируйте скрипт [Get-AzureADPSPermissions.ps1](https://gist.github.com/psignoret/41793f8c6211d2df5051d77ca3728c09) из GitHub в папку, из которой будет выполняться сценарий.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-161">Download or copy the [Get-AzureADPSPermissions.ps1](https://gist.github.com/psignoret/41793f8c6211d2df5051d77ca3728c09) script from GitHub to a folder from which you will run the script.</span></span> <span data-ttu-id="a5c9c-162">Это будет та же папка, в которую будет записан выходной файл "permissions.csv".</span><span class="sxs-lookup"><span data-stu-id="a5c9c-162">This will be the same folder to which the output "permissions.csv" file will be written.</span></span>

3. <span data-ttu-id="a5c9c-163">Откройте экземпляр PowerShell от имени администратора и откройте папку, в которую вы сохранили скрипт.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-163">Open a PowerShell instance as an administrator and open to the folder you saved the script to.</span></span>

4. <span data-ttu-id="a5c9c-164">Подключитесь к каталогу с помощью командлета [Connect – AzureAD](https://docs.microsoft.com/powershell/module/azuread/connect-azuread) .</span><span class="sxs-lookup"><span data-stu-id="a5c9c-164">Connect to your directory using the [Connect-AzureAD](https://docs.microsoft.com/powershell/module/azuread/connect-azuread) cmdlet.</span></span>

5. <span data-ttu-id="a5c9c-165">Выполните следующую команду PowerShell:</span><span class="sxs-lookup"><span data-stu-id="a5c9c-165">Run this PowerShell command:</span></span>

   ```powershell
   Get-AzureADPSPermissions.ps1 | Export-csv -Path "Permissions.csv" -NoTypeInformation
   ```

<span data-ttu-id="a5c9c-166">Сценарий создает один файл с именем Permissions.csv.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-166">The script produces one file named Permissions.csv.</span></span> <span data-ttu-id="a5c9c-167">Выполните следующие действия, чтобы найти незаконные предоставления разрешений приложений:</span><span class="sxs-lookup"><span data-stu-id="a5c9c-167">Follow these steps to look for illicit application permission grants:</span></span>

1. <span data-ttu-id="a5c9c-168">В столбце Консенттипе (столбец G) найдите значение "АллпринЦиплес".</span><span class="sxs-lookup"><span data-stu-id="a5c9c-168">In the ConsentType column (column G) search for the value "AllPrinciples".</span></span> <span data-ttu-id="a5c9c-169">Разрешение АллпринЦипалс позволяет клиентскому приложению получать доступ к контенту всех пользователей в Организации.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-169">The AllPrincipals permission allows the client application to access everyone's content in the tenancy.</span></span> <span data-ttu-id="a5c9c-170">Встроенные приложения Microsoft 365 требуют, чтобы это разрешение работало правильно.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-170">Native Microsoft 365 applications need this permission to work correctly.</span></span> <span data-ttu-id="a5c9c-171">Следует внимательно проанализировать все приложения, отличные от Майкрософт, с этим разрешением.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-171">Every non-Microsoft application with this permission should be reviewed carefully.</span></span>

2. <span data-ttu-id="a5c9c-172">В столбце Permission (Column F) просмотрите разрешения, которые у каждого делегированного приложения есть в содержимом.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-172">In the Permission column (column F) review the permissions that each delegated application has to content.</span></span> <span data-ttu-id="a5c9c-173">Ищите разрешение "чтение" и "запись" или "\*. Разрешение ALL и внимательно изучите их, так как они могут быть неуместны.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-173">Look for "Read" and "Write" permission or "\*.All" permission, and review these carefully because they may not be appropriate.</span></span>

3. <span data-ttu-id="a5c9c-174">Изучите определенных пользователей, которым предоставлены полученные разрешения.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-174">Review the specific users that have consents granted.</span></span> <span data-ttu-id="a5c9c-175">Если высокая или высокая степень влияния на пользователей приводят к неприемлемому получению, следует проанализировать дополнительные сведения.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-175">If high profile or high impact users have inappropriate consents granted, you should investigate further.</span></span>

4. <span data-ttu-id="a5c9c-176">В столбце Клиентдисплайнаме (столбец C) найдите приложения, которые кажутся подозрительными.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-176">In the ClientDisplayName column (column C) look for apps that seem suspicious.</span></span> <span data-ttu-id="a5c9c-177">Приложения с неправильными именами, именами Super Бланд или звуковыми названиями хакеров следует внимательно рассмотреть.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-177">Apps with misspelled names, super bland names, or hacker-sounding names should be reviewed carefully.</span></span>

## <a name="determine-the-scope-of-the-attack"></a><span data-ttu-id="a5c9c-178">Определение области атаки</span><span class="sxs-lookup"><span data-stu-id="a5c9c-178">Determine the scope of the attack</span></span>

<span data-ttu-id="a5c9c-179">Завершив инвентаризацию доступа к приложению, просмотрите **журнал аудита** , чтобы определить полную область нарушения.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-179">After you have finished inventorying application access, review the **audit log** to determine the full scope of the breach.</span></span> <span data-ttu-id="a5c9c-180">Поиск затронутых пользователей, временных кадров, к которым приложение было незаконно получило доступ к вашей организации, а также разрешения, которые имело приложение.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-180">Search on the affected users, the time frames that the illicit application had access to your organization, and the permissions the app had.</span></span> <span data-ttu-id="a5c9c-181">Вы можете выполнить поиск в **журнале аудита** в [центре безопасности и соответствия требованиям Microsoft 365](https://docs.microsoft.com/microsoft-365/compliance/search-the-audit-log-in-security-and-compliance).</span><span class="sxs-lookup"><span data-stu-id="a5c9c-181">You can search the **audit log** in the [Microsoft 365 Security and Compliance Center](https://docs.microsoft.com/microsoft-365/compliance/search-the-audit-log-in-security-and-compliance).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="a5c9c-182">Для получения этих сведений необходимо включить [Аудит и](https://docs.microsoft.com/microsoft-365/compliance/enable-mailbox-auditing) [Аудит действий для администраторов и пользователей,](https://docs.microsoft.com/microsoft-365/compliance/turn-audit-log-search-on-or-off) прежде чем приступить к атакам.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-182">[Mailbox auditing](https://docs.microsoft.com/microsoft-365/compliance/enable-mailbox-auditing) and [Activity auditing for admins and users](https://docs.microsoft.com/microsoft-365/compliance/turn-audit-log-search-on-or-off) must have been enabled prior to the attack for you to get this information.</span></span>

## <a name="how-to-stop-and-remediate-an-illicit-consent-grant-attack"></a><span data-ttu-id="a5c9c-183">Как отказаться от атак с незаконным предоставлением согласия</span><span class="sxs-lookup"><span data-stu-id="a5c9c-183">How to stop and remediate an illicit consent grant attack</span></span>

<span data-ttu-id="a5c9c-184">После определения приложения с незаконными разрешениями вы можете удалить этот доступ несколькими способами.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-184">After you have identified an application with illicit permissions, you have several ways to remove that access.</span></span>

- <span data-ttu-id="a5c9c-185">Вы можете отозвать разрешение приложения на портале Azure Active Directory, выполнив следующие действия:</span><span class="sxs-lookup"><span data-stu-id="a5c9c-185">You can revoke the application's permission in the Azure Active Directory Portal by:</span></span>

  - <span data-ttu-id="a5c9c-186">Перейдите к затронутому пользователю в колонке **пользователя Azure Active Directory** .</span><span class="sxs-lookup"><span data-stu-id="a5c9c-186">Navigate to the affected user in the **Azure Active Directory User** blade.</span></span>

  - <span data-ttu-id="a5c9c-187">Выберите пункт **приложения**.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-187">Select **Applications**.</span></span>

  - <span data-ttu-id="a5c9c-188">Выберите нелегальное приложение.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-188">Select the illicit application.</span></span>

  - <span data-ttu-id="a5c9c-189">Нажмите кнопку **Удалить** в разделе Детализация.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-189">Click **Remove** in the drill down.</span></span>

- <span data-ttu-id="a5c9c-190">Вы можете отозвать предоставление согласия OAuth с помощью PowerShell, выполнив действия, описанные в командлете [Remove – AzureADOAuth2PermissionGrant](https://docs.microsoft.com/powershell/module/azuread/Remove-AzureADOAuth2PermissionGrant).</span><span class="sxs-lookup"><span data-stu-id="a5c9c-190">You can revoke the OAuth consent grant with PowerShell by following the steps in [Remove-AzureADOAuth2PermissionGrant](https://docs.microsoft.com/powershell/module/azuread/Remove-AzureADOAuth2PermissionGrant).</span></span>

- <span data-ttu-id="a5c9c-191">Вы можете отозвать назначение роли приложения службы с помощью PowerShell, выполнив действия, описанные в статье [Remove – азуреадсервицеаппролеассигнмент](https://docs.microsoft.com/powershell/module/azuread/Remove-AzureADServiceAppRoleAssignment).</span><span class="sxs-lookup"><span data-stu-id="a5c9c-191">You can revoke the Service App Role Assignment with PowerShell by following the steps in [Remove-AzureADServiceAppRoleAssignment](https://docs.microsoft.com/powershell/module/azuread/Remove-AzureADServiceAppRoleAssignment).</span></span>

- <span data-ttu-id="a5c9c-192">Вы также можете отключить вход в затронутую учетную запись, что в свою очередь отключит доступ приложений к данным в этой учетной записи.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-192">You can also disable sign-in for the affected account altogether, which will in turn disable app access to data in that account.</span></span> <span data-ttu-id="a5c9c-193">Это не является идеальным условием для продуктивности конечного пользователя, но если вы работаете над ограничениями на снижение влияния, это может быть приемлемым краткосрочным исправлением.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-193">This isn't ideal for the end user's productivity, of course, but if you are working to limit impact quickly, it can be a viable short-term remediation.</span></span>

- <span data-ttu-id="a5c9c-194">Вы можете отключить интегрированные приложения для вашего клиента.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-194">You can turn integrated applications off for your tenancy.</span></span> <span data-ttu-id="a5c9c-195">Это радикальный этап, который отключает возможность предоставления конечным пользователям разрешения на уровне клиента.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-195">This is a drastic step that disables the ability for end users to grant consent on a tenant-wide basis.</span></span> <span data-ttu-id="a5c9c-196">Это предотвратит непреднамеренное предоставление пользователям доступа к вредоносному приложению.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-196">This prevents your users from inadvertently granting access to a malicious application.</span></span> <span data-ttu-id="a5c9c-197">Это не рекомендуется, так как серьезно снижает способность пользователей работать с приложениями сторонних производителей.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-197">This isn't strongly recommended as it severely impairs your users' ability to be productive with third party applications.</span></span> <span data-ttu-id="a5c9c-198">Для этого выполните действия, описанные в статье [Включение и отключение интегрированных приложений](https://docs.microsoft.com/microsoft-365/admin/misc/integrated-apps).</span><span class="sxs-lookup"><span data-stu-id="a5c9c-198">You can do this by following the steps in [Turning Integrated Apps on or off](https://docs.microsoft.com/microsoft-365/admin/misc/integrated-apps).</span></span>

## <a name="secure-microsoft-365-like-a-cybersecurity-pro"></a><span data-ttu-id="a5c9c-199">Защитите Microsoft 365 на профессиональном уровне</span><span class="sxs-lookup"><span data-stu-id="a5c9c-199">Secure Microsoft 365 like a cybersecurity pro</span></span>

<span data-ttu-id="a5c9c-200">Для вашей подписки Microsoft 365 предусмотрен целый ряд полезных функций безопасности, которые можно использовать для защиты ваших данных и пользователей.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-200">Your Microsoft 365 subscription comes with a powerful set of security capabilities that you can use to protect your data and your users.</span></span> <span data-ttu-id="a5c9c-201">Используйте статью к [Стратегия развития безопасности Microsoft 365: приоритеты на первые 30 дней, 90 дней и далее](security-roadmap.md), чтобы применить лучшие методики, рекомендованные корпорацией Майкрософт, для защиты вашего клиента Microsoft 365.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-201">Use the [Microsoft 365 security roadmap - Top priorities for the first 30 days, 90 days, and beyond](security-roadmap.md) to implement Microsoft recommended best practices for securing your Microsoft 365 tenant.</span></span>

- <span data-ttu-id="a5c9c-202">Задачи для выполнения в первые 30 дней.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-202">Tasks to accomplish in the first 30 days.</span></span> <span data-ttu-id="a5c9c-203">Они дают немедленный эффект и не создают помех вашим пользователям.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-203">These have immediate affect and are low-impact to your users.</span></span>

- <span data-ttu-id="a5c9c-204">Задачи для выполнения в течение 90 дней.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-204">Tasks to accomplish in 90 days.</span></span> <span data-ttu-id="a5c9c-205">Эти задачи требуют немного больше времени на планирование и реализацию, но значительно укрепляют вашу безопасность.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-205">These take a bit more time to plan and implement but greatly improve your security posture.</span></span>

- <span data-ttu-id="a5c9c-206">Более 90 дней.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-206">Beyond 90 days.</span></span> <span data-ttu-id="a5c9c-207">Эти меры дополняют ваши действия в течение первых 90 дней.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-207">These enhancements build in your first 90 days work.</span></span>

## <a name="see-also"></a><span data-ttu-id="a5c9c-208">См. также:</span><span class="sxs-lookup"><span data-stu-id="a5c9c-208">See also:</span></span>

- <span data-ttu-id="a5c9c-209">[Неожиданное приложение в списке "Мои приложения](https://docs.microsoft.com/azure/active-directory/application-access-unexpected-application) " просматривает администраторов с помощью различных действий, которые могут потребоваться после реализации приложений с доступом к данным.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-209">[Unexpected application in my applications list](https://docs.microsoft.com/azure/active-directory/application-access-unexpected-application) walks administrators through various actions they may want to take after realizing there are unexpected applications with access to data.</span></span>

- <span data-ttu-id="a5c9c-210">[Интеграция приложений с Azure Active Directory](https://docs.microsoft.com/azure/active-directory/active-directory-apps-permissions-consent) — это высокоуровневый обзор разрешений и разрешений.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-210">[Integrating applications with Azure Active Directory](https://docs.microsoft.com/azure/active-directory/active-directory-apps-permissions-consent) is a high-level overview of consent and permissions.</span></span>

- <span data-ttu-id="a5c9c-211">[Проблемы при разработке приложения](https://docs.microsoft.com/azure/active-directory/active-directory-application-dev-development-content-map) предоставляет ссылки на различные статьи, связанные с согласием.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-211">[Problems developing my application](https://docs.microsoft.com/azure/active-directory/active-directory-application-dev-development-content-map) provides links to various consent related articles.</span></span>

- <span data-ttu-id="a5c9c-212">[Объекты приложения и субъекта-службы в Azure Active Directory (Azure AD)](https://docs.microsoft.com/azure/active-directory/develop/active-directory-application-objects) предоставляет общие сведения об основных объектах приложения и службы, которые являются основными для модели приложения.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-212">[Application and service principal objects in Azure Active Directory (Azure AD)](https://docs.microsoft.com/azure/active-directory/develop/active-directory-application-objects) provides an overview of the Application and Service principal objects that are core to the application model.</span></span>

- <span data-ttu-id="a5c9c-213">[Управление доступом к приложениям](https://docs.microsoft.com/azure/active-directory/active-directory-managing-access-to-apps) — обзор возможностей, которые администраторы могут использовать для управления доступом пользователей к приложениям.</span><span class="sxs-lookup"><span data-stu-id="a5c9c-213">[Manage access to apps](https://docs.microsoft.com/azure/active-directory/active-directory-managing-access-to-apps) is an overview of the capabilities that administrators have to manage user access to apps.</span></span>
