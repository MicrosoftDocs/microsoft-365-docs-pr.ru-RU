---
title: Настройка параметров нежелательной почты в почтовых ящиках Exchange Online
ms.author: chrisda
author: chrisda
manager: dansimp
ms.date: ''
audience: Admin
ms.topic: how-to
localization_priority: Normal
search.appverid:
- MOE150
- MED150
- MBS150
- MET150
ms.collection:
- M365-security-compliance
description: Администраторы могут узнать, как настроить параметры нежелательной почты в почтовых ящиках Exchange Online. Многие из этих параметров доступны пользователям в Outlook или Outlook в Интернете.
ms.technology: mdo
ms.prod: m365-security
ms.openlocfilehash: f7e5d99198e539a46c240fadd2a7a8201236026f
ms.sourcegitcommit: dcb97fbfdae52960ae62b6faa707a05358193ed5
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/25/2021
ms.locfileid: "51204981"
---
# <a name="configure-junk-email-settings-on-exchange-online-mailboxes"></a>Настройка параметров нежелательной почты в почтовых ящиках Exchange Online

[!INCLUDE [Microsoft 365 Defender rebranding](../includes/microsoft-defender-for-office.md)]

**Область применения**
- [Exchange Online Protection](exchange-online-protection-overview.md)
- [Microsoft Defender для Office 365 (план 1 и план 2)](defender-for-office-365.md)
- [Microsoft 365 Defender](../defender/microsoft-365-defender.md)

В microsoft 365 организациях с почтовыми ящиками в Exchange Online организационные параметры защиты от нежелательной почты контролируются Exchange Online Protection (EOP). Дополнительные сведения см. в [сообщении о защите от нежелательной почты в EOP.](anti-spam-protection.md)

Но существуют также определенные параметры борьбы со спамом, которые администраторы могут настроить на отдельных почтовых ящиках в Exchange Online:

- **Включайте** или отключайте правило нежелательной почты. Правило нежелательной почты — это правило скрытого почтового ящика с именем Правило нежелательной почты, включенное по умолчанию в каждом почтовом ящике. Правило нежелательной почты управляет следующими функциями:

  - Перемещение сообщений в папку нежелательной почты на основе политики по борьбе со спамом. Когда политика по борьбе со спамом настроена с помощью действия Переместить сообщение нежелательной почты в папку нежелательной почты для решения фильтра нежелательной почты, правило фильтра нежелательной почты перемещает сообщение в папку нежелательной почты после доставки сообщения в почтовый ящик.   Дополнительные сведения о решениях по фильтрации нежелательной почты в политиках по борьбе со спамом см. в рублях [Configure anti-spam policies in EOP.](configure-your-spam-filter-policies.md) Аналогичным образом, если авточистка с нулевой часовой отметкой (ZAP) определяет доставленное сообщение как нежелательное  или фишинговое, правило фильтра нежелательной почты перемещает сообщение в папку нежелательной почты для перемещения сообщения в нежелательной папке нежелательной почты, фильтруя действия по фильтрации вердикта. Дополнительные сведения о ZAP см. в [веб-сайте Zero-hour auto purge (ZAP) в Exchange Online.](zero-hour-auto-purge.md)

  - **Нежелательные параметры** электронной почты, которые пользователи настраивают для себя в Outlook или Outlook в Интернете: коллекция _safelist_ — это список безопасных отправителей, список безопасных получателей и список заблокированных отправителей на каждом почтовом ящике. Записи в этих списках определяют, перемещает ли правило нежелательной почты сообщение в папку "Входящие" или папку нежелательной почты. Пользователи могут настроить коллекцию safelist для собственного почтового ящика в Outlook или Outlook в Интернете (ранее известный как Outlook Web App). Администраторы могут настроить коллекцию safelist на любом почтовом ящике пользователя.

Когда правило нежелательной почты включено в почтовом ящике, EOP может перемещать сообщения в папку нежелательной почты на основе действия по фильтрации нежелательной почты Переместить сообщение в папку нежелательной почты или список заблокированных отправителей в почтовом ящике, а также запретить доставку сообщений в папку нежелательной почты (на основе списка безопасных отправителей в почтовом ящике). 

 Если правило нежелательной почты отключено в почтовом ящике, EOP не может переместить сообщения в папку нежелательной почты на основе действия по фильтрации нежелательной почты **Перемещение** сообщения в папку нежелательной почты или коллекцию безопасных списков в почтовом ящике.

Администраторы могут использовать Exchange Online PowerShell, чтобы отключить, включить и просмотреть состояние правила нежелательной почты в почтовых ящиках. Администраторы также могут использовать Exchange Online PowerShell для настройки записей в коллекции safelist в почтовых ящиках (список безопасных отправителей, список безопасных получателей и список заблокированных отправителей).

> [!NOTE]
> Сообщения от отправителей, добавленных пользователями в собственные списки безопасных отправителей, пропускают фильтрацию подключения в рамках EOP (SCL —1). Чтобы запретить пользователям добавлять записи в список безопасных отправителей в Outlook, используйте групповую политику, как упоминалось в разделе О нежелательных настройках электронной почты в разделе  [Outlook](#about-junk-email-settings-in-outlook) в этой статье. Фильтрация политик, фильтрация контента и проверки Defender для Office 365 будут по-прежнему применяться к сообщениям.

## <a name="what-do-you-need-to-know-before-you-begin"></a>Что нужно знать перед началом работы

- Процедуры в этой статье можно использовать только в Exchange Online PowerShell. Сведения о том, как подключиться к Exchange Online PowerShell, см. в статье [Подключение к Exchange Online PowerShell](/powershell/exchange/connect-to-exchange-online-powershell).

- Вам необходимо получить разрешения в Exchange Online, прежде чем вы сможете сделать процедуры в этой статье. В частности, вам  потребуется роль получателей почты (которая назначена группам  ролей "Управление организацией", "Управление получателями" и "Пользовательские группы  получателей почты" по умолчанию) или роль **"Параметры** пользователей" (которая по умолчанию назначена группам ролей "Управление организацией" и "Службы поддержки").    Чтобы добавить пользователей в группы ролей в Exchange Online, см. в рублях Изменение групп [ролей в Exchange Online.](/Exchange/permissions-exo/role-groups#modify-role-groups) Обратите внимание, что пользователи с разрешениями по умолчанию могут делать эти же процедуры на собственном почтовом ящике, если у них есть доступ к [PowerShell Exchange Online.](/powershell/exchange/disable-access-to-exchange-online-powershell)

- В автономных средах EOP, в которых EOP защищает локальные почтовые ящики Exchange, требуется настроить правила потока обработки почты (также называемые правилами транспорта) в локальной среде Exchange для преобразования решения фильтра нежелательной почты EOP, чтобы правило нежелательной почты могло перемещать сообщение в папку "Нежелательная почта". Дополнительные сведения см. в статье [Настройка автономной службы EOP для доставки спама в папку нежелательной почты в гибридных средах](ensure-that-spam-is-routed-to-each-user-s-junk-email-folder.md).

- Безопасные отправители для общих почтовых ящиков не синхронизируются с Azure AD и EOP по дизайну.

## <a name="use-exchange-online-powershell-to-enable-or-disable-the-junk-email-rule-in-a-mailbox"></a>Используйте Exchange Online PowerShell, чтобы включить или отключить правило нежелательной почты в почтовом ящике

> [!NOTE]
> Для отключения правила нежелательной почты в почтовом ящике, открываемом в Outlook (в режиме кэширования Exchange) или Outlook в Интернете, вы можете использовать только комлет **Set-MailboxJunkEmailConfiguration.** Если почтовый ящик не открыт, вы получите ошибку. Если вы хотите подавить эту ошибку для массовых операций, вы можете добавить в команду `The Junk Email configuration couldn't be set. The user needs to sign in to Outlook Web App before they can modify their Safe Senders and Recipients or Blocked Senders lists.` `-ErrorAction SilentlyContinue` **Set-MailboxJunkEmailConfiguration.**

Чтобы включить или отключить правило нежелательной почты для почтового ящика, используйте следующий синтаксис:

```PowerShell
Set-MailboxJunkEmailConfiguration -Identity <MailboxIdentity> -Enabled <$true | $false>
```

Пример отключения правила нежелательной почты для почтового ящика пользователя Ori Epstein.

```PowerShell
Set-MailboxJunkEmailConfiguration -Identity "Ori Epstein" -Enabled $false
```

Пример отключения правила нежелательной почты для всех почтовых ящиков пользователей организации.

```PowerShell
$All = Get-Mailbox -RecipientTypeDetails UserMailbox -ResultSize Unlimited; $All | foreach {Set-MailboxJunkEmailConfiguration $_.Name -Enabled $false}
```

Подробные сведения о синтаксисах и параметрах см. в [инструкции Set-MailboxJunkEmailConfiguration.](/powershell/module/exchange/set-mailboxjunkemailconfiguration)

> [!NOTE]
>
> - Если пользователь никогда не открывал почтовый ящик, при запуске предыдущей команды может возникнуть ошибка. Чтобы подавить эту ошибку для массовых операций, добавьте команду `-ErrorAction SilentlyContinue` **Set-MailboxJunkEmailConfiguration.**
>
> - Даже если вы отключили правило нежелательной почты, фильтр нежелательной почты Outlook (в зависимости от того, как оно настроено) также может определить, является ли сообщение спамом, и может перемещать сообщения в папку "Входящие" или нежелательной почты на основе собственного вердикта о нежелательной почте и коллекции безопасных списков на почтовом ящике. Дополнительные сведения см. в разделе [О нежелательных настройках](#about-junk-email-settings-in-outlook) электронной почты в разделе Outlook в этой статье.

### <a name="how-do-you-know-this-worked"></a>Как проверить, что все получилось?

Чтобы убедиться в том, что правило нежелательной почты для почтового ящика успешно включено или отключено, воспользуйтесь любой из приведенных ниже процедур.

- Замените имя, псевдоним или адрес электронной почты почтового ящика и запустите следующую команду, чтобы проверить значение _\<MailboxIdentity\>_ свойства **Включено:**

  ```PowerShell
  Get-MailboxJunkEmailConfiguration -Identity "<MailboxIdentity>" | Format-List Enabled
  ```

## <a name="use-exchange-online-powershell-to-configure-the-safelist-collection-on-a-mailbox"></a>Используйте Exchange Online PowerShell для настройки коллекции safelist на почтовом ящике

В коллекцию списков надежных отправителей для почтового ящика входят списки надежных отправителей, надежных получателей и заблокированных отправителей. По умолчанию пользователи могут настроить коллекцию safelist на собственном почтовом ящике в Outlook или Outlook в Интернете. Администраторы же для настройки таких коллекций для почтовых ящиков пользователей могут воспользоваться командлетом **Set-MailboxJunkEmailConfiguration**. Соответствующие параметры описаны в таблице ниже.

****

|Параметр на Set-MailboxJunkEmailConfiguration|Outlook на веб-параметре|
|---|---|
|_BlockedSendersAndDomains_|**Перемещать электронную почту от этих отправителей и доменов в папку "Нежелательная почта"**|
|_ContactsTrusted_|**Доверять сообщениям электронной почты от моих контактов**|
|_TrustedListsOnly_|**Только доверяйте электронной почте с адресов в списке безопасных отправителей и доменов и списках безопасной рассылки**|
|_TrustedSendersAndDomains_<sup>\*</sup>|**Не перемещайте электронную почту от этих отправителей в папку нежелательной почты**|
|

<sup>\*</sup>**Примечания:**

- В Exchange Online **записи** доменов в списке безопасных отправителей или _параметре TrustedSendersAndDomains_ не распознаются, поэтому используйте только адреса электронной почты. В автономных EOP с синхронизацией каталогов записи доменов не синхронизируются по умолчанию, но можно включить синхронизацию для доменов. Дополнительные сведения см. в [kB3019657](https://support.microsoft.com/help/3019657).

- Вы не можете напрямую изменить список безопасных получателей с помощью комлета **Set-MailboxJunkEmailConfiguration** (параметр _TrustedRecipientsAndDomains_ не работает). Сначала нужно внести изменения в список надежных отправителей, и они синхронизируются со списком надежных получателей.

Для настройки коллекции списков надежных отправителей для почтового ящика следует использовать следующий синтаксис:

```PowerShell
Set-MailboxJunkEmailConfiguration <MailboxIdentity> -BlockedSendersAndDomains <EmailAddressesOrDomains | $null> -ContactsTrusted <$true | $false> -TrustedListsOnly <$true | $false> -TrustedSendersAndDomains  <EmailAddresses | $null>
```

Чтобы ввести несколько значений и перезаписать все существующие записи для параметров _BlockedSendersAndDomains_ и _TrustedSendersAndDomains,_ используйте следующий синтаксис: `"<Value1>","<Value2>"...` . Чтобы добавить или удалить одно или несколько значений без влияния на другие существующие записи, используйте следующий синтаксис: `@{Add="<Value1>","<Value2>"... ; Remove="<Value3>","<Value4>...}`

В примере ниже выполняется настройка следующих параметров для коллекции списков надежных отправителей в почтовом ящике пользователя Ori Epstein:

- Добавьте значение shopping@fabrikam.com в список заблокированных отправителей.

- Удалите значение chris@fourthcoffee.com из списка безопасных отправителей и списка безопасных получателей.

- настройка контактов в папке контактов как надежных отправителей.

```PowerShell
Set-MailboxJunkEmailConfiguration "Ori Epstein" -BlockedSendersAndDomains @{Add="shopping@fabrikam.com"} -TrustedSendersAndDomains @{Remove="chris@fourthcoffee.com"} -ContactsTrusted $true
```

Пример удаления домена contoso.com из списка заблокированных отправителей для всех почтовых ящиков пользователей организации.

```PowerShell
$All = Get-Mailbox -RecipientTypeDetails UserMailbox -ResultSize Unlimited; $All | foreach {Set-MailboxJunkEmailConfiguration $_.Name -BlockedSendersAndDomains @{Remove="contoso.com"}}
```

Подробные сведения о синтаксисах и параметрах см. в [инструкции Set-MailboxJunkEmailConfiguration.](/powershell/module/exchange/set-mailboxjunkemailconfiguration)

> [!NOTE]
>
> - Если пользователь никогда не открывал почтовый ящик, при запуске предыдущих команд может возникнуть ошибка. Чтобы подавить эту ошибку для массовых операций, добавьте команду `-ErrorAction SilentlyContinue` **Set-MailboxJunkEmailConfiguration.**
>
> - Даже если правило нежелательной почты отключено в почтовом ящике, можно настроить коллекцию безопасных списков, а фильтр нежелательной почты Outlook может перемещать сообщения в папку "Входящие" или папку нежелательной почты. Дополнительные сведения см. в разделе [О нежелательных настройках](#about-junk-email-settings-in-outlook) электронной почты в разделе Outlook в этой статье.
>
> - Фильтр нежелательной почты Outlook имеет дополнительные параметры коллекции safelist (например, автоматически добавляет людей, которых я отправляю по электронной почте, в список **безопасных отправителей).** Дополнительные сведения см. в [сообщении Use Junk Email Filters to control which messages you see.](https://support.microsoft.com/office/274ae301-5db2-4aad-be21-25413cede077)

### <a name="how-do-you-know-this-worked"></a>Как проверить, что все получилось?

Чтобы убедиться в том, что коллекция списков надежных отправителей для почтового ящика успешно настроена, воспользуйтесь любой из приведенных ниже процедур.

- Замените имя, псевдоним или адрес электронной почты почтового ящика и запустите следующую команду для проверки _\<MailboxIdentity\>_ значений свойств:

  ```PowerShell
  Get-MailboxJunkEmailConfiguration -Identity "<MailboxIdentity>" | Format-List trusted*,contacts*,blocked*
  ```

  Если список значений слишком длинный, используйте этот синтаксис:

  ```PowerShell
  (Get-MailboxJunkEmailConfiguration -Identity <MailboxIdentity>).BlockedSendersAndDomains
  ```

## <a name="about-junk-email-settings-in-outlook"></a>Сведения о параметрах нежелательной почты в Outlook

Чтобы включить, отключить и настроить параметры клиентского фильтра нежелательной почты, доступные в Outlook, используйте групповую политику. Дополнительные сведения см. в материалах [Administrative Template files (ADMX/ADML) и Office Customization Tool for Microsoft 365 Apps for enterprise, Office 2019 и Office 2016](https://www.microsoft.com/download/details.aspx?id=49030) и [How to deploy junk email settings, such as the Safe Senders list, by using Group Policy.](https://support.microsoft.com/help/2252421)

Когда фильтр нежелательной почты Outlook  задается значению "Нет автоматической фильтрации" в параметрах домашней нежелательной почты нежелательной почты, Outlook не пытается классифицировать массаж как спам, но по-прежнему использует коллекцию безопасных отправителей (список безопасных отправителей, список безопасных получателей и список заблокированных отправителей) для перемещения сообщений в папку нежелательной почты после  \>  \>  \> доставки. Дополнительные сведения об этих параметрах см. в [обзоре фильтра нежелательной почты.](https://support.microsoft.com/office/5ae3ea8e-cf41-4fa0-b02a-3b96e21de089)

Если для фильтра нежелательной почты Outlook выбран параметр **Низкий** или **Высокий**, то фильтр нежелательной почты Outlook использует собственную технологию фильтрации SmartScreen для определения и перемещения спама в папку "Нежелательная почта". Эта классификация нежелательной почты отделена от уровня доверия к нежелательной почте (SCL), определяемой EOP. На самом деле Outlook игнорирует SCL из EOP (если EOP не обозначит сообщение для пропуска фильтрации нежелательной почты) и использует собственные критерии, чтобы определить, является ли сообщение спамом. Конечно, не исключено, что вердикт о нежелательной почте от EOP и Outlook может быть одинаковым. Дополнительные сведения об этих параметрах см. в сообщении [Change the level of protection in the Junk Email Filter.](https://support.microsoft.com/office/e89c12d8-9d61-4320-8c57-d982c8d52f6b)

> [!NOTE]
> В ноябре 2016 г. Корпорация Майкрософт прекратила выпуск обновлений определений нежелательной почты для фильтров SmartScreen в Exchange и Outlook. Существующие определения нежелательной почты SmartScreen были оставлены на месте, но их эффективность со временем, скорее всего, будет ухудшаться. Дополнительные сведения см. в статье [Прекращение поддержки SmartScreen в Outlook и Exchange](https://techcommunity.microsoft.com/t5/exchange-team-blog/deprecating-support-for-smartscreen-in-outlook-and-exchange/ba-p/605332).

Таким образом, фильтр нежелательной почты Outlook может использовать коллекцию безопасных списков почтового ящика и собственную классификацию нежелательной почты для перемещения сообщений в папку нежелательной почты, даже если правило нежелательной почты отключено в почтовом ящике.

Outlook и Outlook в Интернете поддерживают коллекцию safelist. Коллекция safelist сохранена в почтовом ящике Exchange Online, поэтому изменения в коллекции safelist в Outlook отображаются в Outlook в Интернете и наоборот.

## <a name="limits-for-junk-email-settings"></a>Ограничения для параметров нежелательной почты

Коллекция safelist (список безопасных отправителей, список безопасных получателей и список заблокированных отправителей), хранимая в почтовом ящике пользователя, также синхронизируется с EOP. При синхронизации каталогов коллекция safelist синхронизируется с Azure AD.

- Коллекция safelist в почтовом ящике пользователя имеет ограничение в 510 КБ, которое включает все списки, а также дополнительные параметры фильтра нежелательной почты. Если пользователь превышает этот предел, он получит ошибку Outlook, которая выглядит так:

  > Не удается добавить на сервер списки нежелательной почты. Размер, разрешенный на сервере, больше. Фильтр нежелательной электронной почты на сервере будет отключен до тех пор, пока списки нежелательной почты не будут сокращены до разрешенных сервером размеров.

  Дополнительные сведения об этом ограничении и его изменении см. в [kB2669081.](https://support.microsoft.com/help/2669081)

- Синхронизированный набор безопасных списков в EOP имеет следующие ограничения синхронизации:

  - 1024 записей в списке безопасных отправителей, списке безопасных получателей и внешних контактах, если включена электронная почта **Trust** от моих контактов.
  - 500 записей в списке заблокированных отправителей и списке заблокированных доменов.

  Когда будет достигнуто ограничение на вход 1024, произойдет следующее:

  - Список перестает принимать записи в PowerShell и Outlook в Интернете, но ошибки не отображаются.

    Пользователи Outlook могут продолжать добавлять более 1024 записей, пока не достигнут предела Outlook в 510 КБ. Outlook может использовать эти дополнительные записи, если фильтр EOP не блокирует сообщение перед доставкой в почтовый ящик (правила потока почты, противодействие спуфингу и т. д.).

- При синхронизации каталогов записи синхронизируются с Azure AD в следующем порядке:

  1. Контакты почты, если **включена электронная** почта Trust от моих контактов.
  2. Список "Безопасный отправитель" и "Безопасный получатель" объединяются, дублируются и сортируются в алфавитном порядке при изменении первых 1024 записей.

  Используются первые 1024 записи, и соответствующая информация штампуется в заглавных главах сообщений.

  Записи за 1024, не синхронизированные с Azure AD, обрабатываются Outlook (а не Outlook в Интернете), и в заглавных главах сообщений не штампуется информация.

Как видите, включение электронной почты **Trust** из параметров контактов уменьшает число безопасных отправителей и безопасных получателей, которые можно синхронизировать. Если это вызывает озабоченность, рекомендуется отключить эту функцию с помощью групповой политики.

- Имя файла: outlk16.opax
- Параметр политики: **доверяйте электронной почте от контактов**