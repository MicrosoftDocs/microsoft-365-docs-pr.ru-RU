---
title: Настройка параметров нежелательной почты в почтовых ящиках Exchange Online
ms.author: chrisda
author: chrisda
manager: dansimp
ms.date: ''
audience: Admin
ms.topic: article
ms.service: O365-seccomp
localization_priority: Normal
search.appverid:
- MOE150
- MED150
- MBS150
- MET150
ms.collection:
- M365-security-compliance
description: Администраторы могут научиться настраивать параметры нежелательной почты в почтовых ящиках Exchange Online. Многие из этих параметров доступны пользователям в Outlook или Outlook в Интернете.
ms.openlocfilehash: 4e40e3fa2186022a64c8ccdf66f62db24b9f9794
ms.sourcegitcommit: 2acd9ec5e9d150389975e854c7883efc186a9432
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/16/2020
ms.locfileid: "44755264"
---
# <a name="configure-junk-email-settings-on-exchange-online-mailboxes"></a>Настройка параметров нежелательной почты в почтовых ящиках Exchange Online

В организациях Microsoft 365 с почтовыми ящиками в Exchange Online параметры защиты от нежелательной почты в организации контролируются службой Exchange Online Protection (EOP). Дополнительные сведения см. [в разделе Защита от нежелательной почты в EOP](anti-spam-protection.md).

Кроме того, существуют специальные параметры защиты от нежелательной почты, которые администраторы могут настроить для отдельных почтовых ящиков в Exchange Online:

- **Включить или отключить правило нежелательной**почты: правило нежелательной почты — это правило скрытой почты с именем "правило нежелательной почты", которое по умолчанию включено в каждом почтовом ящике. Правило нежелательной почты управляет следующими функциями:

  - **Перемещение сообщений в папку нежелательной почты на основе политик защиты от нежелательной**почты: Если политика защиты от нежелательной почты настроена с помощью команды действие **переместить сообщение в папку нежелательной почты** для фильтрации нежелательной почты вредоносности, правило фильтра нежелательной почты перемещает сообщение в папку нежелательной почты после доставки сообщения в почтовый ящик. Дополнительные сведения о фильтрации нежелательной почты вердиктс в политиках защиты от нежелательной почты приведена [в статье Настройка политик защиты от нежелательной почты в EOP](configure-your-spam-filter-policies.md). Аналогичным образом, если автоматическая очистка (ZAP) с нулевым часовым циклом определяет, что в доставленном сообщении используется Нежелательная почта или фишинг, правило фильтра нежелательной почты перемещает сообщение в папку "Нежелательная почта **" для фильтрации** нежелательной почты вредоносности действия. Дополнительные сведения о команде ZAP приведены [в статье автоматическая очистка (ZAP) в Exchange Online](zero-hour-auto-purge.md).

  - **Параметры нежелательной почты, которые пользователи настраивают для себя в Outlook или Outlook в Интернете**: _коллекция списков надежных_ отправителей, список надежных получателей и список заблокированных отправителей для каждого почтового ящика. Записи в этих списках определяют, будет ли правило нежелательной почты перемещать сообщение в папку "Входящие" или в папку нежелательной почты. Пользователи могут настроить коллекцию списков надежных отправителей для своего почтового ящика в Outlook или Outlook в Интернете (прежнее название — Outlook Web App). Администраторы могут настроить коллекцию списков надежных отправителей для почтового ящика любого пользователя.

Если правило нежелательной почты включено в почтовом ящике, EOP может перемещать сообщения в папку "Нежелательная почта" на основе фильтра нежелательной почты вредоносности действие **переместить сообщение в папку нежелательной почты** или в список заблокированных отправителей почтового ящика и запретить доставку сообщений в папку нежелательной почты (на основе списка надежных отправителей в почтовом ящике).

 Если правило нежелательной почты отключено в почтовом ящике, EOP не может перемещать сообщения в папку "Нежелательная почта" на основе фильтрации нежелательной почты вредоносности действие **переместить сообщение в папку нежелательной почты** или коллекцию списков надежных отправителей в почтовый ящик.

Администраторы могут использовать Exchange Online PowerShell для отключения, включения и просмотра состояния правила нежелательной почты для почтовых ящиков. Администраторы также могут использовать Exchange Online PowerShell для настройки записей в коллекции списков надежных отправителей в почтовых ящиках (надежные отправители, список надежных получателей и список заблокированных отправителей).

> [!NOTE]
> Сообщения от отправителей, добавленных пользователями в собственные списки надежных отправителей, будут пропускать фильтрацию подключений в EOP (нежелательное значение — 1). Чтобы запретить пользователям добавлять записи в список надежных отправителей в Outlook, используйте групповую политику, как описано в разделе [сведения о параметрах нежелательной почты в Outlook](#about-junk-email-settings-in-outlook) далее в этой статье. Фильтрация политик, фильтрация контента и проверки Advanced Threat protection (ATP) по-прежнему будут применяться к сообщениям.

## <a name="what-do-you-need-to-know-before-you-begin"></a>Что нужно знать перед началом работы

- Эти процедуры можно выполнять только с помощью Exchange Online PowerShell. Сведения о том, как подключиться к Exchange Online PowerShell, см. в статье [Подключение к Exchange Online PowerShell](https://docs.microsoft.com/powershell/exchange/connect-to-exchange-online-powershell).

- Прежде чем выполнять эти процедуры, вам необходимо назначить разрешения. В частности, вам потребуются роли **получателей почты** (которые назначаются группам ролей " **Управление организацией**", " **Управление получателями**" и " **настраиваемые получатели почты** по умолчанию") или роли **параметров пользователя** (которые назначаются группам ролей " **Управление организацией** **" и "служба поддержки"** по умолчанию). Чтобы добавить пользователей в группы ролей в Exchange Online, ознакомьтесь со статьей [изменение групп ролей в Exchange Online](https://docs.microsoft.com/Exchange/permissions-exo/role-groups#modify-role-groups). Обратите внимание, что пользователь с разрешениями по умолчанию может выполнять эти же процедуры в своем почтовом ящике, если у них есть [доступ к Exchange Online PowerShell](https://docs.microsoft.com/powershell/exchange/disable-access-to-exchange-online-powershell).

- В автономных средах EOP, в которых EOP защищает локальные почтовые ящики Exchange, требуется настроить правила потока обработки почты (также называемые правилами транспорта) в локальной среде Exchange для преобразования решения фильтра нежелательной почты EOP, чтобы правило нежелательной почты могло перемещать сообщение в папку "Нежелательная почта". Дополнительные сведения см. в статье [Настройка автономной службы EOP для доставки спама в папку нежелательной почты в гибридных средах](ensure-that-spam-is-routed-to-each-user-s-junk-email-folder.md).

- Надежные отправители для общих почтовых ящиков не синхронизируются с Azure AD и EOP по проектированию.

## <a name="use-exchange-online-powershell-to-enable-or-disable-the-junk-email-rule-in-a-mailbox"></a>Включение или отключение правила нежелательной почты в почтовом ящике с помощью Exchange Online PowerShell

> [!NOTE]
> Командлет **Set-MailboxJunkEmailConfiguration** можно использовать только для отключения правила нежелательной почты для почтового ящика, открытого в Outlook (в режиме кэширования Exchange) или Outlook в Интернете. Если почтовый ящик еще не был открыт, появится сообщение об ошибке: `The Junk Email configuration couldn't be set. The user needs to sign in to Outlook Web App before they can modify their Safe Senders and Recipients or Blocked Senders lists.` Если вы хотите отключить эту ошибку для массовых операций, можно добавить `-ErrorAction SlientlyContinue` команду **Set – MailboxJunkEmailConfiguration** .

Чтобы включить или отключить правило нежелательной почты для почтового ящика, используйте следующий синтаксис:

```PowerShell
Set-MailboxJunkEmailConfiguration -Identity <MailboxIdentity> -Enabled <$true | $false>
```

Пример отключения правила нежелательной почты для почтового ящика пользователя Ori Epstein.

```PowerShell
Set-MailboxJunkEmailConfiguration -Identity "Ori Epstein" -Enabled $false
```

Пример отключения правила нежелательной почты для всех почтовых ящиков пользователей организации.

```PowerShell
$All = Get-Mailbox -RecipientTypeDetails UserMailbox -ResultSize Unlimited; $All | foreach {Set-MailboxJunkEmailConfiguration $_.Name -Enabled $false}
```

Подробные сведения о синтаксисе и параметрах можно найти в статье [Set – MailboxJunkEmailConfiguration](https://docs.microsoft.com/powershell/module/exchange/set-mailboxjunkemailconfiguration).

> [!NOTE]
> 
> - Если пользователь еще не открыл свой почтовый ящик, при выполнении предыдущей команды может возникнуть ошибка. Чтобы отключить эту ошибку для массовых операций, добавьте `-ErrorAction SlientlyContinue` команду **Set – MailboxJunkEmailConfiguration** .
> 
> - Даже если отключить правило нежелательной почты, фильтр нежелательной почты Outlook (в зависимости от того, как он настроен) может также определить, является ли сообщение нежелательным, и может переместить сообщения в папку "Входящие" или "Нежелательная почта" на основе собственной нежелательной почты вредоносности и коллекции списков надежных отправителей в почтовом ящике. Дополнительные сведения см. в разделе [Сведения о параметрах нежелательной почты в Outlook](#about-junk-email-settings-in-outlook) данной статьи.

### <a name="how-do-you-know-this-worked"></a>Как проверить, что все получилось?

Чтобы убедиться в том, что правило нежелательной почты для почтового ящика успешно включено или отключено, воспользуйтесь любой из приведенных ниже процедур.

- Замените на _\<MailboxIdentity\>_ имя, псевдоним или адрес электронной почты почтового ящика и выполните следующую команду, чтобы проверить значение свойства **Enabled** :

  ```PowerShell
  Get-MailboxJunkEmailConfiguration -Identity "<MailboxIdentity>" | Format-List Enabled
  ```

## <a name="use-exchange-online-powershell-to-configure-the-safelist-collection-on-a-mailbox"></a>Настройка коллекции списков надежных отправителей для почтового ящика с помощью Exchange Online PowerShell

В коллекцию списков надежных отправителей для почтового ящика входят списки надежных отправителей, надежных получателей и заблокированных отправителей. По умолчанию пользователи могут настраивать коллекцию списков надежных отправителей в своем почтовом ящике в Outlook или Outlook в Интернете. Администраторы же для настройки таких коллекций для почтовых ящиков пользователей могут воспользоваться командлетом **Set-MailboxJunkEmailConfiguration**. Соответствующие параметры описаны в таблице ниже.

|||
|---|---|
|**Параметр в Set — MailboxJunkEmailConfiguration**|**Параметры Outlook в Интернете**|
|_блоккедсендерсанддомаинс_|**Перемещать электронную почту от этих отправителей и доменов в папку "Нежелательная почта"**|
|_контактструстед_|**Доверять сообщениям электронной почты от моих контактов**|
|_трустедлистсонли_|**Доверять сообщениям только от адресов в списках "Надежные отправители" и "домены" и "безопасные списки рассылки"**|
|_трустедсендерсанддомаинс_<sup>\*</sup>|**Не перемещать сообщения от этих отправителей в папку "Нежелательная почта"**|
|

<sup>\*</sup>**Примечания**:

- В Exchange Online **записи домена** в списке надежных отправителей или параметр _трустедсендерсанддомаинс_ не распознаются, поэтому используйте только адреса электронной почты. В автономной EOP с синхронизацией службы каталогов записи домена не синхронизируются по умолчанию, но вы можете включить синхронизацию для доменов. Дополнительные сведения см. в разделе [KB3019657](https://support.microsoft.com/help/3019657).

- Вы не можете напрямую изменить список надежных получателей с помощью командлета **Set-MailboxJunkEmailConfiguration** (параметр _трустедреЦипиентсанддомаинс_ не работает). Сначала нужно внести изменения в список надежных отправителей, и они синхронизируются со списком надежных получателей.

Для настройки коллекции списков надежных отправителей для почтового ящика следует использовать следующий синтаксис:

```PowerShell
Set-MailboxJunkEmailConfiguration <MailboxIdentity> -BlockedSendersAndDomains <EmailAddressesOrDomains | $null> -ContactsTrusted <$true | $false> -TrustedListsOnly <$true | $false> -TrustedSendersAndDomains  <EmailAddresses | $null>
```

Чтобы указать несколько значений и перезаписать существующие записи для параметров _блоккедсендерсанддомаинс_ и _трустедсендерсанддомаинс_ , используйте следующий синтаксис: `"<Value1>","<Value2>"...` . Чтобы добавить или удалить одно или несколько значений, не затрагивая другие существующие записи, используйте следующий синтаксис:`@{Add="<Value1>","<Value2>"... ; Remove="<Value3>","<Value4>...}`

В примере ниже выполняется настройка следующих параметров для коллекции списков надежных отправителей в почтовом ящике пользователя Ori Epstein:

- Добавьте значение shopping@fabrikam.com в список заблокированных отправителей.

- Удалите значение chris@fourthcoffee.com из списка "Надежные отправители" и "Надежные получатели".

- настройка контактов в папке контактов как надежных отправителей.

```PowerShell
Set-MailboxJunkEmailConfiguration "Ori Epstein" -BlockedSendersAndDomains @{Add="shopping@fabrikam.com"} -TrustedSendersAndDomains @{Remove="chris@fourthcoffee.com"} -ContactsTrusted $true
```

Пример удаления домена contoso.com из списка заблокированных отправителей для всех почтовых ящиков пользователей организации.

```PowerShell
$All = Get-Mailbox -RecipientTypeDetails UserMailbox -ResultSize Unlimited; $All | foreach {Set-MailboxJunkEmailConfiguration $_.Name -BlockedSendersAndDomains @{Remove="contoso.com"}}
```

Подробные сведения о синтаксисе и параметрах можно найти в статье [Set – MailboxJunkEmailConfiguration](https://docs.microsoft.com/powershell/module/exchange/set-mailboxjunkemailconfiguration).

> [!NOTE]
> 
> - Если пользователь еще не открыл свой почтовый ящик, при выполнении предыдущих команд может возникнуть ошибка. Чтобы отключить эту ошибку для массовых операций, добавьте `-ErrorAction SlientlyContinue` команду **Set – MailboxJunkEmailConfiguration** .
> 
> - Даже если правило нежелательной почты отключено для почтового ящика, вы можете настроить коллекцию списков надежных отправителей, а фильтр нежелательной почты Outlook может перемещать сообщения в папку "Входящие" или в папку "Нежелательная почта". Дополнительные сведения см. в разделе [Сведения о параметрах нежелательной почты в Outlook](#about-junk-email-settings-in-outlook) данной статьи.
> 
> - В фильтре нежелательной почты Outlook есть дополнительные параметры коллекции списков надежных отправителей (например, **автоматически добавляйте людей в список надежных отправителей**). Более подробную информацию [можно узнать в статье Использование фильтров нежелательной почты для управления отображенными сообщениями](https://support.microsoft.com/office/274ae301-5db2-4aad-be21-25413cede077).

### <a name="how-do-you-know-this-worked"></a>Как проверить, что все получилось?

Чтобы убедиться в том, что коллекция списков надежных отправителей для почтового ящика успешно настроена, воспользуйтесь любой из приведенных ниже процедур.

- Замените на _\<MailboxIdentity\>_ имя, псевдоним или адрес электронной почты почтового ящика и выполните следующую команду, чтобы проверить значения свойств:

  ```PowerShell
  Get-MailboxJunkEmailConfiguration -Identity "<MailboxIdentity>" | Format-List trusted*,contacts*,blocked*
  ```

  Если список значений слишком длинный, используйте следующий синтаксис:

  ```PowerShell
  (Get-MailboxJunkEmailConfiguration -Identity <MailboxIdentity>).BlockedSendersAndDomains
  ```

## <a name="about-junk-email-settings-in-outlook"></a>Сведения о параметрах нежелательной почты в Outlook

Чтобы включить, отключить и настроить на стороне клиента параметры фильтра нежелательной почты, доступные в Outlook, используйте групповую политику. Дополнительные сведения: [файлы административных шаблонов (ADMX/ADML) и центр развертывания Office для приложений Microsoft 365 для предприятий, office 2019 и office 2016](https://www.microsoft.com/download/details.aspx?id=49030) , а [также способы развертывания параметров нежелательной почты, таких как список надежных отправителей, с помощью групповой политики](https://support.microsoft.com/help/2252421).

Если для фильтра нежелательной почты Outlook задано значение по умолчанию **без автоматической фильтрации** в параметрах параметров **домашней** нежелательной \> **Junk** \> **почты** \> **Options**, Outlook не пытается классифицировать массажес как спам, но по-прежнему использует коллекцию надежных отправителей (список надежных отправителей, список надежных отправителей и список заблокированных отправителей) для перемещения сообщений в папку "Нежелательная почта" после доставки. Дополнительные сведения об этих параметрах приведены [в разделе Обзор фильтра нежелательной почты](https://support.microsoft.com/office/5ae3ea8e-cf41-4fa0-b02a-3b96e21de089).

Если для фильтра нежелательной почты Outlook выбран параметр **Низкий** или **Высокий**, то фильтр нежелательной почты Outlook использует собственную технологию фильтрации SmartScreen для определения и перемещения спама в папку "Нежелательная почта". Эта классификация нежелательной почты отличается от вероятности нежелательной почты (SCL), определенной EOP. В действительности Outlook игнорирует нежелательное значение из EOP (если EOP не помечено как сообщение для пропуска фильтрации нежелательной почты) и использует собственные критерии, чтобы определить, является ли сообщение спамом. Конечно, возможно, что нежелательные сообщения вредоносности от EOP и Outlook могут быть одинаковыми. Дополнительные сведения об этих параметрах приведены [в разделе Изменение уровня защиты в фильтре нежелательной почты](https://support.microsoft.com/office/e89c12d8-9d61-4320-8c57-d982c8d52f6b).

> [!NOTE]
> В ноябре 2016 Корпорация Майкрософт прекратила создание обновлений определений нежелательной почты для фильтров SmartScreen в Exchange и Outlook. Существующие определения фильтра нежелательной почты (SmartScreen) остались на месте, но их эффективность скорее всего будет снижаться со временем. Дополнительные сведения см. в статье [Прекращение поддержки SmartScreen в Outlook и Exchange](https://techcommunity.microsoft.com/t5/exchange-team-blog/deprecating-support-for-smartscreen-in-outlook-and-exchange/ba-p/605332).

Таким образом, фильтр нежелательной почты Outlook может использовать коллекцию списков надежных отправителей и собственную классификацию нежелательной почты для перемещения сообщений в папку "Нежелательная почта", даже если правило нежелательной почты отключено в почтовом ящике.

Outlook и Outlook в Интернете поддерживают коллекцию списков надежных отправителей. Коллекция списков надежных отправителей сохраняется в почтовом ящике Exchange Online, поэтому изменения коллекции списков надежных отправителей в Outlook отображаются в Outlook в Интернете и наоборот.

## <a name="limits-for-junk-email-settings"></a>Пределы параметров нежелательной почты

Коллекция списков надежных отправителей (список надежных отправителей, список надежных получателей и список заблокированных отправителей), которая хранится в почтовом ящике пользователя, также синхронизируется с EOP. При синхронизации службы каталогов коллекция списков надежных отправителей синхронизируется с Azure AD.

- Коллекция списков надежных отправителей в почтовом ящике пользователя имеет ограничения 510 КБ, включая все списки, а также дополнительные параметры фильтра нежелательной почты. Если пользователь превышает это ограничение, он получит сообщение об ошибке Outlook, которое выглядит следующим образом:

  > Не удается добавить или невозможно добавить в списки нежелательной почты сервера. Превышен допустимый размер на сервере. Фильтр нежелательной почты на сервере будет отключен до тех пор, пока список нежелательной почты не будет уменьшен до размера, разрешенного сервером.

  Дополнительные сведения об этом ограничении и его изменении можно найти в разделе [KB2669081](https://support.microsoft.com/help/2669081).

- Синхронизация коллекции списков надежных отправителей в EOP имеет следующие предельные значения:

  - 1024 общее количество записей в списке "Надежные отправители", "Надежные получатели" и "внешние контакты", если включена функция **доверять электронной почте из списка контактов** .
  - 500 общее количество записей в списке заблокированных отправителей и заблокированных доменах.

  При достижении ограничения записи 1024 выполняются следующие действия:

  - Список перестает принимать записи в PowerShell и Outlook в Интернете, но сообщение об ошибке не отображается.

    Пользователи Outlook могут добавлять более 1024 записей, пока они не будут достигать предельного значения Outlook (510 КБ). Outlook может использовать эти дополнительные записи, если фильтр EOP не блокирует сообщение перед доставкой в почтовый ящик (правила для обработки почты, защита от спуфинга и т. д.).

- При синхронизации службы каталогов записи синхронизируются в Azure AD в следующем порядке:

  1. Почтовые контакты, если включена функция **доверия электронной почты из списка контактов** .
  2. Список надежных отправителей и список надежных получателей объединяются, не дублируются и сортируются в алфавитном порядке при каждом изменении первых 1024 записей.

  Первые 1024 записей используются, а соответствующая информация отмечаются в заголовках сообщений.

  Записи за 1024, которые не были синхронизированы с Azure AD, обрабатываются в Outlook (а не Outlook в Интернете), и в заголовках сообщений не отображается никакой информации.

Как видите, включение параметра **доверять сообщениям от моих контактов** сокращает количество надежных отправителей и надежных получателей, которые могут быть синхронизированы. Если это не так, рекомендуем отключить эту функцию с помощью групповой политики:

- Имя файла: outlk16. OPAX
- Параметр политики: **доверять сообщениям от контактов**
