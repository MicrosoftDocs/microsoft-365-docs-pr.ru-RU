---
title: Настройка параметров нежелательной почты в почтовых ящиках Exchange Online
ms.author: chrisda
author: chrisda
manager: dansimp
ms.date: ''
audience: Admin
ms.topic: how-to
ms.service: O365-seccomp
localization_priority: Normal
search.appverid:
- MOE150
- MED150
- MBS150
- MET150
ms.collection:
- M365-security-compliance
description: Администраторы могут научиться настраивать параметры нежелательной почты в почтовых ящиках Exchange Online. Многие из этих параметров доступны пользователям в Outlook или Outlook в Интернете.
ms.openlocfilehash: 171eca8535958f01a7f749ad678e6ea9dd83d80c
ms.sourcegitcommit: e12fa502bc216f6083ef5666f693a04bb727d4df
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "46825717"
---
# <a name="configure-junk-email-settings-on-exchange-online-mailboxes"></a><span data-ttu-id="33714-104">Настройка параметров нежелательной почты в почтовых ящиках Exchange Online</span><span class="sxs-lookup"><span data-stu-id="33714-104">Configure junk email settings on Exchange Online mailboxes</span></span>

<span data-ttu-id="33714-105">В организациях Microsoft 365 с почтовыми ящиками в Exchange Online параметрами организационной защиты от нежелательной почты управляет Exchange Online Protection (EOP).</span><span class="sxs-lookup"><span data-stu-id="33714-105">In Microsoft 365 organizations with mailboxes in Exchange Online, organizational anti-spam settings are controlled by Exchange Online Protection (EOP).</span></span> <span data-ttu-id="33714-106">Дополнительные сведения см. в статье ["Защита от нежелательной почты" в службе EOP.](anti-spam-protection.md)</span><span class="sxs-lookup"><span data-stu-id="33714-106">For more information, see [Anti-spam protection in EOP](anti-spam-protection.md).</span></span>

<span data-ttu-id="33714-107">Однако есть также специальные параметры защиты от нежелательной почты, которые администраторы могут настроить для отдельных почтовых ящиков в Exchange Online:</span><span class="sxs-lookup"><span data-stu-id="33714-107">But, there are also specific anti-spam settings that admins can configure on individual mailboxes in Exchange Online:</span></span>

- <span data-ttu-id="33714-108">**Включение или отключение правила нежелательной почты:** правило нежелательной почты скрыто для папки "Входящие" и включенное по умолчанию в каждом почтовом ящике.</span><span class="sxs-lookup"><span data-stu-id="33714-108">**Enable or disable the junk email rule**: The junk email rule is a hidden Inbox rule named Junk E-mail Rule that's enabled by default in every mailbox.</span></span> <span data-ttu-id="33714-109">Правило нежелательной почты управляет следующими функциями:</span><span class="sxs-lookup"><span data-stu-id="33714-109">The junk email rule controls the following features:</span></span>

  - <span data-ttu-id="33714-110">**Перемещать сообщения в**папку нежелательной почты на основе политик защиты от нежелательной почты: если действие "Переместить сообщение" в папку **нежелательной** почты, что позволяет фильтровать нежелательную почту, правило фильтрации нежелательной почты перемещает сообщение в папку "Нежелательная почта" после доставки сообщения в почтовый ящик.</span><span class="sxs-lookup"><span data-stu-id="33714-110">**Move messages to the Junk Email folder based on anti-spam policies**: When an anti-spam policy is configured with the action **Move message to Junk Email folder** for a spam filtering verdict, the junk email filter rule moves the message to the Junk Email folder after the message is delivered to the mailbox.</span></span> <span data-ttu-id="33714-111">Дополнительные сведения о средствах фильтрации нежелательной почты в политиках защиты от нежелательной почты см. в статье ["Настройка политик защиты от нежелательной почты" в EOP.](configure-your-spam-filter-policies.md)</span><span class="sxs-lookup"><span data-stu-id="33714-111">For more information about spam filtering verdicts in anti-spam policies, see [Configure anti-spam policies in EOP](configure-your-spam-filter-policies.md).</span></span> <span data-ttu-id="33714-112">Аналогичным образом, если автоматический чистый (ZAP) определяет, что сообщение является спамом или фишинговыми, правило фильтрации нежелательной почты перемещает сообщение в папку "Нежелательная почта" для действий, выполняемых для фильтрации нежелательных сообщений в папку **"Нежелательная** почта".</span><span class="sxs-lookup"><span data-stu-id="33714-112">Similarly, if zero-hour auto purge (ZAP) determines a delivered message is spam or phish, the junk email filter rule moves the message to the Junk Email folder for **Move message to Junk Email folder** spam filtering verdict actions.</span></span> <span data-ttu-id="33714-113">Дополнительные сведения о ZAP см. в статье ["Автоматическая очистка(ZAP) в Exchange Online".](zero-hour-auto-purge.md)</span><span class="sxs-lookup"><span data-stu-id="33714-113">For more information about ZAP, see [Zero-hour auto purge (ZAP) in Exchange Online](zero-hour-auto-purge.md).</span></span>

  - <span data-ttu-id="33714-114">**Параметры нежелательной почты, которые пользователи**настраивают _safelist collection_ для себя в Outlook или Outlook в Интернете: коллекция списков надежных отправителей, список надежных получателей и список заблокированных отправителей для каждого почтового ящика.</span><span class="sxs-lookup"><span data-stu-id="33714-114">**Junk email settings that users configure for themselves in Outlook or Outlook on the web**: The _safelist collection_ is the Safe Senders list, the Safe Recipients list, and the Block senders list on each mailbox.</span></span> <span data-ttu-id="33714-115">Записи в этих списках определяют, перемещает ли правило нежелательной почты сообщение в папку "Входящие" или в папку нежелательной почты.</span><span class="sxs-lookup"><span data-stu-id="33714-115">The entries in these lists determine whether the junk email rule moves the message to the Inbox or the Junk Email folder.</span></span> <span data-ttu-id="33714-116">Пользователи могут самостоятельно настроить коллекцию списков надежных отправителей для своих почтовых ящиков в Outlook или Outlook в Интернете (прежнее название — Outlook Web App).</span><span class="sxs-lookup"><span data-stu-id="33714-116">Users can configure the safelist collection for their own mailbox in Outlook or Outlook on the web (formerly known as Outlook Web App).</span></span> <span data-ttu-id="33714-117">Администраторы могут настроить коллекцию списков адресов в любом почтовом ящике любого пользователя.</span><span class="sxs-lookup"><span data-stu-id="33714-117">Admins can configure the safelist collection on any user's mailbox.</span></span>

<span data-ttu-id="33714-118">Если для почтового ящика включено правило нежелательной почты, служба EOP может перемещать сообщения в папку нежелательной почты на основе предусмотренного действия по перемещению сообщений в **папку "Нежелательная** почта" или списки заблокированных отправителей для почтового ящика, а сообщения не доставляются в папку нежелательной почты (на основе списка надежных отправителей в почтовом ящике).</span><span class="sxs-lookup"><span data-stu-id="33714-118">When the junk email rule is enabled on the mailbox, EOP is able to move messages to the Junk Email folder based on the spam filtering verdict action **Move message to Junk Email folder** or the Blocked Senders list on the mailbox, and prevent messages from being delivered to the Junk Email folder (based on the Safe Senders list on the mailbox).</span></span>

 <span data-ttu-id="33714-119">Если же в почтовом ящике отключено правило нежелательной почты, EOP не может перемещать сообщения в папку нежелательной почты на основе предусмотренного действия по перемещению сообщений **в папку нежелательной почты или** в коллекцию списков надежных отправителей для почтового ящика.</span><span class="sxs-lookup"><span data-stu-id="33714-119">When the junk email rule is disabled on the mailbox, EOP can't move messages to the Junk Email folder based on the spam filtering verdict action **Move message to Junk Email folder** or the safelist collection on the mailbox.</span></span>

<span data-ttu-id="33714-120">Администраторы могут использовать Exchange Online PowerShell, чтобы отключать, включать и просматривать состояние правила нежелательной почты в почтовых ящиках.</span><span class="sxs-lookup"><span data-stu-id="33714-120">Admins can use Exchange Online PowerShell to disable, enable, and view the status of the junk email rule on mailboxes.</span></span> <span data-ttu-id="33714-121">Администраторы также могут использовать Exchange Online PowerShell для настройки записей в коллекции списков надежных отправителей в почтовых ящиках (список надежных отправителей, список надежных получателей и список заблокированных отправителей).</span><span class="sxs-lookup"><span data-stu-id="33714-121">Admins can also use Exchange Online PowerShell to configure entries in the safelist collection on mailboxes (the Safe Senders list, the Safe Recipients list, and the Block senders list).</span></span>

> [!NOTE]
> <span data-ttu-id="33714-122">Сообщения от отправителей, добавленные пользователями в свои списки надежных отправителей, пропускат фильтрацию подключений в рамках EOP (значение -1).</span><span class="sxs-lookup"><span data-stu-id="33714-122">Messages from senders that users have added to their own Safe Senders lists will skip connection filtering as part of EOP (the SCL is -1).</span></span> <span data-ttu-id="33714-123">Чтобы запретить пользователям добавлять записи в свои списки надежных отправителей в Outlook, используйте групповую политику, как описано в разделе "О параметрах нежелательной  [почты" в Outlook](#about-junk-email-settings-in-outlook) далее в этой статье.</span><span class="sxs-lookup"><span data-stu-id="33714-123">To prevent users from adding entries to their Safe Senders list in Outlook, use Group Policy as mentioned in the  [About junk email settings in Outlook](#about-junk-email-settings-in-outlook) section later in this topic.</span></span> <span data-ttu-id="33714-124">Фильтрация политик, фильтрация содержимого и проверки Advanced Threat Protection (ATP) будут по-прежнему применяться к сообщениям.</span><span class="sxs-lookup"><span data-stu-id="33714-124">Policy filtering, Content filtering and Advanced Threat Protection (ATP) checks will still be applied to the messages.</span></span>

## <a name="what-do-you-need-to-know-before-you-begin"></a><span data-ttu-id="33714-125">Что нужно знать перед началом работы</span><span class="sxs-lookup"><span data-stu-id="33714-125">What do you need to know before you begin?</span></span>

- <span data-ttu-id="33714-126">Для выполнения этих процедур используйте только Exchange Online PowerShell.</span><span class="sxs-lookup"><span data-stu-id="33714-126">You can only use Exchange Online PowerShell to perform these procedures.</span></span> <span data-ttu-id="33714-127">Сведения о том, как подключиться к Exchange Online PowerShell, см. в статье [Подключение к Exchange Online PowerShell](https://docs.microsoft.com/powershell/exchange/connect-to-exchange-online-powershell).</span><span class="sxs-lookup"><span data-stu-id="33714-127">To connect to Exchange Online PowerShell, see [Connect to Exchange Online PowerShell](https://docs.microsoft.com/powershell/exchange/connect-to-exchange-online-powershell).</span></span>

- <span data-ttu-id="33714-128">Для выполнения этих процедур необходимы права.</span><span class="sxs-lookup"><span data-stu-id="33714-128">You need to be assigned permissions before you can do these procedures.</span></span> <span data-ttu-id="33714-129">В частности, необходима роль **получателей** почты (по умолчанию назначается группам ролей **"Управление**организацией", **"Управление**получателями" и **"Настраиваемые** получатели почты") или **роль параметров** пользователя (которая по умолчанию назначается группам ролей **"Управление** организацией" и **"Служба** технической поддержки").</span><span class="sxs-lookup"><span data-stu-id="33714-129">Specifically, you need the **Mail Recipients** role (which is assigned to the **Organization Management**, **Recipient Management**, and **Custom Mail Recipients** role groups by default) or the **User Options** role (which is assigned to the **Organization Management** and **Help Desk** role groups by default).</span></span> <span data-ttu-id="33714-130">Сведения о том, как добавить пользователей в группы ролей в Exchange Online, см. в статье ["Изменение групп ролей в Exchange Online".](https://docs.microsoft.com/Exchange/permissions-exo/role-groups#modify-role-groups)</span><span class="sxs-lookup"><span data-stu-id="33714-130">To add users to role groups in Exchange Online, see [Modify role groups in Exchange Online](https://docs.microsoft.com/Exchange/permissions-exo/role-groups#modify-role-groups).</span></span> <span data-ttu-id="33714-131">Обратите внимание, что пользователь с разрешениями по умолчанию может выполнить те же процедуры в своем почтовом ящике, если у него [есть доступ к удаленной оболочке PowerShell.](https://docs.microsoft.com/powershell/exchange/disable-access-to-exchange-online-powershell)</span><span class="sxs-lookup"><span data-stu-id="33714-131">Note that a user with default permissions can do these same procedures on their own mailbox, as long as they have [access to Exchange Online PowerShell](https://docs.microsoft.com/powershell/exchange/disable-access-to-exchange-online-powershell).</span></span>

- <span data-ttu-id="33714-132">В автономных средах EOP, в которых EOP защищает локальные почтовые ящики Exchange, требуется настроить правила потока обработки почты (также называемые правилами транспорта) в локальной среде Exchange для преобразования решения фильтра нежелательной почты EOP, чтобы правило нежелательной почты могло перемещать сообщение в папку "Нежелательная почта".</span><span class="sxs-lookup"><span data-stu-id="33714-132">In standalone EOP environments where EOP protects on-premises Exchange mailboxes, you need to configure mail flow rules (also known as transport rules) in on-premises Exchange to translate the EOP spam filtering verdict so the junk email rule can move the message to the Junk Email folder.</span></span> <span data-ttu-id="33714-133">Дополнительные сведения см. в статье [Настройка автономной службы EOP для доставки спама в папку нежелательной почты в гибридных средах](ensure-that-spam-is-routed-to-each-user-s-junk-email-folder.md).</span><span class="sxs-lookup"><span data-stu-id="33714-133">For details, see [Configure standalone EOP to deliver spam to the Junk Email folder in hybrid environments](ensure-that-spam-is-routed-to-each-user-s-junk-email-folder.md).</span></span>

- <span data-ttu-id="33714-134">Надежные отправители для общих почтовых ящиков не синхронизируются с Azure AD и EOP.</span><span class="sxs-lookup"><span data-stu-id="33714-134">Safe Senders for shared mailboxes are not synchronized to Azure AD and EOP by design.</span></span>

## <a name="use-exchange-online-powershell-to-enable-or-disable-the-junk-email-rule-in-a-mailbox"></a><span data-ttu-id="33714-135">Включение и отключение правила нежелательной почты в почтовом ящике в Exchange Online PowerShell</span><span class="sxs-lookup"><span data-stu-id="33714-135">Use Exchange Online PowerShell to enable or disable the junk email rule in a mailbox</span></span>

> [!NOTE]
> <span data-ttu-id="33714-136">Для отключения правила нежелательной почты для почтового ящика, открытого в Outlook (в режиме кэширования Exchange) или В Outlook в Интернете, можно использовать только командлет **Set-MailboxJunkEmailConfiguration.**</span><span class="sxs-lookup"><span data-stu-id="33714-136">You can only use the **Set-MailboxJunkEmailConfiguration** cmdlet to disable the junk email rule on a mailbox that's been opened in Outlook (in Cached Exchange mode) or Outlook on the web.</span></span> <span data-ttu-id="33714-137">Если почтовый ящик не был открыт, возникнет ошибка: Если вы хотите отменить эту ошибку для массовых `The Junk Email configuration couldn't be set. The user needs to sign in to Outlook Web App before they can modify their Safe Senders and Recipients or Blocked Senders lists.` `-ErrorAction SilentlyContinue` операций, добавьте ее в **команду Set-MailboxJunkEmailConfiguration.**</span><span class="sxs-lookup"><span data-stu-id="33714-137">If the mailbox hasn't been opened, you'll receive the error: `The Junk Email configuration couldn't be set. The user needs to sign in to Outlook Web App before they can modify their Safe Senders and Recipients or Blocked Senders lists.` If you want to suppress this error for bulk operations, you can add `-ErrorAction SilentlyContinue` to the **Set-MailboxJunkEmailConfiguration** command.</span></span>

<span data-ttu-id="33714-138">Чтобы включить или отключить правило нежелательной почты для почтового ящика, используйте следующий синтаксис:</span><span class="sxs-lookup"><span data-stu-id="33714-138">To enable or disable the junk email rule on a mailbox, use the following syntax:</span></span>

```PowerShell
Set-MailboxJunkEmailConfiguration -Identity <MailboxIdentity> -Enabled <$true | $false>
```

<span data-ttu-id="33714-139">Пример отключения правила нежелательной почты для почтового ящика пользователя Ori Epstein.</span><span class="sxs-lookup"><span data-stu-id="33714-139">This example disables the junk email rule on Ori Epstein's mailbox.</span></span>

```PowerShell
Set-MailboxJunkEmailConfiguration -Identity "Ori Epstein" -Enabled $false
```

<span data-ttu-id="33714-140">Пример отключения правила нежелательной почты для всех почтовых ящиков пользователей организации.</span><span class="sxs-lookup"><span data-stu-id="33714-140">This example disables the junk email rule on all user mailboxes in the organization.</span></span>

```PowerShell
$All = Get-Mailbox -RecipientTypeDetails UserMailbox -ResultSize Unlimited; $All | foreach {Set-MailboxJunkEmailConfiguration $_.Name -Enabled $false}
```

<span data-ttu-id="33714-141">Дополнительные сведения о синтаксисе и параметрах см. в [статье О командлете Set-MailboxJunkEmailConfiguration.](https://docs.microsoft.com/powershell/module/exchange/set-mailboxjunkemailconfiguration)</span><span class="sxs-lookup"><span data-stu-id="33714-141">For detailed syntax and parameter information, see [Set-MailboxJunkEmailConfiguration](https://docs.microsoft.com/powershell/module/exchange/set-mailboxjunkemailconfiguration).</span></span>

> [!NOTE]
>
> - <span data-ttu-id="33714-142">Если пользователь никогда не открывал свой почтовый ящик, при запуске предыдущей команды может возникнуть ошибка.</span><span class="sxs-lookup"><span data-stu-id="33714-142">If the user has never opened their mailbox, you might receive an error when you run the previous command.</span></span> <span data-ttu-id="33714-143">Чтобы не выводить эту ошибку для массовых операций, `-ErrorAction SilentlyContinue` добавьте **к команде Set-MailboxJunkEmailConfiguration.**</span><span class="sxs-lookup"><span data-stu-id="33714-143">To suppress this error for bulk operations, add `-ErrorAction SilentlyContinue` to the **Set-MailboxJunkEmailConfiguration** command.</span></span>
>
> - <span data-ttu-id="33714-144">Даже если отключить правило нежелательной почты, фильтр нежелательной почты Outlook (в зависимости от его настроек) также сможет определить, является ли сообщение спамом, и перемещать сообщения в папку "Входящие" или "Нежелательная почта" на основе собственных слов для нежелательной почты и списков надежных отправителей в почтовом ящике.</span><span class="sxs-lookup"><span data-stu-id="33714-144">Even if you disable the junk email rule, the Outlook Junk Email Filter (depending on how it's configured) can also determine whether a message is spam, and can move messages to the Inbox or Junk Email folder based on it's own spam verdict and the the safelist collection on the mailbox.</span></span> <span data-ttu-id="33714-145">Дополнительные сведения см. в разделе [Сведения о параметрах нежелательной почты в Outlook](#about-junk-email-settings-in-outlook) данной статьи.</span><span class="sxs-lookup"><span data-stu-id="33714-145">For more information, see the [About junk email settings in Outlook](#about-junk-email-settings-in-outlook) section in this topic.</span></span>

### <a name="how-do-you-know-this-worked"></a><span data-ttu-id="33714-146">Как проверить, что все получилось?</span><span class="sxs-lookup"><span data-stu-id="33714-146">How do you know this worked?</span></span>

<span data-ttu-id="33714-147">Чтобы убедиться в том, что правило нежелательной почты для почтового ящика успешно включено или отключено, воспользуйтесь любой из приведенных ниже процедур.</span><span class="sxs-lookup"><span data-stu-id="33714-147">To verify that you have successfully enabled or disabled the junk email rule on a mailbox, use any of the following procedures:</span></span>

- <span data-ttu-id="33714-148">Замените _\<MailboxIdentity\>_ именем, псевдонимом или адресом почтового ящика и выполните следующую команду, чтобы проверить значение свойства **Enabled:**</span><span class="sxs-lookup"><span data-stu-id="33714-148">Replace _\<MailboxIdentity\>_ with the name, alias, or email address of the mailbox, and run the following command to verify the **Enabled** property value:</span></span>

  ```PowerShell
  Get-MailboxJunkEmailConfiguration -Identity "<MailboxIdentity>" | Format-List Enabled
  ```

## <a name="use-exchange-online-powershell-to-configure-the-safelist-collection-on-a-mailbox"></a><span data-ttu-id="33714-149">Использование Exchange Online PowerShell для настройки коллекции списков надежных отправителей почтового ящика</span><span class="sxs-lookup"><span data-stu-id="33714-149">Use Exchange Online PowerShell to configure the safelist collection on a mailbox</span></span>

<span data-ttu-id="33714-150">В коллекцию списков надежных отправителей для почтового ящика входят списки надежных отправителей, надежных получателей и заблокированных отправителей.</span><span class="sxs-lookup"><span data-stu-id="33714-150">The safelist collection on a mailbox includes the Safe Senders list, the Safe Recipients list, and the Blocked Senders list.</span></span> <span data-ttu-id="33714-151">По умолчанию пользователи могут самостоятельно настроить коллекцию списков надежных отправителей для своих почтовых ящиков в Outlook или Outlook в Интернете.</span><span class="sxs-lookup"><span data-stu-id="33714-151">By default, users can configure the safelist collection on their own mailbox in Outlook or Outlook on the web.</span></span> <span data-ttu-id="33714-152">Администраторы же для настройки таких коллекций для почтовых ящиков пользователей могут воспользоваться командлетом **Set-MailboxJunkEmailConfiguration**.</span><span class="sxs-lookup"><span data-stu-id="33714-152">Administrators can use the corresponding parameters on the **Set-MailboxJunkEmailConfiguration** cmdlet to configure the safelist collection on a user's mailbox.</span></span> <span data-ttu-id="33714-153">Соответствующие параметры описаны в таблице ниже.</span><span class="sxs-lookup"><span data-stu-id="33714-153">These parameters are described in the following table.</span></span>

****

|<span data-ttu-id="33714-154">Параметр Set-MailboxJunkEmailConfiguration</span><span class="sxs-lookup"><span data-stu-id="33714-154">Parameter on Set-MailboxJunkEmailConfiguration</span></span>|<span data-ttu-id="33714-155">Параметр Outlook в Интернете</span><span class="sxs-lookup"><span data-stu-id="33714-155">Outlook on the web setting</span></span>|
|---|---|
|<span data-ttu-id="33714-156">_BlockedSendersAndDomains_</span><span class="sxs-lookup"><span data-stu-id="33714-156">_BlockedSendersAndDomains_</span></span>|<span data-ttu-id="33714-157">**Перемещать электронную почту от этих отправителей и доменов в папку "Нежелательная почта"**</span><span class="sxs-lookup"><span data-stu-id="33714-157">**Move email from these senders or domains to my Junk Email folder**</span></span>|
|<span data-ttu-id="33714-158">_ContactsTrusted_</span><span class="sxs-lookup"><span data-stu-id="33714-158">_ContactsTrusted_</span></span>|<span data-ttu-id="33714-159">**Доверять сообщениям электронной почты от моих контактов**</span><span class="sxs-lookup"><span data-stu-id="33714-159">**Trust email from my contacts**</span></span>|
|<span data-ttu-id="33714-160">_TrustedListsOnly_</span><span class="sxs-lookup"><span data-stu-id="33714-160">_TrustedListsOnly_</span></span>|<span data-ttu-id="33714-161">**Доверять сообщениям электронной почты только из адресов в списке надежных отправителей, доменов и списках надежных отправителей и надежных отправителей сообщений**</span><span class="sxs-lookup"><span data-stu-id="33714-161">**Only trust email from addresses in my Safe senders and domains list and Safe mailing lists**</span></span>|
|<span data-ttu-id="33714-162">_TrustedSendersAndDomains_<sup>\*</sup></span><span class="sxs-lookup"><span data-stu-id="33714-162">_TrustedSendersAndDomains_<sup>\*</sup></span></span>|<span data-ttu-id="33714-163">**Не перемещать электронную почту от этих отправителей в папку "Нежелательная почта"**</span><span class="sxs-lookup"><span data-stu-id="33714-163">**Don't move email from these senders to my Junk Email folder**</span></span>|
|

<span data-ttu-id="33714-164"><sup>\*</sup>**Примечания:**</span><span class="sxs-lookup"><span data-stu-id="33714-164"><sup>\*</sup> **Notes**:</span></span>

- <span data-ttu-id="33714-165">В Exchange Online **записи доменов** в списке надежных отправителей или _параметра TrustedSendersAndDomains_ не распознаются, поэтому используйте только адреса электронной почты.</span><span class="sxs-lookup"><span data-stu-id="33714-165">In Exchange Online, **domain entries** in the Safe Senders list or _TrustedSendersAndDomains_ parameter aren't recognized, so only use email addresses.</span></span> <span data-ttu-id="33714-166">В автономной службе EOP с синхронизацией каталогов записи доменов не синхронизируются по умолчанию, но вы можете включить синхронизацию для доменов.</span><span class="sxs-lookup"><span data-stu-id="33714-166">In standalone EOP with directory synchronization, domain entries aren't synchronized by default, but you can enable synchronization for domains.</span></span> <span data-ttu-id="33714-167">Дополнительные сведения см. в [статье KB3019657.](https://support.microsoft.com/help/3019657)</span><span class="sxs-lookup"><span data-stu-id="33714-167">For more information, see [KB3019657](https://support.microsoft.com/help/3019657).</span></span>

- <span data-ttu-id="33714-168">С помощью командлета **Set-MailboxJunkEmailConfiguration** невозможно изменить список надежных получателей напрямую _(параметр TrustedRecipientsAndDomains_ не работает).</span><span class="sxs-lookup"><span data-stu-id="33714-168">You can't directly modify the Safe Recipients list by using the **Set-MailboxJunkEmailConfiguration** cmdlet (the _TrustedRecipientsAndDomains_ parameter doesn't work).</span></span> <span data-ttu-id="33714-169">Сначала нужно внести изменения в список надежных отправителей, и они синхронизируются со списком надежных получателей.</span><span class="sxs-lookup"><span data-stu-id="33714-169">You modify the Safe Senders list, and those changes are synchronized to the Safe Recipients list.</span></span>

<span data-ttu-id="33714-170">Для настройки коллекции списков надежных отправителей для почтового ящика следует использовать следующий синтаксис:</span><span class="sxs-lookup"><span data-stu-id="33714-170">To configure the safelist collection on a mailbox, use the following syntax:</span></span>

```PowerShell
Set-MailboxJunkEmailConfiguration <MailboxIdentity> -BlockedSendersAndDomains <EmailAddressesOrDomains | $null> -ContactsTrusted <$true | $false> -TrustedListsOnly <$true | $false> -TrustedSendersAndDomains  <EmailAddresses | $null>
```

<span data-ttu-id="33714-171">Для ввода нескольких значений и перезаписи существующих записей параметров _BlockedSendersAndDomains_ и _TrustedSendersAndDomains_ используйте следующий `"<Value1>","<Value2>"...` синтаксис:</span><span class="sxs-lookup"><span data-stu-id="33714-171">To enter multiple values and overwrite any existing entries for the _BlockedSendersAndDomains_ and _TrustedSendersAndDomains_ parameters, use the following syntax: `"<Value1>","<Value2>"...`.</span></span> <span data-ttu-id="33714-172">Чтобы добавить или удалить одно или несколько значений, не затрагивая имеющиеся записи, используйте следующий синтаксис: `@{Add="<Value1>","<Value2>"... ; Remove="<Value3>","<Value4>...}`</span><span class="sxs-lookup"><span data-stu-id="33714-172">To add or remove one or more values without affecting other existing entries, use the following syntax: `@{Add="<Value1>","<Value2>"... ; Remove="<Value3>","<Value4>...}`</span></span>

<span data-ttu-id="33714-173">В примере ниже выполняется настройка следующих параметров для коллекции списков надежных отправителей в почтовом ящике пользователя Ori Epstein:</span><span class="sxs-lookup"><span data-stu-id="33714-173">This example configures the following settings for the safelist collection on Ori Epstein's mailbox:</span></span>

- <span data-ttu-id="33714-174">Добавьте значение shopping@fabrikam.com в список заблокированных отправителей.</span><span class="sxs-lookup"><span data-stu-id="33714-174">Add the value shopping@fabrikam.com to the Blocked Senders list.</span></span>

- <span data-ttu-id="33714-175">Удалите значенияchris@fourthcoffee.com из списков надежных отправителей и надежных получателей.</span><span class="sxs-lookup"><span data-stu-id="33714-175">Remove the value chris@fourthcoffee.com from the Safe Senders list and the Safe Recipients list.</span></span>

- <span data-ttu-id="33714-176">настройка контактов в папке контактов как надежных отправителей.</span><span class="sxs-lookup"><span data-stu-id="33714-176">Configures contacts in the Contacts folder to be treated as trusted senders.</span></span>

```PowerShell
Set-MailboxJunkEmailConfiguration "Ori Epstein" -BlockedSendersAndDomains @{Add="shopping@fabrikam.com"} -TrustedSendersAndDomains @{Remove="chris@fourthcoffee.com"} -ContactsTrusted $true
```

<span data-ttu-id="33714-177">Пример удаления домена contoso.com из списка заблокированных отправителей для всех почтовых ящиков пользователей организации.</span><span class="sxs-lookup"><span data-stu-id="33714-177">This example removes the domain contoso.com from the Blocked Senders list in all user mailboxes in the organization.</span></span>

```PowerShell
$All = Get-Mailbox -RecipientTypeDetails UserMailbox -ResultSize Unlimited; $All | foreach {Set-MailboxJunkEmailConfiguration $_.Name -BlockedSendersAndDomains @{Remove="contoso.com"}}
```

<span data-ttu-id="33714-178">Дополнительные сведения о синтаксисе и параметрах см. в [статье О командлете Set-MailboxJunkEmailConfiguration.](https://docs.microsoft.com/powershell/module/exchange/set-mailboxjunkemailconfiguration)</span><span class="sxs-lookup"><span data-stu-id="33714-178">For detailed syntax and parameter information, see [Set-MailboxJunkEmailConfiguration](https://docs.microsoft.com/powershell/module/exchange/set-mailboxjunkemailconfiguration).</span></span>

> [!NOTE]
>
> - <span data-ttu-id="33714-179">Если пользователь никогда не открывал свой почтовый ящик, при выполнении предыдущих команд может возникнуть ошибка.</span><span class="sxs-lookup"><span data-stu-id="33714-179">If the user has never opened their mailbox, you might receive an error when you run the previous commands.</span></span> <span data-ttu-id="33714-180">Чтобы не выводить эту ошибку для массовых операций, `-ErrorAction SilentlyContinue` добавьте **к команде Set-MailboxJunkEmailConfiguration.**</span><span class="sxs-lookup"><span data-stu-id="33714-180">To suppress this error for bulk operations, add `-ErrorAction SilentlyContinue` to the **Set-MailboxJunkEmailConfiguration** command.</span></span>
>
> - <span data-ttu-id="33714-181">Даже если же в почтовом ящике отключено правило нежелательной почты, можно настраивать коллекцию списков надежных отправителей, а фильтр нежелательной почты Outlook может перемещать сообщения в папку "Входящие" или папку нежелательной почты.</span><span class="sxs-lookup"><span data-stu-id="33714-181">Even if the junk email rule is disabled on the mailbox, you can still configure the safelist collection, and the Outlook Junk Email Filter is able to move messages to the Inbox or the Junk Email folder.</span></span> <span data-ttu-id="33714-182">Дополнительные сведения см. в разделе [Сведения о параметрах нежелательной почты в Outlook](#about-junk-email-settings-in-outlook) данной статьи.</span><span class="sxs-lookup"><span data-stu-id="33714-182">For more information, see the [About junk email settings in Outlook](#about-junk-email-settings-in-outlook) section in this topic.</span></span>
>
> - <span data-ttu-id="33714-183">В фильтре нежелательной почты Outlook есть дополнительные параметры коллекции списков надежных отправителей (например, автоматически добавлять **людей, которым я отправляю, в список надежных отправителей).**</span><span class="sxs-lookup"><span data-stu-id="33714-183">The Outlook Junk Email Filter has additional safelist collection settings (for example, **Automatically add people I email to the Safe Senders list**).</span></span> <span data-ttu-id="33714-184">Дополнительные сведения см. в статье ["Использование фильтров нежелательной почты" для управления появляемыми сообщениями.](https://support.microsoft.com/office/274ae301-5db2-4aad-be21-25413cede077)</span><span class="sxs-lookup"><span data-stu-id="33714-184">For more information, see [Use Junk Email Filters to control which messages you see](https://support.microsoft.com/office/274ae301-5db2-4aad-be21-25413cede077).</span></span>

### <a name="how-do-you-know-this-worked"></a><span data-ttu-id="33714-185">Как проверить, что все получилось?</span><span class="sxs-lookup"><span data-stu-id="33714-185">How do you know this worked?</span></span>

<span data-ttu-id="33714-186">Чтобы убедиться в том, что коллекция списков надежных отправителей для почтового ящика успешно настроена, воспользуйтесь любой из приведенных ниже процедур.</span><span class="sxs-lookup"><span data-stu-id="33714-186">To verify that you have successfully configured the safelist collection on a mailbox, use any of following procedures:</span></span>

- <span data-ttu-id="33714-187">Замените _\<MailboxIdentity\>_ именем, псевдонимом или адресом почтового ящика и выполните следующую команду, чтобы проверить значения свойств:</span><span class="sxs-lookup"><span data-stu-id="33714-187">Replace _\<MailboxIdentity\>_ with the name, alias, or email address of the mailbox, and run the following command to verify the property values:</span></span>

  ```PowerShell
  Get-MailboxJunkEmailConfiguration -Identity "<MailboxIdentity>" | Format-List trusted*,contacts*,blocked*
  ```

  <span data-ttu-id="33714-188">Если список значений слишком длинный, используйте следующий синтаксис:</span><span class="sxs-lookup"><span data-stu-id="33714-188">If the list of values is too long, use this syntax:</span></span>

  ```PowerShell
  (Get-MailboxJunkEmailConfiguration -Identity <MailboxIdentity>).BlockedSendersAndDomains
  ```

## <a name="about-junk-email-settings-in-outlook"></a><span data-ttu-id="33714-189">Сведения о параметрах нежелательной почты в Outlook</span><span class="sxs-lookup"><span data-stu-id="33714-189">About junk email settings in Outlook</span></span>

<span data-ttu-id="33714-190">Чтобы включить, отключить и настроить параметры фильтра нежелательной почты на стороне клиента, которые доступны в Outlook, используйте групповую политику.</span><span class="sxs-lookup"><span data-stu-id="33714-190">To enable, disable, and configure the client-side Junk Email Filter settings that are available in Outlook, use Group Policy.</span></span> <span data-ttu-id="33714-191">Для получения дополнительных сведений см. раздел ["Файлы административных шаблонов (ADMX/ADML) и центр развертывания Office" для приложений Microsoft 365 для предприятий, Office 2019 и Office 2016,](https://www.microsoft.com/download/details.aspx?id=49030) а также как развернуть параметры нежелательной [почты, например список надежных отправителей, с помощью групповой политики.](https://support.microsoft.com/help/2252421)</span><span class="sxs-lookup"><span data-stu-id="33714-191">For more information, see [Administrative Template files (ADMX/ADML) and Office Customization Tool for Microsoft 365 Apps for enterprise, Office 2019, and Office 2016](https://www.microsoft.com/download/details.aspx?id=49030) and [How to deploy junk email settings, such as the Safe Senders list, by using Group Policy](https://support.microsoft.com/help/2252421).</span></span>

<span data-ttu-id="33714-192">Если в качестве фильтра нежелательной почты Outlook установлено значение **"Автоматическое** правило фильтрации в параметрах нежелательной почты для дома", Outlook не пытается классифицировать **Home** \> **Junk** \> массовую рассылку как спам, но **по-прежнему** использует коллекцию \> **Options**списков надежных отправителей, надежных получателей и заблокированных отправителей для перемещения сообщений в папку нежелательной почты после доставки.</span><span class="sxs-lookup"><span data-stu-id="33714-192">When the Outlook Junk Email Filter is set to the default value **No automatic filtering** in **Home** \> **Junk** \> **Junk E-Mail Options** \> **Options**, Outlook doesn't attempt to classify massages as spam, but still uses the safelist collection (the Safe Senders list, Safe Recipients list, and Blocked Senders list) to move messages to the Junk Email folder after delivery.</span></span> <span data-ttu-id="33714-193">Дополнительные сведения об этих параметрах см. в статье ["Обзор фильтра нежелательной почты".](https://support.microsoft.com/office/5ae3ea8e-cf41-4fa0-b02a-3b96e21de089)</span><span class="sxs-lookup"><span data-stu-id="33714-193">For more information about these settings, see [Overview of the Junk Email Filter](https://support.microsoft.com/office/5ae3ea8e-cf41-4fa0-b02a-3b96e21de089).</span></span>

<span data-ttu-id="33714-194">Если для фильтра нежелательной почты Outlook выбран параметр **Низкий** или **Высокий**, то фильтр нежелательной почты Outlook использует собственную технологию фильтрации SmartScreen для определения и перемещения спама в папку "Нежелательная почта".</span><span class="sxs-lookup"><span data-stu-id="33714-194">When the Outlook Junk Email Filter is set to **Low** or **High**, the Outlook Junk Email Filter uses its own SmartScreen filter technology to identify and move spam to the Junk Email folder.</span></span> <span data-ttu-id="33714-195">Эта классификация спама выполняется отдельно от вероятности нежелательной почты, которая определяется EOP.</span><span class="sxs-lookup"><span data-stu-id="33714-195">This spam classification is separate from the spam confidence level (SCL) that's determined by EOP.</span></span> <span data-ttu-id="33714-196">К сути, Outlook игнорирует вероятность нежелательной почты из EOP (если EOP не пометил сообщение для пропуска фильтрации нежелательной почты) и использует собственные критерии для определения того, является ли сообщение спамом.</span><span class="sxs-lookup"><span data-stu-id="33714-196">In fact, Outlook ignores the SCL from EOP (unless EOP marked the message to skip spam filtering) and uses its own criteria to determine whether the message is spam.</span></span> <span data-ttu-id="33714-197">Возможно, что у сообщений, используемых EOP и Outlook, может быть одинаковым.</span><span class="sxs-lookup"><span data-stu-id="33714-197">Of course, it's possible that the spam verdict from EOP and Outlook might be the same.</span></span> <span data-ttu-id="33714-198">Дополнительные сведения об этих параметрах см. в разделе ["Изменение уровня защиты" в фильтре нежелательной почты.](https://support.microsoft.com/office/e89c12d8-9d61-4320-8c57-d982c8d52f6b)</span><span class="sxs-lookup"><span data-stu-id="33714-198">For more information about these settings, see [Change the level of protection in the Junk Email Filter](https://support.microsoft.com/office/e89c12d8-9d61-4320-8c57-d982c8d52f6b).</span></span>

> [!NOTE]
> <span data-ttu-id="33714-199">В ноябре 2016 г. корпорация Майкрософт прекратила выпуск обновлений определений спама для фильтров SmartScreen в Exchange и Outlook.</span><span class="sxs-lookup"><span data-stu-id="33714-199">In November 2016, Microsoft stopped producing spam definition updates for the SmartScreen filters in Exchange and Outlook.</span></span> <span data-ttu-id="33714-200">Существующие определения нежелательной почты SmartScreen оставались, но их эффективность скорее всего ухудшится со временем.</span><span class="sxs-lookup"><span data-stu-id="33714-200">The existing SmartScreen spam definitions were left in place, but their effectiveness will likely degrade over time.</span></span> <span data-ttu-id="33714-201">Дополнительные сведения см. в статье [Прекращение поддержки SmartScreen в Outlook и Exchange](https://techcommunity.microsoft.com/t5/exchange-team-blog/deprecating-support-for-smartscreen-in-outlook-and-exchange/ba-p/605332).</span><span class="sxs-lookup"><span data-stu-id="33714-201">For more information, see [Deprecating support for SmartScreen in Outlook and Exchange](https://techcommunity.microsoft.com/t5/exchange-team-blog/deprecating-support-for-smartscreen-in-outlook-and-exchange/ba-p/605332).</span></span>

<span data-ttu-id="33714-202">Итак, для перемещения сообщений в папку "Нежелательная почта" фильтр нежелательной почты Outlook может использовать как коллекции списков надежных отправителей почтового ящика, так и собственную классификацию спама, даже если правило нежелательной почты отключено в почтовом ящике.</span><span class="sxs-lookup"><span data-stu-id="33714-202">So, the Outlook Junk Email Filter is able to use the mailbox's safelist collection and its own spam classification to move messages to the Junk Email folder, even if the junk email rule is disabled in the mailbox.</span></span>

<span data-ttu-id="33714-203">Outlook и Outlook в Интернете поддерживают коллекцию списков надежных отправителей.</span><span class="sxs-lookup"><span data-stu-id="33714-203">Outlook and Outlook on the web both support the safelist collection.</span></span> <span data-ttu-id="33714-204">Коллекция списков надежных отправителей сохраняется в почтовом ящике Exchange Online, поэтому изменения в коллекции списков надежных отправителей Outlook отражаются в Outlook в Интернете и наоборот.</span><span class="sxs-lookup"><span data-stu-id="33714-204">The safelist collection is saved in the Exchange Online mailbox, so changes to the safelist collection in Outlook appear in Outlook on the web, and vice-versa.</span></span>

## <a name="limits-for-junk-email-settings"></a><span data-ttu-id="33714-205">Ограничения для параметров нежелательной почты</span><span class="sxs-lookup"><span data-stu-id="33714-205">Limits for junk email settings</span></span>

<span data-ttu-id="33714-206">Коллекция списков надежных отправителей, список надежных получателей и список заблокированных отправителей, хранящаяся в почтовом ящике пользователя, также синхронизируется со службой EOP.</span><span class="sxs-lookup"><span data-stu-id="33714-206">The safelist collection (the Safe Senders list, Safe Recipients list, and Blocked Senders list) that's stored in the user's mailbox is also synchronized to EOP.</span></span> <span data-ttu-id="33714-207">При синхронизации службы каталогов коллекция списков надежных отправителей синхронизируется с Azure AD.</span><span class="sxs-lookup"><span data-stu-id="33714-207">With directory synchronization, the safelist collection is synchronized to Azure AD.</span></span>

- <span data-ttu-id="33714-208">Ограничение на коллекцию списков надежных отправителей в почтовом ящике пользователя ограничено в 510 КБ (в том числе все списки), а также дополнительные параметры фильтра нежелательной почты.</span><span class="sxs-lookup"><span data-stu-id="33714-208">The safelist collection in the user's mailbox has a limit of 510 KB, which includes all lists, plus additional junk email filter settings.</span></span> <span data-ttu-id="33714-209">Если пользователь превышает это ограничение, возникнет ошибка Outlook, которая выглядит следующим образом:</span><span class="sxs-lookup"><span data-stu-id="33714-209">If a user exceeds this limit, they will receive an Outlook error that looks like this:</span></span>

  > <span data-ttu-id="33714-210">Не удается добавить или отметить в списки нежелательной почты сервера.</span><span class="sxs-lookup"><span data-stu-id="33714-210">Cannot/Unable add to the server Junk E-mail lists.</span></span> <span data-ttu-id="33714-211">Превышаютдопустимый размер сервера.</span><span class="sxs-lookup"><span data-stu-id="33714-211">You are over the size allowed on the server.</span></span> <span data-ttu-id="33714-212">Фильтр нежелательной почты на сервере будет отключен, пока списки нежелательной почты не будут сокращены до допустимого сервера.</span><span class="sxs-lookup"><span data-stu-id="33714-212">The Junk E-mail filter on the server will be disabled until your Junk E-mail lists have been reduced to the size allowed by the server.</span></span>

  <span data-ttu-id="33714-213">Дополнительные сведения об этом ограничении и его изменении см. в [статье KB2669081.](https://support.microsoft.com/help/2669081)</span><span class="sxs-lookup"><span data-stu-id="33714-213">For more information about this limit and how to change it, see [KB2669081](https://support.microsoft.com/help/2669081).</span></span>

- <span data-ttu-id="33714-214">Синхронизированная коллекция списков надежных отправителей в EOP имеет следующие ограничения синхронизации:</span><span class="sxs-lookup"><span data-stu-id="33714-214">The synchronized safelist collection in EOP has the following synchronization limits:</span></span>

  - <span data-ttu-id="33714-215">Суммарное количество записей в списке надежных отправителей, надежных получателей и внешних контактов, если **включено "Доверять сообщениям электронной почты от моих** контактов".</span><span class="sxs-lookup"><span data-stu-id="33714-215">1024 total entries in the Safe Senders list, the Safe Recipients list, and external contacts if **Trust email from my contacts** is enabled.</span></span>
  - <span data-ttu-id="33714-216">500 записей в списках заблокированных отправителей и заблокированных доменов.</span><span class="sxs-lookup"><span data-stu-id="33714-216">500 total entries in the Blocked Senders list and Blocked Domains list.</span></span>

  <span data-ttu-id="33714-217">При достижении предела 1024 записи происходят следующие действия.</span><span class="sxs-lookup"><span data-stu-id="33714-217">When the 1024 entry limit is reached, the following things happen:</span></span>

  - <span data-ttu-id="33714-218">Список прекращает прием записей в PowerShell и Outlook в Интернете, но никакой ошибки не отображается.</span><span class="sxs-lookup"><span data-stu-id="33714-218">The list stops accepting entries in PowerShell and Outlook on the web, but no error is displayed.</span></span>

    <span data-ttu-id="33714-219">Пользователи Outlook могут продолжать добавлять более 1024 записей, пока не достигнут предел Outlook 510 КБ.</span><span class="sxs-lookup"><span data-stu-id="33714-219">Outlook users can continue to add more than 1024 entries until they reach the Outlook limit of 510 KB.</span></span> <span data-ttu-id="33714-220">Outlook может использовать эти дополнительные записи, если фильтр EOP не блокирует сообщение перед доставкой в почтовый ящик (правила потока обработки почты, защита от спуфинга и т. д.).</span><span class="sxs-lookup"><span data-stu-id="33714-220">Outlook can use these additional entries, as long as an EOP filter doesn't block the message before delivery to the mailbox (mail flow rules, anti-spoofing, etc.).</span></span>

- <span data-ttu-id="33714-221">При синхронизации службы каталогов записи синхронизируются с Azure AD в следующем порядке:</span><span class="sxs-lookup"><span data-stu-id="33714-221">With directory synchronization, the entries are synchronized to Azure AD in the following order:</span></span>

  1. <span data-ttu-id="33714-222">Почтовые контакты, если **включено отношение доверия к электронной почте от** моих контактов.</span><span class="sxs-lookup"><span data-stu-id="33714-222">Mail contacts if **Trust email from my contacts** is enabled.</span></span>
  2. <span data-ttu-id="33714-223">При внесении изменений первых 1024 записей список надежных отправителей и список надежных получателей объединены, дедублируются и отсортированы в алфавитном порядке.</span><span class="sxs-lookup"><span data-stu-id="33714-223">The Safe Sender list and Safe Recipient list are combined, de-duplicated, and sorted alphabetically whenever a change is made for the first 1024 entries.</span></span>

  <span data-ttu-id="33714-224">Используются первые 1024 записи, а в заголовках сообщений отмечаются важные сведения.</span><span class="sxs-lookup"><span data-stu-id="33714-224">The first 1024 entries are used, and relevant information is stamped in the message headers.</span></span>

  <span data-ttu-id="33714-225">Записи размером более 1024, которые не были синхронизированы с Azure AD, обрабатываются Outlook (но не Outlook в Интернете) и в заголовках сообщений не помечаются никакие сведения.</span><span class="sxs-lookup"><span data-stu-id="33714-225">Entries over 1024 that weren't synchronized to Azure AD are processed by Outlook (not Outlook on the web), and no information is stamped in the message headers.</span></span>

<span data-ttu-id="33714-226">Как видите, что включение сообщения электронной почты с доверием от **моих** контактов уменьшает количество надежных отправителей и надежных получателей, которые можно синхронизировать.</span><span class="sxs-lookup"><span data-stu-id="33714-226">As you can see, enabling the **Trust email from my contacts** setting reduces the number of Safe Senders and Safe Recipients that can be synchronized.</span></span> <span data-ttu-id="33714-227">В этом случае рекомендуется использовать групповую политику для отключения этой функции.</span><span class="sxs-lookup"><span data-stu-id="33714-227">If this is a concern, then we recommend using Group Policy to turn this feature off:</span></span>

- <span data-ttu-id="33714-228">Имя файла: outlk16.opax</span><span class="sxs-lookup"><span data-stu-id="33714-228">File name: outlk16.opax</span></span>
- <span data-ttu-id="33714-229">Параметр политики: **Доверять сообщениям электронной почты от контактов**</span><span class="sxs-lookup"><span data-stu-id="33714-229">Policy setting: **Trust e-mail from contacts**</span></span>
