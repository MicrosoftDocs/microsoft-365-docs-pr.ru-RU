---
title: Настройка параметров нежелательной почты в почтовых ящиках Exchange Online
ms.author: chrisda
author: chrisda
manager: dansimp
ms.date: ''
audience: Admin
ms.topic: how-to
ms.service: O365-seccomp
localization_priority: Normal
search.appverid:
- MOE150
- MED150
- MBS150
- MET150
ms.collection:
- M365-security-compliance
description: Администраторы могут научиться настраивать параметры нежелательной почты в почтовых ящиках Exchange Online. Многие из этих параметров доступны пользователям в Outlook или Outlook в Интернете.
ms.openlocfilehash: 171eca8535958f01a7f749ad678e6ea9dd83d80c
ms.sourcegitcommit: e12fa502bc216f6083ef5666f693a04bb727d4df
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "46825717"
---
# <a name="configure-junk-email-settings-on-exchange-online-mailboxes"></a>Настройка параметров нежелательной почты в почтовых ящиках Exchange Online

В организациях Microsoft 365 с почтовыми ящиками в Exchange Online параметрами организационной защиты от нежелательной почты управляет Exchange Online Protection (EOP). Дополнительные сведения см. в статье ["Защита от нежелательной почты" в службе EOP.](anti-spam-protection.md)

Однако есть также специальные параметры защиты от нежелательной почты, которые администраторы могут настроить для отдельных почтовых ящиков в Exchange Online:

- **Включение или отключение правила нежелательной почты:** правило нежелательной почты скрыто для папки "Входящие" и включенное по умолчанию в каждом почтовом ящике. Правило нежелательной почты управляет следующими функциями:

  - **Перемещать сообщения в**папку нежелательной почты на основе политик защиты от нежелательной почты: если действие "Переместить сообщение" в папку **нежелательной** почты, что позволяет фильтровать нежелательную почту, правило фильтрации нежелательной почты перемещает сообщение в папку "Нежелательная почта" после доставки сообщения в почтовый ящик. Дополнительные сведения о средствах фильтрации нежелательной почты в политиках защиты от нежелательной почты см. в статье ["Настройка политик защиты от нежелательной почты" в EOP.](configure-your-spam-filter-policies.md) Аналогичным образом, если автоматический чистый (ZAP) определяет, что сообщение является спамом или фишинговыми, правило фильтрации нежелательной почты перемещает сообщение в папку "Нежелательная почта" для действий, выполняемых для фильтрации нежелательных сообщений в папку **"Нежелательная** почта". Дополнительные сведения о ZAP см. в статье ["Автоматическая очистка(ZAP) в Exchange Online".](zero-hour-auto-purge.md)

  - **Параметры нежелательной почты, которые пользователи**настраивают _safelist collection_ для себя в Outlook или Outlook в Интернете: коллекция списков надежных отправителей, список надежных получателей и список заблокированных отправителей для каждого почтового ящика. Записи в этих списках определяют, перемещает ли правило нежелательной почты сообщение в папку "Входящие" или в папку нежелательной почты. Пользователи могут самостоятельно настроить коллекцию списков надежных отправителей для своих почтовых ящиков в Outlook или Outlook в Интернете (прежнее название — Outlook Web App). Администраторы могут настроить коллекцию списков адресов в любом почтовом ящике любого пользователя.

Если для почтового ящика включено правило нежелательной почты, служба EOP может перемещать сообщения в папку нежелательной почты на основе предусмотренного действия по перемещению сообщений в **папку "Нежелательная** почта" или списки заблокированных отправителей для почтового ящика, а сообщения не доставляются в папку нежелательной почты (на основе списка надежных отправителей в почтовом ящике).

 Если же в почтовом ящике отключено правило нежелательной почты, EOP не может перемещать сообщения в папку нежелательной почты на основе предусмотренного действия по перемещению сообщений **в папку нежелательной почты или** в коллекцию списков надежных отправителей для почтового ящика.

Администраторы могут использовать Exchange Online PowerShell, чтобы отключать, включать и просматривать состояние правила нежелательной почты в почтовых ящиках. Администраторы также могут использовать Exchange Online PowerShell для настройки записей в коллекции списков надежных отправителей в почтовых ящиках (список надежных отправителей, список надежных получателей и список заблокированных отправителей).

> [!NOTE]
> Сообщения от отправителей, добавленные пользователями в свои списки надежных отправителей, пропускат фильтрацию подключений в рамках EOP (значение -1). Чтобы запретить пользователям добавлять записи в свои списки надежных отправителей в Outlook, используйте групповую политику, как описано в разделе "О параметрах нежелательной  [почты" в Outlook](#about-junk-email-settings-in-outlook) далее в этой статье. Фильтрация политик, фильтрация содержимого и проверки Advanced Threat Protection (ATP) будут по-прежнему применяться к сообщениям.

## <a name="what-do-you-need-to-know-before-you-begin"></a>Что нужно знать перед началом работы

- Для выполнения этих процедур используйте только Exchange Online PowerShell. Сведения о том, как подключиться к Exchange Online PowerShell, см. в статье [Подключение к Exchange Online PowerShell](https://docs.microsoft.com/powershell/exchange/connect-to-exchange-online-powershell).

- Для выполнения этих процедур необходимы права. В частности, необходима роль **получателей** почты (по умолчанию назначается группам ролей **"Управление**организацией", **"Управление**получателями" и **"Настраиваемые** получатели почты") или **роль параметров** пользователя (которая по умолчанию назначается группам ролей **"Управление** организацией" и **"Служба** технической поддержки"). Сведения о том, как добавить пользователей в группы ролей в Exchange Online, см. в статье ["Изменение групп ролей в Exchange Online".](https://docs.microsoft.com/Exchange/permissions-exo/role-groups#modify-role-groups) Обратите внимание, что пользователь с разрешениями по умолчанию может выполнить те же процедуры в своем почтовом ящике, если у него [есть доступ к удаленной оболочке PowerShell.](https://docs.microsoft.com/powershell/exchange/disable-access-to-exchange-online-powershell)

- В автономных средах EOP, в которых EOP защищает локальные почтовые ящики Exchange, требуется настроить правила потока обработки почты (также называемые правилами транспорта) в локальной среде Exchange для преобразования решения фильтра нежелательной почты EOP, чтобы правило нежелательной почты могло перемещать сообщение в папку "Нежелательная почта". Дополнительные сведения см. в статье [Настройка автономной службы EOP для доставки спама в папку нежелательной почты в гибридных средах](ensure-that-spam-is-routed-to-each-user-s-junk-email-folder.md).

- Надежные отправители для общих почтовых ящиков не синхронизируются с Azure AD и EOP.

## <a name="use-exchange-online-powershell-to-enable-or-disable-the-junk-email-rule-in-a-mailbox"></a>Включение и отключение правила нежелательной почты в почтовом ящике в Exchange Online PowerShell

> [!NOTE]
> Для отключения правила нежелательной почты для почтового ящика, открытого в Outlook (в режиме кэширования Exchange) или В Outlook в Интернете, можно использовать только командлет **Set-MailboxJunkEmailConfiguration.** Если почтовый ящик не был открыт, возникнет ошибка: Если вы хотите отменить эту ошибку для массовых `The Junk Email configuration couldn't be set. The user needs to sign in to Outlook Web App before they can modify their Safe Senders and Recipients or Blocked Senders lists.` `-ErrorAction SilentlyContinue` операций, добавьте ее в **команду Set-MailboxJunkEmailConfiguration.**

Чтобы включить или отключить правило нежелательной почты для почтового ящика, используйте следующий синтаксис:

```PowerShell
Set-MailboxJunkEmailConfiguration -Identity <MailboxIdentity> -Enabled <$true | $false>
```

Пример отключения правила нежелательной почты для почтового ящика пользователя Ori Epstein.

```PowerShell
Set-MailboxJunkEmailConfiguration -Identity "Ori Epstein" -Enabled $false
```

Пример отключения правила нежелательной почты для всех почтовых ящиков пользователей организации.

```PowerShell
$All = Get-Mailbox -RecipientTypeDetails UserMailbox -ResultSize Unlimited; $All | foreach {Set-MailboxJunkEmailConfiguration $_.Name -Enabled $false}
```

Дополнительные сведения о синтаксисе и параметрах см. в [статье О командлете Set-MailboxJunkEmailConfiguration.](https://docs.microsoft.com/powershell/module/exchange/set-mailboxjunkemailconfiguration)

> [!NOTE]
>
> - Если пользователь никогда не открывал свой почтовый ящик, при запуске предыдущей команды может возникнуть ошибка. Чтобы не выводить эту ошибку для массовых операций, `-ErrorAction SilentlyContinue` добавьте **к команде Set-MailboxJunkEmailConfiguration.**
>
> - Даже если отключить правило нежелательной почты, фильтр нежелательной почты Outlook (в зависимости от его настроек) также сможет определить, является ли сообщение спамом, и перемещать сообщения в папку "Входящие" или "Нежелательная почта" на основе собственных слов для нежелательной почты и списков надежных отправителей в почтовом ящике. Дополнительные сведения см. в разделе [Сведения о параметрах нежелательной почты в Outlook](#about-junk-email-settings-in-outlook) данной статьи.

### <a name="how-do-you-know-this-worked"></a>Как проверить, что все получилось?

Чтобы убедиться в том, что правило нежелательной почты для почтового ящика успешно включено или отключено, воспользуйтесь любой из приведенных ниже процедур.

- Замените _\<MailboxIdentity\>_ именем, псевдонимом или адресом почтового ящика и выполните следующую команду, чтобы проверить значение свойства **Enabled:**

  ```PowerShell
  Get-MailboxJunkEmailConfiguration -Identity "<MailboxIdentity>" | Format-List Enabled
  ```

## <a name="use-exchange-online-powershell-to-configure-the-safelist-collection-on-a-mailbox"></a>Использование Exchange Online PowerShell для настройки коллекции списков надежных отправителей почтового ящика

В коллекцию списков надежных отправителей для почтового ящика входят списки надежных отправителей, надежных получателей и заблокированных отправителей. По умолчанию пользователи могут самостоятельно настроить коллекцию списков надежных отправителей для своих почтовых ящиков в Outlook или Outlook в Интернете. Администраторы же для настройки таких коллекций для почтовых ящиков пользователей могут воспользоваться командлетом **Set-MailboxJunkEmailConfiguration**. Соответствующие параметры описаны в таблице ниже.

****

|Параметр Set-MailboxJunkEmailConfiguration|Параметр Outlook в Интернете|
|---|---|
|_BlockedSendersAndDomains_|**Перемещать электронную почту от этих отправителей и доменов в папку "Нежелательная почта"**|
|_ContactsTrusted_|**Доверять сообщениям электронной почты от моих контактов**|
|_TrustedListsOnly_|**Доверять сообщениям электронной почты только из адресов в списке надежных отправителей, доменов и списках надежных отправителей и надежных отправителей сообщений**|
|_TrustedSendersAndDomains_<sup>\*</sup>|**Не перемещать электронную почту от этих отправителей в папку "Нежелательная почта"**|
|

<sup>\*</sup>**Примечания:**

- В Exchange Online **записи доменов** в списке надежных отправителей или _параметра TrustedSendersAndDomains_ не распознаются, поэтому используйте только адреса электронной почты. В автономной службе EOP с синхронизацией каталогов записи доменов не синхронизируются по умолчанию, но вы можете включить синхронизацию для доменов. Дополнительные сведения см. в [статье KB3019657.](https://support.microsoft.com/help/3019657)

- С помощью командлета **Set-MailboxJunkEmailConfiguration** невозможно изменить список надежных получателей напрямую _(параметр TrustedRecipientsAndDomains_ не работает). Сначала нужно внести изменения в список надежных отправителей, и они синхронизируются со списком надежных получателей.

Для настройки коллекции списков надежных отправителей для почтового ящика следует использовать следующий синтаксис:

```PowerShell
Set-MailboxJunkEmailConfiguration <MailboxIdentity> -BlockedSendersAndDomains <EmailAddressesOrDomains | $null> -ContactsTrusted <$true | $false> -TrustedListsOnly <$true | $false> -TrustedSendersAndDomains  <EmailAddresses | $null>
```

Для ввода нескольких значений и перезаписи существующих записей параметров _BlockedSendersAndDomains_ и _TrustedSendersAndDomains_ используйте следующий `"<Value1>","<Value2>"...` синтаксис: Чтобы добавить или удалить одно или несколько значений, не затрагивая имеющиеся записи, используйте следующий синтаксис: `@{Add="<Value1>","<Value2>"... ; Remove="<Value3>","<Value4>...}`

В примере ниже выполняется настройка следующих параметров для коллекции списков надежных отправителей в почтовом ящике пользователя Ori Epstein:

- Добавьте значение shopping@fabrikam.com в список заблокированных отправителей.

- Удалите значенияchris@fourthcoffee.com из списков надежных отправителей и надежных получателей.

- настройка контактов в папке контактов как надежных отправителей.

```PowerShell
Set-MailboxJunkEmailConfiguration "Ori Epstein" -BlockedSendersAndDomains @{Add="shopping@fabrikam.com"} -TrustedSendersAndDomains @{Remove="chris@fourthcoffee.com"} -ContactsTrusted $true
```

Пример удаления домена contoso.com из списка заблокированных отправителей для всех почтовых ящиков пользователей организации.

```PowerShell
$All = Get-Mailbox -RecipientTypeDetails UserMailbox -ResultSize Unlimited; $All | foreach {Set-MailboxJunkEmailConfiguration $_.Name -BlockedSendersAndDomains @{Remove="contoso.com"}}
```

Дополнительные сведения о синтаксисе и параметрах см. в [статье О командлете Set-MailboxJunkEmailConfiguration.](https://docs.microsoft.com/powershell/module/exchange/set-mailboxjunkemailconfiguration)

> [!NOTE]
>
> - Если пользователь никогда не открывал свой почтовый ящик, при выполнении предыдущих команд может возникнуть ошибка. Чтобы не выводить эту ошибку для массовых операций, `-ErrorAction SilentlyContinue` добавьте **к команде Set-MailboxJunkEmailConfiguration.**
>
> - Даже если же в почтовом ящике отключено правило нежелательной почты, можно настраивать коллекцию списков надежных отправителей, а фильтр нежелательной почты Outlook может перемещать сообщения в папку "Входящие" или папку нежелательной почты. Дополнительные сведения см. в разделе [Сведения о параметрах нежелательной почты в Outlook](#about-junk-email-settings-in-outlook) данной статьи.
>
> - В фильтре нежелательной почты Outlook есть дополнительные параметры коллекции списков надежных отправителей (например, автоматически добавлять **людей, которым я отправляю, в список надежных отправителей).** Дополнительные сведения см. в статье ["Использование фильтров нежелательной почты" для управления появляемыми сообщениями.](https://support.microsoft.com/office/274ae301-5db2-4aad-be21-25413cede077)

### <a name="how-do-you-know-this-worked"></a>Как проверить, что все получилось?

Чтобы убедиться в том, что коллекция списков надежных отправителей для почтового ящика успешно настроена, воспользуйтесь любой из приведенных ниже процедур.

- Замените _\<MailboxIdentity\>_ именем, псевдонимом или адресом почтового ящика и выполните следующую команду, чтобы проверить значения свойств:

  ```PowerShell
  Get-MailboxJunkEmailConfiguration -Identity "<MailboxIdentity>" | Format-List trusted*,contacts*,blocked*
  ```

  Если список значений слишком длинный, используйте следующий синтаксис:

  ```PowerShell
  (Get-MailboxJunkEmailConfiguration -Identity <MailboxIdentity>).BlockedSendersAndDomains
  ```

## <a name="about-junk-email-settings-in-outlook"></a>Сведения о параметрах нежелательной почты в Outlook

Чтобы включить, отключить и настроить параметры фильтра нежелательной почты на стороне клиента, которые доступны в Outlook, используйте групповую политику. Для получения дополнительных сведений см. раздел ["Файлы административных шаблонов (ADMX/ADML) и центр развертывания Office" для приложений Microsoft 365 для предприятий, Office 2019 и Office 2016,](https://www.microsoft.com/download/details.aspx?id=49030) а также как развернуть параметры нежелательной [почты, например список надежных отправителей, с помощью групповой политики.](https://support.microsoft.com/help/2252421)

Если в качестве фильтра нежелательной почты Outlook установлено значение **"Автоматическое** правило фильтрации в параметрах нежелательной почты для дома", Outlook не пытается классифицировать **Home** \> **Junk** \> массовую рассылку как спам, но **по-прежнему** использует коллекцию \> **Options**списков надежных отправителей, надежных получателей и заблокированных отправителей для перемещения сообщений в папку нежелательной почты после доставки. Дополнительные сведения об этих параметрах см. в статье ["Обзор фильтра нежелательной почты".](https://support.microsoft.com/office/5ae3ea8e-cf41-4fa0-b02a-3b96e21de089)

Если для фильтра нежелательной почты Outlook выбран параметр **Низкий** или **Высокий**, то фильтр нежелательной почты Outlook использует собственную технологию фильтрации SmartScreen для определения и перемещения спама в папку "Нежелательная почта". Эта классификация спама выполняется отдельно от вероятности нежелательной почты, которая определяется EOP. К сути, Outlook игнорирует вероятность нежелательной почты из EOP (если EOP не пометил сообщение для пропуска фильтрации нежелательной почты) и использует собственные критерии для определения того, является ли сообщение спамом. Возможно, что у сообщений, используемых EOP и Outlook, может быть одинаковым. Дополнительные сведения об этих параметрах см. в разделе ["Изменение уровня защиты" в фильтре нежелательной почты.](https://support.microsoft.com/office/e89c12d8-9d61-4320-8c57-d982c8d52f6b)

> [!NOTE]
> В ноябре 2016 г. корпорация Майкрософт прекратила выпуск обновлений определений спама для фильтров SmartScreen в Exchange и Outlook. Существующие определения нежелательной почты SmartScreen оставались, но их эффективность скорее всего ухудшится со временем. Дополнительные сведения см. в статье [Прекращение поддержки SmartScreen в Outlook и Exchange](https://techcommunity.microsoft.com/t5/exchange-team-blog/deprecating-support-for-smartscreen-in-outlook-and-exchange/ba-p/605332).

Итак, для перемещения сообщений в папку "Нежелательная почта" фильтр нежелательной почты Outlook может использовать как коллекции списков надежных отправителей почтового ящика, так и собственную классификацию спама, даже если правило нежелательной почты отключено в почтовом ящике.

Outlook и Outlook в Интернете поддерживают коллекцию списков надежных отправителей. Коллекция списков надежных отправителей сохраняется в почтовом ящике Exchange Online, поэтому изменения в коллекции списков надежных отправителей Outlook отражаются в Outlook в Интернете и наоборот.

## <a name="limits-for-junk-email-settings"></a>Ограничения для параметров нежелательной почты

Коллекция списков надежных отправителей, список надежных получателей и список заблокированных отправителей, хранящаяся в почтовом ящике пользователя, также синхронизируется со службой EOP. При синхронизации службы каталогов коллекция списков надежных отправителей синхронизируется с Azure AD.

- Ограничение на коллекцию списков надежных отправителей в почтовом ящике пользователя ограничено в 510 КБ (в том числе все списки), а также дополнительные параметры фильтра нежелательной почты. Если пользователь превышает это ограничение, возникнет ошибка Outlook, которая выглядит следующим образом:

  > Не удается добавить или отметить в списки нежелательной почты сервера. Превышаютдопустимый размер сервера. Фильтр нежелательной почты на сервере будет отключен, пока списки нежелательной почты не будут сокращены до допустимого сервера.

  Дополнительные сведения об этом ограничении и его изменении см. в [статье KB2669081.](https://support.microsoft.com/help/2669081)

- Синхронизированная коллекция списков надежных отправителей в EOP имеет следующие ограничения синхронизации:

  - Суммарное количество записей в списке надежных отправителей, надежных получателей и внешних контактов, если **включено "Доверять сообщениям электронной почты от моих** контактов".
  - 500 записей в списках заблокированных отправителей и заблокированных доменов.

  При достижении предела 1024 записи происходят следующие действия.

  - Список прекращает прием записей в PowerShell и Outlook в Интернете, но никакой ошибки не отображается.

    Пользователи Outlook могут продолжать добавлять более 1024 записей, пока не достигнут предел Outlook 510 КБ. Outlook может использовать эти дополнительные записи, если фильтр EOP не блокирует сообщение перед доставкой в почтовый ящик (правила потока обработки почты, защита от спуфинга и т. д.).

- При синхронизации службы каталогов записи синхронизируются с Azure AD в следующем порядке:

  1. Почтовые контакты, если **включено отношение доверия к электронной почте от** моих контактов.
  2. При внесении изменений первых 1024 записей список надежных отправителей и список надежных получателей объединены, дедублируются и отсортированы в алфавитном порядке.

  Используются первые 1024 записи, а в заголовках сообщений отмечаются важные сведения.

  Записи размером более 1024, которые не были синхронизированы с Azure AD, обрабатываются Outlook (но не Outlook в Интернете) и в заголовках сообщений не помечаются никакие сведения.

Как видите, что включение сообщения электронной почты с доверием от **моих** контактов уменьшает количество надежных отправителей и надежных получателей, которые можно синхронизировать. В этом случае рекомендуется использовать групповую политику для отключения этой функции.

- Имя файла: outlk16.opax
- Параметр политики: **Доверять сообщениям электронной почты от контактов**
