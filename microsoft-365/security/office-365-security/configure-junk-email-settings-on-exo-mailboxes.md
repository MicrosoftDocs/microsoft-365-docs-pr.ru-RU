---
title: Настройка параметров нежелательной почты в почтовых ящиках Exchange Online
ms.author: chrisda
author: chrisda
manager: dansimp
ms.date: ''
audience: Admin
ms.topic: how-to
localization_priority: Normal
search.appverid:
- MOE150
- MED150
- MBS150
- MET150
ms.collection:
- M365-security-compliance
description: Администраторы могут узнать, как настроить параметры нежелательной почты в почтовых ящиках Exchange Online. Многие из этих параметров доступны пользователям в Outlook или Outlook в Интернете.
ms.technology: mdo
ms.prod: m365-security
ms.openlocfilehash: 2aa75376a431ded5abf44ad17ddad4f0ac731fa8
ms.sourcegitcommit: a1846b1ee2e4fa397e39c1271c997fc4cf6d5619
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/09/2021
ms.locfileid: "50165695"
---
# <a name="configure-junk-email-settings-on-exchange-online-mailboxes"></a>Настройка параметров нежелательной почты в почтовых ящиках Exchange Online

[!INCLUDE [Microsoft 365 Defender rebranding](../includes/microsoft-defender-for-office.md)]

**Область применения**
- [Exchange Online Protection](https://go.microsoft.com/fwlink/?linkid=2148611)
- [Microsoft Defender для Office 365 (план 1 и план 2)](https://go.microsoft.com/fwlink/?linkid=2148715)
- [Microsoft 365 Defender](https://go.microsoft.com/fwlink/?linkid=2118804)

В организациях Microsoft 365 с почтовыми ящиками в Exchange Online параметры защиты от нежелательной почты организации контролируются Exchange Online Protection (EOP). Дополнительные сведения см. в сведениях о защите [от нежелательной почты в EOP.](anti-spam-protection.md)

Однако существуют также специальные параметры для борьбы с нежелательной почтой, которые администраторы могут настроить для отдельных почтовых ящиков в Exchange Online:

- **Включайте** или отключайте правило нежелательной почты: правило нежелательной почты — это скрытое правило для почты "Входящие" с именем "Правило нежелательной почты", которое включено по умолчанию в каждом почтовом ящике. Правило нежелательной почты управляет следующими функциями:

  - Перемещение сообщений в папку нежелательной почты на основе политик борьбы с нежелательной  **почтой:** если политика борьбы с нежелательной почтой настроена с действием "Переместить сообщение в папку нежелательной почты" для решения фильтра нежелательной почты, правило фильтрации нежелательной почты перемещает сообщение в папку нежелательной почты после его доставки в почтовый ящик. Дополнительные сведения о решениях фильтрации нежелательной почты в политиках нежелательной почты см. в подстройке "Настройка политик нежелательной [почты" в EOP.](configure-your-spam-filter-policies.md) Аналогично, если автоматическая очистка (ZAP) определяет, что доставленное сообщение является спамом или фишингом, правило  фильтрации нежелательной почты перемещает сообщение в папку нежелательной почты для перемещения сообщения в папку нежелательной почты. Дополнительные сведения о автоматической очистке см. в автоматической очистке нулевого часа [в Exchange Online.](zero-hour-auto-purge.md)

  - Параметры нежелательной почты, которые пользователи настраивают для себя  в Outlook или **Outlook в** Интернете: коллекция списков надежных отправителей— это список надежных отправителей, список надежных получателей и список заблокированных отправителей для каждого почтового ящика. Записи в этих списках определяют, перемещает ли правило нежелательной почты сообщение в папку "Входящие" или в папку нежелательной почты. Пользователи могут настроить коллекцию списков надежных адресов для своего почтового ящика в Outlook или Outlook в Интернете (прежнее название — Outlook Web App). Администраторы могут настроить коллекцию списков надежных адресов для любого почтового ящика пользователя.

Если для почтового ящика включено правило нежелательной почты, EOP может перемещать сообщения в папку нежелательной почты на основе решения фильтра нежелательной почты "Переместить сообщение в папку нежелательной почты" или в список заблокированных отправителей в почтовом ящике и запретить доставку сообщений в папку нежелательной почты (на основе списка надежных отправителей в почтовом ящике). 

 Если правило нежелательной почты отключено для почтового ящика, EOP не может перемещать сообщения в папку нежелательной почты на основе решения о фильтрации нежелательной почты **"** Переместить сообщение в папку нежелательной почты или коллекцию списков надежных адресов в почтовом ящике.

Администраторы могут использовать Exchange Online PowerShell, чтобы отключить, включить и просмотреть состояние правила нежелательной почты для почтовых ящиков. Администраторы также могут использовать Exchange Online PowerShell для настройки записей в коллекции списков надежных отправителей для почтовых ящиков (список надежных отправителей, список надежных получателей и список заблокированных отправителей).

> [!NOTE]
> Сообщения от отправителей, добавленные пользователями в собственные списки надежных отправителей, пропускают фильтрацию подключений в рамках EOP (SCL — -1). Чтобы запретить пользователям добавлять записи в список надежных отправителей в Outlook, используйте групповую политику, как упоминалось в разделе "О параметрах нежелательной почты" в  [Outlook](#about-junk-email-settings-in-outlook) далее в этой статье. К сообщениям по-прежнему будут применяться фильтрация политик, фильтрация содержимого и проверки Защитника для Office 365.

## <a name="what-do-you-need-to-know-before-you-begin"></a>Что нужно знать перед началом работы

- Процедуры, которые данная статья посвящена этой статье, можно использовать только в Exchange Online PowerShell. Сведения о том, как подключиться к Exchange Online PowerShell, см. в статье [Подключение к Exchange Online PowerShell](https://docs.microsoft.com/powershell/exchange/connect-to-exchange-online-powershell).

- Для работы с процедурами, которые данной статьи, вам должны быть назначены разрешения в Exchange Online. В частности, необходима  роль получателей почты (которая по умолчанию назначена  группам ролей "Управление организацией",  "Управление получателями" и  "Получатели настраиваемой почты") или "Параметры пользователя" (которая по умолчанию назначена группам ролей "Управление организацией" и "Help **Desk").** Чтобы добавить пользователей в группы ролей в Exchange Online, см. "Изменение [групп ролей в Exchange Online".](https://docs.microsoft.com/Exchange/permissions-exo/role-groups#modify-role-groups) Обратите внимание, что пользователи с разрешениями по умолчанию могут делать такие же процедуры в своем почтовом ящике, если у них есть доступ к [Exchange Online PowerShell.](https://docs.microsoft.com/powershell/exchange/disable-access-to-exchange-online-powershell)

- В автономных средах EOP, в которых EOP защищает локальные почтовые ящики Exchange, требуется настроить правила потока обработки почты (также называемые правилами транспорта) в локальной среде Exchange для преобразования решения фильтра нежелательной почты EOP, чтобы правило нежелательной почты могло перемещать сообщение в папку "Нежелательная почта". Дополнительные сведения см. в статье [Настройка автономной службы EOP для доставки спама в папку нежелательной почты в гибридных средах](ensure-that-spam-is-routed-to-each-user-s-junk-email-folder.md).

- Надежные отправители для общих почтовых ящиков не синхронизируются с Azure AD и EOP по проекту.

## <a name="use-exchange-online-powershell-to-enable-or-disable-the-junk-email-rule-in-a-mailbox"></a>Использование Exchange Online PowerShell для отключения или отключения правила нежелательной почты в почтовом ящике

> [!NOTE]
> Для отключения правила нежелательной почты для почтового ящика, открытого в Outlook (в режиме кэширования Exchange) или Outlook в Интернете, можно использовать только cmdlet **Set-MailboxJunkEmailConfiguration.** Если почтовый ящик не открыт, вы получите сообщение об ошибке: если вы хотите скрыть эту ошибку для массовых операций, можно добавить команду `The Junk Email configuration couldn't be set. The user needs to sign in to Outlook Web App before they can modify their Safe Senders and Recipients or Blocked Senders lists.` `-ErrorAction SilentlyContinue` **Set-MailboxJunkEmailConfiguration.**

Чтобы включить или отключить правило нежелательной почты для почтового ящика, используйте следующий синтаксис:

```PowerShell
Set-MailboxJunkEmailConfiguration -Identity <MailboxIdentity> -Enabled <$true | $false>
```

Пример отключения правила нежелательной почты для почтового ящика пользователя Ori Epstein.

```PowerShell
Set-MailboxJunkEmailConfiguration -Identity "Ori Epstein" -Enabled $false
```

Пример отключения правила нежелательной почты для всех почтовых ящиков пользователей организации.

```PowerShell
$All = Get-Mailbox -RecipientTypeDetails UserMailbox -ResultSize Unlimited; $All | foreach {Set-MailboxJunkEmailConfiguration $_.Name -Enabled $false}
```

Подробные сведения о синтаксисах и параметрах см. в описании [set-MailboxJunkEmailConfiguration.](https://docs.microsoft.com/powershell/module/exchange/set-mailboxjunkemailconfiguration)

> [!NOTE]
>
> - Если пользователь никогда не открывал свой почтовый ящик, при запуске предыдущей команды может возникнуть ошибка. Чтобы скрыть эту ошибку для массовых операций, добавьте команду `-ErrorAction SilentlyContinue` **Set-MailboxJunkEmailConfiguration.**
>
> - Даже если вы отключили правило нежелательной почты, фильтр нежелательной почты Outlook (в зависимости от того, как оно настроено) также может определить, является ли сообщение нежелательным, и может перемещать сообщения в папку "Входящие" или "Нежелаая почта" на основе собственного решения о нежелательной почте и коллекции списков надежных сообщений в почтовом ящике. Дополнительные сведения см. в разделе "О параметрах нежелательной почты" этой статьи в [Outlook.](#about-junk-email-settings-in-outlook)

### <a name="how-do-you-know-this-worked"></a>Как проверить, что все получилось?

Чтобы убедиться в том, что правило нежелательной почты для почтового ящика успешно включено или отключено, воспользуйтесь любой из приведенных ниже процедур.

- Замените имя, псевдоним или адрес электронной почты почтового ящика и запустите следующую команду, чтобы проверить значение _\<MailboxIdentity\>_ свойства **Enabled:**

  ```PowerShell
  Get-MailboxJunkEmailConfiguration -Identity "<MailboxIdentity>" | Format-List Enabled
  ```

## <a name="use-exchange-online-powershell-to-configure-the-safelist-collection-on-a-mailbox"></a>Настройка коллекции списков надежных адресов для почтового ящика с помощью Exchange Online PowerShell

В коллекцию списков надежных отправителей для почтового ящика входят списки надежных отправителей, надежных получателей и заблокированных отправителей. По умолчанию пользователи могут настраивать коллекцию списков надежных адресов в своих почтовых ящиках в Outlook или Outlook в Интернете. Администраторы же для настройки таких коллекций для почтовых ящиков пользователей могут воспользоваться командлетом **Set-MailboxJunkEmailConfiguration**. Соответствующие параметры описаны в таблице ниже.

****

|Параметр на Set-MailboxJunkEmailConfiguration|Параметр Outlook в Интернете|
|---|---|
|_BlockedSendersAndDomains_|**Перемещать электронную почту от этих отправителей и доменов в папку "Нежелательная почта"**|
|_ContactsTrusted_|**Доверять сообщениям электронной почты от моих контактов**|
|_TrustedListsOnly_|**Доверять только электронной почте с адресов в списке надежных отправителей и доменов и списках безопасных почтовых ящиков**|
|_TrustedSendersAndDomains_<sup>\*</sup>|**Не перемещать электронную почту от этих отправителей в папку нежелательной почты**|
|

<sup>\*</sup>**Примечания:**

- В Exchange Online **записи** домена в списке надежных отправителей или _параметре TrustedSendersAndDomains_ не распознаются, поэтому используйте только адреса электронной почты. В автономных EOP с синхронизацией каталогов записи домена по умолчанию не синхронизируются, но вы можете включить синхронизацию для доменов. Дополнительные сведения см. в [KB3019657.](https://support.microsoft.com/help/3019657)

- Изменить список надежных получателей напрямую с помощью параметра **Set-MailboxJunkEmailConfiguration** нельзя (параметр _TrustedRecipientsAndDomains_ не работает). Сначала нужно внести изменения в список надежных отправителей, и они синхронизируются со списком надежных получателей.

Для настройки коллекции списков надежных отправителей для почтового ящика следует использовать следующий синтаксис:

```PowerShell
Set-MailboxJunkEmailConfiguration <MailboxIdentity> -BlockedSendersAndDomains <EmailAddressesOrDomains | $null> -ContactsTrusted <$true | $false> -TrustedListsOnly <$true | $false> -TrustedSendersAndDomains  <EmailAddresses | $null>
```

Чтобы ввести несколько значений и перезаписать все существующие записи для параметров _BlockedSendersAndDomains_ и _TrustedSendersAndDomains,_ используйте следующий синтаксис: `"<Value1>","<Value2>"...` . Чтобы добавить или удалить одно или несколько значений, не затрагивая другие существующие записи, используйте следующий синтаксис: `@{Add="<Value1>","<Value2>"... ; Remove="<Value3>","<Value4>...}`

В примере ниже выполняется настройка следующих параметров для коллекции списков надежных отправителей в почтовом ящике пользователя Ori Epstein:

- Добавьте значение, shopping@fabrikam.com в список заблокированных отправителей.

- Удалите значение chris@fourthcoffee.com из списка надежных отправителей и списка надежных получателей.

- настройка контактов в папке контактов как надежных отправителей.

```PowerShell
Set-MailboxJunkEmailConfiguration "Ori Epstein" -BlockedSendersAndDomains @{Add="shopping@fabrikam.com"} -TrustedSendersAndDomains @{Remove="chris@fourthcoffee.com"} -ContactsTrusted $true
```

Пример удаления домена contoso.com из списка заблокированных отправителей для всех почтовых ящиков пользователей организации.

```PowerShell
$All = Get-Mailbox -RecipientTypeDetails UserMailbox -ResultSize Unlimited; $All | foreach {Set-MailboxJunkEmailConfiguration $_.Name -BlockedSendersAndDomains @{Remove="contoso.com"}}
```

Подробные сведения о синтаксисах и параметрах см. в описании [set-MailboxJunkEmailConfiguration.](https://docs.microsoft.com/powershell/module/exchange/set-mailboxjunkemailconfiguration)

> [!NOTE]
>
> - Если пользователь никогда не открывал свой почтовый ящик, при запуске предыдущих команд может возникнуть ошибка. Чтобы скрыть эту ошибку для массовых операций, добавьте команду `-ErrorAction SilentlyContinue` **Set-MailboxJunkEmailConfiguration.**
>
> - Даже если правило нежелательной почты отключено для почтового ящика, вы по-прежнему можете настроить коллекцию списков надежных адресов, а фильтр нежелательной почты Outlook может перемещать сообщения в папку "Входящие" или папку нежелательной почты. Дополнительные сведения см. в разделе "О параметрах нежелательной почты" этой статьи в [Outlook.](#about-junk-email-settings-in-outlook)
>
> - Фильтр нежелательной почты Outlook имеет дополнительные параметры коллекции списков надежных отправителей (например, автоматически добавлять людей, которых я отправляю, в список надежных **отправителей).** Дополнительные сведения см. в теме "Использование фильтров нежелательной почты для управления [тем, какие сообщения вы видите".](https://support.microsoft.com/office/274ae301-5db2-4aad-be21-25413cede077)

### <a name="how-do-you-know-this-worked"></a>Как проверить, что все получилось?

Чтобы убедиться в том, что коллекция списков надежных отправителей для почтового ящика успешно настроена, воспользуйтесь любой из приведенных ниже процедур.

- Замените имя, псевдоним или адрес электронной почты почтового ящика и запустите следующую команду, чтобы проверить _\<MailboxIdentity\>_ значения свойств:

  ```PowerShell
  Get-MailboxJunkEmailConfiguration -Identity "<MailboxIdentity>" | Format-List trusted*,contacts*,blocked*
  ```

  Если список значений слишком длинный, используйте синтаксис:

  ```PowerShell
  (Get-MailboxJunkEmailConfiguration -Identity <MailboxIdentity>).BlockedSendersAndDomains
  ```

## <a name="about-junk-email-settings-in-outlook"></a>Сведения о параметрах нежелательной почты в Outlook

Чтобы включить, отключить и настроить параметры клиентского фильтра нежелательной почты, доступные в Outlook, используйте групповую политику. Дополнительные сведения см. в файлах административных шаблонов [(ADMX/ADML)](https://www.microsoft.com/download/details.aspx?id=49030) и в средстве настройки Office для приложений Microsoft 365 для предприятий, Office 2019 и Office 2016, а также в том, как развернуть параметры нежелательной почты, такие как список надежных отправителей, с помощью групповой [политики.](https://support.microsoft.com/help/2252421)

Если для фильтра нежелательной почты  Outlook установлено  значение по умолчанию "Нет автоматической фильтрации" в параметрах домашней нежелательной почты, Outlook не пытается классифицировать сообщения как нежелательные, но использует коллекцию списков надежных отправителей (список надежных \>  \>  \> отправителей, список надежных получателей и список заблокированных отправителей) для перемещения сообщений в папку нежелательной почты после доставки. Дополнительные сведения об этих параметрах см. в [обзоре фильтра нежелательной почты.](https://support.microsoft.com/office/5ae3ea8e-cf41-4fa0-b02a-3b96e21de089)

Если для фильтра нежелательной почты Outlook выбран параметр **Низкий** или **Высокий**, то фильтр нежелательной почты Outlook использует собственную технологию фильтрации SmartScreen для определения и перемещения спама в папку "Нежелательная почта". Эта классификация нежелательной почты отделена от уровня уверенности в нежелательной почте (SCL), определяемой EOP. На самом деле Outlook игнорирует SCL из EOP (если только EOP не поместит сообщение для пропуска фильтрации нежелательной почты) и использует собственные критерии, чтобы определить, является ли сообщение спамом. Конечно, решение о нежелательной почте из EOP и Outlook может быть одинаковым. Дополнительные сведения об этих параметрах см. в подмене уровня защиты фильтра [нежелательной почты.](https://support.microsoft.com/office/e89c12d8-9d61-4320-8c57-d982c8d52f6b)

> [!NOTE]
> В ноябре 2016 г. корпорация Майкрософт перестала выпускать обновления определений нежелательной почты для фильтров SmartScreen в Exchange и Outlook. Существующие определения нежелательной почты SmartScreen были оставлены на месте, но их эффективность, скорее всего, со временем ухудшена. Дополнительные сведения см. в статье [Прекращение поддержки SmartScreen в Outlook и Exchange](https://techcommunity.microsoft.com/t5/exchange-team-blog/deprecating-support-for-smartscreen-in-outlook-and-exchange/ba-p/605332).

Таким образом, фильтр нежелательной почты Outlook может использовать коллекцию списков надежных адресов почтового ящика и собственную классификацию нежелательной почты для перемещения сообщений в папку нежелательной почты, даже если правило нежелательной почты отключено в почтовом ящике.

Outlook и Outlook в Интернете поддерживают коллекцию списков надежных надежных пользователей. Коллекция списков надежных адресов сохранена в почтовом ящике Exchange Online, поэтому изменения в коллекции списков надежных адресов в Outlook отображаются в Outlook в Интернете и наоборот.

## <a name="limits-for-junk-email-settings"></a>Ограничения для параметров нежелательной почты

Коллекция списков надежных отправителей (список надежных отправителей, список надежных получателей и список заблокированных отправителей), хранимая в почтовом ящике пользователя, также синхронизируется с EOP. При синхронизации службы каталогов коллекция списков надежных подписей синхронизируется с Azure AD.

- Размер коллекции списков надежных адресов в почтовом ящике пользователя составляет 510 КБ, включая все списки, а также дополнительные параметры фильтра нежелательной почты. Если пользователь превышает это ограничение, он получит ошибку Outlook, которая выглядит так:

  > Не удается добавить в списки нежелательной почты сервера. Допустимый размер на сервере больше. Фильтр нежелательной почты на сервере будет отключен до тех пор, пока список нежелательной почты не уменьшится до допустимого на сервере размера.

  Дополнительные сведения об этом ограничении и его изменении см. в [KB2669081.](https://support.microsoft.com/help/2669081)

- Для синхронизированной коллекции списков надежных надежных почт в EOP имеются следующие ограничения синхронизации:

  - 1024 записей в списке надежных отправителей, списке надежных  получателей и внешних контактах, если включено доверие электронной почте от моих контактов.
  - 500 записей в списке заблокированных отправителей и списка заблокированных доменов.

  После ограничения на количество записей в 1024 происходит следующее:

  - Список перестает принимать записи в PowerShell и Outlook в Интернете, но ошибка не отображается.

    Пользователи Outlook могут добавлять более 1024 записей, пока не достигнут предел в 510 КБ в Outlook. Outlook может использовать эти дополнительные записи, если фильтр EOP не блокирует сообщение перед доставкой в почтовый ящик (правила потока почты, анти спуфинг и т. д.).

- При синхронизации службы каталогов записи синхронизируются с Azure AD в следующем порядке:

  1. Почтовые контакты, если включено доверие **электронной** почте от моих контактов.
  2. Список надежных отправитель и список надежных получателей объединяются, дублируются и сортируются в алфавитном порядке при изменении первых 1024 записей.

  Используются первые 1024 записи, и в них помеются соответствующие сведения.

  Записи старше 1024 года, которые не были синхронизированы с Azure AD, обрабатываются Outlook (а не Outlook в Интернете), и никакие сведения не помечены в сообщениях.

Как видно, включение сообщения  с доверием из параметров контактов сокращает число надежных отправителей и надежных получателей, которые можно синхронизировать. Если это является проблемой, мы рекомендуем отключить эту функцию с помощью групповой политики:

- Имя файла: outlk16.opax
- Параметр политики: **доверять электронной почте от контактов**
