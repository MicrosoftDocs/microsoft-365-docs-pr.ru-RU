---
title: Трассировка сообщений в Центре безопасности и соответствия требованиям
f1.keywords:
- NOCSH
ms.author: chrisda
author: chrisda
manager: dansimp
audience: ITPro
ms.topic: how-to
ms.service: O365-seccomp
localization_priority: Normal
ms.assetid: 3e64f99d-ac33-4aba-91c5-9cb4ca476803
ms.custom:
- seo-marvel-apr2020
description: Администраторы могут использовать трассировку сообщений в Центре безопасности & безопасности, чтобы определить, что произошло с сообщениями.
ms.openlocfilehash: c6e1f8f9280c84ab6ff6a1572d902ed1d4d4caa3
ms.sourcegitcommit: e12fa502bc216f6083ef5666f693a04bb727d4df
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "46827055"
---
# <a name="message-trace-in-the-security--compliance-center"></a>Трассировка сообщений в Центре безопасности и соответствия требованиям

## <a name="message-trace-features"></a>Функции трассировки сообщений

Трассировка сообщений в Центре безопасности & отслеживает сообщения электронной почты по мере их прохождения через организацию Exchange Online. Можно определить, было ли сообщение получено, отклонено, отложено или доставлено службой. В нем также показаны действия, выполненные над сообщением, до того как оно достигло окончательного состояния.

Трассировка сообщений в Центре безопасности & требованиям улучшается при трассировке исходных сообщений, доступной через Центр администрирования Exchange (EAC). Информация трассировки сообщений позволяет эффективно отвечать на вопросы пользователей о том, что случилось с сообщениями, устранять неполадки потока обработки почты и проверять изменения политики.

> [!NOTE]
>
> - Для трассировки сообщений вы должны быть членом группы ролей "Управление организацией", "Управление соответствием требованиям" или "Служба поддержки". Дополнительные сведения см. в статье [Разрешения в Центре безопасности и соответствия требованиям](permissions-in-the-security-and-compliance-center.md).
>
> - Максимальное число отображаемых в результатах сообщений зависит от выбранного типа отчета (дополнительные сведения см. в разделе ["Выбор](#choose-report-type) типа отчета"). Командлет [Get-HistoricalSearch](https://docs.microsoft.com/powershell/module/exchange/get-historicalsearch) в Exchange Online PowerShell или автономный командлет EOP PowerShell возвращает все сообщения в результатах.

## <a name="open-message-trace"></a>Открытие трассировки сообщений

1. Откройте Центр безопасности & соответствия требованиям на <https://protection.office.com> сайте.

2. Разверните **"Поток обработки почты",** а затем выберите **трассировку сообщений.**

## <a name="message-trace-page"></a>Страница трассировки сообщений

Отсюда можно запустить новую трассировку по умолчанию, нажав **кнопку "Начать трассировку".** При этом будет выполнен поиск всех отправителей и получателей за последние два дня. Или можно использовать один из сохраненных запросов из доступных категорий запроса и либо запустить их в исходном виде, либо использовать их как отправную точку для собственных запросов.

- **Запросы по умолчанию:** встроенные запросы, предоставляемые Microsoft 365.

- **Пользовательские запросы:** запросы, сохраненные администраторами организации для использования в будущем.

- **Автоматически сохраненные запросы**— последние из них недавно выполняются. Этот список упрощает продолжить работать с того места, где вы остановились.

Кроме того, на этой **странице** находится раздел доступных для загрузки отчетов по отправленным запросам, а также самим отчетам о наличии.

## <a name="options-for-a-new-message-trace"></a>Параметры трассировки нового сообщения

### <a name="filter-by-senders-and-recipients"></a>Фильтрация по отправителям и получателям

Значения по умолчанию **: Все отправители** **и все получатели,** но вы можете использовать следующие поля для фильтрации результатов:

- **Понятие**этих пользователей: щелкните это поле, чтобы выбрать одного или нескольких отправителей из организации. Вы также можете начать вводить имя и элементы списка будут фильтроваться по введенному вами сообщению, аналогично поведу страницы поиска.

- **Для этих людей:** щелкните это поле, чтобы выбрать одного или нескольких получателей в организации.

> [!NOTE]
> Вы также можете ввести адреса электронной почты внешних отправителей и получателей. Поддерживаются подстановочные знаки (например, ), но в одном поле нельзя одновременно использовать несколько `*@contoso.com` записей подстановочных знаков. <br/><br/> Вы можете вставить несколько отправителей или списков получателей чисел точкой с запятой ( `;` ). пробелы ( `\s` ), ), ), ( ) ( `\r` `\n` ).

### <a name="time-range"></a>Диапазон времени

Значение по умолчанию **составляет 2 дня,** но вы можете указать диапазоны дат и времени, которые могут быть до 90 дней. При использовании диапазонов дат и времени следует учитывать следующие факторы:

- По умолчанию вы выбираете диапазон времени в представлении **ползунка** с использованием временной шкалы. Можно выбрать только отображаемые параметры дня или времени. Попытка выбрать значение "Между значением" приведет к прикреплению начального или конца к ближайшему отображаемому значению параметра.

  ![Ползунок в новом трассировке сообщений в Центре безопасности & соответствия требованиям](../../media/55a9e9c1-f7d5-4047-b217-824e8b976bcb.png)

  Однако вы также можете выбрать **настраиваемое** представление, где можно указать значения **даты начала** **и окончания** (включая время), а также выбрать **часовой пояс** для диапазона дат/времени. Обратите внимание, что настройка **часового** пояса применяется как к входным, так и к результатам запроса.

  ![Пользовательский диапазон времени нового трассировки сообщений в Центре безопасности & соответствия требованиям](../../media/ed4c8d50-9ea5-4694-93f9-ee3ab6660b4f.png)

  На 10 и меньше ее результаты **Summary** становятся доступны мгновенно в сводных отчетах. Если указать диапазон времени, который еще немного превышает 10 дней, то результаты будут откладываться, так как они доступны только как доступный для загрузки CSV-файл **(расширенные сводные** сведения или **расширенные отчеты).**

  Дополнительные сведения о различных типах отчетов см. в разделе ["Выбор типа отчета"](#choose-report-type) данной статьи.

  **Примечание. Для**подготовки отчета с помощью архивированных данных трассировки сообщений может потребоваться до нескольких часов. В зависимости от того, сколько других администраторов также отправляли запросы отчетов за то же время, можно заметить задержку перед началом обработки для запроса в очереди.

- При сохранении запроса в представлении **ползунка** сохраняется относительный диапазон времени (например, за 3 дня от сегодняшнего дня). Сохранение запроса в **пользовательском представлении** сэкономит абсолютный диапазон дат и времени (например, с 2018-05-06 13:00 до 2018-05-08 18:00).

### <a name="more-search-options"></a>Дополнительные параметры поиска

#### <a name="delivery-status"></a>Состояние доставки.

Чтобы отфильтровать результаты, **оставьте все** значения по умолчанию или выберите одно из следующих значений:

- **Доставлено:** сообщение успешно доставлено в место назначения.

- **В ожидании:** попытка доставки или повторной доставки сообщения.

- **Расширено:** получателя группы рассылки был расширен до доставки отдельным членам группы.

- **Failed**: Сообщение не было доставлено.

- **Поместилось**в карантин: сообщение помещено в карантин (как спам, массовая рассылка или фишинг). Дополнительные сведения см. в статье "Сообщения [электронной почты, помещенные на карантин" в службе EOP.](quarantine-email-messages.md)

- **Фильтруется как нежелательная почта:** сообщение было обнаружено как спам, отклонено или заблокировано (не в карантин).

- **Получение состояния:** Сообщение было получено недавно Microsoft 365, но другие данные о состоянии еще недоступны. Вернитесь в течение нескольких минут.

**Примечание.** Значения, **ожидающие, помещенные** **в карантин**и **фильтрация** в качестве нежелательных сообщений, доступны для поиска менее чем через 10 дней. Кроме того, между фактическим и переданным состоянием доставки может быть 0-10 минута.

#### <a name="message-id"></a>ИД сообщения

Это идентификатор интернет-сообщения (также называемый кодом клиента), который находится в **поле "Идентификатор клиента"** в заголовке сообщения. Пользователи могут позволять проанализировать определенные сообщения.

Это значение не изменяется на протяжении всего времени жизни сообщения. Для сообщений, созданных в Microsoft 365 или Exchange, значение задается в формате, включая угловые `<GUID@ServerFQDN>` скобки ( \< \> ). Например, `<d9683b4c-127b-413a-ae2e-fa7dfb32c69d@DM3NAM06BG401.Eop-nam06.prod.protection.outlook.com>`. В других системах обмена сообщениями могут использоваться другие значения или синтаксис. Это значение должно быть уникальным, но не все почтовые системы строго следуют этому требованию. Если поле **заголовка Message-ID:** не существует или пусто для входящих сообщений из внешних источников, назначается произвольное значение.

При фильтрации результатов с использованием **идентификатора** сообщения не забудьте включить полную строку, включая любые угловые скобки.

#### <a name="direction"></a>Direction

Можно оставить значение по умолчанию **"Все"** или выбрать входящие **(сообщения,** отправленные получателям в вашей организации) **или** исходящие (сообщения от пользователей в вашей организации), чтобы отфильтровать результаты.

#### <a name="original-client-ip-address"></a>Исходный IP-адрес клиента.

Вы можете провести эту совпадение по IP-адресу клиента, чтобы изучить взломанные компьютеры с большой вероятностью нежелательной почты или вредоносных программ. Несмотря на то что сообщения поступают от нескольких отправителей, весьма вероятно, на одном компьютере будут поступать все сообщения.

**Примечание.** Сведения об IP-адресах клиентов доступны только в течение 10 дней и доступны только в расширенных **сводных** и **расширенных** отчетах (загружаемых CSV-файлах).

### <a name="choose-report-type"></a>Выберите тип отчета

Ниже перечислены доступные типы отчетов.

- **Сводка.** Доступно, если диапазон времени менее 10 дней и требует дополнительных параметров фильтрации. Результаты становятся доступны практически сразу после нажатия кнопки **"Поиск".** Отчет возвращает до 20 000 результатов.

- **Улучшенная сводка** **или расширенные**сведения: эти отчеты доступны только как загружаемые CSV-файлы. Кроме того, для них требуется один или несколько из следующих параметров фильтрации, независимо от временного диапазона: **этим пользователям,** **для этих**пользователей или **код сообщения.** Вы можете использовать подстановочные знаки для отправителей или получателей (например, \* @contoso.com). Расширенный сводный отчет возвращает до 50000 результатов. Расширенный отчет возвращает до 1000 результатов.

**Примечания**:

- Для подготовки сводки и расширенного отчета используются архивированные данные трассировки сообщений, и может потребоваться до нескольких часов, прежде чем ваш отчет станет доступным для загрузки. В зависимости от того, сколько других администраторов также отправили запросы отчетности за то же время, можно заметить задержку на начало обработки запроса в очереди.

- Хотя можно выбрать расширенный сводный или расширенный отчет для любого диапазона дат и времени, обычно за последние четыре часа архивированных данных будут недоступны для этих двух типов отчетов.

После **нажатия кнопки**"Далее" отображается страница сводки со списком выбранных параметров фильтрации, уникального (редактируемого) заголовка отчета и электронный адрес, получающий уведомление после завершения трассировки сообщений (также можно изменять и находиться на одном из обслуживаемых вашей организацией доменов). Нажмите **кнопку "Подготовить** отчет", чтобы отправить трассировку сообщений. На основной **странице трассировки** сообщений состояние отчета отображается в разделе "Доступные для **загрузки** отчеты".

Дополнительные сведения о сведениях, которые возвращаются в различных типах отчетов, см. в следующем разделе.

## <a name="message-trace-results"></a>Результаты трассировки сообщений

Различные типы отчетов возвращают различные уровни информации. Сведения, доступные в различных отчетах, приведены в следующих разделах.

### <a name="summary-report-output"></a>Выходные данные сводных отчет

После запуска трассировки сообщений результаты будут отсортированы по дате и времени в порядке убывания (самые последние).

![Сводные результаты трассировки сообщений в Центре безопасности & соответствия требованиям](../../media/0664bafe-0b03-477b-b571-0b046ac8c977.png)

Сводный отчет содержит следующие сведения:

- **Дата.** Дата и время в формате UTC, когда служба получила сообщение (согласно настройкам часового пояса).

- **Отправитель:** электронный адрес отправителя *(псевдоним)* @ *отправителя.*

- **Recipient**: адрес электронной почты получателя или получателей. Для сообщения, отправленного нескольким получателям, для каждого получателя выравнина одна строка. Если получателем является группа рассылки, динамическая группа рассылки или группа безопасности с включенной поддержкой почты, группа будет первым получателем, а каждый ее участник будет вывезывать в отдельную строку.

- **Subject**— первые 256 символов **темы сообщения:** поле.

- **Status:** Эти значения описаны в [разделе "Состояние](#delivery-status) доставки".

По умолчанию загружаются и доступны первые 250 результатов. При прокрутке вниз на экране присутствует нечто паузы, когда следующий пакет результатов загружается. Вместо прокрутки можно нажать **"Загрузить** все" для загрузки всех результатов размером до 10 000.

Чтобы отсортировать результаты по значениям столбца по возрастанию или убыванию, щелкните заголовок столбца.

Можно щелкнуть **"Фильтровать результаты",** чтобы отфильтровать результаты по одному или нескольким столбцам.

Результаты можно экспортировать, выбрав одну или несколько строк. Для этого нажмите **"Экспорт результатов"** и выберите **команду "Экспортировать все результаты",** **"Экспортировать**все результаты" или **"Экспортировать выбранные результаты".**

#### <a name="find-related-records-for-this-message"></a>Поиск связанных записей для этого сообщения

Связанные записи это записи с одинаковым идентификатором сообщения. Помните, что создавать несколько записей может только одно сообщение, отправленное между двумя пользователями. Увеличивается, когда на сообщение влияет расширение группы рассылки, пересылка, правила потока обработки почты (правила транспорта) и т. д.

После установки флажка строки можно найти связанные записи для сообщения, нажав появившуюся кнопку **"Найти** связанные" или выбрав **More options** ![ дополнительные ](../../media/1ea52bbf-9d00-48ce-9362-307f7f6fb7fe.png) \> **параметры "Найти связанные записи" для этого сообщения).**

Дополнительные сведения о идентификаторе сообщения см. в разделе "Код сообщения" выше в этой статье.

#### <a name="message-trace-details"></a>Сведения о трассировке сообщений

В выходных данных сводного отчета можно просмотреть сведения о сообщении с помощью одного из следующих методов.

- Выберите строку (щелкните в любом месте строки, кроме флажка).

- Установите флажок строки и нажмите кнопку Дополнительные **параметры просмотра** ![ ](../../media/1ea52bbf-9d00-48ce-9362-307f7f6fb7fe.png) \> **сведений о сообщении.**

   ![Сведения после двойного щелчка по строке в результатах трассировки сводных отчетов в Центре безопасности & соответствия требованиям](../../media/e50ee7cd-810a-4c06-8b58-e56ffd7028d1.png)

В отчете о трассировке сообщений содержатся следующие дополнительные сведения, отсутствующие в сводном отчете:

- **События сообщений:** этот раздел содержит классификации, которые помогают определить действия, принимаемые службой с сообщениями. **Наиболее интересные события,** которые могут возникнуть:

  - **Receive:** Сообщение получено службой.

  - **"Отправить:** Сообщение отправлено службой".

  - **Fail:** Сбой доставки сообщения.

  - **Доставка:** сообщение доставлено в почтовый ящик.

  - **Расширение**: Сообщение отправлено в группу рассылки, которая была расширена.

  - **Transfer:** Получатели были перемещены в раздуманное сообщение из-за преобразования содержимого, ограничений, налогов на количество получателей сообщения или агентов.

  - **Отложено:** доставка сообщения была отложена и повторна попытка доставить сообщение может быть повторена.

  - **Решение:** сообщение перенаправлено по новому адресу получателя на основании поиска в Active Directory. В этом случае исходный адрес получателя указывается в отдельной строке трассировки сообщений вместе с итоговым состоянием доставки сообщения.

  Примечания:

  - Если успешно доставленное сообщение, в трассировке сообщений будет **создано** несколько записей о событиях.

  - Этот список не является ислочным. Описание дополнительных событий см. в [описании типов событий в журнале отслеживания сообщений.](https://docs.microsoft.com/Exchange/mail-flow/transport-logs/message-tracking#event-types-in-the-message-tracking-log) Обратите внимание, что эта ссылка представляет собой статью, связанную с Exchange Server (локальной службой Exchange).

- **Дополнительные сведения:** этот раздел содержит следующие сведения:

  - **Идентификатор сообщения:** это значение описано в разделе ["Код сообщения"](#message-id) выше в этой статье. Например, `<d9683b4c-127b-413a-ae2e-fa7dfb32c69d@DM3NAM06BG401.Eop-nam06.prod.protection.outlook.com>`.

  - **Размер сообщения**.

  - **From IP**: IP-адрес компьютера, с которого было отправлено сообщение. Для исходящих сообщений, отправленных из Exchange Online, это значение будет пустым.

  - **Для**IP-адреса: IP-адрес или IP-адреса, по которых служба попыталась доставить сообщение. Если у сообщения несколько получателей, то отображается следующее. Для входящих сообщений, отправленных в Exchange Online, это значение будет пустым.

### <a name="enhanced-summary-reports"></a>Расширенные сводные отчеты

Доступные (заполненные) расширенные сводные отчеты доступны в разделе **загружаемых отчетов** в начале трассировки сообщений. В отчете содержатся следующие сведения:

- **origin_timestamp:** дата и время первоначального получения сообщения службой <sup>*</sup> с использованием настроенного часового пояса в формате UTC.

- **sender_address:** Электронный адрес отправителя *(домен* @ *псевдонима).*

- **Recipient_status:** состояние доставки сообщения получателю. Если сообщение было отправлено нескольким получателям, в нем будут показаны все получатели и соответствующий статус для каждого из них в следующем формате: \<*email address*\> ## \<*status*\> Пример:

  - **##Receive". "Отправить"** сообщение означает, что сообщение получено службой и отправлено в место назначения.

  - **##Receive " Fail" означает,** что сообщение было получено службой, но не удалось доставить сообщение по назначению.

  - **##Receive Запись** это означает, что сообщение получено службой и доставлено в почтовый ящик получателя.

- **message_subject:** первые 256 символов в поле **темы** сообщения.

- **total_bytes:** Размер сообщения в байтах, включая вложения.

- **message_id:** это значение описано в разделе ["Код сообщения"](#message-id) выше в этой статье. Например, `<d9683b4c-127b-413a-ae2e-fa7dfb32c69d@DM3NAM06BG401.Eop-nam06.prod.protection.outlook.com>`.

- **network_message_id**: уникальное значение идентификатора сообщения, которое сохраняется во всех копиях сообщения, которые могут создаваться в связи с развертыванием или расширением группы рассылки. Пример `1341ac7b13fb42ab4d4408cf7f55890f` значения: .

- **original_client_ip:** IP-адрес клиента отправителя.

- **directionality:** указывает, было ли сообщение входящим (1) или исходящим (2) из вашей организации.

- **connector_id:** имя исходного или конечного соединителя. Дополнительные сведения о соединителях в Exchange Online см. в статье ["Настройка потока обработки почты с помощью соединителей в Office 365".](https://docs.microsoft.com/Exchange/mail-flow-best-practices/use-connectors-to-configure-mail-flow/use-connectors-to-configure-mail-flow)

- **delivery_priority:** <sup>*</sup> указывает, было ли сообщение отправлено: с **низким,** **низким** **или обычным** приоритетом.

<sup>*</sup>Эти свойства доступны только в расширенных сводных отчетах.

### <a name="extended-reports"></a>Расширенные отчеты

Доступные расширенные отчеты (заполненные) доступны в разделе **загружаемых** отчетов в начале трассировки сообщений. По любую информацию из расширенного сводного отчета доступна в расширенном отчете (кроме **origin_timestamp** **и delivery_priority).** Следующие сведения доступны только в расширенном отчете:

- **client_ip:** IP-адрес почтового сервера или клиента обмена сообщениями, который отправил сообщение.

- **client_hostname:** Имя узла или полное доменное имя почтового сервера или клиента обмена сообщениями, который отправил сообщение.

- **server_ip:** IP-адрес исходного или конечного сервера.

- **server_hostname:** Имя узла или полное доменное имя конечного сервера.

- **source_context:** дополнительные сведения, связанные с **исходным полем.** Пример:

  - `Protocol Filter Agent`

  - `3489061114359050000`

- **source**— компонент Exchange Online, отвечающий за событие. Пример:

  - `AGENT`

  - `MAILBOXRULE`

  - `SMTP`

- **event_id.** Они соответствуют значениям событий **Message,** которые объясняются в [записях, связанных с этим сообщением.](#find-related-records-for-this-message)

- **internal_message_id.** Идентификатор сообщения, назначенный сервером Exchange Online, который в настоящий момент обрабатывает сообщение.

- **recipient_address:** адреса электронной почты получателей сообщения. Если указано несколько адресов, то они отделяются друг от друга точкой с запятой (;).

- **recipient_count:** общее количество получателей сообщения.

- **related_recipient_address**: используется `EXPAND` `REDIRECT` с, , и событиями для `RESOLVE` отображения других адресов электронной почты получателей, связанных с сообщением.

- **reference:** это поле содержит дополнительные сведения о конкретных типах событий. Пример:

  - **DSN**— содержит ссылку на **отчет, являющуюся message_id связанным** уведомлением о доставке (также называемого сообщением о доставке, отчетом о недоставке, отчетом о недоставке или сообщением о недоставке), если после события создается DSN. Если это сообщение DSN, в этом поле **message_id содержится значение исходного** сообщения, для которого было создано уведомление о доставке.

  - **EXPAND**— **содержит related_recipient_address** связанных сообщений.

  - **RECEIVE:** может **message_id значение** связанного сообщения, если сообщение было создано другими процессами (например, правилами для папки "Входящие").

  - **SEND**— содержит **internal_message_id значение** любого сообщения DSN.

  - **TRANSFER**: **internal_message_id** значение вступящего в запрос (например, в результате преобразования содержимого, ограничений, налоговых на получателей сообщения или агентов).

  - **MAILBOXRULE:** содержит **internal_message_id входящего** сообщения, из-за которого правило для папки "Входящие" создало исходящее сообщение.

    Для других типов событий это поле обычно не заполнено.

- **return_path:** адрес электронной почты, который указан **командой MAIL FROM,** отправившей сообщение. Несмотря на то что это поле не является пустым, в нем может быть указан нулевой адрес `<>` отправителя.

- **message_info.** Дополнительные сведения о сообщении. Пример:

  - Дата и время поступления сообщения в формате UTC и `DELIVER` `SEND` для событий. Это дата и время первого поступения сообщения в организацию Exchange Online. Дата и время в формате UTC представлены в формате ISO 8601: `yyyy-mm-ddThh:mm:ss.fffZ` ; `yyyy` где = `mm` год, месяц, день, указывает на начало компонента `dd` `T` `hh` времени, = `mm` час, минуту, `ss` = секунду, = доли секунды, — доли секунды и означает, что является другой способ `fff` `Z` `Zulu` обозначения времени в формате UTC.

  - Ошибки проверки подлинности. Например, можно увидеть значение `11a` и тип проверки подлинности, который использовался при возникновении ошибки проверки подлинности.

- **tenant_id:** значение GUID, представляющее организацию Exchange Online (например, `39238e87-b5ab-4ef6-a559-af54c6b07b42` ).

- **original_server_ip:** IP-адрес исходного сервера.

- **custom_data :** содержит данные, связанные с определенными типами событий. Дополнительные сведения см. в следующих разделах.

#### <a name="custom_data-values"></a>custom_data значений

Поле **custom_data для** события используется различными агентами Exchange Online для записи в журнал `AGENTINFO` сведений об обработке сообщений. Некоторые из наиболее интересных агентов описаны в следующих разделах.

#### <a name="spam-filter-agent"></a>Агент фильтрации нежелательной почты

Значениеcustom_data **которое** начинается с `S:SFA` агента фильтра нежелательной почты. Основные сведения представлены в следующей таблице:

****

|Значение|Описание|
|---|---|
|`SFV=NSPM`|Сообщение помечено как не являющееся нежелательным и отправлено указанным получателям.|
|`SFV=SPM`|Сообщение помечено как нежелательное средством фильтрации нежелательной почты (также называемой фильтрацией содержимого).|
|`SFV=BLK`|Фильтрация была пропущена, а сообщение было заблокировано, так как оно исходило от заблокированного отправителя.|
|`SFV=SKS`|Сообщение помечено как нежелательное до обработки фильтром нежелательной почты. Это применяется к сообщениям, сопоставленным с правилом потока обработки почты (другое название — правило транспорта), требующим автоматически помечать их как нежелательные и обходить любую дополнительную фильтрацию.|
|`SCL=<number>`|Дополнительные сведения о различных значениях вероятности нежелательной почты и их значении см. в разделе [Вероятность нежелательной почты](spam-confidence-levels.md).    |
|`PCL=<number>`|Значение вероятности фишинга для сообщения. Эти значения можно интерпретировать так же, как и значения SCL, которые задокументированы в [Вероятность нежелательной почты](spam-confidence-levels.md).  |
|`DI=SB`|Отправитель сообщения заблокирован.|
|`DI=SQ`|Сообщение перемещено в карантин.|
|`DI=SD`|Сообщение удалено.|
|`DI=SJ`|Сообщение отправлено в папку нежелательной почты получателя.|
|`DI=SN`|Сообщение перенаправлено через пул обычной исходящей доставки.|
|`DI=SO`|Сообщение перенаправлено через пул высокого риска доставки. Дополнительные сведения см. в статье [Пул доставки сообщений с высоким уровнем опасности](high-risk-delivery-pool-for-outbound-messages.md).|
|`SFS=[a]|SFS=[b]`|Это означает выполнение правил нежелательной почты.|
|`IPV=CAL`|Сообщение пропущено через фильтр нежелательной почты, поскольку IP-адрес указан в списке разрешенных IP-адресов в фильтре подключений.|
|`H=<EHLOstring>`|Строка HELO или EHLO подключающегося почтового сервера.|
|`PTR=<ReverseDNS>`|Запись PTR отправляющего IP-адреса, называемая также обратным DNS-адресом.|
|

Ниже **приведено custom_data** значение для сообщения, отфильтрованного для нежелательной почты:

`S:SFA=SUM|SFV=SPM|IPV=CAL|SRV=BULK|SFS=470454002|SFS=349001|SCL=9|SCORE=-1|LIST=0|DI=SN|RD=ftmail.inc.com|H=ftmail.inc.com|CIP=98.129.140.74|SFP=1501|ASF=1|CTRY=US|CLTCTRY=|LANG=en|LAT=287|LAT=260|LAT=18;`

#### <a name="malware-filter-agent"></a>Агент фильтрации вредоносных программ

Значение **custom_data,** которое начинается с `S:AMA` агента фильтрации вредоносных программ. Основные сведения представлены в следующей таблице:

****

|Значение|Описание|
|---|---|
|`AMA=SUM|v=1|` или `AMA=EV|v=1`|Сообщение помечено как содержащее вредоносные программы. `SUM` указывает, что вредоносное ПО могло быть обнаружено каким-либо числом обработчиков. `EV` указывает, что вредоносная программа была обнаружена определенным обработчиком. Если обработчиком обнаружены вредоносные программы, это вызывает последующие действия.|
|`Action=r`|Сообщение заменено.|
|`Action=p`|Сообщение не проходило фильтрацию.|
|`Action=d`|Сообщение отложено.|
|`Action=s`|Сообщение удалено.|
|`Action=st`|Сообщение не проходило фильтрацию.|
|`Action=sy`|Сообщение не проходило фильтрацию.|
|`Action=ni`|Сообщение отклонено.|
|`Action=ne`|Сообщение отклонено.|
|`Action=b`|Сообщение заблокировано.|
|`Name=<malware>`|Имя обнаруженной вредоносной программы.|
|`File=<filename>`|Имя файла, содержащего вредоносные программы.|
|

Ниже **приведено custom_data** вредоносная программа.

`S:AMA=SUM|v=1|action=b|error=|atch=1;S:AMA=EV|engine=M|v=1|sig=1.155.974.0|name=DOS/Test_File|file=filename;S:AMA=EV|engine=A|v=1|sig=201707282038|name=Test_File|file=filename`

#### <a name="transport-rule-agent"></a>Агент правил транспорта

**Значениеcustom_data** которое начинается с агента правил транспорта для правил `S:TRA` потока обработки почты (их также известного как правила транспорта). Основные сведения представлены в следующей таблице:

****

|Значение|Описание|
|---|---|
|`ETR|ruleId=<guid>`|Выполнено правило идентификатора.|
|`St=<datetime>`|Дата и время (в формате UTC) выполнения правила.|
|`Action=<ActionDefinition>`|Примененное действие. Список доступных действий см. в статье о [действиях правил обработки почтового потока в Exchange Online.](https://docs.microsoft.com/exchange/security-and-compliance/mail-flow-rules/mail-flow-rule-actions)|
|`Mode=<Mode>`|Режим правила. Допустимые значения:<ul><li>**Правило принудительно:** все действия правила будут применены.</li><li>**Тестирование с подсказками политики:** все действия с подсказками политики отправляются, но другие принудительные действия не применяются.</li><li>**Тест без подсказок**политики: действия перечисляются в файле журнала, но отправители не уведомляются никаким образом, принудительные действия не применяются.</li></ul>|
|

Ниже **custom_data** значения для сообщений, которые соответствуют условиям правила потока обработки почты, выглядит следующим образом:

`S:TRA=ETR|ruleId=19a25eb2-3e43-4896-ad9e-47b6c359779d|st=7/17/2017 12:31:25 AM|action=ApplyHtmlDisclaimer|sev=1|mode=Enforce`
