---
title: Трассировка сообщений в Центре безопасности и соответствия требованиям
f1.keywords:
- NOCSH
ms.author: chrisda
author: chrisda
manager: dansimp
audience: ITPro
ms.topic: how-to
localization_priority: Normal
ms.assetid: 3e64f99d-ac33-4aba-91c5-9cb4ca476803
ms.custom:
- seo-marvel-apr2020
description: Администраторы могут использовать трассировка сообщений в Центре & безопасности, чтобы узнать, что произошло с сообщениями.
ms.technology: mdo
ms.prod: m365-security
ms.openlocfilehash: 9c3f7e4bc9624b9fae48074203da525d7a504a12
ms.sourcegitcommit: 06d9e056eabfbac8fafe66cc32907b33d4ae8253
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/12/2021
ms.locfileid: "50741579"
---
# <a name="message-trace-in-the-security--compliance-center"></a>Трассировка сообщений в Центре безопасности и соответствия требованиям

[!INCLUDE [Microsoft 365 Defender rebranding](../includes/microsoft-defender-for-office.md)]

**Область применения**
- [Exchange Online Protection](exchange-online-protection-overview.md)
- [Microsoft Defender для Office 365 (план 1 и план 2)](office-365-atp.md)
- [Microsoft 365 Defender](../mtp/microsoft-threat-protection.md)

## <a name="message-trace-features"></a>Функции трассировки сообщений

Трассировка сообщений в Центре & безопасности следует за сообщениями электронной почты во время их перемещения через организацию Exchange Online. Вы можете определить, было ли сообщение получено, отклонено, отложено или доставлено службой. В нем также показано, какие действия были приняты в сообщении до его окончательного состояния.

Трассировка сообщений в центре & безопасности улучшает исходный след сообщений, доступный в центре администрирования Exchange (EAC). Вы можете использовать сведения из трассировки сообщений, чтобы эффективно отвечать на вопросы пользователей о том, что произошло с сообщениями, устранять проблемы с потоком почты и проверять изменения политики.

> [!NOTE]
>
> - Для выполнения трассировки сообщений необходимо быть членом групп ролей "Управление организацией", "Управление соответствием требованиям" или "Службы поддержки". Дополнительные сведения см. в статье [Разрешения в Центре безопасности и соответствия требованиям](permissions-in-the-security-and-compliance-center.md).
>
> - Максимальное количество сообщений, отображаемых в результатах, зависит от выбранного типа отчета (подробнее см. раздел [Выберите](#choose-report-type) тип отчета). Комлет [Get-HistoricalSearch](https://docs.microsoft.com/powershell/module/exchange/get-historicalsearch) в Exchange Online PowerShell или автономный EOP PowerShell возвращает все сообщения в результатах.

## <a name="open-message-trace"></a>Трассировка открытого сообщения

1. Откройте центр & безопасности в <https://protection.office.com> .

2. **Разорите поток** почты и выберите **трассировку сообщения.**

## <a name="message-trace-page"></a>Страница трассировки сообщений

Отсюда можно запустить новый след по умолчанию, нажав кнопку **Начните трассировку.** В течение последних двух дней будут искаться все сообщения для всех отправителей и получателей. Или вы можете использовать один из сохраненных запросов из доступных категорий запросов и запускать их как есть, либо использовать их в качестве отправных точек для собственных запросов:

- **Запросы по** умолчанию: встроенные запросы, предоставляемые Microsoft 365.

- **Настраиваемые запросы.** Запросы, сохраненные администраторами в организации для дальнейшего использования.

- **Автоматические запросы.** Последние десять последних запросов, которые запускаются в последнее время. Этот список упрощает выбор места, где вы были отключены.

Кроме того, на этой странице находится раздел **Загружаемые** отчеты для отправленных запросов, а также сами отчеты, когда они доступны для скачивания.

## <a name="options-for-a-new-message-trace"></a>Параметры для нового трассировки сообщений

### <a name="filter-by-senders-and-recipients"></a>Фильтрация отправителей и получателей

Значения по умолчанию — **это все** отправители и все получатели, но для фильтрации результатов можно использовать следующие поля: 

- **Эти люди:** Щелкните в этом поле, чтобы выбрать одного или несколько отправителей из вашей организации. Вы также можете начать введите имя, и элементы в списке будут фильтроваться тем, что вы ввели, как и поведение страницы поиска.

- **Для этих людей:** Щелкните в этом поле, чтобы выбрать одного или несколько получателей в вашей организации.

> [!NOTE]
>
> - Вы также можете ввести адреса электронной почты внешних отправителей и получателей. Поддиальды поддерживаются (например, ), но одновременно нельзя использовать несколько записей под диктовки в одном `*@contoso.com` поле.
>
> - Можно вклеить несколько списков отправителей или получателей, разделенных полуколонами ( `;` ). пробелы ( `\s` ), возвращается карета `\r` () или следующие строки ( `\n` ).

### <a name="time-range"></a>Диапазон времени

Значение по умолчанию **— 2 дня,** но можно указать диапазоны даты и времени до 90 дней. При использовании диапазонов дат и времени следует учитывать эти проблемы:

- По умолчанию вы выбираете диапазон времени в представлении **Slider** с помощью строки времени. Вы можете выбрать только отображаемые параметры дня или времени. При попытке выбрать между значениями щелкнуть пузырек запуска и конца до ближайшего отображаемого параметра.

  ![Диапазон времени слайдера в новом следе сообщений в Центре & соответствия требованиям](../../media/55a9e9c1-f7d5-4047-b217-824e8b976bcb.png)

  Кроме того, можно  перейти на настраиваемый  вид,  в котором можно указать значения даты  начала и окончания (включая время), а также выбрать часовой пояс для диапазона даты и времени. Обратите внимание, что параметр **Часовой** зоны применяется как к входным данным запроса, так и к результатам запроса.

  ![Настраиваемый диапазон времени в новом следе сообщений в Центре & соответствия требованиям](../../media/ed4c8d50-9ea5-4694-93f9-ee3ab6660b4f.png)

  В течение 10 дней или менее результаты можно получить мгновенно в **сводке.** Если указать диапазон времени, который даже немного превышает 10 дней, результаты будут отложены, так как они доступны только  в качестве загружаемого CSV-файла **(расширенные** сводки или расширенные отчеты).

  Дополнительные сведения о различных типах отчетов см. в разделе [Выберите](#choose-report-type) тип отчета в этой статье.

  > [!NOTE]
  > Расширенные сводные и расширенные отчеты готовятся с использованием архивных данных трассировки сообщений, и это может занять до нескольких часов, прежде чем ваш отчет будет доступен для скачивания. В зависимости от того, сколько других администраторов также отправили запросы отчетов примерно в одно и то же время, вы также можете заметить задержку перед началом обработки для вашего запроса в очередь.

- Сохранение запроса в **представлении Slider** сохраняет относительный диапазон времени (например, 3 дня с сегодняшнего дня). Сохранение запроса в **настраиваемом** представлении сохраняет абсолютный диапазон дат и времени (например, 2018-05-06 с 13:00 до 2018-05-08 18:00).

### <a name="more-search-options"></a>Дополнительные параметры поиска

#### <a name="delivery-status"></a>Состояние доставки.

Вы можете оставить выбранное **значение по** умолчанию или выбрать одно из следующих значений для фильтрации результатов:

- **Доставлено.** Сообщение было успешно доставлено в нужное место.

- **Ожидание.** Доставка сообщения пытаетсяся или повторно пытаетсяся.

- **Расширенный.** Получатель группы рассылки был расширен до доставки отдельным членам группы.

- **Не удалось.** Сообщение не было доставлено.

- **Карантин:** сообщение было карантином (как спам, массовая почта или фишинг). Дополнительные сведения см. в сообщении электронной почты с [карантином в EOP.](quarantine-email-messages.md)

- **Фильтруется как спам.** Сообщение было идентифицировано как нежелательное, и было отклонено или заблокировано (не на карантине).

- **Получение статуса:** Сообщение было недавно получено Корпорацией Майкрософт 365, но других данных о состоянии пока нет. Возвращайся через несколько минут.

> [!NOTE]
> Значения **"Ожидание",** **"Карантин"** и **"Фильтр** как спам" доступны только для поиска менее чем за 10 дней. Кроме того, может быть задержка от 5 до 10 минут между фактическим и сообщаемого состояния доставки.

#### <a name="message-id"></a>ИД сообщения

Это ИД интернет-сообщения (также известный как client ID), найденный в поле **Message-ID:** header в загонщике сообщений. Пользователи могут предоставить вам это значение для изучения определенных сообщений.

Это значение не изменяется на протяжении всего времени жизни сообщения. Для сообщений, созданных в Microsoft 365 или Exchange, значение находится в формате, включая `<GUID@ServerFQDN>` угловые скобки ( \< \> ). Например, `<d9683b4c-127b-413a-ae2e-fa7dfb32c69d@DM3NAM06BG401.Eop-nam06.prod.protection.outlook.com>`. Другие системы обмена сообщениями могут использовать различные синтаксис или значения. Это значение должно быть уникальным, но не все системы электронной почты строго следуют этому требованию. Если поле **message-ID:** поле заголовки не существует или пусто для входящих сообщений из внешних источников, назначено произвольное значение.

При **фильтрации результатов** с помощью message ID обязательно включаем полную строку, в том числе любые угловые скобки.

#### <a name="direction"></a>Direction

Вы можете оставить  выбранное значение по умолчанию или выбрать входящие **(сообщения,** отосланные получателям в организации) или **Исходящие** (сообщения, отосланные от пользователей в организации) для фильтрации результатов.

#### <a name="original-client-ip-address"></a>Исходный IP-адрес клиента.

Вы можете подать результаты по IP-адресу клиента для расследования взлома компьютеров, которые отправляют большое количество нежелательной почты или вредоносных программ. Хотя сообщения могут появиться от нескольких отправителей, вполне вероятно, что один и тот же компьютер создает все сообщения.

> [!NOTE]
> Сведения об IP-адресе клиента доступны только в течение 10 дней  и доступны только в сводных сводке или расширенных отчетах (загружаемых CSV-файлах). 

### <a name="choose-report-type"></a>Выберите тип отчета

Доступные типы отчетов:

- **Сводка.** Доступно, если диапазон времени не превышает 10 дней и не требует дополнительных вариантов фильтрации. Результаты доступны почти сразу после нажатия **поиска.** Отчет возвращает до 20000 результатов.

- **Расширенные** сводки или расширенные: Эти отчеты доступны только в качестве загружаемых CSV-файлов, и требуются один или несколько из следующих вариантов фильтрации независимо от диапазона **времени:** Эти люди , **Для** этих людей , или сообщение **ID**. Вы можете использовать подкарды для отправителей или получателей (например, \* @contoso.com). Расширенный сводный отчет возвращает до 50000 результатов. Расширенный отчет возвращает до 1000 результатов.

> [!NOTE]
>
> - Расширенные сводные и расширенные отчеты готовятся с помощью архивных данных трассировки сообщений, и загрузка отчета может занять до нескольких часов. В зависимости от того, сколько других администраторов также отправили запросы отчетов примерно в одно и то же время, вы также можете заметить задержку перед началом обработки вашего запроса в очереди.
>
> - Хотя вы можете выбрать расширенный сводный или расширенный отчет для любого диапазона дат и времени, обычно последние четыре часа архивных данных еще не будут доступны для этих двух типов отчетов.
>
> - Максимальный размер загружаемого отчета — 500 МБ. Если загружаемый отчет превышает 500 МБ, его нельзя открыть в Excel или Блокноте.

При нажатии кнопки **Далее** вам будет представлена сводная страница, на которую перечислены выбранные параметры фильтрации, уникальное (редактируемое) название отчета и адрес электронной почты, который получает уведомление по завершению трассировки сообщения (также редактируемой и должен быть в одном из принятых доменов организации). Нажмите **кнопку Подготовка отчета** для отправки трассировки сообщения. На главной **странице трассировки** сообщений можно увидеть состояние отчета в разделе **Загружаемые отчеты.**

Дополнительные сведения о возвращаемой информации в различных типах отчетов см. в следующем разделе.

## <a name="message-trace-results"></a>Результаты трассировки сообщений

Различные типы отчетов возвращают различные уровни информации. Сведения, доступные в различных отчетах, описаны в следующих разделах.

### <a name="summary-report-output"></a>Вывод сводного отчета

После запуска трассировки сообщения результаты будут перечислены, отсортированы по дате и времени убывания (самый последний первый).

![Результаты сводного отчета для отслеживания сообщений в Центре & соответствия требованиям](../../media/0664bafe-0b03-477b-b571-0b046ac8c977.png)

Сводный отчет содержит следующие сведения:

- **Дата.** Дата и время, в которые было получено сообщение службой, с помощью настроенного часовой пояс UTC.

- **Отправитель.** Адрес электронной почты отправитель *(псевдоним* @ *домена).*

- **Получатель.** Адрес электронной почты получателя или получателя. Для сообщения, отправленного нескольким получателям, существует одна строка на каждого получателя. Если получатель — это группа рассылки, динамическая группа рассылки или группа безопасности с включенной почтой, она будет первым получателем, а затем каждый член группы находится в отдельной строке.

- **Тема.** Первые 256 символов темы **сообщения:** поле.

- **Состояние.** Эти значения описаны в разделе [Состояние доставки.](#delivery-status)

По умолчанию загружаются и легко доступны первые 250 результатов. При прокрутке вниз происходит небольшая пауза при загрузке следующей партии результатов. Вместо прокрутки можно нажать кнопку **Загрузить** все, чтобы загрузить все результаты до 10 000.

Вы можете нажать на столбцы для сортировки результатов по значениям в этом столбце в порядке подъема или убывания.

Вы можете **щелкнуть фильтр результатов,** чтобы отфильтровать результаты одним или несколько столбцов.

Вы можете экспортировать результаты после выбора одной или более  строк, щелкнув результаты экспорта, а затем выбрав экспорт всех результатов, экспортировать загруженные результаты **или** **экспортировать выбранные**.

#### <a name="find-related-records-for-this-message"></a>Поиск связанных записей для этого сообщения

Связанные записи сообщений — это записи, которые разделяют один и тот же ID сообщения. Помните, что даже одно сообщение, отправленное между двумя людьми, может создавать несколько записей. Количество записей увеличивается, когда на сообщение влияет расширение группы рассылки, пересылание, правила потока почты (также известные как правила транспорта) и т.д.

После выбора контрольного окна строки можно найти соответствующие записи для сообщения, нажав кнопку  **Find related,** которая появится, или выбрав дополнительные параметры Дополнительные записи поиска для этого ![ ](../../media/1ea52bbf-9d00-48ce-9362-307f7f6fb7fe.png) \> сообщения).

Дополнительные сведения о ID сообщения см. в разделе Message ID в этой статье.

#### <a name="message-trace-details"></a>Сведения о трассировок сообщений

В сводной сводке отчетов можно просмотреть сведения о сообщении с помощью любого из следующих методов:

- Выберите строку (щелкните в любом месте строки, кроме контрольного окна).

- Выберите контрольный ящик строки и щелкните **Дополнительные параметры** ![ Дополнительные ](../../media/1ea52bbf-9d00-48ce-9362-307f7f6fb7fe.png) \> **сведения о сообщении просмотра**.

   ![Сведения после двойного нажатия строки в трассировке сообщений сводного отчета приводит к & Центра & соответствия требованиям.](../../media/e50ee7cd-810a-4c06-8b58-e56ffd7028d1.png)

Сведения о трассировке сообщений содержат следующие дополнительные сведения, которых нет в сводной сводке:

- **События сообщений.** В этом разделе содержатся классификации, которые помогают классифицировать действия, которые служба принимает на сообщения. **Некоторые из наиболее интересных событий,** с которыми вы можете столкнуться:

  - **Получение.** Сообщение было получено службой.

  - **Отправка.** Сообщение было отправлено службой.

  - **Fail.** Сообщение не было доставлено.

  - **Доставка.** Сообщение было доставлено в почтовый ящик.

  - **Расширение.** Сообщение было отправлено расширенной группе рассылки.

  - **Передача.** Получатели были перемещены в двухфуркированное сообщение из-за преобразования контента, ограничений получателей сообщений или агентов.

  - **Отсрочка.** Доставка сообщения была отложена и может быть повторно предпринята позже.

  - **Разрешено.** Сообщение было перенаправлено на новый адрес получателя на основе образа Active Directory. В этом случае исходный адрес получателя указывается в отдельной строке трассировки сообщений вместе с итоговым состоянием доставки сообщения.

  > [!NOTE]
  > 
  > - Успешно доставленное сообщение с неравномерностью создает несколько **записей события** в следе сообщения.
  > 
  > - Этот список не является исчерпывающим. Дополнительные описания событий см. в [журнале отслеживания](https://docs.microsoft.com/Exchange/mail-flow/transport-logs/message-tracking#event-types-in-the-message-tracking-log)сообщений типами событий. Обратите внимание, что эта ссылка является Exchange Server (локальной exchange) темой.

- **Дополнительные сведения.** В этом разделе содержатся следующие сведения:

  - **ID сообщения.** Это значение описано в разделе [Message ID](#message-id) ранее в этой статье. Например, `<d9683b4c-127b-413a-ae2e-fa7dfb32c69d@DM3NAM06BG401.Eop-nam06.prod.protection.outlook.com>`.

  - **Размер сообщения**.

  - **С IP:** IP-адрес компьютера, отправив сообщение. Для исходящие сообщения, отправленные из Exchange Online, это значение является пустым.

  - **IP:** IP-адрес или адреса, на которых служба попыталась доставить сообщение. Если в сообщении несколько получателей, они отображаются. Для входящие сообщения, отправленные в Exchange Online, это значение является пустым.

### <a name="enhanced-summary-reports"></a>Расширенные сводные отчеты

Доступные (завершенные) расширенные сводные отчеты доступны в разделе **Загружаемые** отчеты в начале сообщения трассировки. В отчете доступны следующие сведения:

- **origin_timestamp:** дата и время, когда сообщение изначально было получено службой, используя настроенный <sup>*</sup> часовой пояс UTC.

- **sender_address**: адрес электронной почты отправитель *(псевдоним* @ *домена).*

- **Recipient_status:** состояние доставки сообщения получателю. Если сообщение было отправлено нескольким получателям, оно будет показывать всех получателей и соответствующий статус для каждого из них в формате: \<*email address*\> ## \<*status*\> . Например:

  - **##Receive отправка означает,** что сообщение было получено службой и отправлено в нужное место.

  - **##Receive fail означает,** что сообщение было получено службой, но доставка в нужное место не удалась.

  - **##Receive Deliver означает,** что сообщение было получено службой и доставлено в почтовый ящик получателя.

- **message_subject**: Первые 256 символов поля Subject **сообщения.**

- **total_bytes:** размер сообщения в bytes, включая вложения.

- **message_id.** Это значение описано в разделе [Message ID](#message-id) ранее в этой статье. Например, `<d9683b4c-127b-413a-ae2e-fa7dfb32c69d@DM3NAM06BG401.Eop-nam06.prod.protection.outlook.com>`.

- **network_message_id:** уникальное значение ID сообщения, которое сохраняется во всех копиях сообщения, которое может быть создано из-за расширения группы рассылки или бифуркации. Например, значение `1341ac7b13fb42ab4d4408cf7f55890f` .

- **original_client_ip:** IP-адрес клиента отправитель.

- **направленность.** Указывает, было ли сообщение отправлено входящие (1) в вашу организацию, или же оно было отправлено исходящие (2) из организации.

- **connector_id:** имя соединитетеля источника или назначения. Дополнительные сведения о соединители в Exchange Online см. в сообщении [Configure mail flow using connectors in Office 365.](https://docs.microsoft.com/Exchange/mail-flow-best-practices/use-connectors-to-configure-mail-flow/use-connectors-to-configure-mail-flow)

- **delivery_priority**: Было ли отправлено сообщение с высоким, низким или <sup>*</sup> **нормальным** приоритетом. 

<sup>*</sup> Эти свойства доступны только в расширенных сводных отчетах.

### <a name="extended-reports"></a>Расширенные отчеты

Доступные (завершенные) расширенные отчеты доступны в разделе **Загружаемые** отчеты в начале трассировки сообщений. Практически все сведения из расширенного сводного отчета доступны в расширенном отчете  (за исключением origin_timestamp **и delivery_priority).** Следующие дополнительные сведения доступны только в расширенном отчете:

- **client_ip**: IP-адрес сервера электронной почты или клиента обмена сообщениями, которые отправили сообщение.

- **client_hostname:** имя хозяина или FQDN сервера электронной почты или клиента обмена сообщениями, которые отправили сообщение.

- **server_ip:** IP-адрес источника или сервера назначения.

- **server_hostname:** имя или FQDN сервера назначения.

- **source_context**: Дополнительные сведения, связанные с **исходным полем.** Например:

  - `Protocol Filter Agent`

  - `3489061114359050000`

- **источник.** Компонент Exchange Online, ответственный за событие. Например:

  - `AGENT`

  - `MAILBOXRULE`

  - `SMTP`

- **event_id.** Эти значения соответствуют значениям событий **Message,** которые объясняются в разделе Поиск связанных записей [для этого сообщения.](#find-related-records-for-this-message)

- **internal_message_id:** идентификатор сообщения, который назначен сервером Exchange Online, который в настоящее время обрабатывает сообщение.

- **recipient_address:** адреса электронной почты получателей сообщения. Если указано несколько адресов, то они отделяются друг от друга точкой с запятой (;).

- **recipient_count:** общее число получателей в сообщении.

- **related_recipient_address**: Используется с и событиями для отображения других адресов электронной почты `EXPAND` `REDIRECT` получателей, `RESOLVE` связанных с сообщением.

- **справка.** Это поле содержит дополнительные сведения для определенных типов событий. Например:

  - **DSN**: Содержит ссылку отчета, которая является **message_id** значения связанного уведомления о состоянии доставки (также известного как DSN, отчет о невывозе, NDR или отказов сообщение), если DSN создается после этого события. Если это сообщение DSN, это **поле** содержит message_id исходного сообщения, для которое был создан DSN.

  - **EXPAND**: **содержит related_recipient_address** значение связанных сообщений.

  - **ПОЛУЧЕНИЕ:** Может содержать **message_id** связанного сообщения, если сообщение было сгенерировано другими процессами (например, правилами почтовых ящиков).

  - **SEND:** **содержит internal_message_id** всех сообщений DSN.

  - **TRANSFER.** Содержит **internal_message_id** значение разоренного сообщения (например, путем преобразования контента, ограничений получателей сообщений или агентов).

  - **MAILBOXRULE.** Содержит **internal_message_id** входящих сообщений, из-за чего правило "Входящие" создает исходящие сообщения.

    Для других типов событий это поле обычно пусто.

- **return_path:** адрес электронной почты, указанный командой **MAIL FROM,** отправив сообщение. Несмотря на то, что это поле никогда не пусто, оно может иметь значение адреса отправитель null в качестве `<>` .

- **message_info:** Дополнительные сведения о сообщении. Например:

  - Дата начала сообщения в UTC и `DELIVER` `SEND` события. Дата начала — это время, когда сообщение впервые вступило в организацию Exchange Online. Дата UTC представлена в формате дата-времени ISO 8601: , где = год, = месяц, = день, указывает начало компонента `yyyy-mm-ddThh:mm:ss.fffZ` `yyyy` `mm` `dd` `T` времени, = час, = минута, = секунда, = доли `hh` `mm` секунды, `ss` `fff` `Z` и означает `Zulu` , что это еще один способ обозначить UTC.

  - Ошибки проверки подлинности. Например, можно увидеть значение и тип проверки подлинности, которые использовались при `11a` ошибке проверки подлинности.

- **tenant_id**: значение GUID, представляю которое представляет организацию Exchange Online (например, `39238e87-b5ab-4ef6-a559-af54c6b07b42` ).

- **original_server_ip**: IP-адрес исходного сервера.

- **custom_data**: Содержит данные, связанные с определенными типами событий. Дополнительные сведения см. в следующих разделах.

#### <a name="custom_data-values"></a>custom_data значения

Поле **custom_data** для события используется различными агентами Exchange Online для регистрации `AGENTINFO` сведений об обработке сообщений. Некоторые из наиболее интересных агентов описаны в следующих разделах.

#### <a name="spam-filter-agent"></a>Агент фильтра нежелательной почты

Значение **custom_data,** которое начинается `S:SFA` с агента фильтра нежелательной почты. Основные сведения описаны в следующей таблице:

****

|Значение|Описание|
|---|---|
|`SFV=NSPM`|Сообщение помечено как не являющееся нежелательным и отправлено указанным получателям.|
|`SFV=SPM`|Сообщение было отмечено как спам путем фильтрации от нежелательной почты (также известной как фильтрация контента).|
|`SFV=BLK`|Фильтрация была пропущена, а сообщение было заблокировано, так как оно исходило от заблокированного отправителя.|
|`SFV=SKS`|Сообщение было помечено как спам перед обработкой фильтрацией от нежелательной почты. Это применяется к сообщениям, сопоставленным с правилом потока обработки почты (другое название — правило транспорта), требующим автоматически помечать их как нежелательные и обходить любую дополнительную фильтрацию.|
|`SCL=<number>`|Дополнительные сведения о различных значениях вероятности нежелательной почты и их значении см. в разделе [Вероятность нежелательной почты](spam-confidence-levels.md).    |
|`PCL=<number>`|Значение вероятности фишинга для сообщения. Эти значения можно интерпретировать так же, как и значения SCL, которые задокументированы в [Вероятность нежелательной почты](spam-confidence-levels.md).  |
|`DI=SB`|Отправитель сообщения заблокирован.|
|`DI=SQ`|Сообщение перемещено в карантин.|
|`DI=SD`|Сообщение удалено.|
|`DI=SJ`|Сообщение отправлено в папку нежелательной почты получателя.|
|`DI=SN`|Сообщение перенаправлено через пул обычной исходящей доставки.|
|`DI=SO`|Сообщение перенаправлено через пул высокого риска доставки. Дополнительные сведения см. в статье [Пул доставки сообщений с высоким уровнем опасности](high-risk-delivery-pool-for-outbound-messages.md).|
|`SFS=[a]|SFS=[b]`|Это означает выполнение правил нежелательной почты.|
|`IPV=CAL`|Сообщение пропущено через фильтр нежелательной почты, поскольку IP-адрес указан в списке разрешенных IP-адресов в фильтре подключений.|
|`H=<EHLOstring>`|Строка HELO или EHLO подключенного почтового сервера.|
|`PTR=<ReverseDNS>`|Запись PTR отправляющего IP-адреса, называемая также обратным DNS-адресом.|
|

Пример **custom_data** для сообщения, фильтруемой для нежелательной почты:

`S:SFA=SUM|SFV=SPM|IPV=CAL|SRV=BULK|SFS=470454002|SFS=349001|SCL=9|SCORE=-1|LIST=0|DI=SN|RD=ftmail.inc.com|H=ftmail.inc.com|CIP=98.129.140.74|SFP=1501|ASF=1|CTRY=US|CLTCTRY=|LANG=en|LAT=287|LAT=260|LAT=18;`

#### <a name="malware-filter-agent"></a>Агент фильтрации вредоносных программ

Значение **custom_data,** которое начинается `S:AMA` с агента фильтра вредоносных программ. Основные сведения описаны в следующей таблице:

****

|Значение|Описание|
|---|---|
|`AMA=SUM|v=1|` или `AMA=EV|v=1`|Сообщение помечено как содержащее вредоносные программы. `SUM` указывает, что вредоносные программы могли быть обнаружены любым числом двигателей. `EV` указывает, что вредоносная программа была обнаружена определенным двигателем. Если обработчиком обнаружены вредоносные программы, это вызывает последующие действия.|
|`Action=r`|Сообщение заменено.|
|`Action=p`|Сообщение не проходило фильтрацию.|
|`Action=d`|Сообщение отложено.|
|`Action=s`|Сообщение удалено.|
|`Action=st`|Сообщение не проходило фильтрацию.|
|`Action=sy`|Сообщение не проходило фильтрацию.|
|`Action=ni`|Сообщение отклонено.|
|`Action=ne`|Сообщение отклонено.|
|`Action=b`|Сообщение заблокировано.|
|`Name=<malware>`|Имя обнаруженной вредоносной программы.|
|`File=<filename>`|Имя файла, содержащего вредоносные программы.|
|

Пример **custom_data** для сообщения, содержаного вредоносные программы, выглядит так:

`S:AMA=SUM|v=1|action=b|error=|atch=1;S:AMA=EV|engine=M|v=1|sig=1.155.974.0|name=DOS/Test_File|file=filename;S:AMA=EV|engine=A|v=1|sig=201707282038|name=Test_File|file=filename`

#### <a name="transport-rule-agent"></a>Агент правил транспорта

Значение **custom_data,** которое начинается с агента правила транспорта для правил потока почты `S:TRA` (также известного как правила транспорта). Основные сведения описаны в следующей таблице:

****

|Значение|Описание|
|---|---|
|`ETR|ruleId=<guid>`|Выполнено правило идентификатора.|
|`St=<datetime>`|Дата и время в UTC при совпадении правил.|
|`Action=<ActionDefinition>`|Примененное действие. Список доступных действий см. в списке действий правил потока [почты в Exchange Online.](https://docs.microsoft.com/exchange/security-and-compliance/mail-flow-rules/mail-flow-rule-actions)|
|`Mode=<Mode>`|Режим правила. Допустимые значения:<ul><li>**Применение.** Все действия по правилу будут применены.</li><li>**Тест с помощью советов по политике:** любые действия наконечника политики будут отправлены, но другие действия по принунию не будут действовать.</li><li>**Test without Policy Tips:** Actions will be listed in a log file, but senders will not be notified in any way, and enforcement actions will not be acted on.</li></ul>|
|

Пример **custom_data** для сообщений, которые совпадают с условиями правила потока почты, выглядит так:

`S:TRA=ETR|ruleId=19a25eb2-3e43-4896-ad9e-47b6c359779d|st=7/17/2017 12:31:25 AM|action=ApplyHtmlDisclaimer|sev=1|mode=Enforce`
