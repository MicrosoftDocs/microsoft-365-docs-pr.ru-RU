---
title: Использование правил потока почты для блокировки сообщений с исполняемыми вложениями
f1.keywords:
- NOCSH
ms.author: chrisda
author: chrisda
manager: dansimp
ms.date: ''
audience: ITPro
ms.topic: how-to
localization_priority: Normal
ms.assetid: c4fb4a86-b772-49d0-8773-e8ee897e175d
ms.custom:
- seo-marvel-apr2020
description: Администраторы могут научиться создавать правила потока почты (правила транспорта) для блокировки сообщений, содержащих исполняемые вложения.
ms.technology: mdo
ms.prod: m365-security
ms.openlocfilehash: 8631ae2a1370e338bfcc689c72d09533c39397a9
ms.sourcegitcommit: 27b2b2e5c41934b918cac2c171556c45e36661bf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "50916914"
---
# <a name="use-mail-flow-rules-to-block-messages-with-executable-attachments-in-eop"></a><span data-ttu-id="e4ac6-103">Использование правил потока почты для блокировки сообщений с исполняемыми вложениями в EOP</span><span class="sxs-lookup"><span data-stu-id="e4ac6-103">Use mail flow rules to block messages with executable attachments in EOP</span></span>

[!INCLUDE [Microsoft 365 Defender rebranding](../includes/microsoft-defender-for-office.md)]

<span data-ttu-id="e4ac6-104">**Область применения**</span><span class="sxs-lookup"><span data-stu-id="e4ac6-104">**Applies to**</span></span>
- [<span data-ttu-id="e4ac6-105">Exchange Online Protection</span><span class="sxs-lookup"><span data-stu-id="e4ac6-105">Exchange Online Protection</span></span>](exchange-online-protection-overview.md)
- [<span data-ttu-id="e4ac6-106">Microsoft Defender для Office 365 (план 1 и план 2)</span><span class="sxs-lookup"><span data-stu-id="e4ac6-106">Microsoft Defender for Office 365 plan 1 and plan 2</span></span>](office-365-atp.md)
- [<span data-ttu-id="e4ac6-107">Microsoft 365 Defender</span><span class="sxs-lookup"><span data-stu-id="e4ac6-107">Microsoft 365 Defender</span></span>](../mtp/microsoft-threat-protection.md)

<span data-ttu-id="e4ac6-108">В организациях Microsoft 365 с почтовыми ящиками в Exchange Online или автономных организациях Exchange Online Protection (EOP) без почтовых ящиков Exchange Online EOP использует политики защиты от вредоносных программ для блокировки вредоносных сообщений, в том числе сообщений с исполняемыми вложениями.</span><span class="sxs-lookup"><span data-stu-id="e4ac6-108">In Microsoft 365 organizations with mailboxes in Exchange Online or standalone Exchange Online Protection (EOP) organizations without Exchange Online mailboxes, EOP uses anti-malware policies to block harmful messages, including messages with executable attachments.</span></span> <span data-ttu-id="e4ac6-109">Дополнительные сведения см. в [программе Защита от вредоносных программ в EOP.](anti-malware-protection.md)</span><span class="sxs-lookup"><span data-stu-id="e4ac6-109">For more information, see [Anti-malware protection in EOP](anti-malware-protection.md).</span></span>

<span data-ttu-id="e4ac6-110">Для дальнейшего повышения защиты можно использовать правила потока почты (также известные как правила транспорта) для выявления и блокировки сообщений, содержащих исполняемые вложения, как описано в этой статье.</span><span class="sxs-lookup"><span data-stu-id="e4ac6-110">To further enhance protection, you can use mail flow rules (also known as transport rules) to identify and block messages that contain executable attachments as described in this article.</span></span>

<span data-ttu-id="e4ac6-111">Например, после вспышки вредоносных программ компания может применить это правило с ограничением по времени, чтобы пострадавшие пользователи могли вернуться к отправке вложений после определенного времени.</span><span class="sxs-lookup"><span data-stu-id="e4ac6-111">For example, following a malware outbreak, a company could apply this rule with a time limit so that affected users can get back to sending attachments after a specified length of time.</span></span>

## <a name="what-do-you-need-to-know-before-you-begin"></a><span data-ttu-id="e4ac6-112">Что нужно знать перед началом работы</span><span class="sxs-lookup"><span data-stu-id="e4ac6-112">What do you need to know before you begin?</span></span>

- <span data-ttu-id="e4ac6-113">Вам необходимо получить разрешения в Exchange Online или Exchange Online Protection, прежде чем вы сможете сделать процедуры в этой статье.</span><span class="sxs-lookup"><span data-stu-id="e4ac6-113">You need to be assigned permissions in Exchange Online or Exchange Online Protection before you can do the procedures in this article.</span></span> <span data-ttu-id="e4ac6-114">В частности, вам нужна роль **Правила** транспорта, которая по умолчанию назначена группам ролей **"Управление** организацией", "Управление соответствием требованиям" и "Управление записями". </span><span class="sxs-lookup"><span data-stu-id="e4ac6-114">Specifically, you need the **Transport Rules** role, which is assigned to the **Organization Management**, **Compliance Management**, and **Records Management** role groups by default.</span></span>

  <span data-ttu-id="e4ac6-115">Дополнительную информацию см. в следующих статьях:</span><span class="sxs-lookup"><span data-stu-id="e4ac6-115">For more information, see the following topics:</span></span>

  - [<span data-ttu-id="e4ac6-116">Разрешения в Exchange Online</span><span class="sxs-lookup"><span data-stu-id="e4ac6-116">Permissions in Exchange Online</span></span>](/exchange/permissions-exo/permissions-exo)
  - [<span data-ttu-id="e4ac6-117">Разрешения в автономном EOP</span><span class="sxs-lookup"><span data-stu-id="e4ac6-117">Permissions in standalone EOP</span></span>](feature-permissions-in-eop.md)
  - [<span data-ttu-id="e4ac6-118">Использование EAC измените список участников в группах ролей</span><span class="sxs-lookup"><span data-stu-id="e4ac6-118">Use the EAC modify the list of members in role groups</span></span>](manage-admin-role-group-permissions-in-eop.md#use-the-eac-modify-the-list-of-members-in-role-groups)

- <span data-ttu-id="e4ac6-119">Чтобы открыть центр администрирования в Exchange Online, см. в центре [администрирования Exchange в Exchange Online.](/Exchange/exchange-admin-center)</span><span class="sxs-lookup"><span data-stu-id="e4ac6-119">To open the EAC in Exchange Online, see [Exchange admin center in Exchange Online](/Exchange/exchange-admin-center).</span></span> <span data-ttu-id="e4ac6-120">Чтобы открыть EAC в автономных EOP, см. в центре администрирования Exchange в режиме [автономный EOP.](exchange-admin-center-in-exchange-online-protection-eop.md)</span><span class="sxs-lookup"><span data-stu-id="e4ac6-120">To open the EAC in standalone EOP, see [Exchange admin center in standalone EOP](exchange-admin-center-in-exchange-online-protection-eop.md).</span></span>

- <span data-ttu-id="e4ac6-121">Сведения о том, как подключиться к Exchange Online PowerShell, см. в статье [Подключение к Exchange Online PowerShell](/powershell/exchange/connect-to-exchange-online-powershell).</span><span class="sxs-lookup"><span data-stu-id="e4ac6-121">To connect to Exchange Online PowerShell, see [Connect to Exchange Online PowerShell](/powershell/exchange/connect-to-exchange-online-powershell).</span></span> <span data-ttu-id="e4ac6-122">Чтобы подключиться к автономному EOP PowerShell, см. раздел [Подключение к PowerShell Exchange Online Protection](/powershell/exchange/connect-to-exchange-online-protection-powershell).</span><span class="sxs-lookup"><span data-stu-id="e4ac6-122">To connect to standalone EOP PowerShell, see [Connect to Exchange Online Protection PowerShell](/powershell/exchange/connect-to-exchange-online-protection-powershell).</span></span>

- <span data-ttu-id="e4ac6-123">Дополнительные сведения о правилах потока почты в Exchange Online и автономных EOP см. в следующих темах:</span><span class="sxs-lookup"><span data-stu-id="e4ac6-123">For more information about mail flow rules in Exchange Online and standalone EOP, see the following topics:</span></span>

  - [<span data-ttu-id="e4ac6-124">Правила потока обработки почты (правила транспорта) в Exchange Online</span><span class="sxs-lookup"><span data-stu-id="e4ac6-124">Mail flow rules (transport rules) in Exchange Online</span></span>](/Exchange/security-and-compliance/mail-flow-rules/mail-flow-rules)

  - [<span data-ttu-id="e4ac6-125">Условия и исключения правил потока почты (предикаты) в Exchange Online</span><span class="sxs-lookup"><span data-stu-id="e4ac6-125">Mail flow rule conditions and exceptions (predicates) in Exchange Online</span></span>](/Exchange/security-and-compliance/mail-flow-rules/conditions-and-exceptions)

  - [<span data-ttu-id="e4ac6-126">Действия правила потока почты в Exchange Online</span><span class="sxs-lookup"><span data-stu-id="e4ac6-126">Mail flow rule actions in Exchange Online</span></span>](/Exchange/security-and-compliance/mail-flow-rules/mail-flow-rule-actions)

## <a name="use-the-eac-to-create-a-rule-that-blocks-messages-with-executable-attachments"></a><span data-ttu-id="e4ac6-127">Используйте EAC для создания правила, которое блокирует сообщения с исполняемыми вложениями</span><span class="sxs-lookup"><span data-stu-id="e4ac6-127">Use the EAC to create a rule that blocks messages with executable attachments</span></span>

1. <span data-ttu-id="e4ac6-128">В Центре администрирования Exchange перейдите в раздел **Поток обработки почты** \> **Правила**.</span><span class="sxs-lookup"><span data-stu-id="e4ac6-128">In the EAC, go to **Mail flow** \> **Rules**.</span></span>

2. <span data-ttu-id="e4ac6-129">Нажмите **кнопку Добавить** ![ значок Добавить, ](../../media/ITPro-EAC-AddIcon.png) а затем выберите Создать новое **правило**.</span><span class="sxs-lookup"><span data-stu-id="e4ac6-129">Click **Add** ![Add icon](../../media/ITPro-EAC-AddIcon.png) and then select **Create a new rule**.</span></span>

3. <span data-ttu-id="e4ac6-130">На открывшейся странице **Новое правило** настройте следующие параметры:</span><span class="sxs-lookup"><span data-stu-id="e4ac6-130">In the **New rule** page that opens, configure the following settings:</span></span>

   - <span data-ttu-id="e4ac6-131">**Имя.** Введите уникальное, описательное имя для правила.</span><span class="sxs-lookup"><span data-stu-id="e4ac6-131">**Name**: Enter a unique, descriptive name for the rule.</span></span>

   - <span data-ttu-id="e4ac6-132">Нажмите кнопку **Дополнительные параметры**.</span><span class="sxs-lookup"><span data-stu-id="e4ac6-132">Click **More Options**.</span></span>

   - <span data-ttu-id="e4ac6-133">**Применить это правило, если**: Выберите **любое вложение** \> **имеет исполняемое содержимое.**</span><span class="sxs-lookup"><span data-stu-id="e4ac6-133">**Apply this rule if**: Select **Any attachment** \> **has executable content**.</span></span>

   - <span data-ttu-id="e4ac6-134">**Сделайте следующее:** **Выберите блок сообщения,** а затем выберите нужное действие:</span><span class="sxs-lookup"><span data-stu-id="e4ac6-134">**Do the following**: Select **Block the message** and then choose the action you want:</span></span>

     - <span data-ttu-id="e4ac6-135">**отклонить** сообщение и включить  объяснение: В диалоговом окрике Укажите причину отказа, которая появится, введите текст, который необходимо отображать в отчете о невывозе (также известном как сообщение об отказе или NDR).</span><span class="sxs-lookup"><span data-stu-id="e4ac6-135">**reject the message and include an explanation**: In the **Specify reject reason** dialog that appears, enter the text you want to appear in the non-delivery report (also known as an NDR or bounce message).</span></span> <span data-ttu-id="e4ac6-136">Расширенный код состояния, который используется по умолчанию: 5.7.1.</span><span class="sxs-lookup"><span data-stu-id="e4ac6-136">The default enhanced status code that's used is 5.7.1.</span></span>

     - <span data-ttu-id="e4ac6-137">**отклонить** сообщение с кодом расширенного состояния: В диалоговом окрике **Ввод** расширенного кода состояния, который появится, введите расширенный код состояния, который необходимо отображать в NDR.</span><span class="sxs-lookup"><span data-stu-id="e4ac6-137">**reject the message with the enhanced status code of**:  In the **Enter enhanced status code** dialog that appears, enter the enhanced status code that you want to appear in the NDR.</span></span> <span data-ttu-id="e4ac6-138">Допустимые значения : 5.7.1 или значение от 5.7.900 до 5.7.999.</span><span class="sxs-lookup"><span data-stu-id="e4ac6-138">Valid values are 5.7.1 or a value from 5.7.900 to 5.7.999.</span></span> <span data-ttu-id="e4ac6-139">Текст отказа по умолчанию: доставка не разрешена, сообщение отклонено.</span><span class="sxs-lookup"><span data-stu-id="e4ac6-139">The default rejection text is: Delivery not authorized, message refused.</span></span>

     - <span data-ttu-id="e4ac6-140">**отклонить сообщение, не уведомив никого**</span><span class="sxs-lookup"><span data-stu-id="e4ac6-140">**reject the message without notifying anyone**</span></span>

4. <span data-ttu-id="e4ac6-141">По завершении нажмите кнопку **Сохранить**.</span><span class="sxs-lookup"><span data-stu-id="e4ac6-141">When you're finished, click **Save**.</span></span> <span data-ttu-id="e4ac6-142">Теперь правило блокирования вложений вступило в силу.</span><span class="sxs-lookup"><span data-stu-id="e4ac6-142">Your attachment blocking rule is now in force.</span></span>

## <a name="use-powershell-to-create-a-rule-that-blocks-messages-with-executable-attachments"></a><span data-ttu-id="e4ac6-143">Используйте PowerShell для создания правила, которое блокирует сообщения с исполняемыми вложениями</span><span class="sxs-lookup"><span data-stu-id="e4ac6-143">Use PowerShell to create a rule that blocks messages with executable attachments</span></span>

<span data-ttu-id="e4ac6-144">Для создания правила для блокировки сообщений, содержащих исполняемые вложения, используйте следующий синтаксис:</span><span class="sxs-lookup"><span data-stu-id="e4ac6-144">Use the following syntax to create a rule to blocks messages that contain executable attachments:</span></span>

```powershell
New-TransportRule -Name "<UniqueName>" -AttachmentHasExecutableContent $true [-RejectMessageEnhancedStatusCode <5.7.1 | 5.7.900 to 5.7.999>] [-RejectMessageReasonText "<Text>"] [-DeleteMessage $true]
```

<span data-ttu-id="e4ac6-145">**Примечания.**</span><span class="sxs-lookup"><span data-stu-id="e4ac6-145">**Notes**:</span></span>

- <span data-ttu-id="e4ac6-146">Если вы используете параметр _RejectMessageEnhancedStatusCode_ без параметра _RejectMessageReasonText,_ по умолчанию используется текст: доставка не разрешена, сообщение отклонено.</span><span class="sxs-lookup"><span data-stu-id="e4ac6-146">If you use the _RejectMessageEnhancedStatusCode_ parameter without the _RejectMessageReasonText_ parameter, the default text is: Delivery not authorized, message refused.</span></span>

- <span data-ttu-id="e4ac6-147">Если вы используете параметр _RejectMessageReasonText_ без параметра _RejectMessageEnhancedStatusCode,_ код по умолчанию — 5.7.1.</span><span class="sxs-lookup"><span data-stu-id="e4ac6-147">If you use the _RejectMessageReasonText_ parameter without the _RejectMessageEnhancedStatusCode_ parameter, the default code is 5.7.1.</span></span>

<span data-ttu-id="e4ac6-148">В этом примере создается новое правило с именем Block Executable Attachments, которое безмолвно удаляет сообщения, содержащие исполняемые вложения.</span><span class="sxs-lookup"><span data-stu-id="e4ac6-148">This example creates a new rule named Block Executable Attachments that silently deletes messages that contain executable attachments.</span></span>

```powershell
New-TransportRule -Name "Block Executable Attachments" -AttachmentHasExecutableContent $true -DeleteMessage $true
```

<span data-ttu-id="e4ac6-149">Дополнительные сведения о синтаксисе и параметрах см. в статье [New-TransportRule](/powershell/module/exchange/new-transportrule).</span><span class="sxs-lookup"><span data-stu-id="e4ac6-149">For detailed syntax and parameter information, see [New-TransportRule](/powershell/module/exchange/new-transportrule).</span></span>

## <a name="how-do-you-know-this-worked"></a><span data-ttu-id="e4ac6-150">Как убедиться, что все получилось?</span><span class="sxs-lookup"><span data-stu-id="e4ac6-150">How do you know this worked?</span></span>

<span data-ttu-id="e4ac6-151">Чтобы убедиться, что вы успешно создали правило потока почты для блокировки сообщений, содержащих исполняемые вложения, сделайте все следующие действия:</span><span class="sxs-lookup"><span data-stu-id="e4ac6-151">To verify that you've successfully create a mail flow rule to block messages that contain executable attachments, do any of the following steps:</span></span>

- <span data-ttu-id="e4ac6-152">В EAC перейдите к **правилу потока почты** выберите правило \>  \> \> нажмите кнопку Изменить значок **Редактирование** ![ и проверьте ](../../media/ITPro-EAC-EditIcon.png) параметры.</span><span class="sxs-lookup"><span data-stu-id="e4ac6-152">In the EAC, go to **Mail flow** \> **Rules** \> select the rule \> click **Edit** ![Edit icon](../../media/ITPro-EAC-EditIcon.png), and verify the settings.</span></span>

- <span data-ttu-id="e4ac6-153">В PowerShell запустите следующую команду для проверки параметров:</span><span class="sxs-lookup"><span data-stu-id="e4ac6-153">In PowerShell, run the following command to verify the settings:</span></span>

  ```powershell
  Get-TransportRule -Identity "<Rule Name>" | Format-List Name,AttachmentHasExecutableContent,RejectMessage*,DeleteMessage
  ```