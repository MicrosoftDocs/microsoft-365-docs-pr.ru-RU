---
title: Использование правил для обработки почтового ящика для блокирования сообщений с исполняемыми вложениями
f1.keywords:
- NOCSH
ms.author: chrisda
author: chrisda
manager: dansimp
ms.date: ''
audience: ITPro
ms.topic: article
ms.service: O365-seccomp
localization_priority: Normal
ms.assetid: c4fb4a86-b772-49d0-8773-e8ee897e175d
ms.custom:
- seo-marvel-apr2020
description: Администраторы могут узнать, как создавать правила для поток обработки почты (правила транспорта), чтобы заблокировать сообщения, содержащие исполняемые файлы.
ms.openlocfilehash: 4f25af9dc6595201c98a9e89875772bc7192d9dc
ms.sourcegitcommit: 40ec697e27b6c9a78f2b679c6f5a8875dacde943
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/23/2020
ms.locfileid: "44350999"
---
# <a name="use-mail-flow-rules-to-block-messages-with-executable-attachments-in-eop"></a><span data-ttu-id="a74cc-103">Используйте правила потока почты для блокировки сообщений с исполняемыми вложениями в EOP</span><span class="sxs-lookup"><span data-stu-id="a74cc-103">Use mail flow rules to block messages with executable attachments in EOP</span></span>

<span data-ttu-id="a74cc-104">В организациях Microsoft 365 с почтовыми ящиками в организациях Exchange Online или Exchange Online Protection (EOP) без почтовых ящиков Exchange Online, EOP использует политики защиты от вредоносных программ для блокирования вредоносных сообщений, включая сообщения с исполняемыми вложениями.</span><span class="sxs-lookup"><span data-stu-id="a74cc-104">In Microsoft 365 organizations with mailboxes in Exchange Online or standalone Exchange Online Protection (EOP) organizations without Exchange Online mailboxes, EOP uses anti-malware policies to block harmful messages, including messages with executable attachments.</span></span> <span data-ttu-id="a74cc-105">Дополнительные сведения см. [в статье Защита от вредоносных программ в EOP](anti-malware-protection.md).</span><span class="sxs-lookup"><span data-stu-id="a74cc-105">For more information, see [Anti-malware protection in EOP](anti-malware-protection.md).</span></span>

<span data-ttu-id="a74cc-106">Чтобы улучшить защиту, вы можете использовать правила для управления потоками обработки почты (также называемые правилами транспорта), чтобы определять и блокировать сообщения, содержащие исполняемые вложения, как описано в этой статье.</span><span class="sxs-lookup"><span data-stu-id="a74cc-106">To further enhance protection, you can use mail flow rules (also known as transport rules) to identify and block messages that contain executable attachments as described in this topic.</span></span>

<span data-ttu-id="a74cc-107">Например, после эпидемии вредоносных программ компания может применить это правило с предельным пределом времени, чтобы затронутые пользователи могли вернуться к отправке вложений через заданный период времени.</span><span class="sxs-lookup"><span data-stu-id="a74cc-107">For example, following a malware outbreak, a company could apply this rule with a time limit so that affected users can get back to sending attachments after a specified length of time.</span></span>

## <a name="what-do-you-need-to-know-before-you-begin"></a><span data-ttu-id="a74cc-108">Что нужно знать перед началом работы</span><span class="sxs-lookup"><span data-stu-id="a74cc-108">What do you need to know before you begin?</span></span>

- <span data-ttu-id="a74cc-109">Прежде чем выполнять следующие процедуры, необходимо назначить разрешения.</span><span class="sxs-lookup"><span data-stu-id="a74cc-109">You need to be assigned permissions before you can do these procedures:</span></span>

  - <span data-ttu-id="a74cc-110">В Exchange Online вы найдете запись "почтовый ящик" в разделе "Управление [разрешениями" функции в Exchange Online](https://docs.microsoft.com/Exchange/permissions-exo/feature-permissions).</span><span class="sxs-lookup"><span data-stu-id="a74cc-110">In Exchange Online, see the "Mail flow" entry in [Feature Permissions in Exchange Online](https://docs.microsoft.com/Exchange/permissions-exo/feature-permissions).</span></span>
  
  - <span data-ttu-id="a74cc-111">В автономном EOP вам потребуются роли правил транспорта, которые назначаются ролям Организатионманажемент, Комплианцеманажемент и RecordsManagement по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="a74cc-111">In standalone EOP, you need the Transport Rules role, which is assigned to the OrganizationManagement, ComplianceManagement, and RecordsManagement roles by default.</span></span> <span data-ttu-id="a74cc-112">Дополнительные сведения см. [в разделе разрешения в автономных EOP](feature-permissions-in-eop.md) и используйте центр администрирования Exchange для [изменения списка участников в группах ролей](manage-admin-role-group-permissions-in-eop.md#use-the-eac-modify-the-list-of-members-in-role-groups).</span><span class="sxs-lookup"><span data-stu-id="a74cc-112">For more information, see [Permissions in standalone EOP](feature-permissions-in-eop.md) and [Use the EAC modify the list of members in role groups](manage-admin-role-group-permissions-in-eop.md#use-the-eac-modify-the-list-of-members-in-role-groups).</span></span>

- <span data-ttu-id="a74cc-113">Чтобы открыть центр администрирования Exchange в Exchange Online, обратитесь к [центру администрирования Exchange в Exchange Online](https://docs.microsoft.com/Exchange/exchange-admin-center).</span><span class="sxs-lookup"><span data-stu-id="a74cc-113">To open the EAC in Exchange Online, see [Exchange admin center in Exchange Online](https://docs.microsoft.com/Exchange/exchange-admin-center).</span></span> <span data-ttu-id="a74cc-114">Чтобы открыть центр администрирования Exchange в автономном EOP, обратитесь к разделу [центр администрирования Exchange в отдельном EOP](exchange-admin-center-in-exchange-online-protection-eop.md).</span><span class="sxs-lookup"><span data-stu-id="a74cc-114">To open the EAC in standalone EOP, see [Exchange admin center in standalone EOP](exchange-admin-center-in-exchange-online-protection-eop.md).</span></span>

- <span data-ttu-id="a74cc-115">Сведения о том, как подключиться к Exchange Online PowerShell, см. в статье [Подключение к Exchange Online PowerShell](https://docs.microsoft.com/powershell/exchange/exchange-online/connect-to-exchange-online-powershell/connect-to-exchange-online-powershell).</span><span class="sxs-lookup"><span data-stu-id="a74cc-115">To connect to Exchange Online PowerShell, see [Connect to Exchange Online PowerShell](https://docs.microsoft.com/powershell/exchange/exchange-online/connect-to-exchange-online-powershell/connect-to-exchange-online-powershell).</span></span> <span data-ttu-id="a74cc-116">Чтобы подключиться к автономному EOP PowerShell, см. раздел [Подключение к PowerShell Exchange Online Protection](https://docs.microsoft.com/powershell/exchange/exchange-eop/connect-to-exchange-online-protection-powershell).</span><span class="sxs-lookup"><span data-stu-id="a74cc-116">To connect to standalone EOP PowerShell, see [Connect to Exchange Online Protection PowerShell](https://docs.microsoft.com/powershell/exchange/exchange-eop/connect-to-exchange-online-protection-powershell).</span></span>

- <span data-ttu-id="a74cc-117">Дополнительные сведения о правилах обработки почтового ящика в Exchange Online и отдельном EOP содержатся в следующих разделах:</span><span class="sxs-lookup"><span data-stu-id="a74cc-117">For more information about mail flow rules in Exchange Online and standalone EOP, see the following topics:</span></span>

  - [<span data-ttu-id="a74cc-118">Правила потока обработки почты (правила транспорта) в Exchange Online</span><span class="sxs-lookup"><span data-stu-id="a74cc-118">Mail flow rules (transport rules) in Exchange Online</span></span>](https://docs.microsoft.com/Exchange/security-and-compliance/mail-flow-rules/mail-flow-rules)

  - [<span data-ttu-id="a74cc-119">Условия и исключения правила для обработки почтового процесса (предикаты) в Exchange Online</span><span class="sxs-lookup"><span data-stu-id="a74cc-119">Mail flow rule conditions and exceptions (predicates) in Exchange Online</span></span>](https://docs.microsoft.com/Exchange/security-and-compliance/mail-flow-rules/conditions-and-exceptions)

  - [<span data-ttu-id="a74cc-120">Действия правил обработки почты в Exchange Online</span><span class="sxs-lookup"><span data-stu-id="a74cc-120">Mail flow rule actions in Exchange Online</span></span>](https://docs.microsoft.com/Exchange/security-and-compliance/mail-flow-rules/mail-flow-rule-actions)

## <a name="use-the-eac-to-create-a-rule-that-blocks-messages-with-executable-attachments"></a><span data-ttu-id="a74cc-121">Использование центра администрирования Exchange для создания правила, блокирующего сообщения с исполняемыми вложениями</span><span class="sxs-lookup"><span data-stu-id="a74cc-121">Use the EAC to create a rule that blocks messages with executable attachments</span></span>

1. <span data-ttu-id="a74cc-122">В Центре администрирования Exchange перейдите в раздел **Поток обработки почты** \> **Правила**.</span><span class="sxs-lookup"><span data-stu-id="a74cc-122">In the EAC, go to **Mail flow** \> **Rules**.</span></span>

2. <span data-ttu-id="a74cc-123">Щелкните **Добавить** ![ значок Добавить ](../../media/ITPro-EAC-AddIcon.png) , а затем выберите **создать новое правило**.</span><span class="sxs-lookup"><span data-stu-id="a74cc-123">Click **Add** ![Add icon](../../media/ITPro-EAC-AddIcon.png) and then select **Create a new rule**.</span></span>

3. <span data-ttu-id="a74cc-124">На открывшейся странице **Новое правило** настройте следующие параметры:</span><span class="sxs-lookup"><span data-stu-id="a74cc-124">In the **New rule** page that opens, configure the following settings:</span></span>

   - <span data-ttu-id="a74cc-125">**Name**: введите уникальное описательное имя правила.</span><span class="sxs-lookup"><span data-stu-id="a74cc-125">**Name**: Enter a unique, descriptive name for the rule.</span></span>

   - <span data-ttu-id="a74cc-126">Нажмите кнопку **Дополнительные параметры**.</span><span class="sxs-lookup"><span data-stu-id="a74cc-126">Click **More Options**.</span></span>

   - <span data-ttu-id="a74cc-127">**Применять это правило, если**: выберите **любое вложение** \> **с исполняемым содержимым**.</span><span class="sxs-lookup"><span data-stu-id="a74cc-127">**Apply this rule if**: Select **Any attachment** \> **has executable content**.</span></span>

   - <span data-ttu-id="a74cc-128">**Выполните следующие**действия: выберите **блокировать сообщение** , а затем выберите нужное действие:</span><span class="sxs-lookup"><span data-stu-id="a74cc-128">**Do the following**: Select **Block the message** and then choose the action you want:</span></span>

     - <span data-ttu-id="a74cc-129">**Отклонить сообщение и включить объяснение**: в открывшемся диалоговом окне **Указание причины отклонения** введите текст, который должен отображаться в отчете о недоставке (также называемом сообщением о недоставке или сообщении Bounce).</span><span class="sxs-lookup"><span data-stu-id="a74cc-129">**reject the message and include an explanation**: In the **Specify reject reason** dialog that appears, enter the text you want to appear in the non-delivery report (also known as an NDR or bounce message).</span></span> <span data-ttu-id="a74cc-130">Расширенный код состояния, который используется по умолчанию: 5.7.1.</span><span class="sxs-lookup"><span data-stu-id="a74cc-130">The default enhanced status code that's used is 5.7.1.</span></span>

     - <span data-ttu-id="a74cc-131">**Отклонить сообщение с расширенным кодом состояния**: в появившемся диалоговом окне **Ввод расширенного кода** состояния введите расширенный код состояния, который будет отображаться в отчете о недоставке.</span><span class="sxs-lookup"><span data-stu-id="a74cc-131">**reject the message with the enhanced status code of**:  In the **Enter enhanced status code** dialog that appears, enter the enhanced status code that you want to appear in the NDR.</span></span> <span data-ttu-id="a74cc-132">Допустимые значения: 5.7.1 или значение от от 5.7.900 до 5.7.999.</span><span class="sxs-lookup"><span data-stu-id="a74cc-132">Valid values are 5.7.1 or a value from 5.7.900 to 5.7.999.</span></span> <span data-ttu-id="a74cc-133">Текст отклонения по умолчанию: Доставка не разрешена, сообщение отклонено.</span><span class="sxs-lookup"><span data-stu-id="a74cc-133">The default rejection text is: Delivery not authorized, message refused.</span></span>

     - <span data-ttu-id="a74cc-134">**отклонить сообщение, не уведомляя кого**</span><span class="sxs-lookup"><span data-stu-id="a74cc-134">**reject the message without notifying anyone**</span></span>

4. <span data-ttu-id="a74cc-135">По завершении нажмите кнопку **Сохранить**.</span><span class="sxs-lookup"><span data-stu-id="a74cc-135">When you're finished, click **Save**.</span></span> <span data-ttu-id="a74cc-136">Теперь правило блокирования вложений вступило в силу.</span><span class="sxs-lookup"><span data-stu-id="a74cc-136">Your attachment blocking rule is now in force.</span></span>

## <a name="use-powershell-to-create-a-rule-that-blocks-messages-with-executable-attachments"></a><span data-ttu-id="a74cc-137">Использование PowerShell для создания правила, блокирующего сообщения с исполняемыми вложениями</span><span class="sxs-lookup"><span data-stu-id="a74cc-137">Use PowerShell to create a rule that blocks messages with executable attachments</span></span>

<span data-ttu-id="a74cc-138">Используйте следующий синтаксис, чтобы создать правило для блокирования сообщений, содержащих исполняемые вложения:</span><span class="sxs-lookup"><span data-stu-id="a74cc-138">Use the following syntax to create a rule to blocks messages that contain executable attachments:</span></span>

```powershell
New-TransportRule -Name "<UniqueName>" -AttachmentHasExecutableContent $true [-RejectMessageEnhancedStatusCode <5.7.1 | 5.7.900 to 5.7.999>] [-RejectMessageReasonText "<Text>"] [-DeleteMessage $true]
```

<span data-ttu-id="a74cc-139">**Примечания**:</span><span class="sxs-lookup"><span data-stu-id="a74cc-139">**Notes**:</span></span>

- <span data-ttu-id="a74cc-140">При использовании параметра _RejectMessageEnhancedStatusCode_ без параметра _RejectMessageReasonText_ текст по умолчанию: Доставка не разрешена, сообщение отклонено.</span><span class="sxs-lookup"><span data-stu-id="a74cc-140">If you use the _RejectMessageEnhancedStatusCode_ parameter without the _RejectMessageReasonText_ parameter, the default text is: Delivery not authorized, message refused.</span></span>

- <span data-ttu-id="a74cc-141">Если параметр _RejectMessageReasonText_ используется без параметра _RejectMessageEnhancedStatusCode_ , то по умолчанию используется код 5.7.1.</span><span class="sxs-lookup"><span data-stu-id="a74cc-141">If you use the _RejectMessageReasonText_ parameter without the _RejectMessageEnhancedStatusCode_ parameter, the default code is 5.7.1.</span></span>

<span data-ttu-id="a74cc-142">В этом примере создается новое правило с именем блокировать исполняемые вложения, которое удаляет сообщения, содержащие исполняемые файлы, без уведомления.</span><span class="sxs-lookup"><span data-stu-id="a74cc-142">This example creates a new rule named Block Executable Attachments that silently deletes messages that contain executable attachments.</span></span>

```powershell
New-TransportRule -Name "Block Executable Attachments" -AttachmentHasExecutableContent $true -DeleteMessage $true
```

<span data-ttu-id="a74cc-143">Дополнительные сведения о синтаксисе и параметрах см. в статье [New-TransportRule](https://docs.microsoft.com/powershell/module/exchange/new-transportrule).</span><span class="sxs-lookup"><span data-stu-id="a74cc-143">For detailed syntax and parameter information, see [New-TransportRule](https://docs.microsoft.com/powershell/module/exchange/new-transportrule).</span></span>

## <a name="how-do-you-know-this-worked"></a><span data-ttu-id="a74cc-144">Как убедиться, что все получилось?</span><span class="sxs-lookup"><span data-stu-id="a74cc-144">How do you know this worked?</span></span>

<span data-ttu-id="a74cc-145">Чтобы убедиться, что вы успешно создали правило для обработки почтового ящика, чтобы заблокировать сообщения, содержащие исполняемые файлы, выполните одно из указанных ниже действий.</span><span class="sxs-lookup"><span data-stu-id="a74cc-145">To verify that you've successfully create a mail flow rule to block messages that contain executable attachments, do any of the following steps:</span></span>

- <span data-ttu-id="a74cc-146">В центре администрирования Exchange перейдите к разделу правила для обработки **почтового ящика** , \> **Rules** \> выберите правило \> щелкните **изменить** ![ значок редактирования ](../../media/ITPro-EAC-EditIcon.png) и проверьте параметры.</span><span class="sxs-lookup"><span data-stu-id="a74cc-146">In the EAC, go to **Mail flow** \> **Rules** \> select the rule \> click **Edit** ![Edit icon](../../media/ITPro-EAC-EditIcon.png), and verify the settings.</span></span>

- <span data-ttu-id="a74cc-147">В PowerShell выполните следующую команду, чтобы проверить параметры:</span><span class="sxs-lookup"><span data-stu-id="a74cc-147">In PowerShell, run the following command to verify the settings:</span></span>

  ```powershell
  Get-TransportRule -Identity "<Rule Name>" | Format-List Name,AttachmentHasExecutableContent,RejectMessage*,DeleteMessage
  ```
