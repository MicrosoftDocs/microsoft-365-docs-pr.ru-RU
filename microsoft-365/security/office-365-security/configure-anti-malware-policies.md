---
title: Настройка политик защиты от вредоносных программ
f1.keywords:
- NOCSH
ms.author: chrisda
author: chrisda
manager: dansimp
ms.date: ''
audience: ITPro
ms.topic: how-to
ms.service: O365-seccomp
localization_priority: Normal
search.appverid:
- MET150
ms.assetid: b0cfc21f-e3c6-41b6-8670-feb2b2e252e5
ms.collection:
- M365-security-compliance
- m365initiative-defender-office365
description: Администраторы могут узнать, как просматривать, создавать, изменять и удалять политики защиты от вредоносных программ в Exchange Online Protection (EOP).
ms.custom: seo-marvel-apr2020
ms.openlocfilehash: 3c6b4e23f9d56696ae437ca8161d921e1f8991b4
ms.sourcegitcommit: 849b365bd3eaa9f3c3a9ef9f5973ef81af9156fa
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/16/2020
ms.locfileid: "49688551"
---
# <a name="configure-anti-malware-policies-in-eop"></a>Настройка политик борьбы с вредоносными программами в EOP

[!INCLUDE [Microsoft 365 Defender rebranding](../includes/microsoft-defender-for-office.md)]


В организациях Microsoft 365 с почтовыми ящиками в организациях Exchange Online или автономных организациях Exchange Online Protection (EOP) без почтовых ящиков Exchange Online сообщения электронной почты автоматически защищаются от вредоносных программ с помощью EOP. EOP использует политики защиты от вредоносных программ для параметров защиты от вредоносных программ. Дополнительные сведения см. в [под защитой от вредоносных программ.](anti-malware-protection.md)

Администраторы могут просматривать, изменять и настраивать (но не удалять) политику по умолчанию для борьбы с вредоносными программами в удовлетворении потребностей организации. Для большей детализации можно также создать настраиваемые политики борьбы с вредоносными программами, которые применяются к определенным пользователям, группам или доменам в организации. Настраиваемые политики всегда имеют приоритет перед политикой по умолчанию, но вы можете изменить приоритеты (порядок применения) своих настраиваемых политик.

Политики защиты от вредоносных программ можно настроить в Центре безопасности & соответствия требованиям или в PowerShell (Exchange Online PowerShell для организаций Microsoft 365 с почтовыми ящиками в Exchange Online; автономный EOP PowerShell для организаций без почтовых ящиков Exchange Online).

## <a name="what-do-you-need-to-know-before-you-begin"></a>Что нужно знать перед началом работы

- Откройте Центр безопасности и соответствия требованиям на сайте <https://protection.office.com/>. Чтобы перейти непосредственно на страницу **"Антивредоносная** программа", используйте <https://protection.office.com/antimalware> .

- Сведения о том, как подключиться к Exchange Online PowerShell, см. в статье [Подключение к Exchange Online PowerShell](https://docs.microsoft.com/powershell/exchange/connect-to-exchange-online-powershell). Чтобы подключиться к автономному EOP PowerShell, см. раздел [Подключение к PowerShell Exchange Online Protection](https://docs.microsoft.com/powershell/exchange/connect-to-exchange-online-protection-powershell).

- Для выполнения процедур, описанных в этой статье, вам должны быть назначены разрешения в Центре безопасности и соответствия требованиям:
  - Чтобы добавлять, изменять и удалять политики защиты от вредоносных программ, необходимо быть членом группы ролей "Управление организацией" или "Администратор **безопасности".** 
  - Для доступа только для чтения к политикам защиты от вредоносных программ  необходимо быть членом группы ролей **"Глобальный** читатель" или "Читатель безопасности".

  Дополнительные сведения см. в статье [Разрешения в Центре безопасности и соответствия требованиям](permissions-in-the-security-and-compliance-center.md).

  **Примечания**.

  - Добавление пользователей в соответствующую роль Azure Active Directory в Центре безопасности Microsoft 365 предоставляет пользователям необходимые разрешения в Центре безопасности и соответствия требованиям _и_ разрешения для других функций в Microsoft 365. Дополнительные сведения см. в статье [О ролях администраторов](https://docs.microsoft.com/microsoft-365/admin/add-users/about-admin-roles).
  - Группа ролей **Управление организацией с правами только на просмотр** в [Exchange Online](https://docs.microsoft.com/Exchange/permissions-exo/permissions-exo#role-groups) также предоставляет доступ только для чтения к этой функции.

- Рекомендуемые параметры политик для борьбы с вредоносными программами см. в параметрах политики [EOP.](recommended-settings-for-eop-and-office365-atp.md#eop-anti-malware-policy-settings)

## <a name="use-the-security--compliance-center-to-create-anti-malware-policies"></a>Использование Центра безопасности & соответствия требованиям для создания политик защиты от вредоносных программ

При создании настраиваемой политики защиты от вредоносных программ в Центре безопасности & соответствия требованиям одновременно создаются правило фильтрации вредоносных программ и связанная с ними политика фильтрации вредоносных программ с одинаковым именем.

1. В Центре безопасности & соответствия требованиям  перейдите в центр защиты от вредоносных программ политики управления угрозами и нажмите кнопку \>  \>  **"Новый** ![ значок добавления". ](../../media/ITPro-EAC-AddIcon.png)

2. На **открываемой** странице "Создание политики для борьбы с вредоносными программами" настройте эти параметры:

   - **Имя**. Укажите уникальное, понятное имя политики.

   - **Описание**. Укажите необязательное описание политики.

   - **Ответ на обнаружение** вредоносных программ: выберите одно из этих значений для параметра "Уведомлять получателей о том, что их сообщения находятся в **карантине?".**

     - **Нет:** сообщение находится на карантине без уведомления для получателей. Это значение используется по умолчанию.

     - **Да и используйте текст уведомления по умолчанию:** сообщение находится в карантине. Копия сообщения доставляется получателям, но  все вложения (а не только обнаруженные) заменяются одним текстовым файлом с именем **Malware Alert Text.txt** который содержит текст по умолчанию. Текст по умолчанию см. в политиках [борьбы с вредоносными программами.](anti-malware-protection.md#anti-malware-policies)

     - **Да и используйте пользовательский текст уведомления:** сообщение находится в карантине. Копия сообщения доставляется получателям, но  все вложения (а не только обнаруженные) заменяются одним текстовым файлом с  именем **Malware Alert Text.txt** содержит пользовательский текст, заданный в текстовом поле настраиваемого оповещения.

   - **Фильтр распространенных типов вложений:** выберите одно из этих значений для блокировки типов вложений, которые могут нанести **вред компьютеру.**:

     - **Выкл.**

     - **On**: Messages with the specified attachments are treated as malware detections and are automatically quarantined. Список можно изменить, нажав кнопки **"Добавить"** и **"Удалить".**

   - **Автоматическая очистка** вредоносных программ : автоматическая очистка вредоносных программ карантин сообщений, которые уже были доставлены. Дополнительные сведения см. в автоматической очистке [(ZAP)](zero-hour-auto-purge.md)в Exchange Online. Выберите одно из этих значений:

     - **Выкл.**

     - **Ветвь (рекомендуется)**

   - **Уведомление:** параметры в этом разделе контролируют уведомления отправитель и администратор при обнаружении вредоносной программы в сообщении.

     - **Sender Notifications**: Select one or both of these options:

       - **Уведомить внутренних отправителей:** внутренний отправитель находится внутри организации.

       - **Уведомлять внешних отправителей:** внешний отправитель находится за пределами организации.

     - **Уведомления администратора:** выберите один или оба этих параметра:

       - **Уведомлять администратора** о недосвеченных сообщениях от внутренних отправителей: если выбран этот параметр, введите адрес электронной почты уведомления в поле "Адрес электронной почты **администратора".**

       - **Уведомлять администратора** о недосвеченных сообщениях от внешних отправителей: если выбран этот параметр, введите адрес электронной почты уведомления в поле "Адрес электронной почты **администратора".**

     - **Настройка уведомлений:** эти параметры заменяют текст уведомлений по умолчанию, используемый для отправителей или администраторов. Дополнительные сведения о значениях по умолчанию см. в политиках для [борьбы с вредоносными программами.](anti-malware-protection.md#anti-malware-policies)

       - Используйте настраиваемый текст **уведомления:** при выборе этого параметра необходимо  использовать поля "От" и "От" адресов, чтобы указать имя и адрес электронной почты отправитель, используемые в настраиваемом уведомлении. 

       - Сообщения от внутренних отправителей: если вы выбрали уведомление отправителей или администраторов о недоставки сообщений от  внутренних  отправителей, необходимо использовать поля "Тема" и "Сообщения", чтобы указать тему и текст настраиваемого уведомления. 

       - Сообщения от внешних отправителей: если вы выбрали уведомление отправителей или администраторов о недоставки сообщений от  внешних отправителей, необходимо использовать поля "Тема" и "Сообщения", чтобы указать тему и текст сообщения настраиваемого уведомления.  

   - **Применяется к**: параметры в этом разделе определяют внутренних получателей, к которые применяется политика.

     - **If**: Click on the **Select one** drop-down, and select conditions for the rule:

       - **Получатель:** указывает один или несколько почтовых ящиков, почтовых пользователей или почтовых контактов в организации. В **отображемом** диалоговом окне "Выбор членов" выберите одного или несколько получателей в списке и нажмите кнопку **"Добавить" . \>** В поле **"Check names"** можно использовать подикалки для нескольких адресов электронной почты (например, \* @fabrikam.com). После этого нажмите кнопку **ОК**.

       - **The recipient domain is**: Specifies recipients in one or more of the configured accepted domains your organization. В отображемом диалоговом окне выберите один или несколько доменов и нажмите кнопку **"Добавить" \> .** После этого нажмите кнопку **ОК**.

       - **Получатель является членом**: указывает одну или несколько групп в организации. В **отображемом** диалоговом окне "Выбор членов" выберите одну или несколько групп в списке и нажмите кнопку **"Добавить" . \>** После этого нажмите кнопку **ОК**.

     Условие можно использовать только один раз, но можно указать несколько значений для условия. Несколько значений одного условия используют логику OR (например, _\<recipient1\>_ или _\<recipient2\>_ ). В разных условиях используется логика AND (например, _\<recipient1\>_ и _\<member of group 1\>_ ). Чтобы добавить условие, нажмите **Добавить условие** и выберите один из оставшихся вариантов.

     - **За исключением случаев,** когда : чтобы добавить исключения  для правила, нажмите кнопку "Добавить исключение", выберите один из них и настройте исключения. Параметры и поведение полностью идентичны условиям.

3. По завершении нажмите кнопку **Сохранить**.

## <a name="use-the-security--compliance-center-to-view-anti-malware-policies"></a>Просмотр политик защиты & безопасности с помощью Центра безопасности и соответствия требованиям

1. В Центре безопасности & соответствия требованиям  перейдите к политике управления угрозами для защиты от \>  \> **вредоносных программ.**

2. При выборе политики сведения о ней отображаются в области сведений. Чтобы увидеть дополнительные сведения о политике, нажмите **значок редактирования.** ![ ](../../media/ITPro-EAC-EditIcon.png)

   - Значения свойств **Enabled** и **Priority**, а также параметры со вкладки **Применяется к** входят в состав правила фильтрации вредоносных программ.

   - Параметры на вкладках **Общие** и **Параметры** входят в состав политики фильтрации вредоносных программ.

## <a name="use-the-security--compliance-center-to-modify-anti-malware-policies"></a>Использование Центра безопасности & соответствия требованиям для изменения политик защиты от вредоносных программ

1. В Центре безопасности & соответствия требованиям  перейдите к политике управления угрозами для защиты от \>  \> **вредоносных программ.**

2. Выберите политику и нажмите  значок ![ ](../../media/ITPro-EAC-EditIcon.png) редактирования. Дополнительные сведения о параметрах см. в разделе ["Использование](#use-the-security--compliance-center-to-create-anti-malware-policies) центра безопасности & соответствия требованиям для создания политик защиты от вредоносных программ" этой статьи.

   **Примечания**.

   - Параметры не отображаются на одной странице, а разделены на вкладки **Общие**, **Параметры** и **Применяется к**. Вкладка **"Применено к"** недоступна в политике по умолчанию с именем Default (которая автоматически применяется для всех).

   - Переименовать политику по умолчанию невозможно.

## <a name="use-the-security--compliance-center-to-enable-or-disable-anti-malware-policies"></a>Использование Центра безопасности & соответствия требованиям для включаемой или отключенной политики защиты от вредоносных программ

1. В Центре безопасности & соответствия требованиям  перейдите к политике управления угрозами для защиты от \>  \> **вредоносных программ.**

2. Выберите политику в списке, а затем настройте один из следующих параметров:

   - **Отключать политику:** сключив этот столбец в **столбце "Включено".** По умолчанию политики защиты от вредоносных программ включены при их создании в Центре безопасности & соответствия требованиям.

   - **Включит политику:** выберите этот столбец в **столбце "Включено".**

## <a name="use-the-security--compliance-center-to-set-the-priority-of-custom-anti-malware-policies"></a>Использование Центра безопасности & соответствия требованиям для настройки приоритета настраиваемой политики защиты от вредоносных программ

По умолчанию политикам борьбы с вредоносными программами предоставляется приоритет, основанный на порядке их создания (приоритет новых политик ниже, чем у старых политик). Чем ниже значение, тем выше приоритет политики, а порядок обработки политик зависит от их приоритетов (политики с высоким приоритетом обрабатываются раньше, чем политики с низким приоритетом). Никакие две политики не могут иметь одинаковый приоритет, и обработка политики прекращается после применения первой политики.

 **Примечания**.

- В Центре & соответствия требованиям приоритет политики защиты от вредоносных программ можно изменить только после ее создания. В PowerShell можно переопредить приоритет по умолчанию при создании правила фильтрации вредоносных программ (которое может повлиять на приоритет существующих правил).

- В Центре & соответствия требованиям политики защиты от вредоносных программ обрабатываются в том порядке, в  который они отображаются (первая политика имеет значение приоритета 0). Политика по умолчанию для борьбы с вредоносными программами с именем Default имеет значение приоритета **"Самый** низкий", и изменить его нельзя.

Чтобы изменить приоритет политики, переместите ее вверх или вниз в списке (в Центре безопасности и соответствия требованиям невозможно напрямую изменить значение свойства **Приоритет**).

1. В Центре безопасности & соответствия требованиям  перейдите к политике управления угрозами для защиты от \>  \> **вредоносных программ.**

2. Выберите политику, а  затем щелкните значок стрелки вверх или вниз, чтобы переместить правило вверх или ![ вниз в ](../../media/ITPro-EAC-UpArrowIcon.png)  ![ ](../../media/ITPro-EAC-DownArrowIcon.png) списке.

## <a name="use-the-security--compliance-center-to-remove-anti-malware-policies"></a>Удаление политик защиты & безопасности с помощью Центра безопасности и соответствия требованиям

При удалении политики & безопасности и соответствия требованиям правило фильтрации вредоносных программ и соответствующая политика удаляются.

1. В Центре безопасности & соответствия требованиям  перейдите к политике управления угрозами для защиты от \>  \> **вредоносных программ.**

2. Выберите политику для борьбы с вредоносными программами, которая будет удалена из списка, и нажмите значок **"Удалить** ![ ](../../media/ITPro-EAC-DeleteIcon.png) удалить".

## <a name="use-exchange-online-powershell-or-standalone-eop-powershell-to-configure-anti-malware-policies"></a>Настройка политик антивредоносной программы с помощью Exchange Online PowerShell или автономных EOP PowerShell

### <a name="use-powershell-to-create-anti-malware-policies"></a>Создание политик для борьбы с вредоносными программами с помощью PowerShell

Создание политики борьбы с вредоносными программами в PowerShell — это двухшаговая процедура:

1. Создание политики фильтрации вредоносных программ.

2. Создание правила фильтрации вредоносных программ, указывающего политику, к которой оно применяется.

 **Примечания**.

- Вы можете создать новое правило фильтрации вредоносных программ и назначить ему существующую несвязаную политику фильтрации вредоносных программ. Правило фильтрации вредоносных программ не может быть связано с более чем одной политикой фильтрации вредоносных программ.

- Существует два параметра, которые можно настроить для новых политик защиты от вредоносных программ в PowerShell, которые недоступны в Центре безопасности и соответствия требованиям & до создания политики:

  - Создайте новую политику как отключенную _(включена_ `$false` в **cmdlet New-MalwareFilterRule).**

  - Установите приоритет политики во время создания _(приоритет)_ в _\<Number\>_ **cmdlet New-MalwareFilterRule).**

- Новая политика фильтрации вредоносных программ, которую вы создаете в PowerShell, не отображается в Центре безопасности & соответствия требованиям, пока вы не назначите политику правилу фильтрации вредоносных программ.

#### <a name="step-1-use-powershell-to-create-a-malware-filter-policy"></a>Шаг 1. Создание политики фильтрации вредоносных программ с помощью PowerShell

**Примечание.** В EOP значения _параметра Action_ не удаляют `DeleteMessage` `DeleteAttachmentAndUseDefaultAlert` `DeleteAttachmentAndUseCustomAlert` сообщения. Вместо этого сообщения находятся в карантине. Дополнительные сведения о том, как получить сообщения на карантине, см. в подзапросе "Управление сообщениями и файлами на карантине" от имени администратора [в EOP.](manage-quarantined-messages-and-files.md)

Чтобы создать политику фильтрации вредоносных программ, используйте следующий синтаксис:

```PowerShell
New-MalwareFilterPolicy -Name "<PolicyName>" [-Action <DeleteMessage | DeleteAttachmentAndUseDefaultAlert | DeleteAttachmentAndUseCustomAlert>] [-AdminDisplayName "<OptionalComments>"] [-CustomNotifications <$true | $false>] [<Inbound notification options>] [<Outbound notification options>]
```

В этом примере создается политика фильтрации вредоносных программ с именем Contoso Malware Filter Policy и следующими параметрами:

- Карантин сообщений, содержащих вредоносные программы без уведомления получателей (мы не используем параметр _Action,_ и значение по `DeleteMessage` умолчанию).

- Не уведомлять отправитель сообщения об обнаружении в сообщении вредоносной программы (мы не используем _параметры EnableExternalSenderNotifications_ или _EnableInternalSenderNotifications,_ а по умолчанию для них заданы оба `$false` параметра).

- Уведомлять администратора по адресу admin@contoso.com, когда в сообщении внутреннего отправителя обнаружена вредоносная программа.

```PowerShell
New-MalwareFilterPolicy -Name "Contoso Malware Filter Policy" -EnableInternalSenderAdminNotifications $true -InternalSenderAdminAddress admin@contoso.com
```

Подробные сведения о синтаксисе и параметрах см. в статье [New-MalwareFilterPolicy](https://docs.microsoft.com/powershell/module/exchange/new-malwarefilterpolicy).

#### <a name="step-2-use-powershell-to-create-a-malware-filter-rule"></a>Шаг 2. Создание правила фильтрации вредоносных программ с помощью PowerShell

Чтобы создать правило фильтрации вредоносных программ, используйте следующий синтаксис:

```PowerShell
New-MalwareFilterRule -Name "<RuleName>" -MalwareFilterPolicy "<PolicyName>" <Recipient filters> [<Recipient filter exceptions>] [-Comments "<OptionalComments>"]
```

В этом примере создается новое правило фильтрации вредоносных программ с именем Contoso Recipients и следующими параметрами:

- с правилом связана политика фильтрации вредоносных программ под названием Contoso Malware Filter Policy;

- правило применяется к получателям в домене contoso.com.

```PowerShell
New-MalwareFilterRule -Name "Contoso Recipients" -MalwareFilterPolicy "Contoso Malware Filter Policy" -RecipientDomainIs contoso.com
```

Подробные сведения о синтаксисе и параметрах см. в статье [New-MalwareFilterRule](https://docs.microsoft.com/powershell/module/exchange/new-malwarefilterrule).

### <a name="use-powershell-to-view-malware-filter-policies"></a>Просмотр политик фильтрации вредоносных программ с помощью PowerShell

Чтобы получить сводный список всех политик фильтрации вредоносных программ, выполните следующую команду:

```PowerShell
Get-MalwareFilterPolicy
```

Чтобы получить подробные сведения об определенной политике фильтрации вредоносных программ, используйте следующий синтаксис:

```PowerShell
Get-MalwareFilterPolicy -Identity "<PolicyName>" | Format-List [<Specific properties to view>]
```

В этом примере возвращаются значения всех свойств политики фильтрации вредоносных программ с именем Executives.

```PowerShell
Get-MalwareFilterPolicy -Identity "Executives" | Format-List
```

В этом примере возвращаются только указанные свойства той же политики.

```PowerShell
Get-MalwareFilterPolicy -Identity "Executives" | Format-List Action,AdminDisplayName,CustomNotifications,Enable*Notifications
```

Подробные сведения о синтаксисе и параметрах см. в статье [Get-MalwareFilterPolicy](https://docs.microsoft.com/powershell/module/exchange/get-malwarefilterpolicy).

### <a name="use-powershell-to-view-malware-filter-rules"></a>Просмотр правил фильтрации вредоносных программ с помощью PowerShell

Чтобы получить сводный список всех правил фильтрации вредоносных программ, выполните следующую команду:

```PowerShell
Get-MalwareFilterRule
```

Чтобы отфильтровать список по включенным или отключенным правилам, выполните следующие команды:

```PowerShell
Get-HostedContentFilterRule -State Disabled
```

```PowerShell
Get-HostedContentFilterRule -State Enabled
```

Чтобы получить подробные сведения об определенном правиле фильтрации вредоносных программ, используйте следующий синтаксис:

```PowerShell
Get-MalwareFilterRule -Identity "<RuleName>" | Format-List [<Specific properties to view>]
```

В этом примере возвращаются значения всех свойств правила фильтрации вредоносных программ с именем Executives.

```PowerShell
Get-MalwareFilterRule -Identity "Executives" | Format-List
```

В этом примере возвращаются только указанные свойства правила.

```PowerShell
Get-MalwareFilterRule -Identity "Executives" | Format-List Name,Priority,State,MalwareFilterPolicy,*Is,*SentTo,*MemberOf
```

Подробные сведения о синтаксисе и параметрах см. в статье [Get-MalwareFilterRule](https://docs.microsoft.com/powershell/module/exchange/get-malwarefilterrule).

### <a name="use-powershell-to-modify-malware-filter-policies"></a>Изменение политик фильтрации вредоносных программ с помощью PowerShell

Кроме следующих элементов, при изменении политики фильтрации вредоносных программ в PowerShell доступны те же параметры, что и при создании политики, как описано в разделе "Шаг [1. Использование PowerShell](#step-1-use-powershell-to-create-a-malware-filter-policy) для создания раздела политики фильтрации вредоносных программ" выше в этой статье.

- Переключатель _MakeDefault,_ который превращает указанную политику в политику по умолчанию (применяется ко всем, неизменяемый самый низкий приоритет, и вы не можете удалить ее) доступен только при изменении политики фильтрации вредоносных программ в PowerShell. 

- Политику фильтрации вредоносных программ переименовать нельзя (у cmdlet **Set-MalwareFilterPolicy** нет _параметра Name)._ При переименовании политики защиты от вредоносных программ в Центре безопасности и соответствия требованиям & только переименовывать правило фильтрации вредоносных _программ._

Чтобы изменить политику фильтрации вредоносных программ, используйте следующий синтаксис:

```PowerShell
Set-MalwareFilterPolicy -Identity "<PolicyName>" <Settings>
```

Подробные сведения о синтаксисе и параметрах см. в статье [Set-MalwareFilterPolicy](https://docs.microsoft.com/powershell/module/exchange/set-malwarefilterpolicy).

### <a name="use-powershell-to-modify-malware-filter-rules"></a>Изменение правил фильтрации вредоносных программ с помощью PowerShell

Единственным параметром, недоступным при изменении правила фильтрации вредоносных программ в PowerShell, является параметр _Enabled,_ позволяющий создать отключенное правило. Чтобы включить или отключить существующие правила фильтрации вредоносных программ, см. следующий раздел.

В противном случае при изменении правила фильтрации вредоносных программ в PowerShell дополнительные параметры недоступны. Эти же параметры доступны при создании правила, как описано в разделе "Шаг 2. Создание правила фильтрации вредоносных программ с помощью [PowerShell"](#step-2-use-powershell-to-create-a-malware-filter-rule) ранее в этой статье.

Чтобы изменить правило фильтрации вредоносных программ, используйте следующий синтаксис:

```PowerShell
Set-MalwareFilterRule -Identity "<RuleName>" <Settings>
```

Подробные сведения о синтаксисе и параметрах см. в статье [Set-MalwareFilterRule](https://docs.microsoft.com/powershell/module/exchange/set-malwarefilterrule).

### <a name="use-powershell-to-enable-or-disable-malware-filter-rules"></a>Использование PowerShell для включаемой или отключенной фильтрации вредоносных программ

Включение или отключение правила фильтрации вредоносных программ в PowerShell включает или отключает всю политику (правило фильтрации вредоносных программ и назначенную политику фильтрации вредоносных программ). Вы не можете включить или отключить политику по умолчанию для борьбы с вредоносными программами (она всегда применяется к всем получателям).

Чтобы включить или отключить правило фильтрации вредоносных программ в PowerShell, используйте синтаксис:

```PowerShell
<Enable-MalwareFilterRule | Disable-MalwareFilterRule> -Identity "<RuleName>"
```

В этом примере отключается правило фильтрации вредоносных программ с именем Marketing Department.

```PowerShell
Disable-MalwareFilterRule -Identity "Marketing Department"
```

В этом примере включается то же правило.

```PowerShell
Enable-MalwareFilterRule -Identity "Marketing Department"
```

Дополнительные сведения о синтаксисе и параметрах см. в статьях [Enable-MalwareFilterRule](https://docs.microsoft.com/powershell/module/exchange/enable-malwarefilterrule) и [Disable-MalwareFilterRule](https://docs.microsoft.com/powershell/module/exchange/disable-malwarefilterrule).

### <a name="use-powershell-to-set-the-priority-of-malware-filter-rules"></a>Настройка приоритета правил фильтрации вредоносных программ с помощью PowerShell

Максимальный приоритет, который можно задать для правила, — 0. Минимальное значение зависит от количества правил. Например, если у вас есть пять правил, вы можете использовать значения 0–4. Изменение приоритета существующего правила оказывает каскадное влияние на другие правила. Например, если вы измените приоритет правила на 2, когда у вас есть пять настраиваемых правил (с приоритетами от 0 до 4), то для существующего правила с приоритетом 2 будет задан приоритет 3, а для правила с приоритетом 3 будет задан приоритет 4.

Чтобы установить приоритет правила фильтрации вредоносных программ в PowerShell, используйте следующий синтаксис:

```PowerShell
Set-MalwareFilterRule -Identity "<RuleName>" -Priority <Number>
```

В этом примере для правила Marketing Department задается приоритет 2. Все правила с приоритетом не больше 2 понижаются на один ранг (значения приоритета увеличиваются на 1).

```PowerShell
Set-MalwareFilterRule -Identity "Marketing Department" -Priority 2
```

**Примечания**:

- Чтобы установить приоритет нового правила при его создании, используйте параметр _Priority_ в вместо этого параметра **new-MalwareFilterRule.**

- Политика фильтрации вредоносных программ по умолчанию не имеет соответствующего правила фильтрации вредоносных программ и всегда имеет немодифимимое значение приоритета **"Самый низкий".**

### <a name="use-powershell-to-remove-malware-filter-policies"></a>Удаление политик фильтрации вредоносных программ с помощью PowerShell

При удалении политики фильтрации вредоносных программ с помощью PowerShell соответствующее правило фильтрации вредоносных программ не удаляется.

Чтобы удалить политику фильтрации вредоносных программ в PowerShell, используйте синтаксис:

```PowerShell
Remove-MalwareFilterPolicy -Identity "<PolicyName>"
```

В этом примере удаляется политика фильтрации вредоносных программ с именем Marketing Department.

```PowerShell
Remove-MalwareFilterPolicy -Identity "Marketing Department"
```

Подробные сведения о синтаксисе и параметрах см. в статье [Remove-MalwareFilterPolicy](https://docs.microsoft.com/powershell/module/exchange/remove-malwarefilterpolicy).

### <a name="use-powershell-to-remove-malware-filter-rules"></a>Удаление правил фильтрации вредоносных программ с помощью PowerShell

При удалении правила фильтрации вредоносных программ с помощью PowerShell соответствующая политика фильтрации вредоносных программ не удаляется.

Чтобы удалить правило фильтрации вредоносных программ в PowerShell, используйте синтаксис:

```PowerShell
Remove-MalwareFilterRule -Identity "<PolicyName>"
```

В этом примере удаляется правило фильтрации вредоносных программ Marketing Department.

```PowerShell
Remove-MalwareFilterRule -Identity "Marketing Department"
```

Подробные сведения о синтаксисе и параметрах см. в статье [Remove-MalwareFilterRule](https://docs.microsoft.com/powershell/module/exchange/remove-malwarefilterrule).

## <a name="how-do-you-know-these-procedures-worked"></a>Как проверить, что эти процедуры выполнены?

### <a name="use-the-eicartxt-file-to-verify-your-anti-malware-policy-settings"></a>Использование файла EICAR.TXT для проверки параметров политики для борьбы с вредоносными программами

> [!IMPORTANT]
> Файл EICAR.TXT не является вирусом. Европейский института компьютерных антивирусных исследований (EICAR) разработал этот файл для безопасного тестирования антивирусных установок и параметров.

1. Откройте Блокнот и в paste the following text into an empty file:

   ```Text
   X5O!P%@AP[4\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*
   ```

   Убедитесь, что это единственные текстовые символы в файле. Размер файла должен быть 68байт.

2. Сохраните файл как EICAR.TXT

   В антивирусной программе для настольных компьютеров обязательно исключите EICAR.TXT проверки (в противном случае файл будет на карантине).

3. Отправьте сообщение электронной почты с EICAR.TXT в виде вложения с помощью почтового клиента, который не будет автоматически блокировать файл. Используйте параметры политики для борьбы с вредоносными программами, чтобы определить следующие сценарии для тестирования:

   - Электронная почта из внутреннего почтового ящика внутреннему получателю.

   - Электронная почта из внутреннего почтового ящика внешнему получателю.

   - Электронная почта из внешнего почтового ящика внутреннему получателю.

4. Убедитесь, что сообщение было на карантине, и проверьте результаты уведомлений получателя и отправитель на основе параметров политики для борьбы с вредоносными программами. Например:

   - Получатели не получают уведомления или получают исходное сообщение с вложением EICAR.TXT, замененным предупреждением о вредоносных **программахText.txt** который содержит текст по умолчанию или настроенный текст.

   - Внутренние или внешние отправитые получают уведомления по умолчанию или настраиваемые уведомления.

   - Указанный адрес электронной почты администратора оповещен для внутренних или внешних отправителей сообщений с настроенными или настроенными уведомлениями по умолчанию.

5. Удалите EICAR.TXT после завершения тестирования (чтобы другие пользователи не были в нем встревожены).
