---
title: Настройка политик защиты от вредоносных программ
f1.keywords:
- NOCSH
ms.author: chrisda
author: chrisda
manager: dansimp
ms.date: ''
audience: ITPro
ms.topic: how-to
ms.service: O365-seccomp
localization_priority: Normal
search.appverid:
- MET150
ms.assetid: b0cfc21f-e3c6-41b6-8670-feb2b2e252e5
ms.collection:
- M365-security-compliance
description: Администраторы могут узнать, как просматривать, создавать, изменять и удалять политики защиты от вредоносных программ в Exchange Online Protection (EOP).
ms.custom: seo-marvel-apr2020
ms.openlocfilehash: e9e787a608832d098d991690a977e4cce37207b8
ms.sourcegitcommit: c083602dda3cdcb5b58cb8aa070d77019075f765
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/22/2020
ms.locfileid: "48203423"
---
# <a name="configure-anti-malware-policies-in-eop"></a>Настройка политик защиты от вредоносных программ в EOP

[!INCLUDE [Microsoft 365 Defender rebranding](../includes/microsoft-defender-for-office.md)]


В организациях Microsoft 365 с почтовыми ящиками в организациях Exchange Online или отдельной среде Exchange Online Protection (EOP) без почтовых ящиков Exchange Online сообщения электронной почты автоматически защищаются от вредоносных программ с помощью EOP. EOP использует политики защиты от вредоносных программ для настройки защиты от вредоносных программ. Более подробную информацию можно узнать в статье [Защита от вредоносных программ](anti-malware-protection.md).

Администраторы могут просматривать, изменять и настраивать (но не удалять) политику защиты от вредоносных программ по умолчанию в соответствии с потребностями Организации. Для большей детализации можно также создать настраиваемые политики защиты от вредоносных программ, которые применяются к определенным пользователям, группам или доменам в Организации. Настраиваемые политики всегда имеют приоритет перед политикой по умолчанию, но вы можете изменить приоритеты (порядок применения) своих настраиваемых политик.

Политики защиты от вредоносных программ можно настроить в центре безопасности & соответствия требованиям или в PowerShell (Exchange Online PowerShell для Microsoft 365 организации с почтовыми ящиками в Exchange Online; изолированный EOP PowerShell для организаций без почтовых ящиков Exchange Online).

## <a name="what-do-you-need-to-know-before-you-begin"></a>Что нужно знать перед началом работы

- Откройте Центр безопасности и соответствия требованиям на сайте <https://protection.office.com/>. Чтобы перейти непосредственно на страницу **защиты от вредоносных программ** , используйте <https://protection.office.com/antimalware> .

- Сведения о том, как подключиться к Exchange Online PowerShell, см. в статье [Подключение к Exchange Online PowerShell](https://docs.microsoft.com/powershell/exchange/connect-to-exchange-online-powershell). Чтобы подключиться к автономному EOP PowerShell, см. раздел [Подключение к PowerShell Exchange Online Protection](https://docs.microsoft.com/powershell/exchange/connect-to-exchange-online-protection-powershell).

- Чтобы вы могли выполнить процедуры, упомянутые в этой теме, вам должны быть назначены соответствующие разрешения.

  - Для добавления, изменения и удаления политик защиты от вредоносных программ необходимо быть участником одной из следующих групп ролей:

    - **Управление организацией** или **Администратор безопасности** в [Центре безопасности и соответствия требованиям](permissions-in-the-security-and-compliance-center.md).
    - **Управление организацией** или **Управление санацией** в [Exchange Online](https://docs.microsoft.com/Exchange/permissions-exo/permissions-exo#role-groups).

  - Для доступа только для чтения к политикам защиты от вредоносных программ необходимо быть участником одной из следующих групп ролей:

    - **Средство считывания сведений о безопасности** в [Центре безопасности и соответствия требованиям](permissions-in-the-security-and-compliance-center.md).
    - **Управление организацией с правами только на просмотр** в [Exchange Online](https://docs.microsoft.com/Exchange/permissions-exo/permissions-exo#role-groups).

- Рекомендуемые параметры политик защиты от вредоносных программ приведены в статье [EOP защиты от вредоносных программ](recommended-settings-for-eop-and-office365-atp.md#eop-anti-malware-policy-settings).

## <a name="use-the-security--compliance-center-to-create-anti-malware-policies"></a>Использование центра безопасности & соответствия требованиям для создания политик защиты от вредоносных программ

Создание настраиваемой политики защиты от вредоносных программ в центре безопасности & соответствия требованиям создает правило фильтрации вредоносных программ и связанную с ним политику фильтрации вредоносных программ с одинаковыми именами.

1. В центре безопасности & соответствия требованиям перейдите к разделу политика **управления угрозами** \> **Policy** \> **защиты от вредоносных программ**и нажмите кнопку **создать** ![ значок добавления ](../../media/ITPro-EAC-AddIcon.png) .

2. На открывшейся странице **Создание политики защиты от вредоносных программ** настройте следующие параметры:

   - **Имя**. Укажите уникальное, понятное имя политики.

   - **Описание**. Укажите необязательное описание политики.

   - **Ответ на обнаружение вредоносных программ**: выберите одно из этих значений, **чтобы уведомить получателей, если их сообщения помещены в карантин?** параметр:

     - **Нет**: сообщение помещено в карантин без уведомления для указанных получателей. Это значение используется по умолчанию.

     - **Да и использовать текст уведомления по умолчанию**: сообщение помещено в карантин. Копия сообщения доставляется получателям, но *все* вложения (а не только обнаруженные) заменяются на один текстовый файл с именем " **Alert Alert Text.txt** , который содержит текст по умолчанию. Текст по умолчанию: " [политики защиты от вредоносных программ](anti-malware-protection.md#anti-malware-policies)".

     - **Да и использовать пользовательский текст уведомления**: сообщение помещено в карантин. Копия сообщения доставляется получателям, но *все* вложения (не только обнаруженные) заменяются на один текстовый файл с именем **Alert Alert Text.txt** содержит настраиваемый текст, указанный в **текстовом поле настраиваемого оповещения** .

   - **Фильтр распространенных типов вложений**: выберите одно из этих значений **, чтобы заблокировать типы вложений, которые могут повредить компьютер.**:

     - **Отключение**

     - **On**: сообщения с указанными вложениями считаются обнаружением вредоносных программ и автоматически отправляются на карантин. Вы можете изменить список, нажимая кнопки **Добавить**  и **Удалить** .

   - **Автоматическое удаление вредоносных программ с нулевым временем**: вредоносные программы ZAP помещаются сообщения, которые уже были доставлены. Дополнительные сведения см. [в статье автоматическая очистка (ZAP) в Exchange Online](zero-hour-auto-purge.md). Выберите одно из следующих значений:

     - **Отключение**

     - **Включить (рекомендуется)**

   - **Уведомление**: параметры, указанные в этом разделе, управляют уведомлениями отправителей и администраторов при обнаружении вредоносных программ в сообщении.

     - **Уведомления отправителя**: выберите один или оба из следующих параметров:

       - **Уведомлять внутренних отправителей**: Внутренний отправитель находится в Организации.

       - **Уведомлять внешних отправителей**: внешний отправитель находится за пределами Организации.

     - **Уведомления администратора**: выберите один или оба из следующих параметров:

       - **Сообщите администратору о недоставленных сообщениях от внутренних отправителей**: Если выбран этот параметр, введите адрес электронной почты для уведомлений в поле **адрес электронной почты администратора** .

       - **Сообщите администратору о недоставленных сообщениях от внешних отправителей**: Если выбран этот параметр, введите адрес электронной почты для уведомлений в поле **адрес электронной почты администратора** .

     - **Настройка уведомлений**: эти параметры заменяют текст уведомления по умолчанию, который используется отправителями или администраторами. Дополнительные сведения о значениях по умолчанию можно найти в разделе [политики защиты от вредоносных программ](anti-malware-protection.md#anti-malware-policies).

       - **Использовать настраиваемый текст уведомления**: при выборе этого параметра необходимо использовать поля **от имени** и **адреса** для указания имени отправителя и адреса электронной почты, которые используются в настраиваемом уведомлении.

       - **Сообщения от внутренних отправителей**: Если вы выбрали уведомлять отправителей или администраторов о недоставленных сообщениях от внутренних отправителей, то для указания темы и текста сообщения настраиваемого уведомления необходимо использовать поля **Тема** и **сообщение** .

       - **Сообщения от внешних отправителей**: Если вы выбрали уведомлять отправителей или администраторов о недоставленных сообщениях от внешних отправителей, то для указания темы и текста сообщения настраиваемого уведомления необходимо использовать поля **Тема** и **сообщение** .

   - **Применяется к**: параметры в этом разделе определяют внутренних получателей, к которым применяется политика.

     - **Если**: щелкните раскрывающийся список **выбрать один** и выберите условия для правила:

       - **Получатель**: указывает один или несколько почтовых ящиков, почтовых пользователей или почтовых контактов в Организации. В открывшемся диалоговом окне **Выбор членов** выберите одного или нескольких получателей из списка и нажмите кнопку ** \> добавить**. В поле **Проверить имена** можно использовать подстановочные знаки для нескольких адресов электронной почты (например \* , @fabrikam. com). После этого нажмите кнопку **ОК**.

       - **Домен получателя**: указывает получателей в одном или нескольких настроенных обслуживаемых доменах организации. В появившемся диалоговом окне выберите один или несколько доменов, а затем нажмите кнопку **Добавить \> **. После этого нажмите кнопку **ОК**.

       - **Получатель является участником**: указывает одну или несколько групп в Организации. В появившемся диалоговом окне **Выбор членов** выберите одну или несколько групп из списка и нажмите кнопку **Add (Добавить) \> **. После этого нажмите кнопку **ОК**.

     Вы можете использовать условие только один раз, но вы можете указать несколько значений для этого условия. Несколько значений одного и того же условного использования или логики (например, _\<recipient1\>_ или _\<recipient2\>_ ). Различные условия используются и логика (например, _\<recipient1\>_ и _\<member of group 1\>_ ). Чтобы добавить условие, нажмите **Добавить условие** и выберите один из оставшихся вариантов.

     - **Кроме случая**: чтобы добавить исключения для правила, щелкните **Добавить исключение**, щелкните раскрывающийся список **Выбор одного** и настройте исключения. Параметры и поведение полностью идентичны условиям.

3. По завершении нажмите кнопку **Сохранить**.

## <a name="use-the-security--compliance-center-to-view-anti-malware-policies"></a>Использование центра безопасности & соответствия требованиям для просмотра политик защиты от вредоносных программ

1. В центре безопасности & соответствия требованиям перейдите к разделу политика **управления угрозами** для \> **Policy** \> **защиты от вредоносных программ**.

2. При выборе политики сведения о ней отображаются в области сведений. Чтобы просмотреть дополнительные сведения о политике, щелкните **изменить** ![ значок редактирования ](../../media/ITPro-EAC-EditIcon.png) .

   - Значения свойств **Enabled** и **Priority**, а также параметры со вкладки **Применяется к** входят в состав правила фильтрации вредоносных программ.

   - Параметры на вкладках **Общие** и **Параметры** входят в состав политики фильтрации вредоносных программ.

## <a name="use-the-security--compliance-center-to-modify-anti-malware-policies"></a>Использование центра безопасности & соответствия требованиям для изменения политик защиты от вредоносных программ

1. В центре безопасности & соответствия требованиям перейдите к разделу политика **управления угрозами** для \> **Policy** \> **защиты от вредоносных программ**.

2. Выберите политику, а затем щелкните **изменить** ![ значок редактирования ](../../media/ITPro-EAC-EditIcon.png) . Сведения о параметрах можно найти в разделе [Использование центра безопасности & соответствия требованиям для создания политик защиты от вредоносных программ](#use-the-security--compliance-center-to-create-anti-malware-policies) в этой статье.

   **Примечания.**

   - Параметры не отображаются на одной странице, а разделены на вкладки **Общие**, **Параметры** и **Применяется к**. Вкладка " **применено к** " недоступна в политике по умолчанию с именем Default (автоматически применяется для всех).

   - Переименовать политику по умолчанию невозможно.

## <a name="use-the-security--compliance-center-to-enable-or-disable-anti-malware-policies"></a>Использование центра безопасности & соответствия требованиям для включения или отключения политик защиты от вредоносных программ

1. В центре безопасности & соответствия требованиям перейдите к разделу политика **управления угрозами** для \> **Policy** \> **защиты от вредоносных программ**.

2. Выберите политику в списке, а затем настройте один из следующих параметров:

   - **Отключить политику**: снимите флажок в столбце **включено** . По умолчанию политики защиты от вредоносных программ включаются при их создании в центре безопасности & соответствия требованиям.

   - **Включите политику**: установите флажок в столбце **включено** .

## <a name="use-the-security--compliance-center-to-set-the-priority-of-custom-anti-malware-policies"></a>Использование центра безопасности & соответствия требованиям для установки приоритета настраиваемых политик защиты от вредоносных программ

По умолчанию политикам защиты от вредоносных программ назначен приоритет, основанный на порядке, в котором они были созданы (более новые политики имеют более низкий приоритет, чем старые политики). Чем ниже значение, тем выше приоритет политики, а порядок обработки политик зависит от их приоритетов (политики с высоким приоритетом обрабатываются раньше, чем политики с низким приоритетом). Никакие две политики не могут иметь одинаковый приоритет, и обработка политики прекращается после применения первой политики.

 **Примечания.**

- В центре безопасности & соответствия требованиям можно изменить приоритет политики защиты от вредоносных программ после ее создания. В PowerShell можно переопределить приоритет по умолчанию при создании правила фильтрации вредоносных программ (что может повлиять на приоритет существующих правил).

- В центре безопасности & соответствия политикам защиты от вредоносных программ обрабатываются в том порядке, в котором они отображаются (первая политика имеет значение **приоритета** 0). По умолчанию политика защиты от вредоносных программ с именем по умолчанию имеет **самый низкий**приоритет, и ее нельзя изменить.

Чтобы изменить приоритет политики, переместите ее вверх или вниз в списке (в Центре безопасности и соответствия требованиям невозможно напрямую изменить значение свойства **Приоритет**).

1. В центре безопасности & соответствия требованиям перейдите к разделу политика **управления угрозами** для \> **Policy** \> **защиты от вредоносных программ**.

2. Выберите политику, а затем нажмите кнопку **переместить вверх** вверх или вниз стрелку вниз, ![ ](../../media/ITPro-EAC-UpArrowIcon.png) **Move down** ![ ](../../media/ITPro-EAC-DownArrowIcon.png) чтобы переместить правило вверх или вниз в списке.

## <a name="use-the-security--compliance-center-to-remove-anti-malware-policies"></a>Использование центра безопасности & соответствия требованиям для удаления политик защиты от вредоносных программ

При использовании центра безопасности & соответствия требованиям для удаления политики защиты от вредоносных программ удаляются и правило фильтрации вредоносных программ, и соответствующая политика фильтрации вредоносных программ.

1. В центре безопасности & соответствия требованиям перейдите к разделу политика **управления угрозами** для \> **Policy** \> **защиты от вредоносных программ**.

2. Выберите из списка политику защиты от вредоносных программ, которую необходимо удалить, и нажмите кнопку **Удалить** ![ значок удаления ](../../media/ITPro-EAC-DeleteIcon.png) .

## <a name="use-exchange-online-powershell-or-standalone-eop-powershell-to-configure-anti-malware-policies"></a>Настройка политик защиты от вредоносных программ с помощью Exchange Online PowerShell или изолированной EOP PowerShell

### <a name="use-powershell-to-create-anti-malware-policies"></a>Создание политик защиты от вредоносных программ с помощью PowerShell

Процесс создания политики защиты от вредоносных программ в PowerShell состоит из двух этапов:

1. Создание политики фильтрации вредоносных программ.

2. Создание правила фильтрации вредоносных программ, указывающего политику, к которой оно применяется.

 **Примечания.**

- Вы можете создать новое правило фильтрации вредоносных программ и назначить для него существующую, несвязанную с ней политику фильтрации вредоносных программ. Правило фильтрации вредоносных программ невозможно связать с несколькими политиками фильтрации вредоносных программ.

- Существует два параметра, которые можно настроить для новых политик защиты от вредоносных программ в PowerShell, которые недоступны в центре безопасности & соответствия требованиям, пока не будет создана политика:

  - Создайте новую политику как отключенную (_включена_ `$false` в командлете **New-malwarefilterrule используется** ).

  - Задайте приоритет политики при создании (_приоритет_ _\<Number\>_ ) для командлета **New-malwarefilterrule используется** .

- Новая политика фильтрации вредоносных программ, созданная в PowerShell, не отображается в центре безопасности &, пока политика не будет назначена правилу фильтрации вредоносных программ.

#### <a name="step-1-use-powershell-to-create-a-malware-filter-policy"></a>Шаг 1: использование PowerShell для создания политики фильтрации вредоносных программ

**Примечание**: в EOP значения параметров _действия_ , `DeleteMessage` а также `DeleteAttachmentAndUseDefaultAlert` `DeleteAttachmentAndUseCustomAlert` не удаляются сообщения. Вместо этого сообщения помещаются в карантин. Дополнительные сведения о получении сообщений, помещенных в карантин, можно найти [в статье Manage a карантинных сообщений и файлов в качестве администратора в EOP](manage-quarantined-messages-and-files.md).

Чтобы создать политику фильтрации вредоносных программ, используйте следующий синтаксис:

```PowerShell
New-MalwareFilterPolicy -Name "<PolicyName>" [-Action <DeleteMessage | DeleteAttachmentAndUseDefaultAlert | DeleteAttachmentAndUseCustomAlert>] [-AdminDisplayName "<OptionalComments>"] [-CustomNotifications <$true | $false>] [<Inbound notification options>] [<Outbound notification options>]
```

В этом примере создается политика фильтрации вредоносных программ с именем Contoso Malware Filter Policy и следующими параметрами:

- Сообщения на карантине, содержащие вредоносные программы, без уведомления получателей (мы не используем параметр _Action_ , а значение по умолчанию — `DeleteMessage` ).

- Не уведомлять отправителя об обнаружении вредоносных программ в сообщении (мы не используем параметры _енабликстерналсендернотификатионс_ или _енаблеинтерналсендернотификатионс_ , а значение по умолчанию для обоих `$false` ).

- Уведомлять администратора по адресу admin@contoso.com, когда в сообщении внутреннего отправителя обнаружена вредоносная программа.

```PowerShell
New-MalwareFilterPolicy -Name "Contoso Malware Filter Policy" -EnableInternalSenderAdminNotifications $true -InternalSenderAdminAddress admin@contoso.com
```

Подробные сведения о синтаксисе и параметрах см. в статье [New-MalwareFilterPolicy](https://docs.microsoft.com/powershell/module/exchange/new-malwarefilterpolicy).

#### <a name="step-2-use-powershell-to-create-a-malware-filter-rule"></a>Шаг 2: использование PowerShell для создания правила фильтрации вредоносных программ

Чтобы создать правило фильтрации вредоносных программ, используйте следующий синтаксис:

```PowerShell
New-MalwareFilterRule -Name "<RuleName>" -MalwareFilterPolicy "<PolicyName>" <Recipient filters> [<Recipient filter exceptions>] [-Comments "<OptionalComments>"]
```

В этом примере создается новое правило фильтрации вредоносных программ с именем Contoso Recipients и следующими параметрами:

- с правилом связана политика фильтрации вредоносных программ под названием Contoso Malware Filter Policy;

- правило применяется к получателям в домене contoso.com.

```PowerShell
New-MalwareFilterRule -Name "Contoso Recipients" -MalwareFilterPolicy "Contoso Malware Filter Policy" -RecipientDomainIs contoso.com
```

Подробные сведения о синтаксисе и параметрах см. в статье [New-MalwareFilterRule](https://docs.microsoft.com/powershell/module/exchange/new-malwarefilterrule).

### <a name="use-powershell-to-view-malware-filter-policies"></a>Просмотр политик фильтрации вредоносных программ с помощью PowerShell

Чтобы получить сводный список всех политик фильтрации вредоносных программ, выполните следующую команду:

```PowerShell
Get-MalwareFilterPolicy
```

Чтобы получить подробные сведения об определенной политике фильтрации вредоносных программ, используйте следующий синтаксис:

```PowerShell
Get-MalwareFilterPolicy -Identity "<PolicyName>" | Format-List [<Specific properties to view>]
```

В этом примере возвращаются значения всех свойств политики фильтрации вредоносных программ с именем Executives.

```PowerShell
Get-MalwareFilterPolicy -Identity "Executives" | Format-List
```

В этом примере возвращаются только указанные свойства той же политики.

```PowerShell
Get-MalwareFilterPolicy -Identity "Executives" | Format-List Action,AdminDisplayName,CustomNotifications,Enable*Notifications
```

Подробные сведения о синтаксисе и параметрах см. в статье [Get-MalwareFilterPolicy](https://docs.microsoft.com/powershell/module/exchange/get-malwarefilterpolicy).

### <a name="use-powershell-to-view-malware-filter-rules"></a>Просмотр правил фильтрации вредоносных программ с помощью PowerShell

Чтобы получить сводный список всех правил фильтрации вредоносных программ, выполните следующую команду:

```PowerShell
Get-MalwareFilterRule
```

Чтобы отфильтровать список по включенным или отключенным правилам, выполните следующие команды:

```PowerShell
Get-HostedContentFilterRule -State Disabled
```

```PowerShell
Get-HostedContentFilterRule -State Enabled
```

Чтобы получить подробные сведения об определенном правиле фильтрации вредоносных программ, используйте следующий синтаксис:

```PowerShell
Get-MalwareFilterRule -Identity "<RuleName>" | Format-List [<Specific properties to view>]
```

В этом примере возвращаются значения всех свойств правила фильтрации вредоносных программ с именем Executives.

```PowerShell
Get-MalwareFilterRule -Identity "Executives" | Format-List
```

В этом примере возвращаются только указанные свойства правила.

```PowerShell
Get-MalwareFilterRule -Identity "Executives" | Format-List Name,Priority,State,MalwareFilterPolicy,*Is,*SentTo,*MemberOf
```

Подробные сведения о синтаксисе и параметрах см. в статье [Get-MalwareFilterRule](https://docs.microsoft.com/powershell/module/exchange/get-malwarefilterrule).

### <a name="use-powershell-to-modify-malware-filter-policies"></a>Изменение политик фильтрации вредоносных программ с помощью PowerShell

Кроме следующих элементов, одни и те же параметры доступны при изменении политики фильтрации вредоносных программ в PowerShell, как при создании политики, как описано в [шаге 1: используйте PowerShell для создания раздела политики фильтрации вредоносных программ](#step-1-use-powershell-to-create-a-malware-filter-policy) ранее в этой статье.

- Переключатель _македефаулт_ , который включает указанную политику в политику по умолчанию (применяется ко всем, неизменяемому **нижнему** приоритету и не может удалить его), доступна только при изменении политики фильтрации вредоносных программ в PowerShell.

- Невозможно переименовать политику фильтра вредоносных программ (командлет **Set-MalwareFilterPolicy** не имеет параметра _Name_ ). При переименовании политики защиты от вредоносных программ в центре безопасности & соответствия требованиям Вы переименовываете _правило_фильтрации вредоносных программ.

Чтобы изменить политику фильтрации вредоносных программ, используйте следующий синтаксис:

```PowerShell
Set-MalwareFilterPolicy -Identity "<PolicyName>" <Settings>
```

Подробные сведения о синтаксисе и параметрах см. в статье [Set-MalwareFilterPolicy](https://docs.microsoft.com/powershell/module/exchange/set-malwarefilterpolicy).

### <a name="use-powershell-to-modify-malware-filter-rules"></a>Изменение правил фильтрации вредоносных программ с помощью PowerShell

Единственный параметр, недоступный при изменении правила фильтрации вредоносных программ в PowerShell — это параметр _Enabled_ , позволяющий создать отключенное правило. Чтобы включить или отключить существующие правила фильтрации вредоносных программ, ознакомьтесь со статьей в следующем разделе.

В противном случае дополнительные параметры не будут доступны при изменении правила фильтрации вредоносных программ в PowerShell. Те же параметры доступны при создании правила, как описано в [шаге 2: используйте PowerShell для создания раздела правила фильтрации вредоносных программ](#step-2-use-powershell-to-create-a-malware-filter-rule) ранее в этой статье.

Чтобы изменить правило фильтрации вредоносных программ, используйте следующий синтаксис:

```PowerShell
Set-MalwareFilterRule -Identity "<RuleName>" <Settings>
```

Подробные сведения о синтаксисе и параметрах см. в статье [Set-MalwareFilterRule](https://docs.microsoft.com/powershell/module/exchange/set-malwarefilterrule).

### <a name="use-powershell-to-enable-or-disable-malware-filter-rules"></a>Включение и отключение правил фильтрации вредоносных программ с помощью PowerShell

При включении или отключении правила фильтрации вредоносных программ в PowerShell включается или отключается полная политика защиты от вредоносных программ (правило фильтрации вредоносных программ и назначенная политика фильтрации вредоносных программ). Вы не можете включить или отключить политику защиты от вредоносных программ по умолчанию (она всегда применяется ко всем получателям).

Чтобы включить или отключить правило фильтрации вредоносных программ в PowerShell, используйте следующий синтаксис:

```PowerShell
<Enable-MalwareFilterRule | Disable-MalwareFilterRule> -Identity "<RuleName>"
```

В этом примере отключается правило фильтрации вредоносных программ с именем Marketing Department.

```PowerShell
Disable-MalwareFilterRule -Identity "Marketing Department"
```

В этом примере включается то же правило.

```PowerShell
Enable-MalwareFilterRule -Identity "Marketing Department"
```

Дополнительные сведения о синтаксисе и параметрах см. в статьях [Enable-MalwareFilterRule](https://docs.microsoft.com/powershell/module/exchange/enable-malwarefilterrule) и [Disable-MalwareFilterRule](https://docs.microsoft.com/powershell/module/exchange/disable-malwarefilterrule).

### <a name="use-powershell-to-set-the-priority-of-malware-filter-rules"></a>Установка приоритета правил фильтрации вредоносных программ с помощью PowerShell

Максимальный приоритет, который можно задать для правила, — 0. Минимальное значение зависит от количества правил. Например, если у вас есть пять правил, вы можете использовать значения 0–4. Изменение приоритета существующего правила оказывает каскадное влияние на другие правила. Например, если вы измените приоритет правила на 2, когда у вас есть пять настраиваемых правил (с приоритетами от 0 до 4), то для существующего правила с приоритетом 2 будет задан приоритет 3, а для правила с приоритетом 3 будет задан приоритет 4.

Чтобы задать приоритет правила фильтрации вредоносных программ в PowerShell, используйте следующий синтаксис:

```PowerShell
Set-MalwareFilterRule -Identity "<RuleName>" -Priority <Number>
```

В этом примере для правила Marketing Department задается приоритет 2. Все правила с приоритетом не больше 2 понижаются на один ранг (значения приоритета увеличиваются на 1).

```PowerShell
Set-MalwareFilterRule -Identity "Marketing Department" -Priority 2
```

**Примечания**:

- Чтобы задать приоритет нового правила при его создании, используйте параметр _Priority_ в командлете **New – malwarefilterrule используется** .

- Политика фильтрации вредоносных программ по умолчанию не имеет соответствующего правила фильтрации вредоносных программ и имеет **самое низкое**значение приоритета.

### <a name="use-powershell-to-remove-malware-filter-policies"></a>Удаление политик фильтрации вредоносных программ с помощью PowerShell

При использовании PowerShell для удаления политики фильтрации вредоносных программ соответствующие правила фильтрации вредоносных программ не удаляются.

Чтобы удалить политику фильтрации вредоносных программ в PowerShell, используйте следующий синтаксис:

```PowerShell
Remove-MalwareFilterPolicy -Identity "<PolicyName>"
```

В этом примере удаляется политика фильтрации вредоносных программ с именем Marketing Department.

```PowerShell
Remove-MalwareFilterPolicy -Identity "Marketing Department"
```

Подробные сведения о синтаксисе и параметрах см. в статье [Remove-MalwareFilterPolicy](https://docs.microsoft.com/powershell/module/exchange/remove-malwarefilterpolicy).

### <a name="use-powershell-to-remove-malware-filter-rules"></a>Удаление правил фильтрации вредоносных программ с помощью PowerShell

Если вы используете PowerShell для удаления правила фильтрации вредоносных программ, соответствующая политика фильтрации вредоносных программ не удаляется.

Чтобы удалить правило фильтрации вредоносных программ в PowerShell, используйте следующий синтаксис:

```PowerShell
Remove-MalwareFilterRule -Identity "<PolicyName>"
```

В этом примере удаляется правило фильтрации вредоносных программ с именем Marketing Department.

```PowerShell
Remove-MalwareFilterRule -Identity "Marketing Department"
```

Подробные сведения о синтаксисе и параметрах см. в статье [Remove-MalwareFilterRule](https://docs.microsoft.com/powershell/module/exchange/remove-malwarefilterrule).

## <a name="how-do-you-know-these-procedures-worked"></a>Как проверить, что эти процедуры выполнены?

### <a name="use-the-eicartxt-file-to-verify-your-anti-malware-policy-settings"></a>Проверка параметров политики защиты от вредоносных программ с помощью файла EICAR.TXT

> [!IMPORTANT]
> Файл EICAR.TXT не является вирусом. В Европейской институте антивирусного исследования (файл eicar) этот файл был разработан для безопасного тестирования установок и параметров защиты от вирусов.

1. Откройте Блокнот и вставьте в пустой файл следующий текст:

   ```Text
   X5O!P%@AP[4\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*
   ```

   Убедитесь, что в файле есть только текстовые символы. Размер файла должен быть 68 байт.

2. Сохраните файл как EICAR.TXT

   В антивирусной программе не забудьте исключить EICAR.TXT из проверки (в противном случае файл будет помещен на карантин).

3. Отправьте сообщение электронной почты, содержащее файл EICAR.TXT в виде вложения, с помощью почтового клиента, который не будет автоматически блокировать файл. Используйте параметры политики защиты от вредоносных программ, чтобы определить следующие сценарии для тестирования:

   - Сообщение электронной почты от внутреннего почтового ящика внутреннему получателю.

   - Электронная почта от внутреннего почтового ящика к внешнему получателю.

   - Сообщение электронной почты от внешнего почтового ящика внутреннему получателю.

4. Убедитесь, что сообщение помещено в карантин, и проверьте результаты уведомлений о получателях и отправителях на основе параметров политики защиты от вредоносных программ. Например:

   - Получатели не получают уведомления, или получатели получают исходное сообщение с EICAR.TXT вложения, замененного **Text.txtоповещения о вредоносных программах ** , которое содержит текст по умолчанию или пользовательский текст.

   - Внутренние или внешние отправители получают уведомления о сообщениях по умолчанию или о настраиваемых уведомлениях.

   - Указанный адрес электронной почты администратора уведомляется о внутренних или внешних отправителях сообщений с настраиваемыми или настраиваемыми сообщениями уведомления.

5. Удалите файл EICAR.TXT после завершения тестирования (так, чтобы другие пользователи не будильником).
