---
title: Настройка SPF для предотвращения спуфинга
f1.keywords:
- CSH
ms.author: tracyp
author: MSFTTracyP
manager: dansimp
ms.date: 11/21/2019
audience: ITPro
ms.topic: article
ms.service: O365-seccomp
localization_priority: Priority
search.appverid:
- MET150
ms.assetid: 71373291-83d2-466f-86ea-fc61493743a6
ms.collection:
- M365-security-compliance
ms.custom:
- seo-marvel-apr2020
description: Узнайте, как обновить запись службы доменных имен (DNS), чтобы использовать инфраструктуру политики отправителей (SPF) с личным доменом в Office 365.
ms.openlocfilehash: dfbd5f7091420d079f91b93f7c581ed69572b7bd
ms.sourcegitcommit: fa8e488936a36e4b56e1252cb4061b5bd6c0eafc
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/13/2020
ms.locfileid: "46656615"
---
# <a name="set-up-spf-to-help-prevent-spoofing"></a>Настройка SPF для предотвращения спуфинга

 **Сводка.** В этой статье описано, как обновить запись DNS, чтобы использовать инфраструктуру политики отправителей (SPF) с личным доменом в Office 365. С помощью инфраструктуры политики отправителей можно проверять почту, отправляемую из личного домена.

Чтобы использовать личный домен в Office 365, в запись DNS необходимо добавить запись SPF TXT для предотвращения спуфинга. Инфраструктура политики отправителей определяет, каким почтовым серверам разрешается отправлять сообщения от вашего имени. Инфраструктура политики отправителей, а также DKIM, DMARC и другие технологии, поддерживаемые Office 365, помогают предотвратить спуфинг и фишинг. Инфраструктура политики отправителей добавляется в виде записи TXT, которую служба DNS использует, чтобы определить, какие почтовые серверы могут отправлять сообщения от имени вашего личного домена. Почтовые системы получателей могут просматривать записи SPF TXT, чтобы определить, было ли сообщение из вашего личного домена отправлено с уполномоченного сервера обмена сообщениями.

Допустим, ваш личный домен contoso.com использует Office 365. Мы добавим запись SPF TXT, в которой перечислены серверы обмена сообщениями Office 365, разрешенные для домена. Когда сервер получателя получает сообщение от joe@contoso.com, сервер находит запись SPF TXT для домена contoso.com и определяет, является ли сообщение допустимым. Если сервер получателя определит, что сообщение отправлено с сервера, не указанного в списке серверов обмена сообщениями Office 365 в записи SPF, то сервер получателя может отклонить сообщение как спам.

Кроме того, если на вашем личном домене отсутствует запись SPF TXT, некоторые серверы получателей могут сразу отклонить сообщение. Это вызвано тем, что сервер получателя не может проверить, отправлено ли сообщение с уполномоченного сервера обмена сообщениями.

Если для Office 365 уже настроена почта, то серверы обмена сообщениями Майкрософт уже включены в службу DNS в виде записи SPF TXT. Но в некоторых случаях может потребоваться обновить запись SPF TXT в службе DNS. Например:

- Раньше, если вы использовали SharePoint Online, в личный домен нужно было добавить другую запись SPF TXT. Этого больше не требуется. Это изменение необходимо для того, чтобы уведомления SharePoint Online не попадали в папку нежелательной почты. Обновите запись SPF TXT, если достигнут предел в 10 запросов и возникают ошибки с сообщениями вроде "превышен предел запросов" и "слишком много прыжков".

- Используется гибридная среда с Office 365 и локальной службой Exchange.

- Вы планируете настроить DKIM и DMARC (рекомендуется).

## <a name="updating-your-spf-txt-record-for-office-365"></a>Обновление записи SPF TXT для Office 365

Прежде чем обновлять запись TXT в службе DNS, необходимо собрать некоторые сведения и определить формат записи. Это поможет избежать ошибок DNS. Расширенные примеры и подробное обсуждение поддерживаемых команд для инфраструктуры политики отправителей см. в разделе [Как инфраструктура политики отправителей помогает предотвратить спуфинг и фишинг в Office 365](how-office-365-uses-spf-to-prevent-spoofing.md#HowSPFWorks).

Подготовьте указанные ниже данные.

- Текущая запись SPF TXT для личного домена. Сведения о том, как это сделать, см. в статье [Сбор необходимых сведений для создания записей DNS в Office 365](https://docs.microsoft.com/microsoft-365/admin/get-help-with-domains/information-for-dns-records).

- Внешние IP-адреса всех локальных серверов обмена сообщениями. Пример: **131.107.2.200**.

- Доменные имена, используемые для всех сторонних доменов, которые требуется включить в запись SPF TXT. Некоторые поставщики массовых рассылок настраивают поддомены для своих клиентов. Например, компания MailChimp создала поддомен **servers.mcsv.net**.

- Определите, какое правило принудительного применения следует использовать для записи SPF TXT. Рекомендуется использовать правило **-all**. Подробные сведения о других вариантах команд см. в разделе [Синтаксис записи SPF TXT для Office 365](how-office-365-uses-spf-to-prevent-spoofing.md#SPFSyntaxO365).

### <a name="to-add-or-update-your-spf-txt-record"></a>Добавление и обновление записи типа TXT инфраструктуры политики отправителей

1. Убедитесь, что вы знакомы с синтаксисом SPF из следующей таблицы.

   ****

   |<!-- -->|Используемая система|Распространенная у клиентов?|Добавляемый параметр|
   |---|---|---|---|
   |1|Любая почтовая система (обязательно)|Распространенная. Все записи SPF TXT начинаются с этого значения|v=spf1|
   |2|Exchange Online|Распространенная|include:spf.protection.outlook.com|
   |3|Только для Exchange Online|Нераспространенная|ip4:23.103.224.0/19 ip4:206.191.224.0/19 ip4:40.103.0.0/16 include:spf.protection.outlook.com|
   |4|Office 365 Germany, только Microsoft Cloud Germany|Нераспространенная|include:spf.protection.outlook.de|
   |5|Сторонняя почтовая система|Нераспространенная|include:\<domain name\>  <br/> где <доменное имя> — это доменное имя сторонней почтовой системы.|
   |6|Локальная почтовая система, например Exchange Online Protection с другой почтовой системой|Нераспространенная| Используйте один из следующих параметров для каждой дополнительной почтовой системы: <br> ip4:\<_IP address_\>  <br/>  ip6:\<_IP address_\>  <br/>  include:\<_domain name_\>  <br/>  где значение \<_IP address_\> — это IP-адрес другой почтовой системы, а \<_domain name_\> — доменное имя другой почтовой системы, которая отправляет сообщения от имени вашего домена.|
   |7|Любая почтовая система (обязательно)|Распространенная. Все записи SPF TXT заканчиваются этим значением|\<_enforcement rule_\>  <br/> Это может быть одно из нескольких значений. Рекомендуем использовать значение **-all**.|
   |

2. Создайте запись SPF TXT (если вы еще не сделали этого), используя синтаксис из таблицы:

   Например, если ваша организация целиком размещена в Office 365 (то есть у вас нет локальных почтовых серверов), то в запись SPF TXT будут включены строки 1, 2 и 7, и она будет выглядеть следующим образом:

   `v=spf1 include:spf.protection.outlook.com -all`

   Это одна из самых распространенных записей SPF TXT. Эта запись подходит практически для всех, независимо от того, где находится ваш центр обработки данных Майкрософт — в США, Европе (в том числе в Германии) или другом месте.

   Но если вы приобрели Office 365 Germany в составе Microsoft Cloud Germany, следует использовать оператор include из строки 4, а не из строки 2. Например, если ваша организация целиком размещена в Office 365 Germany (то есть у вас нет локальных почтовых серверов), то в запись SPF TXT будут включены строки 1, 4 и 7, и она будет выглядеть следующим образом:

   `v=spf1 include:spf.protection.outlook.de -all`

   При переходе с Office 365 на Office 365 Germany необходимо обновить запись SPF TXT для личного домена. Для этого измените **include:spf.protection.outlook.com** на **include.spf.protection.outlook.de**.

3. Создав запись SPF TXT, вам необходимо будет обновить ее в службе DNS. Для домена можно создать только одну запись SPF TXT. Поэтому если такая запись существует, то вместо того чтобы добавлять новую запись, следует обновить существующую. Откройте статью [Создание записей DNS для Office 365 при самостоятельном управлении записями DNS](https://docs.microsoft.com/microsoft-365/admin/get-help-with-domains/create-dns-records-at-any-dns-hosting-provider), а затем перейдите по ссылке, соответствующей вашему поставщику DNS.

4. Проверьте свою запись SPF TXT.

## <a name="how-to-handle-subdomains"></a>Как работать с поддоменами?

Важно отметить, что вам требуется создать отдельную запись для каждого поддомена, так как поддомены не наследуют запись SPF от своего домена верхнего уровня.

Для каждого домена и поддомена требуется дополнительная запись SPF с подстановочным знаком (`*.`), чтобы помешать злоумышленникам отправлять письма от несуществующих поддоменов. Например:

```console
*.subdomain.contoso.com. IN TXT "v=spf1 –all"
```

## <a name="more-information-about-spf"></a>Дополнительные сведения об инфраструктуре политики отправителей

Расширенные примеры, подробное обсуждение поддерживаемого синтаксиса для инфраструктуры политики отправителей и сведения о спуфинге, устранении неполадок и о том, как Office 365 поддерживает инфраструктуру политики отправителей, см. в разделе [Как инфраструктура политики отправителей помогает предотвратить спуфинг и фишинг в Office 365](how-office-365-uses-spf-to-prevent-spoofing.md#HowSPFWorks).

## <a name="next-steps-after-you-set-up-spf-for-office-365"></a>Дальнейшие действия: после настройки инфраструктуры политики отправителей для Office 365

Возникли проблемы с записью типа TXT инфраструктуры политики отправителей? Прочитайте статью [Устранение неполадок: рекомендации по инфраструктуре политики отправителей в Office 365](how-office-365-uses-spf-to-prevent-spoofing.md#SPFTroubleshoot).

 Несмотря на то что инфраструктура политики отправителей разработана для предотвращения спуфинга, существует ряд методик, позволяющих обойти ее. Чтобы защититься от таких атак, по завершении настройки инфраструктуры политики отправителей необходимо настроить DKIM и DMARC для Office 365. Соответствующие инструкции по началу работы см. в статье [Проверка исходящей электронной почты, отправляемой с личного домена в Office 365, с помощью DKIM](use-dkim-to-validate-outbound-email.md). Дальнейшие действия см. в статье [Использование протокола DMARC для проверки электронной почты в Office 365](use-dmarc-to-validate-email.md).
