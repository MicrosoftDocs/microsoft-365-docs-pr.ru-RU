---
title: Настройка SPF для предотвращения спуфинга
f1.keywords:
- CSH
ms.author: tracyp
author: MSFTTracyP
manager: dansimp
ms.date: 11/21/2019
audience: ITPro
ms.topic: how-to
localization_priority: Priority
search.appverid:
- MET150
ms.assetid: 71373291-83d2-466f-86ea-fc61493743a6
ms.collection:
- M365-security-compliance
ms.custom:
- seo-marvel-apr2020
description: Узнайте, как обновить запись службы доменных имен (DNS), чтобы использовать инфраструктуру политики отправителей (SPF) с личным доменом в Office 365.
ms.technology: mdo
ms.prod: m365-security
ms.openlocfilehash: 1aff62792be86b9c77430777c23edc655fe3bb9b
ms.sourcegitcommit: dcb97fbfdae52960ae62b6faa707a05358193ed5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/25/2021
ms.locfileid: "51205258"
---
# <a name="set-up-spf-to-help-prevent-spoofing"></a>Настройка SPF для предотвращения спуфинга

[!INCLUDE [Microsoft 365 Defender rebranding](../includes/microsoft-defender-for-office.md)]

**Область применения**
- [Exchange Online Protection](exchange-online-protection-overview.md)
- [Microsoft Defender для Office 365 (план 1 и план 2)](defender-for-office-365.md)
- [Microsoft 365 Defender](../defender/microsoft-365-defender.md)

В этой статье описано, как обновить запись DNS, чтобы использовать проверку подлинности электронной почты в инфраструктуре политики отправителей (SPF) с личным доменом в Office 365.

С помощью инфраструктуры политики отправителей можно проверять исходящую почту, отправляемую из личного домена. Это первый шаг при настройке других рекомендуемых методов проверки подлинности электронной почты DMARC и DKIM (два дополнительных метода проверки подлинности электронной почты, поддерживаемых в Office 365).

## <a name="prerequisites"></a>Предварительные условия

> [!IMPORTANT]
> Если вы управляете **малым предприятием** или не знакомы с IP-адресами и настройкой DNS, обратитесь к своему регистратору доменных имен (например, GoDaddy, Bluehost, web.com) за помощью с настройкой DNS в SPF (и любых других методов проверки подлинности электронной почты). *Кроме того*, если вы еще не приобрели или не используете собственный URL-адрес (т. е. URL-адрес, на который вы и ваши клиенты переходите для доступа к Office 365, заканчивается на **onmicrosoft.com**), в службе Office 365 для вас настроена инфраструктура политики отправителей (SPF). В этом случае не требуется выполнять никаких дополнительных действий. Спасибо за внимание.

Прежде чем создать или обновить запись SPF TXT для Office 365 во внешней службе DNS, требуется собрать некоторые сведения, необходимые для создания записи. Расширенные примеры и подробное обсуждение поддерживаемых команд для инфраструктуры политики отправителей см. в разделе [Как инфраструктура политики отправителей помогает предотвратить спуфинг и фишинг в Office 365](how-office-365-uses-spf-to-prevent-spoofing.md#HowSPFWorks).

Подготовьте указанные ниже данные.

- Текущая запись SPF TXT для личного домена, если он существует. Инструкции см. в статье [Сбор необходимых сведений для создания DNS-записей Office 365](../../admin/get-help-with-domains/information-for-dns-records.md).

- Перейдите на свой сервер обмена сообщениями и найдите внешние IP-адреса (требуются со всех локальных серверов обмена сообщениями). Например, **131.107.2.200**.

- Доменные имена, используемые для всех сторонних доменов, которые требуется включить в запись SPF TXT. Некоторые поставщики массовых рассылок настраивают поддомены для своих клиентов. Например, компания MailChimp создала поддомен **servers.mcsv.net**.

- Определите, какое правило принудительного применения следует использовать для записи SPF TXT. Рекомендуется использовать правило **-all**. Подробные сведения о других вариантах команд см. в разделе [Синтаксис записи SPF TXT для Office 365](how-office-365-uses-spf-to-prevent-spoofing.md#SPFSyntaxO365).

> [!IMPORTANT]
> Чтобы использовать личный домен в Office 365, в запись DNS необходимо добавить запись SPF TXT для предотвращения спуфинга.

## <a name="create-or-update-your-spf-txt-record"></a>Создание или обновление записи SPF TXT

1. Убедитесь, что вы знакомы с синтаксисом SPF из следующей таблицы.

   ****

   |Элемент|Используемая система|Распространенная у клиентов?|Добавляемый параметр|
   |---|---|---|---|
   |1|Любая почтовая система (обязательно)|Распространенная. Все записи SPF TXT начинаются с этого значения|`v=spf1`|
   |2|Exchange Online|Распространенная|`include:spf.protection.outlook.com`|
   |3|Только для Exchange Online|Нераспространенная|`ip4:23.103.224.0/19` <br> `ip4:206.191.224.0/19` <br> `ip4:40.103.0.0/16` <br> `include:spf.protection.outlook.com`|
   |4|Office 365 Germany, только Microsoft Cloud Germany|Нераспространенная|`include:spf.protection.outlook.de`|
   |5|Сторонняя почтовая система|Нераспространенная|`include:<domain_name>` <p> \<domain_name\> — это домен сторонней почтовой системы.|
   |6|Локальная почтовая система, например Exchange Online Protection с другой почтовой системой|Нераспространенная|Используйте один из следующих параметров для каждой дополнительной почтовой системы: <p> `ip4:<IP_address>` <br> `ip6:<IP_address>` <br> `include:<domain_name>` <p> \<IP_address\> и \<domain_name\> — это IP-адрес и домен другой почтовой системы, отправляющей почту от имени вашего домена.|
   |7|Любая почтовая система (обязательно)|Распространенная. Все записи SPF TXT заканчиваются этим значением|`<enforcement rule>` <p> Это может быть одно из нескольких значений. Рекомендуется значение `-all`.|
   |

2. Создайте запись SPF TXT (если вы еще не сделали этого), используя синтаксис из таблицы.

   Например, если ваша организация целиком размещена в Office 365 (то есть у вас нет локальных почтовых серверов), то в запись SPF TXT будут включены строки 1, 2 и 7, и она будет выглядеть следующим образом:

   ```text
   v=spf1 include:spf.protection.outlook.com -all
   ```

   Это одна из самых распространенных записей SPF TXT. Эта запись подходит практически для всех, независимо от того, где находится ваш центр обработки данных Майкрософт — в США, Европе (в том числе в Германии) или другом месте.

   Но если вы приобрели Office 365 Germany в составе Microsoft Cloud Germany, следует использовать оператор include из строки 4, а не из строки 2. Например, если ваша организация целиком размещена в Office 365 Germany (то есть у вас нет локальных почтовых серверов), то в запись SPF TXT будут включены строки 1, 4 и 7, и она будет выглядеть следующим образом:

   ```text
   v=spf1 include:spf.protection.outlook.de -all
   ```

   При переходе с Office 365 на Office 365 Germany необходимо обновить запись SPF TXT для личного домена. Чтобы сделать это, измените `include:spf.protection.outlook.com` на `include:spf.protection.outlook.de`.

3. Создав запись SPF TXT, вам необходимо будет обновить ее в службе DNS. Для домена можно создать только одну запись SPF TXT. Поэтому если такая запись существует, то вместо того чтобы добавлять новую запись, следует обновить существующую. Откройте статью [Создание записей DNS для Office 365 при самостоятельном управлении записями DNS](../../admin/get-help-with-domains/create-dns-records-at-any-dns-hosting-provider.md), а затем перейдите по ссылке, соответствующей вашему поставщику DNS.

4. Проверьте свою запись SPF TXT.

## <a name="how-to-handle-subdomains"></a>Как работать с поддоменами?

Важно отметить, что *вам требуется создать отдельную запись для каждого поддомена, так как поддомены не наследуют запись SPF от своего домена верхнего уровня*.

Для каждого домена и поддомена требуется дополнительная запись SPF с подстановочным знаком (`*.`), чтобы помешать злоумышленникам отправлять письма от несуществующих поддоменов. Например:

```text
*.subdomain.contoso.com. IN TXT "v=spf1 -all"
```

## <a name="troubleshooting-spf"></a>Устранение неполадок инфраструктуры политики отправителей

Возникли проблемы с записью типа TXT инфраструктуры политики отправителей? Прочитайте статью [Устранение неполадок: советы и рекомендации по инфраструктуре политики отправителей в Office 365](how-office-365-uses-spf-to-prevent-spoofing.md#SPFTroubleshoot).


## <a name="what-does-spf-email-authentication-actually-do"></a>Какие действия выполняет проверка подлинности электронной почты инфраструктуры политики отправителей?

Инфраструктура политики отправителей определяет, каким почтовым серверам разрешается отправлять сообщения от вашего имени. Инфраструктура политики отправителей, а также DKIM, DMARC и другие технологии, поддерживаемые Office 365, помогают предотвратить спуфинг и фишинг. Инфраструктура политики отправителей добавляется в виде записи TXT, которую служба DNS использует, чтобы определить, какие почтовые серверы могут отправлять сообщения от имени вашего личного домена. Почтовые системы получателей могут просматривать записи SPF TXT, чтобы определить, было ли сообщение из вашего личного домена отправлено с уполномоченного сервера обмена сообщениями.

Допустим, ваш личный домен contoso.com использует Office 365. Мы добавим запись SPF TXT, в которой перечислены серверы обмена сообщениями Office 365, разрешенные для домена. Когда сервер получателя получает сообщение от joe@contoso.com, сервер находит запись SPF TXT для домена contoso.com и определяет, является ли сообщение допустимым. Если сервер получателя определит, что сообщение отправлено с сервера, не указанного в списке серверов обмена сообщениями Office 365 в записи SPF, то сервер получателя может отклонить сообщение как спам.

Кроме того, если на вашем личном домене отсутствует запись SPF TXT, некоторые серверы получателей могут сразу отклонить сообщение. Это вызвано тем, что сервер получателя не может проверить, отправлено ли сообщение с уполномоченного сервера обмена сообщениями.

Если для Office 365 уже настроена почта, то серверы обмена сообщениями Майкрософт уже включены в службу DNS в виде записи SPF TXT. Но в некоторых случаях может потребоваться обновить запись SPF TXT в службе DNS. Например:

- Раньше, если вы использовали SharePoint Online, в личный домен нужно было добавить другую запись SPF TXT. Этого больше не требуется. Это изменение необходимо для того, чтобы уведомления SharePoint Online не попадали в папку нежелательной почты. Обновите запись SPF TXT, если достигнут предел в 10 запросов и возникают ошибки с сообщениями вроде "превышен предел запросов" и "слишком много прыжков".

- Используется гибридная среда с Office 365 и локальной службой Exchange.

- Вы планируете настроить DKIM и DMARC (рекомендуется).

## <a name="more-information-about-spf"></a>Дополнительные сведения об инфраструктуре политики отправителей

Расширенные примеры, подробное обсуждение поддерживаемого синтаксиса для инфраструктуры политики отправителей и сведения о спуфинге, устранении неполадок и о том, как Office 365 поддерживает инфраструктуру политики отправителей, см. в разделе [Как инфраструктура политики отправителей помогает предотвратить спуфинг и фишинг в Office 365](how-office-365-uses-spf-to-prevent-spoofing.md#HowSPFWorks).

## <a name="links-to-configure-dkim-and-dmarc"></a>Ссылки для настройки DKIM и DMARC

 Инфраструктура политики отправителей (SPF) призвана предотвратить спуфинг, но существуют некоторые методики, позволяющие обойти ее. Чтобы защититься от таких атак, по завершении настройки SPF необходимо настроить DKIM и DMARC для Office 365.

Цель проверки подлинности электронной почты [DKIM](https://docs.microsoft.com/microsoft-365/security/office-365-security/use-dkim-to-validate-outbound-email?view=o365-worldwide) — проверить, что содержимое письма не подделано.

Цель проверки подлинности электронной почты [DMARC](https://docs.microsoft.com/microsoft-365/security/office-365-security/use-dmarc-to-validate-email?view=o365-worldwide) — убедиться, что сведения SPF и DKIM соответствуют адресу, указанному в поле "От".
