---
title: Заголовки сообщений по защите от нежелательной почты
f1.keywords:
- NOCSH
ms.author: chrisda
author: chrisda
manager: dansimp
audience: ITPro
ms.topic: article
ms.service: O365-seccomp
localization_priority: Priority
search.appverid:
- MET150
ms.assetid: 2e3fcfc5-5604-4b88-ac0a-c5c45c03f1db
ms.collection:
- M365-security-compliance
description: Сведения для администраторов о полях заголовков, которые добавляются в сообщения в Exchange Online Protection (EOP). В этих полях заголовков содержатся сведения о сообщении и его обработке.
ms.custom: seo-marvel-apr2020
ms.openlocfilehash: 5073e0721e82e969dbeaa850cc38cb13100a7947
ms.sourcegitcommit: 6a1a8aa024fd685d04da97bfcbc8eadacc488534
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/12/2020
ms.locfileid: "46653429"
---
# <a name="anti-spam-message-headers-in-microsoft-365"></a>Заголовки сообщений о защите от нежелательной почты в Microsoft 365

В организациях Microsoft 365 с почтовыми ящиками в Exchange Online и в автономных организациях Exchange Online Protection (EOP) без почтовых ящиков Exchange Online служба EOP проверяет входящие электронные сообщения и вставляет заголовок **X-Forefront-Antispam-Report** в каждое из них. Поля в этом заголовке могут предоставить администраторам информацию о сообщении и его обработке. Поля заголовка **X-Microsoft-Antispam** содержат дополнительные сведения о массовой рассылке и фишинге. Помимо этих двух заголовков, служба Exchange Online Protection также вставляет в каждое сообщение, которое она обрабатывает, заголовок **Authentication-results** с результатами проверки подлинности сообщения.

Сведения о том, как просматривать заголовки электронных сообщений в различных почтовых клиентах, см. в статье [Просмотр заголовков сообщений Интернета в Outlook](https://support.microsoft.com/office/cd039382-dc6e-4264-ac74-c048563d212c).

> [!TIP]
> Вы можете скопировать и вставить содержимое заголовка сообщения в инструмент [Анализатор заголовков сообщений](https://mha.azurewebsites.net/). Это средство помогает анализировать заголовки и преобразовывать их в более удобный для чтения формат.

## <a name="x-forefront-antispam-report-message-header-fields"></a>Поля заголовка сообщения X-Forefront-Antispam-Report

После получения сведений о заголовке сообщения найдите заголовок **X-Forefront-Antispam-Report**. Для заголовка предоставляется несколько полей и пар значений, разделенных точкой с запятой (;). Например:

`...CTRY:;LANG:hr;SCL:1;SRV:;IPV:NLI;SFV:NSPM;PTR:;CAT:NONE;SFTY:;...`

Отдельные поля и значения описаны в таблице ниже.

> [!NOTE]
> Заголовок **X-Forefront-Antispam-Report** содержит множество различных полей и значений заголовка. Другие поля в этом заголовке, не упомянутые в таблице, нужны для диагностики и используются исключительно группой специалистов Майкрософт, ответственной за защиту от нежелательной почты.

****

|Поле заголовка|Описание|
|---|---|
|ARC|В протоколе ARC имеются следующие заголовки: <ul><li>AAR. Записывает содержимое заголовка результатов проверки подлинности из DMARC.</li><li>AMS. Этот заголовок включает криптографические подписи сообщения.</li><li>AS. Включает криптографические подписи заголовков сообщений. Этот заголовок содержит тег проверки цепочки "cv=", включающий результат проверки цепочки в виде **none**, **pass** или **fail**.</li></ul>|
|CAT:|Категория политики защиты, применяемая для сообщения: <ul><li>BULK. Массовая рассылка</li><li>DIMP. Подмена домена</li><li>GIMP. Подмена на основе аналитики почтовых ящиков</li><li>HPHSH или HPHISH. Фишинг с высокой степенью уверенности</li><li>HSPM. Нежелательное сообщение с высокой степенью уверенности</li><li>MALW. Вредоносная программа</li><li>PHSH. Фишинг</li><li>SPM. Нежелательное сообщение</li><li>SPOOF. Спуфинг</li><li>UIMP. Подмена пользователя</li><li>AMP. Защита от вредоносных программ</li><li>SAP. Безопасные вложения</li><li>OSPM. Исходящая нежелательная почта</li></ul><br/>Входящее сообщение может помечаться несколькими формами защиты и несколькими сканерами обнаружения. Политики имеют разные приоритеты. Политика с наивысшим приоритетом применяется в первую очередь. См. статью [Какая политика применяется, когда для электронной почты запускается несколько методов защиты и сканеров обнаружения](how-policies-and-protections-are-combined.md).|
|CIP: \[IP-адрес\]|IP-адрес для подключения. Этот IP-адрес можно использовать в списке разрешенных или заблокированных IP-адресов. Дополнительные сведения см. в статье [Настройка фильтрации подключений](configure-the-connection-filter-policy.md).|
|CTRY|Исходная страна определяется по подключенному IP-адресу, который может отличаться от IP-адреса источника отправки.|
|H:\[helostring\]|Строка HELO или EHLO подключающегося почтового сервера.|
|IPV:CAL|Сообщение пропустило фильтрацию спама, так как исходный IP-адрес был указан в списке разрешенных IP-адресов. Дополнительные сведения см. в статье [Настройка фильтрации подключений](configure-the-connection-filter-policy.md).|
|IPV:NLI|IP-адрес отсутствовал в списке репутации IP-адресов.|
|LANG|Язык, на котором написано сообщение, как это указано в коде страны (например, ru_RU для русского).|
|PTR:\[ReverseDNS\]|Запись PTR (называемая также обратным поиском DNS) исходного IP-адреса.|
|SCL|Вероятность нежелательной почты (SCL) сообщения. Чем больше значение, тем вероятнее, что сообщение окажется спамом. Дополнительные сведения см. в статье [Вероятность нежелательной почты (SCL)](spam-confidence-levels.md).|
|SFTY|Сообщение определено как фишинговое и помечается с помощью одного из следующих значений: <ul><li>9.1. Значение по умолчанию. Сообщение содержит фишинговый URL-адрес, может содержать другой фишинговый контент или могло быть помечено как фишинг другим фильтром почты (например, локальной версией Exchange) перед ретрансляцией в Microsoft 365.</li><li>9.11. [Спуфинг в пределах организации или внутренний спуфинг](anti-spoofing-protection.md#different-types-of-spoofing). Сообщение не прошло проверку защиты от спуфинга, когда почтовый домен отправителя в заголовке "От:" совпадает или соответствует принимающему домену или является частью его организации. Совет по безопасности в отношении спуфинга внутри организации добавляется в сообщение.</li><li>9.19. Олицетворение доменов. Отправляющий домен пытается олицетворить защищенный домен (домен, принадлежащий организации получателя, или личный домен), указанный в политике защиты от фишинга ATP. Совет по безопасности в отношении олицетворения домена добавляется в сообщение (если советы безопасности включены в политике защиты от фишинга ATP).</li><li>9.20. Олицетворение пользователей. Отправляющий пользователь пытается олицетворить пользователя в организации получателя или защищенного пользователя, указанного в политике защиты от фишинга ATP. Совет по безопасности в отношении олицетворения пользователя добавляется в сообщение (если советы безопасности включены в политике защиты от фишинга ATP).</li><li>9.21. [Междоменный спуфинг](anti-spoofing-protection.md#different-types-of-spoofing). Сообщение не прошло проверку защиты от спуфинга, если почтовый домен отправителя в заголовке "От:" не прошел проверку подлинности и является внешним доменом. Используется в сочетании с [CompAuth](#authentication-results-message-header-fields-used-by-microsoft-email-authentication).</li><li>9.22. Аналогично 9.21, но у пользователя есть надежный отправитель, который был переопределен.</li><li>9.23. Аналогично 9.22, но у организации есть разрешенный отправитель или домен, который был переопределен.</li><li>9.24. Аналогично 9.23, но у пользователя есть правило потока обработки почты Exchange (правило транспорта), которое было переопределено.</li></ul>|
|SFV:BLK|Фильтрация пропущена, а сообщение заблокировано, так как было отправлено с адреса, который входит в список заблокированных отправителей Outlook (список заблокированных отправителей пользователя).<br/></br> Дополнительные сведения о том, как администраторы могут управлять списком заблокированных отправителей пользователя, см. в статье [Настройка параметров нежелательной почты в почтовых ящиках Exchange Online](configure-junk-email-settings-on-exo-mailboxes.md).|
|SFV:NSPM|Сообщение помечено фильтрацией спама как не являющееся нежелательным и отправлено указанным получателям.|
|SFV:SFE|Фильтрация пропущена, а сообщение отправлено, так как его отправили с адреса, который входит в список надежных отправителей Outlook (список надежных отправителей пользователя).<br/></br> Дополнительные сведения о том, как администраторы могут управлять списком надежных отправителей пользователя, см. в статье [Настройка параметров нежелательной почты в почтовых ящиках Exchange Online](configure-junk-email-settings-on-exo-mailboxes.md).|
|SFV:SKA|Сообщение пропущено фильтром нежелательной почты и отправлено в папку "Входящие", так как совпадает с записью в списке разрешенных отправителей или доменов политики защиты от нежелательной почты. Дополнительные сведения см. в статье [Настройка политик защиты от нежелательной почты](configure-your-spam-filter-policies.md).|
|SFV:SKB|Сообщение помечено как нежелательное, так как совпадает с записью в списке заблокированных отправителей или доменов политики защиты от нежелательной почты. Дополнительные сведения см. в статье [Настройка политик защиты от нежелательной почты](configure-your-spam-filter-policies.md).|
|SFV:SKI|Подобно SFV:SKN, фильтрация сообщения пропущена по иной причине (например, оно отправляется внутри организации клиента).|
|SFV:SKN|Сообщение помечено как не являющееся нежелательным до обработки фильтром нежелательной почты (например, сообщение помечено как SCL — 1 или **Обошло фильтр нежелательной почты** правилом обработки почтового потока).|
|SFV:SKQ|Сообщение было извлечено из почтового ящика карантина и отправлено указанным получателям.|
|SFV:SKS|Сообщение помечено как нежелательное до обработки фильтром нежелательной почты (например, сообщение помечено как SCL 5-9 правилом обработки почтового потока).|
|SFV:SPM|Сообщение помечено как нежелательное фильтром нежелательной почты.|
|SRV:BULK|Сообщение идентифицировано как массовая рассылка в результате фильтрации спама и порогового значения уровня массовых жалоб (BCL). Если параметр _MarkAsSpamBulkMail_ `On` (по умолчанию), сообщение массовой рассылки помечается как нежелательная почта с высокой вероятностью (SCL 9). Дополнительные сведения см. в статье [Настройка политик защиты от нежелательной почты](configure-your-spam-filter-policies.md).|
|X-CustomSpam: \[ASFOption\]|Сообщение имеет параметр, соответствующий одному из расширенных параметров фильтрации нежелательной почты (ASF). Сведения о том, как узнать значение X-заголовка для каждого из параметров ASF, см. в статье [Параметры расширенного фильтра спама (ASF)](advanced-spam-filtering-asf-options.md).|
|

## <a name="x-microsoft-antispam-message-header-fields"></a>Поля заголовка сообщения X-Microsoft-Antispam

В таблице ниже описаны нужные поля в заголовке сообщения **X-Microsoft-Antispam**. Другие поля в этом заголовке нужны для диагностики и используются исключительно группой специалистов Майкрософт, ответственной за защиту от нежелательной почты.

****

|Поле заголовка|Описание|
|---|---|
|BCL|Количество жалоб на массовую рассылку сообщений (BCL). Более высокий уровень BCL указывает, что сообщения массовой рассылки (_серая почта_), с большей вероятностью вызовут жалобы (и скорее всего являются нежелательной почтой). Дополнительные сведения см. в статье [Порог неприятия массовых рассылок (BCL)](bulk-complaint-level-values.md).|
|

## <a name="authentication-results-message-header"></a>Заголовок сообщения Authentication-results

Когда на почтовый сервер приходит сообщение, оно проверяется с помощью инфраструктуры политики отправителей, DKIM и DMARC. Результаты этой проверки служба Microsoft 365 записывает в заголовке сообщения **Authentication-results** (добавляет к нему метку).

### <a name="check-stamp-syntax-and-examples"></a>Ознакомьтесь с примерами и синтаксисом добавления меток

В следующих примерах синтаксиса показана текстовая метка, которую Microsoft 365 добавляет к заголовку каждого сообщения, проходящего проверку подлинности при доставке на почтовый сервер. Такая метка добавляется в заголовок **Authentication-Results**.

#### <a name="syntax-spf-check-stamp"></a>Синтаксис: метка при проверке с помощью инфраструктуры политики отправителей

В случае инфраструктуры политики отправителей применяется указанный ниже синтаксис.

```text
spf=<pass (IP address)|fail (IP address)|softfail (reason)|neutral|none|temperror|permerror> smtp.mailfrom=<domain>
```

##### <a name="examples-spf-check-stamp"></a>Примеры: метка при проверке с помощью инфраструктуры политики отправителей

```text
spf=pass (sender IP is 192.168.0.1) smtp.mailfrom=contoso.com
spf=fail (sender IP is 127.0.0.1) smtp.mailfrom=contoso.com
```

#### <a name="syntax-dkim-check-stamp"></a>Синтаксис: метка при проверке с помощью DKIM

В случае DKIM применяется указанный ниже синтаксис.

```text
dkim=<pass|fail (reason)|none> header.d=<domain>
```

##### <a name="examples-dkim-check-stamp"></a>Примеры: метка при проверке с помощью DKIM

```text
dkim=pass (signature was verified) header.d=contoso.com
dkim=fail (body hash did not verify) header.d=contoso.com
```

#### <a name="syntax-dmarc-check-stamp"></a>Синтаксис: метка при проверке с помощью DMARC

В случае DMARC применяется указанный ниже синтаксис.

```text
dmarc=<pass|fail|bestguesspass|none> action=<permerror|temperror|oreject|pct.quarantine|pct.reject> header.from=<domain>
```

##### <a name="examples-dmarc-check-stamp"></a>Примеры: метка при проверке с помощью DMARC

```text
dmarc=pass action=none header.from=contoso.com
dmarc=bestguesspass action=none header.from=contoso.com
dmarc=fail action=none header.from=contoso.com
dmarc=fail action=oreject header.from=contoso.com
```

### <a name="authentication-results-message-header-fields-used-by-microsoft-email-authentication"></a>Поля заголовка сообщения Authentication-results, используемые при проверке подлинности почты в Майкрософт

В этой таблице описаны поля и возможные значения для каждой проверки подлинности сообщений.

****

|Поле заголовка|Описание|
|---|---|
|action|Указывает действие, выполняемое фильтром спама на основании результатов проверки с помощью DMARC. Например: <ul><li>**oreject** или **o.reject**. Указывает, что было выполнено переопределение отклонения. В этом случае Microsoft 365 использует это действие при получении сообщения, не прошедшего проверку DMARC, из доменов, в записях DMARC TXT которых применена политика отклонения (p=reject). Вместо удаления или отклонения такого сообщения служба Microsoft 365 помечает его как спам. Дополнительные сведения о том, почему Microsoft 365 поступает именно так, см. в разделе [Как Microsoft 365 обрабатывает входящую почту, не прошедшую проверки DMARC](use-dmarc-to-validate-email.md#how-microsoft-365-handles-inbound-email-that-fails-dmarc).</li><li>**pct.quarantine**. Указывает, что менее 100 % сообщений, не прошедших проверку DMARC, все равно будут доставлены. Это означает, что сообщение не прошло проверку DMARC и согласно политике должно быть отправлено в карантин, но для поля "pct" не задано значение 100 %, и система случайно определила, что действие DMARC применять не следует.</li><li>**pct.reject**. Указывает, что менее 100 % сообщений, не прошедших проверку DMARC, все равно будут доставлены. Это означает, что сообщение не прошло проверку DMARC и согласно политике должно быть отклонено, но для поля "pct" не задано значение 100 %, и система случайно определила, что действие DMARC применять не следует.</li><li>**permerror**. Указывает, что во время проверки с помощью DMARC произошла постоянная ошибка, такая как обнаружение неправильно созданной записи DMARC TXT в DNS. Попытка отправить такое сообщение повторно вряд ли завершится другим результатом. Вместо этого может потребоваться обратиться к владельцу домена с просьбой устранить проблему.</li><li>**temperror**. Указывает, что во время проверки с помощью DMARC произошла временная ошибка. Можно обратиться к отправителю с просьбой повторно отправить сообщение позже, чтобы почта была обработана должным образом.</li></ul>|
|compauth|Результат многофакторной проверки подлинности. Используется в Microsoft 365 для сочетания различных типов проверки подлинности, например SPF, DKIM, DMARC или другой части сообщения, чтобы определить, прошло ли сообщение проверку подлинности. В качестве основы для оценки используется домен "От:".|
|dkim|Описывает результаты проверки сообщения с использованием DKIM. Возможные значения: <ul><li>**pass**. Указывает, что проверка сообщения с помощью DKIM пройдена успешно.</li><li>**fail (причина)**. Указывает, что не удалось проверить сообщение с помощью DKIM, а также причину этого. Например, когда сообщение не подписано или подпись не проверена.</li><li>**none**. Указывает, что сообщение не подписано. Это может быть связано с тем, что для домена задана запись DKIM, которая не приводит к результату.</li></ul>|
|dmarc|Описывает результаты проверки сообщения с использованием DMARC. Возможные значения: <ul><li>**pass**. Указывает, что проверка сообщения с помощью DMARC пройдена успешно.</li><li>**fail**. Указывает, что проверка сообщения с помощью DMARC не пройдена.</li><li>**bestguesspass**. Указывает, что для домена отсутствует запись DMARC TXT, однако если бы такая запись существовала, проверка DMARC была бы пройдена успешно. Причина заключается в том, что домен, указанный в адресе `5321.MailFrom` (например, "адрес отправителя", "отправитель P1" или "отправитель конверта"), совпадает с доменом в адресе `5322.From` (адрес "от" или "отправитель P2").</li><li>**none**. Указывает, что для отправляющего домена в DNS отсутствует запись DMARC TXT.|
|header.d|Определяет домен, указанный в подписи DKIM, если такая есть. Это домен, у которого запрашивается открытый ключ.|
|header.from|Домен, указанный в адресе `5322.From` в заголовке сообщения ("адрес отправителя" или "отправитель P2"). Получатель видит адрес отправителя в почтовых клиентах.|
|reason|Причина удачного или неудачного выполнения многофакторной проверки подлинности. Значением является 3-значный код. Например: <ul><li>**000**. Сообщение не прошло явную проверку подлинности (`compauth=fail`). Например, сообщение получило ошибку DMARC с действием отправки на карантин или отклонения.</li><li>**001**. Сообщение не прошло неявную проверку подлинности (`compauth=fail`). Это означает, что отправляющий домен не содержал опубликованных записей проверки подлинности электронной почты, либо (при их наличии) к ним применялась менее строгая политика сбоя (SPF — несерьезный сбой или нейтральный результат, политика DMARC `p=none`).</li><li>**002**. В организация есть политика для пары отправитель/домен, явным образом запрещающая отправку подделанных электронных сообщений. Этот параметр настраивается вручную администратором.</li><li>**010**. Сообщению не удалось пройти проверку DMARC, оно было отклонено или отправлено в карантин, а домен отправителя является одним из одобренных вашей организацией доменов (это так называемый спуфинг внутри организации).</li><li>**1xx** или **7xx**. Сообщение прошло проверку подлинности (`compauth=pass`). Последние две цифры — это внутренние коды, используемые в Microsoft 365.</li><li>**2xx**. Сообщение прошло нестрогую неявную проверку подлинности (`compauth=softpass`). Последние две цифры — это внутренние коды, используемые в Microsoft 365.</li><li>**3xx**. Сообщение не подвергалось многофакторной проверке подлинности (`compauth=none`).</li><li>**4xx** или **9xx**. Сообщение обошло многофакторную проверку подлинности (`compauth=none`). Последние две цифры — это внутренние коды, используемые в Microsoft 365.</li><li>**6xx**. Сообщению не удалось пройти неявную проверку подлинности, а домен отправителя является одним из разрешенных вашей организацией доменов (это так называемый спуфинг внутри организации).</li></ul>|
|smtp.mailfrom|Домен адреса `5321.MailFrom` (например, "адрес отправителя", "отправитель P1" или "отправитель конверта"). Это адрес электронной почты, который используется в отчетах о недоставке (сообщения NDR или сообщения о возврате).|
|spf|Описывает результаты проверки сообщения с использованием инфраструктуры политики отправителей. Возможные значения: <ul><li>**pass (IP-адрес)**. Указывает, что выполнена проверка сообщения с помощью инфраструктуры политики отправителей, и показывает IP-адрес отправителя. Клиент уполномочен отправлять или пересылать сообщение от имени домена отправителя.</li><li>**fail (IP-адрес)**. Указывает, что не удалось выполнить проверку сообщения с использованием инфраструктуры политики отправителей, и показывает IP-адрес отправителя. Это еще иногда называется _серьезным сбоем_.</li><li>**softfail (причина)**. Указывает, что запись инфраструктуры политики отправителей определила узел как такой, отправка сообщений для которого не разрешена, но находится в процессе.</li><li>**neutral**. Указывает, что запись инфраструктуры политики отправителей не может точно определить, авторизован ли IP-адрес.</li><li>**none**. Указывает, что для домена не задана запись инфраструктуры политики отправителей (или что эта запись не приводит к результату).</li><li>**temperror**. Указывает, что произошла ошибка, которая может быть временной (например, ошибка DNS). Повторите попытку позже. Вмешательство администратора, возможно, не понадобится.  </li><li>**permerror**. Указывает, что произошла постоянная ошибка. Причиной может быть ошибочно созданная запись инфраструктуры политики отправителей для домена.</li></ul>|
|
