---
title: антивирусная программа в Microsoft Defender инфраструктура виртуальных рабочих столов развертывания
description: Узнайте, как развернуть антивирусная программа в Microsoft Defender в виртуальной среде рабочего стола для наилучшего баланса между защитой и производительностью.
keywords: vdi, hyper-v, vm, виртуальная машина, защитник Windows, антивирус, av, виртуальный рабочий стол, rds, удаленный рабочий стол
search.product: eADQiWindows 10XVcnh
ms.prod: m365-security
ms.mktglfcycl: manage
ms.sitesec: library
localization_priority: Normal
author: denisebmsft
ms.author: deniseb
ms.custom: nextgen
ms.date: 06/11/2021
ms.reviewer: jesquive
manager: dansimp
ms.technology: mde
ms.topic: article
ms.openlocfilehash: ce200ca12bacc3ae8d9f7b48d36274ca54322586
ms.sourcegitcommit: 3e197d1ff7d8100faeaf1f5a33f1ad4ed2f72e99
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/11/2021
ms.locfileid: "52908033"
---
# <a name="deployment-guide-for-microsoft-defender-antivirus-in-a-virtual-desktop-infrastructure-vdi-environment"></a>Руководство по развертыванию антивирусной программы в Microsoft Defender в среде инфраструктуры виртуальных рабочих столов (VDI)

**Область применения:**

- [Microsoft Defender для конечной точки](/microsoft-365/security/defender-endpoint/)

Помимо стандартных конфигураций локального или аппаратного оборудования, вы также можете использовать антивирусная программа в Microsoft Defender в среде удаленного рабочего стола (RDS) или виртуальной инфраструктуры настольных компьютеров (VDI).

Дополнительные [сведения о](/azure/virtual-desktop) Удаленный рабочий стол (Майкрософт) и поддержке VDI см. в Windows документации по виртуальным настольным компьютерам.

Виртуальные машины на основе Azure см. в Endpoint Protection [в Azure Defender.](/azure/security-center/security-center-install-endpoint-protection)

Благодаря возможности легкого развертывания обновлений для VMs, работающих в VDIs, мы сократили это руководство, чтобы сосредоточиться на том, как быстро и легко получать обновления на компьютерах. Вам больше не нужно создавать и запечатать золотые изображения на периодической основе, так как обновления расширяются в их части компонентов на сервере хост-сервера и загружаются непосредственно в VM, когда он включен.

В этом руководстве описывается настройка VM-компьютеров для оптимальной защиты и производительности, в том числе:

- [Настройка выделенного файла VDI для обновления сведении о безопасности](#set-up-a-dedicated-vdi-file-share)
- [Рандомизация запланированных сканов](#randomize-scheduled-scans)
- [Использование быстрых сканов](#use-quick-scans)
- [Предотвращение уведомлений](#prevent-notifications)
- [Отключение сканирования после каждого обновления](#disable-scans-after-an-update)
- [Сканирование устарелых машин или компьютеров, которые некоторое время не были в автономном режиме](#scan-vms-that-have-been-offline)
- [Применение исключений](#exclusions)

Вы также можете скачать антивирусная программа в Microsoft Defender на [инфраструктура виртуальных рабочих столов](https://demo.wd.microsoft.com/Content/wdav-testing-vdi-ssu.pdf), который рассматривает новую функцию общего обновления сведении безопасности, а также тестирование производительности и руководство по проверке производительности антивируса на собственном VDI.

> [!IMPORTANT]
> Несмотря на то, что VDI может быть организован на Windows Server 2012 или Windows Server 2016, виртуальные машины (виртуальные машины) должны работать как минимум Windows 10 1607 из-за увеличения технологий и функций защиты, недоступных в более ранних версиях Windows.<br/>Существуют улучшения производительности и функций в том, как Microsoft Defender AV работает на виртуальных машинах в Windows 10 предварительного просмотра, сборки 18323 (и более поздней версии). В этом руководстве мы определяем, нужно ли использовать сборку предварительного просмотра для предварительного просмотра. если она не указана, то минимальная требуемая версия для наилучшей защиты и производительности Windows 10 1607.

## <a name="set-up-a-dedicated-vdi-file-share"></a>Настройка выделенного файла VDI

В Windows 10 версии 1903 мы представили функцию общей разведки безопасности, которая разгружает распаковку скачаемых обновлений разведки безопасности на хост-машину, тем самым сэкономив предыдущие ресурсы ЦП, диска и памяти на отдельных машинах. Эта функция была отсвеяна и теперь работает в Windows 10 версии 1703 и выше. Эту функцию можно настроить с помощью групповой политики или PowerShell.

### <a name="use-group-policy-to-enable-the-shared-security-intelligence-feature"></a>Используйте групповую политику, чтобы включить функцию общей разведки безопасности:

1. На компьютере управления групповой политикой откройте консоль управления групповой политикой, щелкните правой кнопкой мыши объект групповой политики, который необходимо настроить, а затем нажмите **кнопку Изменить**.

2. В **редакторе управления групповой политикой** перейдите к **конфигурации компьютера.**

3. Щелкните **административные шаблоны**.

4. Расширь **дерево, Windows компоненты**  >  **антивирусная программа в Microsoft Defender**  >  **обновлений разведки безопасности.**

5. Дважды **щелкните Определение расположения аналитики безопасности для клиентов VDI,** а затем установите параметр **Включено**. Поле автоматически отображается.

6. Введите `\\<sharedlocation\>\wdav-update` (для справки с этим значением см. [Скачать и распаковать).](#download-and-unpackage-the-latest-updates)

7. Нажмите кнопку **ОК**.

8. Развертывание GPO для тестовых VMs.

### <a name="use-powershell-to-enable-the-shared-security-intelligence-feature"></a>Использование PowerShell для обеспечения общей функции разведки безопасности

Чтобы включить эту функцию, используйте следующий cmdlet. Затем необходимо нажать это, как правило, нажимая политики конфигурации на основе PowerShell на VMs:

```PowerShell
Set-MpPreference -SharedSignaturesPath \\<shared location>\wdav-update
```

Раздел [Загрузка и распаковка](#download-and-unpackage-the-latest-updates) см. в разделе Загрузка и \<shared location\> распаковка.

## <a name="download-and-unpackage-the-latest-updates"></a>Скачивание и распаковка последних обновлений

Теперь вы можете начать загрузку и установку новых обновлений. Ниже мы создали пример сценария PowerShell. Этот скрипт — самый простой способ скачивания новых обновлений и их готовности к вашим VMs. Затем следует настроить сценарий для запуска в определенное время на машине управления с помощью запланированной задачи (или, если вы знакомы с использованием скриптов PowerShell в Azure, Intune или SCCM, вы также можете использовать эти скрипты).

```PowerShell
$vdmpathbase = "$env:systemdrive\wdav-update\{00000000-0000-0000-0000-"
$vdmpathtime = Get-Date -format "yMMddHHmmss"
$vdmpath = $vdmpathbase + $vdmpathtime + '}'
$vdmpackage = $vdmpath + '\mpam-fe.exe'

New-Item -ItemType Directory -Force -Path $vdmpath | Out-Null

Invoke-WebRequest -Uri 'https://go.microsoft.com/fwlink/?LinkID=121721&arch=x64' -OutFile $vdmpackage

cmd /c "cd $vdmpath & c: & mpam-fe.exe /x"
```

Вы можете установить запланированную задачу, которую нужно выполнить один раз в день, чтобы при загрузке и распаковке пакета видеомайки получали новое обновление. Мы предлагаем начинать с одного раза в день, но для понимания воздействия следует экспериментировать с увеличением или уменьшением частоты. 

Пакеты сведений безопасности обычно публикуются один раз в три-четыре часа. Не рекомендуется устанавливать частоту меньше четырех часов, так как это увеличит накладные расходы на сеть на компьютере управления без каких-либо преимуществ.

### <a name="set-a-scheduled-task-to-run-the-powershell-script"></a>Установите запланированную задачу для запуска сценария PowerShell

1. На компьютере управления откройте меню Пуск и введите **план-график задач.** Откройте его и выберите **Создать задачу...** на боковой панели.

2. Введите имя в **качестве распаковщика сведений** безопасности . Перейдите на **вкладку Trigger.** Выберите **новое...** > **Ежедневно** и выберите **ОК**.

3. Перейдите на **вкладку Действия.** Выберите **новое...** Введите **PowerShell** в **поле Program/Script.** Введите `-ExecutionPolicy Bypass c:\wdav-update\vdmdlunpack.ps1` в поле Добавление **аргументов.** Нажмите **ОК**.

4. При желании можно настроить дополнительные параметры.

5. Выберите **ОК,** чтобы сохранить запланированную задачу.
 
Вы можете инициировать обновление вручную, щелкнув правой кнопкой мыши по задаче и нажав **выполнить**.

### <a name="download-and-unpackage-manually"></a>Загрузка и распаковка вручную

Если вы предпочитаете делать все вручную, вот что нужно сделать для репликации поведения скрипта:

1. Создайте новую папку в корневой системе, призванной хранить обновления `wdav_update` сведении, например, создайте папку. `c:\wdav_update`

2. Создание подмостков под *wdav_update* с именем GUID, например `{00000000-0000-0000-0000-000000000000}`

Вот пример: `c:\wdav_update\{00000000-0000-0000-0000-000000000000}`

   > [!NOTE]
   > В скрипте мы задаем его таким образом, что последние 12 цифр GUID — это год, месяц, день и время загрузки файла, чтобы каждый раз создавалась новая папка. Это можно изменить, чтобы файл каждый раз загружался в ту же папку.

3. Скачайте пакет сведений безопасности [https://www.microsoft.com/wdsi/definitions](https://www.microsoft.com/wdsi/definitions)  из папки GUID. Файл должен быть назван `mpam-fe.exe` .

4. Откройте окно подсказки cmd и перейдите в созданную папку GUID. Для **извлечения** файлов, например, используйте команду извлечения `mpam-fe.exe /X` /X.

   > [!NOTE]
   > VMs будут выбирать обновленный пакет всякий раз, когда новая папка GUID создается с извлеченным пакетом обновления или когда существующая папка обновляется с помощью нового извлеченного пакета.

## <a name="randomize-scheduled-scans"></a>Рандомизация запланированных сканов

Запланированные проверки запускают в дополнение к защите [и сканированию в режиме реального времени.](configure-real-time-protection-microsoft-defender-antivirus.md)

Время начала самой проверки по-прежнему основано на политике планового сканирования **(ScheduleDay,** **ScheduleTime** и **ScheduleQuickScanTime).** Рандомизация приведет антивирусная программа в Microsoft Defender для запуска сканирования на каждой машине в течение 4-часового окна от установленного времени для запланированного сканирования.

См. [список сканов](scheduled-catch-up-scans-microsoft-defender-antivirus.md) расписания для других параметров конфигурации, доступных для запланированных сканов.

## <a name="use-quick-scans"></a>Использование быстрых сканов

Можно указать тип сканирования, который должен выполняться во время запланированного сканирования. Быстрые проверки являются предпочтительным подходом, так как они предназначены для того, чтобы выглядеть во всех местах, где вредоносные программы должны находиться для активного использования. В следующей процедуре описывается настройка быстрого сканирования с помощью групповой политики.

1. В редакторе групповой политики перейдите к **административным**  >  **шаблонам Windows компоненты**  >  **антивирусная программа в Microsoft Defender**  >  **сканирования.**

2. Выберите Тип сканирования, который **необходимо использовать для запланированного** сканирования, а затем изменить параметр политики.

3. Установите политику **включенной,** а затем в **статье Параметры** выберите **быстрое сканирование.**

4. Нажмите **ОК**. 

5. Разверните объект групповой политики, как обычно.

## <a name="prevent-notifications"></a>Предотвращение уведомлений

Иногда антивирусная программа в Microsoft Defender уведомления могут быть отправлены или сохраняются на нескольких сеансах. Чтобы свести к минимуму эту проблему, можно заблокировать интерфейс антивирусная программа в Microsoft Defender пользователя. В следующей процедуре описывается, как пресекать уведомления с помощью групповой политики.

1. В редакторе групповой политики перейдите **Windows компоненты антивирусная программа в Microsoft Defender**  >    >  **клиентского интерфейса.**

2. Выберите **Suppress all notifications** and then edit the policy settings. 

3. Установите политику **включенной,** а затем выберите **ОК.**

4. Разверните объект групповой политики, как обычно.

Подавление уведомлений не позволяет антивирусная программа в Microsoft Defender в Центре действий в Windows 10 при сканировании или действиях по исправлению. Однако команда операций безопасности увидит результаты проверки на портале [Microsoft 365 Defender.](microsoft-defender-security-center.md)

> [!TIP]
> Чтобы открыть Центр действий на Windows 10, необходимо сделать один из следующих действий:
> - В правом конце панели задач выберите значок Центра действий.
> - Нажмите кнопку Windows логотипа + A.
> - На сенсорном экране проведите пальцем по правому краю экрана.

## <a name="disable-scans-after-an-update"></a>Отключение сканов после обновления

Отключение сканирования после обновления не позволит сканировать после получения обновления. Этот параметр можно применить при создании базового изображения, если вы также запустите быстрое сканирование. Таким образом, можно запретить вновь обновленной VM выполнять сканирование (как вы уже отсканировали его при создания базового изображения).

> [!IMPORTANT]
> Запуск сканирования после обновления поможет убедиться, что ваши VMs защищены последними обновлениями разведки безопасности. Отключение этого параметра снизит уровень защиты ваших VMs и должно использоваться только при первом создании или развертывании базового изображения.

1. В редакторе групповой политики перейдите **Windows компоненты антивирусная программа в Microsoft Defender**  >    >  **обновления безопасности.**

2. Выберите **включив сканирование после обновления сведении безопасности,** а затем изменить параметр политики.

3. Установите политику **отключенной.**

4. Нажмите **ОК**.

5. Разверните объект групповой политики, как обычно.

Эта политика предотвращает запуск сканирования сразу после обновления.

## <a name="scan-vms-that-have-been-offline"></a>Сканирование VMs, которые были отключены

1. В редакторе групповой политики перейдите к Windows **компоненты**  >  **антивирусная программа в Microsoft Defender**  >  **сканирования.**

2. **Включите быстрое сканирование и** отредактируйте параметр политики.

3. Установите политику **включенной**.

4. Нажмите **ОК**.

5. Развертывание объекта групповой политики, как обычно.

Эта политика заставляет проверку, если VM пропустил два или более последовательных запланированных сканов.

## <a name="enable-headless-ui-mode"></a>Включить безголовый режим пользовательского интерфейса

1. В редакторе групповой политики перейдите **Windows компоненты антивирусная программа в Microsoft Defender**  >    >  **клиентского интерфейса.**

2. Выберите **режим включить безголовый пользовательский интерфейс** и изменить политику.

3. Установите политику **включенной**.

4. Нажмите кнопку **ОК**.

5. Развертывание объекта групповой политики, как обычно.
 
Эта политика скрывает весь пользовательский интерфейс антивирусная программа в Microsoft Defender от конечных пользователей в вашей организации.

## <a name="exclusions"></a>Исключения

Исключения можно добавлять, удалять или настраивать в соответствии с вашими потребностями.

Дополнительные сведения см. в [антивирусная программа в Microsoft Defender на Windows Server.](configure-exclusions-microsoft-defender-antivirus.md)

## <a name="additional-resources"></a>Дополнительные ресурсы

- [Блог Community технологий: настройка антивирусная программа в Microsoft Defender для нестандартных машин VDI](https://techcommunity.microsoft.com/t5/microsoft-defender-for-endpoint/configuring-microsoft-defender-antivirus-for-non-persistent-vdi/ba-p/1489633)
- [Форумы TechNet по службам удаленного рабочего стола и VDI](https://social.technet.microsoft.com/Forums/windowsserver/en-US/home?forum=winserverTS)
- [Сценарий SignatureDownloadCustomTask PowerShell](https://www.powershellgallery.com/packages/SignatureDownloadCustomTask/1.4)