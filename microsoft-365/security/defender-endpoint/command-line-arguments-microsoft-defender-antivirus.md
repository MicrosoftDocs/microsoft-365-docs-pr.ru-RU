---
title: Используйте командную строку для управления антивирусная программа в Microsoft Defender
description: Выполнить антивирусная программа в Microsoft Defender проверки и настроить защиту следующего поколения с помощью специальной командной строки.
keywords: выполнить сканирование защитника Windows, выполнить антивирусное сканирование из командной строки, выполнить сканирование защитника windows из командной строки, mpcmdrun, defender
search.product: eADQiWindows 10XVcnh
ms.prod: m365-security
ms.mktglfcycl: manage
ms.sitesec: library
localization_priority: Normal
author: denisebmsft
ms.author: deniseb
ms.custom: nextgen
ms.reviewer: ksarens
manager: dansimp
ms.date: 05/24/2021
ms.technology: mde
ms.topic: how-to
ms.openlocfilehash: 25f038846f9dd9855823382d4e1babcf0547fed6
ms.sourcegitcommit: 17f0aada83627d9defa0acf4db03a2d58e46842f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/24/2021
ms.locfileid: "52636174"
---
# <a name="configure-and-manage-microsoft-defender-antivirus-with-the-mpcmdrunexe-command-line-tool"></a><span data-ttu-id="f78a9-104">Настройка и управление антивирусная программа в Microsoft Defender с помощью mpcmdrun.exe командной строки</span><span class="sxs-lookup"><span data-stu-id="f78a9-104">Configure and manage Microsoft Defender Antivirus with the mpcmdrun.exe command-line tool</span></span>

<span data-ttu-id="f78a9-105">**Область применения:**</span><span class="sxs-lookup"><span data-stu-id="f78a9-105">**Applies to:**</span></span>

- [<span data-ttu-id="f78a9-106">Microsoft Defender для конечной точки</span><span class="sxs-lookup"><span data-stu-id="f78a9-106">Microsoft Defender for Endpoint</span></span>](/microsoft-365/security/defender-endpoint/)

<span data-ttu-id="f78a9-107">Вы можете выполнять различные функции в антивирусная программа в Microsoft Defender с помощью выделенного средства командной строки **mpcmdrun.exe.**</span><span class="sxs-lookup"><span data-stu-id="f78a9-107">You can perform various functions in Microsoft Defender Antivirus using the dedicated command-line tool **mpcmdrun.exe**.</span></span> <span data-ttu-id="f78a9-108">Эта утилита полезна для автоматизации антивирусная программа в Microsoft Defender задач.</span><span class="sxs-lookup"><span data-stu-id="f78a9-108">This utility is useful when you want to automate Microsoft Defender Antivirus tasks.</span></span> <span data-ttu-id="f78a9-109">Вы можете найти утилиту `%ProgramFiles%\Windows Defender\MpCmdRun.exe` в .</span><span class="sxs-lookup"><span data-stu-id="f78a9-109">You can find the utility in `%ProgramFiles%\Windows Defender\MpCmdRun.exe`.</span></span> <span data-ttu-id="f78a9-110">Запустите его из командной подсказки.</span><span class="sxs-lookup"><span data-stu-id="f78a9-110">Run it from a command prompt.</span></span>

> [!TIP]
> <span data-ttu-id="f78a9-111">Может потребоваться открыть версию командной подсказки на уровне администратора.</span><span class="sxs-lookup"><span data-stu-id="f78a9-111">You might need to open an administrator-level version of the command prompt.</span></span> <span data-ttu-id="f78a9-112">При поиске **командной подсказки** в меню Пуск выберите **Выполнить в качестве администратора.**</span><span class="sxs-lookup"><span data-stu-id="f78a9-112">When you search for **Command Prompt** on the Start menu, choose **Run as administrator**.</span></span> <span data-ttu-id="f78a9-113">Если вы работаете с обновленной версией платформы Защитника Майкрософт, запустите ее из `MpCmdRun` следующего расположения: `C:\ProgramData\Microsoft\Windows Defender\Platform\<antimalware platform version>` .</span><span class="sxs-lookup"><span data-stu-id="f78a9-113">If you're running an updated Microsoft Defender Platform version, run `MpCmdRun` from the following location: `C:\ProgramData\Microsoft\Windows Defender\Platform\<antimalware platform version>`.</span></span> <span data-ttu-id="f78a9-114">Дополнительные сведения о платформе антивирусных программ см. в антивирусная программа в Microsoft Defender [обновления и базовые версии.](manage-updates-baselines-microsoft-defender-antivirus.md)</span><span class="sxs-lookup"><span data-stu-id="f78a9-114">For more information about the antimalware platform, see [Microsoft Defender Antivirus updates and baselines](manage-updates-baselines-microsoft-defender-antivirus.md).</span></span>

<span data-ttu-id="f78a9-115">Утилита MpCmdRun использует следующий синтаксис:</span><span class="sxs-lookup"><span data-stu-id="f78a9-115">The MpCmdRun utility uses the following syntax:</span></span>

```console
MpCmdRun.exe [command] [-options]
```

<span data-ttu-id="f78a9-116">Пример:</span><span class="sxs-lookup"><span data-stu-id="f78a9-116">Here's an example:</span></span>

```console
MpCmdRun.exe -Scan -ScanType 2
``` 

<span data-ttu-id="f78a9-117">В нашем примере утилита MpCmdRun запускает полное антивирусное сканирование на устройстве.</span><span class="sxs-lookup"><span data-stu-id="f78a9-117">In our example, the MpCmdRun utility starts a full antivirus scan on the device.</span></span>

## <a name="commands"></a><span data-ttu-id="f78a9-118">Команды</span><span class="sxs-lookup"><span data-stu-id="f78a9-118">Commands</span></span>

| <span data-ttu-id="f78a9-119">Команда</span><span class="sxs-lookup"><span data-stu-id="f78a9-119">Command</span></span>  | <span data-ttu-id="f78a9-120">Описание</span><span class="sxs-lookup"><span data-stu-id="f78a9-120">Description</span></span>   |
|:----|:----|
| <span data-ttu-id="f78a9-121">`-?`**или**`-h`</span><span class="sxs-lookup"><span data-stu-id="f78a9-121">`-?` **or** `-h`</span></span>   | <span data-ttu-id="f78a9-122">Отображает все доступные параметры для средства MpCmdRun</span><span class="sxs-lookup"><span data-stu-id="f78a9-122">Displays all available options for the MpCmdRun tool</span></span> |
| `-Scan [-ScanType [<value>]] [-File <path> [-DisableRemediation] [-BootSectorScan] [-CpuThrottling]] [-Timeout <days>] [-Cancel]` | <span data-ttu-id="f78a9-123">Сканирование вредоносного программного обеспечения.</span><span class="sxs-lookup"><span data-stu-id="f78a9-123">Scans for malicious software.</span></span> <span data-ttu-id="f78a9-124">Значения для **ScanType:**</span><span class="sxs-lookup"><span data-stu-id="f78a9-124">Values for **ScanType** are:</span></span><p><span data-ttu-id="f78a9-125">**0** По умолчанию в соответствии с конфигурацией</span><span class="sxs-lookup"><span data-stu-id="f78a9-125">**0** Default, according to your configuration</span></span><p><span data-ttu-id="f78a9-126">**1 Быстрое** сканирование</span><span class="sxs-lookup"><span data-stu-id="f78a9-126">**1** Quick scan</span></span><p><span data-ttu-id="f78a9-127">**2** Полное сканирование</span><span class="sxs-lookup"><span data-stu-id="f78a9-127">**2** Full scan</span></span><p><span data-ttu-id="f78a9-128">**3 Пользовательское** сканирование файлов и каталогов.</span><span class="sxs-lookup"><span data-stu-id="f78a9-128">**3** File and directory custom scan.</span></span><p><span data-ttu-id="f78a9-129">CpuThrottling выполняется в соответствии с конфигурациями политики</span><span class="sxs-lookup"><span data-stu-id="f78a9-129">CpuThrottling runs according to policy configurations</span></span> |
| `-Trace [-Grouping #] [-Level #]` | <span data-ttu-id="f78a9-130">Начало отслеживания диагностики</span><span class="sxs-lookup"><span data-stu-id="f78a9-130">Starts diagnostic tracing</span></span> |
| `-GetFiles [-SupportLogLocation <path>]` | <span data-ttu-id="f78a9-131">Собирает сведения о поддержке.</span><span class="sxs-lookup"><span data-stu-id="f78a9-131">Collects support information.</span></span> <span data-ttu-id="f78a9-132">Сведения о[сборе диагностических данных](collect-diagnostic-data.md)см. в</span><span class="sxs-lookup"><span data-stu-id="f78a9-132">See '[collecting diagnostic data](collect-diagnostic-data.md)'</span></span>  |
| `-GetFilesDiagTrack`  | <span data-ttu-id="f78a9-133">То `-GetFiles` же, что и , но выводит во временную папку DiagTrack</span><span class="sxs-lookup"><span data-stu-id="f78a9-133">Same as `-GetFiles`, but outputs to temporary DiagTrack folder</span></span> |
| `-RemoveDefinitions [-All]` | <span data-ttu-id="f78a9-134">Восстановление установленного интеллекта безопасности в предыдущей копии резервного копирования или в исходном наборе по умолчанию</span><span class="sxs-lookup"><span data-stu-id="f78a9-134">Restores the installed Security intelligence to a previous backup copy or to the original default set</span></span> |
| `-RemoveDefinitions [-DynamicSignatures]` | <span data-ttu-id="f78a9-135">Удаляет только динамически загруженный интеллект безопасности</span><span class="sxs-lookup"><span data-stu-id="f78a9-135">Removes only the dynamically downloaded Security intelligence</span></span> |
| `-RemoveDefinitions [-Engine]` | <span data-ttu-id="f78a9-136">Восстановление предыдущего установленного двигателя</span><span class="sxs-lookup"><span data-stu-id="f78a9-136">Restores the previous installed engine</span></span> |
| `-SignatureUpdate [-UNC \| -MMPC]` | <span data-ttu-id="f78a9-137">Проверка новых обновлений службы безопасности</span><span class="sxs-lookup"><span data-stu-id="f78a9-137">Checks for new Security intelligence updates</span></span> |
| `-Restore  [-ListAll \| [[-Name <name>] [-All] \| [-FilePath <filePath>]] [-Path <path>]]` | <span data-ttu-id="f78a9-138">Восстановление или перечисление на карантин элемента (ы)</span><span class="sxs-lookup"><span data-stu-id="f78a9-138">Restores or lists quarantined item(s)</span></span> |
| `-AddDynamicSignature [-Path]` | <span data-ttu-id="f78a9-139">Загружает динамический интеллект безопасности</span><span class="sxs-lookup"><span data-stu-id="f78a9-139">Loads dynamic Security intelligence</span></span> |
| `-ListAllDynamicSignatures` | <span data-ttu-id="f78a9-140">Списки загруженной динамической разведки безопасности</span><span class="sxs-lookup"><span data-stu-id="f78a9-140">Lists the loaded dynamic Security intelligence</span></span> |
| `-RemoveDynamicSignature [-SignatureSetID]` | <span data-ttu-id="f78a9-141">Удаляет динамический интеллект безопасности</span><span class="sxs-lookup"><span data-stu-id="f78a9-141">Removes dynamic Security intelligence</span></span> |
| `-CheckExclusion -path <path>` | <span data-ttu-id="f78a9-142">Проверяет, исключен ли путь</span><span class="sxs-lookup"><span data-stu-id="f78a9-142">Checks whether a path is excluded</span></span> |
| `-ValidateMapsConnection` | <span data-ttu-id="f78a9-143">Проверяет, может ли ваша сеть взаимодействовать с антивирусная программа в Microsoft Defender облачной службой.</span><span class="sxs-lookup"><span data-stu-id="f78a9-143">Verifies that your network can communicate with the Microsoft Defender Antivirus cloud service.</span></span> <span data-ttu-id="f78a9-144">Эта команда будет работать только на Windows 10 версии 1703 или выше.</span><span class="sxs-lookup"><span data-stu-id="f78a9-144">This command will only work on Windows 10, version 1703 or higher.</span></span>|

## <a name="common-errors-in-running-commands-via-mpcmdrunexe"></a><span data-ttu-id="f78a9-145">Распространенные ошибки при запуске команд через mpcmdrun.exe</span><span class="sxs-lookup"><span data-stu-id="f78a9-145">Common errors in running commands via mpcmdrun.exe</span></span> 

<span data-ttu-id="f78a9-146">В следующей таблице перечислены распространенные ошибки, которые могут возникать при использовании средства MpCmdRun.</span><span class="sxs-lookup"><span data-stu-id="f78a9-146">The following table lists common errors that can occur while using the MpCmdRun tool.</span></span>

|<span data-ttu-id="f78a9-147">Сообщение об ошибке</span><span class="sxs-lookup"><span data-stu-id="f78a9-147">Error message</span></span> | <span data-ttu-id="f78a9-148">Возможная причина</span><span class="sxs-lookup"><span data-stu-id="f78a9-148">Possible reason</span></span> |
|:----|:----|
| <span data-ttu-id="f78a9-149">**Не удалось проверитьMapsConnection (800106BA)** **или 0x800106BA**</span><span class="sxs-lookup"><span data-stu-id="f78a9-149">**ValidateMapsConnection failed (800106BA)** or **0x800106BA**</span></span> | <span data-ttu-id="f78a9-150">Служба антивирусная программа в Microsoft Defender отключена.</span><span class="sxs-lookup"><span data-stu-id="f78a9-150">The Microsoft Defender Antivirus service is disabled.</span></span> <span data-ttu-id="f78a9-151">Включить службу и попробовать еще раз.</span><span class="sxs-lookup"><span data-stu-id="f78a9-151">Enable the service and try again.</span></span> <span data-ttu-id="f78a9-152">Если вам нужна помощь по повторному антивирусная программа в Microsoft Defender, см. в антивирусная программа в Microsoft Defender [reinstall/enable.](switch-to-microsoft-defender-setup.md#reinstallenable-microsoft-defender-antivirus-on-your-endpoints)</span><span class="sxs-lookup"><span data-stu-id="f78a9-152">If you need help re-enabling Microsoft Defender Antivirus, see [Reinstall/enable Microsoft Defender Antivirus on your endpoints](switch-to-microsoft-defender-setup.md#reinstallenable-microsoft-defender-antivirus-on-your-endpoints).</span></span><p>   <span data-ttu-id="f78a9-153">**TIP**  В Windows 10 1909 г. и старше Windows Server 2019 или старше служба ранее называлась *антивирусная программа .*</span><span class="sxs-lookup"><span data-stu-id="f78a9-153">**TIP**  In Windows 10 1909 or older, and Windows Server 2019 or older, the service was formerly called *Windows Defender Antivirus*.</span></span> |
| <span data-ttu-id="f78a9-154">**0x80070667**</span><span class="sxs-lookup"><span data-stu-id="f78a9-154">**0x80070667**</span></span> | <span data-ttu-id="f78a9-155">Вы работаете с командой с компьютера, который Windows 10 версии 1607 или старше или Windows Server 2016 `-ValidateMapsConnection` старше.</span><span class="sxs-lookup"><span data-stu-id="f78a9-155">You're running the `-ValidateMapsConnection` command from a computer that is Windows 10 version 1607 or older, or Windows Server 2016 or older.</span></span> <span data-ttu-id="f78a9-156">Запустите команду с компьютера, Windows 10 версии 1703 или более новой, или Windows Server 2019 или более новой.</span><span class="sxs-lookup"><span data-stu-id="f78a9-156">Run the command from a machine that is Windows 10 version 1703 or newer, or Windows Server 2019 or newer.</span></span>|
| <span data-ttu-id="f78a9-157">**MpCmdRun не распознается как внутренняя или внешняя команда, оперативная программа или пакетный файл.**</span><span class="sxs-lookup"><span data-stu-id="f78a9-157">**MpCmdRun is not recognized as an internal or external command, operable program, or batch file.**</span></span> | <span data-ttu-id="f78a9-158">Средство должно запускаться либо из одного, либо из (где может отличаться, так как обновления платформы ежемесячно, за `%ProgramFiles%\Windows Defender` `C:\ProgramData\Microsoft\Windows Defender\Platform\4.18.2012.4-0` `2012.4-0` исключением марта)</span><span class="sxs-lookup"><span data-stu-id="f78a9-158">The tool must be run from either `%ProgramFiles%\Windows Defender` or `C:\ProgramData\Microsoft\Windows Defender\Platform\4.18.2012.4-0` (where `2012.4-0` might differ since platform updates are monthly except for March)</span></span>|
| <span data-ttu-id="f78a9-159">**ValidateMapsConnection не удалось установить подключение к MAPS (hr=800700005 httpcode=450)**</span><span class="sxs-lookup"><span data-stu-id="f78a9-159">**ValidateMapsConnection failed to establish a connection to MAPS (hr=80070005 httpcode=450)**</span></span> | <span data-ttu-id="f78a9-160">Команда была предпринята с использованием недостаточных привилегий.</span><span class="sxs-lookup"><span data-stu-id="f78a9-160">The command was attempted using insufficient privileges.</span></span> <span data-ttu-id="f78a9-161">Используйте командную подсказку (cmd.exe) в качестве администратора.</span><span class="sxs-lookup"><span data-stu-id="f78a9-161">Use the command prompt (cmd.exe) as an administrator.</span></span>|
| <span data-ttu-id="f78a9-162">**ValidateMapsConnection не удалось установить подключение к MAPS (hr=80070006 httpcode=451)**</span><span class="sxs-lookup"><span data-stu-id="f78a9-162">**ValidateMapsConnection failed to establish a connection to MAPS (hr=80070006 httpcode=451)**</span></span> | <span data-ttu-id="f78a9-163">Брандмауэр блокирует подключение или проводит проверку SSL.</span><span class="sxs-lookup"><span data-stu-id="f78a9-163">The firewall is blocking the connection or conducting SSL inspection.</span></span> |
| <span data-ttu-id="f78a9-164">**ValidateMapsConnection не удалось установить подключение к MAPS (hr=80004005 httpcode=450)**</span><span class="sxs-lookup"><span data-stu-id="f78a9-164">**ValidateMapsConnection failed to establish a connection to MAPS (hr=80004005 httpcode=450)**</span></span> | <span data-ttu-id="f78a9-165">Возможные проблемы, связанные с сетью, например проблемы с разрешением имен</span><span class="sxs-lookup"><span data-stu-id="f78a9-165">Possible network-related issues, like name resolution problems</span></span>|
| <span data-ttu-id="f78a9-166">**ПроверкаMapsConnection не удалось установить подключение к MAPS (hr=0x80508015**</span><span class="sxs-lookup"><span data-stu-id="f78a9-166">**ValidateMapsConnection failed to establish a connection to MAPS (hr=0x80508015**</span></span> | <span data-ttu-id="f78a9-167">Брандмауэр блокирует подключение или проводит проверку SSL.</span><span class="sxs-lookup"><span data-stu-id="f78a9-167">The firewall is blocking the connection or conducting SSL inspection.</span></span> |
| <span data-ttu-id="f78a9-168">**ПроверкаMapsConnection не удалось установить подключение к MAPS (hr=800722F0D**</span><span class="sxs-lookup"><span data-stu-id="f78a9-168">**ValidateMapsConnection failed to establish a connection to MAPS (hr=800722F0D**</span></span> | <span data-ttu-id="f78a9-169">Брандмауэр блокирует подключение или проводит проверку SSL.</span><span class="sxs-lookup"><span data-stu-id="f78a9-169">The firewall is blocking the connection or conducting SSL inspection.</span></span> |
| <span data-ttu-id="f78a9-170">**ValidateMapsConnection не удалось установить подключение к MAPS (hr=80072EE7 httpcode=451)**</span><span class="sxs-lookup"><span data-stu-id="f78a9-170">**ValidateMapsConnection failed to establish a connection to MAPS (hr=80072EE7 httpcode=451)**</span></span> | <span data-ttu-id="f78a9-171">Брандмауэр блокирует подключение или проводит проверку SSL.</span><span class="sxs-lookup"><span data-stu-id="f78a9-171">The firewall is blocking the connection or conducting SSL inspection.</span></span> |

## <a name="see-also"></a><span data-ttu-id="f78a9-172">См. также</span><span class="sxs-lookup"><span data-stu-id="f78a9-172">See also</span></span>

- [<span data-ttu-id="f78a9-173">Настройка функций антивирусной программы в Microsoft Defender</span><span class="sxs-lookup"><span data-stu-id="f78a9-173">Configure Microsoft Defender Antivirus features</span></span>](configure-microsoft-defender-antivirus-features.md)
- [<span data-ttu-id="f78a9-174">Настройка и проверка сетевого подключения антивирусной программы в Microsoft Defender</span><span class="sxs-lookup"><span data-stu-id="f78a9-174">Configure and validate Microsoft Defender Antivirus network connections</span></span>](configure-network-connections-microsoft-defender-antivirus.md)
- [<span data-ttu-id="f78a9-175">Справочные темы для средств управления и конфигурации</span><span class="sxs-lookup"><span data-stu-id="f78a9-175">Reference topics for management and configuration tools</span></span>](configuration-management-reference-microsoft-defender-antivirus.md)
