---
title: Настройка защиты от эксплойтов
keywords: Защита от эксплуатации, смягчение последствий, включить, powershell, dep, cfg, emet, aslr
description: Вы можете включить или отключить определенные меры по смягчению последствий, используемых с помощью защиты Безопасность Windows приложения или PowerShell. Вы также можете аудита смягчения последствий и конфигураций экспорта.
search.product: eADQiWindows 10XVcnh
ms.prod: m365-security
ms.mktglfcycl: manage
ms.sitesec: library
localization_priority: Normal
audience: ITPro
author: dansimp
ms.author: dansimp
ms.reviewer: ''
manager: dansimp
ms.technology: mde
ms.openlocfilehash: 762ace0adcb8bdb3f1c9d532bbaac0d80bdcc258
ms.sourcegitcommit: 4fb1226d5875bf5b9b29252596855a6562cea9ae
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/08/2021
ms.locfileid: "52845502"
---
# <a name="customize-exploit-protection"></a>Настройка защиты от эксплойтов

[!INCLUDE [Microsoft 365 Defender rebranding](../../includes/microsoft-defender.md)]


**Область применения:**
- [Microsoft Defender для конечной точки](https://go.microsoft.com/fwlink/p/?linkid=2154037)
- [Microsoft 365 Defender](https://go.microsoft.com/fwlink/?linkid=2118804)

>Хотите испытать Defender для конечной точки? [Зарегистрився для бесплатной пробной.](https://www.microsoft.com/microsoft-365/windows/microsoft-defender-atp?ocid=docs-wdatp-assignaccess-abovefoldlink)


Защита от эксплойтов автоматически применяет ряд методов смягчения последствий эксплойта как в операционных системах, так и в отдельных приложениях.

Настройка этих параметров с помощью Безопасность Windows приложения на отдельном устройстве. Затем экспортировать конфигурацию в качестве XML-файла, чтобы можно было развернуть на других устройствах. Используйте групповую политику для распространения XML-файла сразу на нескольких устройствах. Вы также можете настроить смягчение с помощью PowerShell.

В этой статье перечислены все меры по смягчению последствий, доступные в защите от эксплойтов. В нем указывается, можно ли применять смягчение по всей системе или к отдельным приложениям, и содержит краткое описание работы по смягчению последствий.

В нем также описывается, как включить или настроить меры по смягчению последствий с помощью поставщиков служб конфигурации Безопасность Windows, PowerShell и управления мобильными устройствами (MDM). Это первый шаг в создании конфигурации, которую можно развернуть по всей сети. Следующий шаг включает создание, экспорт, импорт и развертывание конфигурации [на нескольких устройствах.](import-export-exploit-protection-emet-xml.md)

> [!WARNING]
> Некоторые технологии защиты безопасности могут иметь проблемы совместимости с некоторыми приложениями. Необходимо проверить защиту от эксплойтов во всех сценариях целевого использования с помощью [режима аудита](evaluate-exploit-protection.md) перед развертыванием конфигурации в производственной среде или в остальной части сети.

## <a name="exploit-protection-mitigations"></a>Использование смягчения защиты

Все смягчающие меры можно настроить для отдельных приложений. Некоторые меры по смягчению последствий также могут применяться на уровне операционной системы.

Вы можете установить каждое из этих значений по умолчанию. Некоторые меры по смягчению последствий имеют дополнительные параметры, указанные в описании в таблице.

Значения по умолчанию всегда заданы в скобках в параметре **Use default** для каждого смягчения. В следующем примере по умолчанию для предотвращения выполнения данных существует значение "On".

Конфигурация **Использования по** умолчанию для каждого из параметров смягчения указывает на нашу рекомендацию по базовому уровню защиты для повседневного использования для домашних пользователей. Enterprise развертывания должны учитывать защиту, необходимую для их индивидуальных потребностей, и может потребоваться изменить конфигурацию вдали от по умолчанию.

Для связанных с PowerShell cmdlets для каждого смягчения см. в справочной таблице [PowerShell](#cmdlets-table) в нижней части этой статьи.

| Устранение рисков | Описание | Можно применить к | Доступный режим аудита |
| ---------- | ----------- | ----------------- | -------------------- |
| Диспетчерская система потока (CFG) | Обеспечивает целостность потока управления для непрямых вызовов. Может необязательным образом подавлять экспорт и использовать строгий CFG. | Системный и app-level | ![Проверка знака нет](/security/defender-endpoint/images/svg/check-no) |
| Предотвращение выполнения данных (DEP) | Предотвращает запуск кода со страниц памяти только для данных, таких как куча и стеки. Настраивается только для 32-битных (x86) приложений, которые постоянно включены для всех других архитектур. Может дополнительно включить эмуляцию thunk ATL. | Системный и app-level  | ![Проверка знака нет](/security/defender-endpoint/images/svg/check-no) |
| Принудительный случайный выбор изображений (обязательный ASLR) | Принудительно передает изображения, не компилироваться с /DYNAMICBASE. Может по желанию сбой загрузки изображений, которые не имеют данных о переносе. | Системный и app-level  | ![Проверка знака нет](/security/defender-endpoint/images/svg/check-no) |
| Случайные выделения памяти (ASLR снизу вверх) | Рандомизирует расположения для виртуальных распределений памяти. Он включает в себя кучи структуры системы, стеки, TEBs и PEBs. Можно дополнительно использовать более широкую дисперсию рандомизации для 64-битных процессов. | Системный и app-level | ![Проверка знака нет](/security/defender-endpoint/images/svg/check-no) |
| Проверка цепочек исключений (SEHOP) | Обеспечивает целостность цепочки исключений во время отправки исключений. Настраивается только для 32-битных (x86) приложений. | Системный и app-level  | ![Проверка знака нет](/security/defender-endpoint/images/svg/check-no) |
| Проверка целостности кучи | Завершает процесс при обнаружении повреждения кучи. | Системный и app-level  | ![Проверка знака нет](/security/defender-endpoint/images/svg/check-no) |
| Механизм Arbitrary code guard (ACG) | Предотвращает введение исполняемого кода, не являемого изображением, и предотвращает изменение страниц кода. Можно дополнительно разрешить отключение потока и разрешить удаленное понижение (настраиваемое только с Помощью PowerShell). | Только на уровне приложений | ![Проверка знака да](/security/defender-endpoint/images/svg/check-yes) |
| Блокировать изображений с низкой целостностью | Предотвращает загрузку изображений с низкой целостностью. | Только на уровне приложений | ![Проверка знака да](/security/defender-endpoint/images/svg/check-yes)|
| Блокировать удаленные изображения | Предотвращает загрузку изображений с удаленных устройств. | Только на уровне приложений | ! [Проверить метку нет] (/security/defender-endpoint/images/svg/check-no |
| Блокировка ненадежные шрифты | Предотвращает загрузку шрифтов на основе GDI, не установленных в каталоге системных шрифтов, в частности шрифтов из Интернета. | Только на уровне приложений | !include[Check mark yes](/security/defender-endpoint/images/svg/check-yes) |
| Защита целостности кода | Ограничивает загрузку изображений, подписанных Корпорацией Майкрософт, WHQL или более высокими. Может дополнительно разрешить Microsoft Store подписанные изображения. | Только на уровне приложений | ![Проверка знака да](/security/defender-endpoint/images/svg/check-yes) |
| Отключить точки расширения | Отключает различные механизмы размежевания, которые позволяют впрыскивание DLL во все процессы, такие как DLLs AppInit, оконные крючки и поставщики услуг Winsock. | Только на уровне приложений | ![Проверка знака нет](/security/defender-endpoint/images/svg/check-no) |
| Отключить системные вызовы Win32k | Не позволяет приложению использовать таблицу вызовов системы Win32k. | Только на уровне приложений | ![Проверка знака да](/security/defender-endpoint/images/svg/check-yes) |
| Не разрешайте детские процессы | Не позволяет приложению создавать детские процессы. | Только на уровне приложений | ![Проверка знака да](/security/defender-endpoint/images/svg/check-yes) |
| Фильтрация адресов экспорта (EAF) | Обнаруживает опасные операции, разрешаемые вредоносным кодом. Может дополнительно проверять доступ к модулям, часто используемым эксплойтами. | Только на уровне приложений | ![Проверка знака да](/security/defender-endpoint/images/svg/check-yes) |
| Фильтрация адресов импорта (IAF) | Обнаруживает опасные операции, разрешаемые вредоносным кодом. | Только на уровне приложений | ![Проверка знака да](/security/defender-endpoint/images/svg/check-yes) |
| Имитация выполнения (SimExec) | Гарантирует, что вызовы конфиденциальных API возвращаются законным звонителям. Настраивается только для 32-битных (x86) приложений. Несовместимо с ACG | Только на уровне приложений | ![Проверка знака да](/security/defender-endpoint/images/svg/check-yes) |
| Проверка вызова API (CallerCheck) | Гарантирует, что конфиденциальные API вызываются законными звонителями. Настраивается только для 32-битных (x86) приложений. Несовместимо с ACG | Только на уровне приложений | ![Проверка знака да](/security/defender-endpoint/images/svg/check-yes) |
| Проверка использования дескриптора | Вызывает исключение, которое будет поднято на любые ссылки на недействительные ручки. | Только на уровне приложений | ![Проверка знака нет](/security/defender-endpoint/images/svg/check-no) |
| Проверка целостности зависимостей изображения | Обеспечивает выполнение подписи кода для Windows загрузки зависимостей изображений. | Только на уровне приложений | ![Проверка знака нет](/security/defender-endpoint/images/svg/check-no) |
| Проверка целостности стека (StackPivot) | Гарантирует, что стек не был перенаправлен для конфиденциальных API. Несовместимо с ACG | Только на уровне приложений | ![Проверка знака да](/security/defender-endpoint/images/svg/check-yes) |


> [!IMPORTANT]
> Если вы добавите  приложение в раздел Параметры программы и настроите там отдельные параметры смягчения, они будут соблюдаться выше конфигурации для тех же смягчений, указанных в разделе **Параметры** системы. В следующей матрице и примерах показано, как работают по умолчанию:
>
>
> | Включено в **параметрах программы** | Включено в **параметрах System** | Поведение |
> | ------------------------------- | ------------------------------ | -------- |
> | ![Проверка знака да](/security/defender-endpoint/images/svg/check-yes) | ![Проверка знака нет](/security/defender-endpoint/images/svg/check-no) | Как определено в **параметрах программы** |
> | ![Проверка знака да](/security/defender-endpoint/images/svg/check-yes) | ![Проверка знака да](/security/defender-endpoint/images/svg/check-yes) | Как определено в **параметрах программы** |
> | ![Проверка знака нет](/security/defender-endpoint/images/svg/check-no) | ![Проверка знака да](/security/defender-endpoint/images/svg/check-yes) | Как определено в **параметрах System** |
> | ![Проверка знака нет](/security/defender-endpoint/images/svg/check-no) | ![Проверка знака да](/security/defender-endpoint/images/svg/check-yes) | По умолчанию, как определено в **параметре Использование по умолчанию** |
>
>
>
> * **Пример 1**
>
>    Mikael настраивает предотвращение выполнения данных **(DEP)** в разделе **Параметры** системы для **отключения по умолчанию.**
>
>    Затем Микаэль добавляет приложение *test.exe* в раздел **Параметры** программы. В параметрах этого приложения в статье Предотвращение выполнения данных **(DEP)** он включает параметр параметры системы **Override** и задает переключатель **На**. В разделе Параметры программы не указаны **другие** приложения.
>
>    В результате deP будет включен только *для* test.exe. Все другие приложения не будут применяться к DEP.
>
>
> * **Пример 2**
>
>    Josie настраивает предотвращение выполнения данных **(DEP)** в разделе **Параметры** системы, которые будут **отключены по умолчанию.**
>
>    Затем Джози добавляет приложение *test.exe* в раздел **Параметры** программы. В параметрах для этого приложения в статье Предотвращение выполнения данных **(DEP)** она включает параметр параметры системы **Override** и задает переключатель **На**.
>
>    Джози также добавляет *приложениеmiles.exe* в  раздел Параметры программы и настраивает службу управления потоком **(CFG)** в **On**. Она не включает **параметры** системы Переопределения для DEP или любые другие меры по смягчению последствий для этого приложения.
>
>    В результате deP будет включен для *test.exe.* DEP не будет включен для любого другого приложения, включая *miles.exe*. CFG будет включен для *miles.exe*.

> [!NOTE]
> Если вы нашли какие-либо проблемы в этой статье, вы можете сообщить об этом непосредственно партнеру Windows Server/Windows или использовать номера технической поддержки Майкрософт для вашей страны.

### <a name="configure-system-level-mitigations-with-the-windows-security-app"></a>Настройка системных смягчений с помощью приложения Безопасность Windows

1. Откройте приложение Безопасность Windows, выбрав значок щита в панели задач или нажав меню пусков для **Defender.**

2. Выберите **плитку управления &** браузера (или значок приложения в левой панели меню), а затем выберите **защиту exploit.**

3. В разделе **Параметры системы** найдите смягчение, необходимое для настройки, и выберите один из следующих. Приложения, которые не настроены по отдельности в разделе **Параметры** программы, будут использовать параметры, настроенные здесь:
   * **По умолчанию** — смягчение  включено для приложений, которые не имеют этого набора смягчения в разделе параметры программы, определенные **для приложения.**
   * **Отключено** по умолчанию .  Смягчение отключено для приложений, которые не имеют этого набора смягчения в разделе параметры программы для **определенных приложений.**
   * **Использование по** умолчанию . Смягчение может быть включено или отключено в зависимости от конфигурации по умолчанию, Windows 10 установки; значение по умолчанию **(On** or **Off)** всегда указывается рядом со меткой **Использование** по умолчанию для каждого смягчения

   > [!NOTE]
   > При изменении некоторых параметров может появиться окно управления учетной записью пользователя. Введите учетные данные администратора, чтобы применить этот параметр.

   Изменение некоторых параметров может потребовать перезапуска.

4. Повторите это для всех системных смягчений, которые необходимо настроить.

5. Перейдите в **раздел Параметры программы** и выберите приложение, которое необходимо применить к:

   1. Если приложение, которое нужно настроить, уже перечислены, выберите его и выберите **Изменить**
   2. Если приложение не указано, в верхней части списка выберите программу **Добавить** для настройки, а затем выберите, как добавить приложение:
      * Используйте **Add по имени программы,** чтобы смягчение было применено к любому запущенного процесса с этим именем. Необходимо указать файл с расширением. Вы можете ввести полный путь, чтобы ограничить смягчение только приложение с этим именем в этом расположении.
      * Используйте **выберите точный путь** к файлу, чтобы использовать стандартное окно Windows выбора файлов Explorer для поиска и выбора нужного файла.

6. После выбора приложения вы увидите список всех смягчающих последствий, которые можно применить. Чтобы включить смягчение, выберите шажок, а затем измените ползунок **на On**. Выберите дополнительные параметры. Выбор **аудита** будет применяться только в режиме аудита. Вы будете уведомлены о необходимости перезапустить процесс или приложение или перезапустить Windows.

7. Повторите эти действия для всех приложений и смягчения последствий, которые необходимо настроить. Выберите **Применить,** когда вы закончили настройку конфигурации.

Теперь вы можете [экспортировать эти параметры в качестве XML-файла](import-export-exploit-protection-emet-xml.md) или продолжить настройку специальных приложений для смягчения последствий.

Экспорт конфигурации в виде XML-файла позволяет скопировать конфигурацию с одного устройства на другие устройства.

## <a name="powershell-reference"></a>Справка PowerShell

Вы можете использовать приложение Безопасность Windows для настройки защиты от эксплойтов, или можно использовать cmdlets PowerShell.

Параметры конфигурации, которые были недавно изменены, всегда будут применяться независимо от того, используете ли вы PowerShell или Безопасность Windows. Это означает, что если вы используете приложение для настройки смягчения, затем используйте PowerShell для настройки того же смягчения, приложение будет обновляться, чтобы показать изменения, внесенные в PowerShell. Если вы должны были затем использовать приложение, чтобы изменить смягчение снова, это изменение будет применяться.

> [!IMPORTANT]
> Любые изменения, развернутые на устройстве с помощью групповой политики, переопределяют локализованную конфигурацию. При настройке начальной конфигурации используйте устройство, на которое не будет применена конфигурация групповой политики, чтобы не переопределять изменения.

Вы можете использовать глагол PowerShell `Get` или `Set` с помощью `ProcessMitigation` команды. Использование будет перечислять текущее состояние конфигурации любых смягчений, которые были включены на устройстве - добавьте `Get` cmdlet и exe приложения, чтобы увидеть смягчения только для `-Name` этого приложения:

```PowerShell
Get-ProcessMitigation -Name processName.exe
```

> [!IMPORTANT]
> Не настроенные на системном уровне меры по смягчению последствий будут показывать состояние `NOTSET` .
>
> Для параметров системного уровня указывается параметр по умолчанию для этого `NOTSET` смягчения.
>
> Для параметров уровня приложения указывается, что параметр системного уровня для смягчения будет `NOTSET` применен.
>
> Параметр по умолчанию для каждого смягчения на уровне системы можно увидеть в Безопасность Windows.

Используйте `Set` для настройки каждого смягчения в следующем формате:

```PowerShell
Set-ProcessMitigation -<scope> <app executable> -<action> <mitigation or options>,<mitigation or options>,<mitigation or options>
```

Где:

* \<Scope>:
    * `-Name` чтобы указать, какие меры по смягчению последствий должны применяться к определенному приложению. Укажите исполняемое приложение после этого флага.
    * `-System` чтобы указать, что смягчение должно применяться на уровне системы
- \<Action>:
    * `-Enable` чтобы включить смягчение
    * `-Disable` отключение смягчения
* \<Mitigation>:
    * Комлет смягчения, как определено в [](#cmdlets-table) таблице смлетов смягчения ниже, наряду с любыми подопциями (в окружении пробелов). Каждое смягчение разделено запятой.

Например, чтобы включить смягчение меры по предотвращению выполнения данных (DEP) с помощью эмуляции thunk ATL и для исполняемого под названием *testing.exe* в папке *C:\Apps\LOB\tests,* а также предотвратить создание детских процессов, необходимо использовать следующую команду:

```PowerShell
Set-ProcessMitigation -Name c:\apps\lob\tests\testing.exe -Enable DEP, EmulateAtlThunks, DisallowChildProcessCreation
```

> [!IMPORTANT]
> Разделите каждый вариант смягчения с запятой.

Если вы хотите применить DEP на уровне системы, вы используете следующую команду:

```PowerShell
Set-Processmitigation -System -Enable DEP
```

Чтобы отключить смягчение последствий, можно `-Enable` заменить `-Disable` . Однако для смягчения последствий на уровне приложений это заставит отключить смягчение только для этого приложения.

Если требуется восстановить смягчение до системного по умолчанию, необходимо также включить этот список, как в `-Remove` следующем примере:

```PowerShell
Set-Processmitigation -Name test.exe -Remove -Disable DEP
```

Вы также можете настроить некоторые меры по смягчению последствий для режима аудита. Вместо того, чтобы использовать для смягчения эту меру, используйте комлет режима Аудита, как указано в таблице смдлетов по смягчению последствий.  [](#cmdlets-table)

Например, чтобы включить произвольный код Guard (ACG) *в* режиме аудита для используемой ранееtesting.exe, необходимо использовать следующую команду:

```PowerShell
Set-ProcessMitigation -Name c:\apps\lob\tests\testing.exe -Enable AuditDynamicCode
```

Режим аудита можно отключить, используя ту же команду, но заменив `-Enable` `-Disable` .

### <a name="powershell-reference-table"></a>Справочная таблица PowerShell

В этой таблице перечислены cmdlets PowerShell (и связанный с ним режим аудита), которые можно использовать для настройки каждого смягчения.

<a id="cmdlets-table"></a>

| Устранение рисков | Область применения | Командлеты PowerShell | Комлет режима аудита |
| ---------- | ---------- | ------------------ | ----------------- |
| Диспетчерская система потока (CFG) | Системный и app-level |   CFG, StrictCFG, SuppressExports  | Аудит не доступен |
| Предотвращение выполнения данных (DEP) | Системный и app-level |   DEP, EmulateAtlThunks  | Аудит не доступен |
| Принудительный случайный выбор изображений (обязательный ASLR) | Системный и app-level |   ForceRelocateImages  | Аудит не доступен |
| Случайные выделения памяти (ASLR снизу вверх) | Системный и app-level |   BottomUp, HighEntropy  | Аудит не доступен |
| Проверка цепочек исключений (SEHOP) | Системный и app-level |   SEHOP, SEHOPTelemetry  | Аудит не доступен |
| Проверка целостности кучи | Системный и app-level |   TerminateOnError  | Аудит не доступен |
| Механизм Arbitrary code guard (ACG) | Только на уровне приложений |   DynamicCode  |   AuditDynamicCode |
| Блокировать изображений с низкой целостностью | Только на уровне приложений |   BlockLowLabel  |   AuditImageLoad |
| Блокировать удаленные изображения | Только на уровне приложений |   BlockRemoteImages  | Аудит не доступен |
| Блокировка ненадежные шрифты | Только на уровне приложений |   ОтключениеNonSystemFonts  |   AuditFont, FontAuditOnly |
| Защита целостности кода | Только на уровне приложений |   BlockNonMicrosoftSigned, AllowStoreSigned  |   AuditMicrosoftSigned, AuditStoreSigned |
| Отключить точки расширения | Только на уровне приложений |   ExtensionPoint  | Аудит не доступен |
| Отключить системные вызовы Win32k | Только на уровне приложений |   DisableWin32kSystemCalls  |   AuditSystemCall |
| Не разрешать дочерние процессы | Только на уровне приложений |   DisallowChildProcessCreation  |   AuditChildProcess |
| Фильтрация адресов экспорта (EAF) | Только на уровне приложений |   EnableExportAddressFilterPlus, EnableExportAddressFilter <a href="#r1" id="t1"> \[ 1 \] </a> | Аудит не доступен<a href="#r2" id="t2"> \[ 2 \] </a> |
| Фильтрация адресов импорта (IAF) | Только на уровне приложений |   EnableImportAddressFilter  | Аудит не доступен<a href="#r2" id="t2"> \[ 2 \] </a> |
| Имитация выполнения (SimExec) | Только на уровне приложений |   EnableRopSimExec  | Аудит не доступен<a href="#r2" id="t2"> \[ 2 \] </a> |
| Проверка вызова API (CallerCheck) | Только на уровне приложений |   EnableRopCallerCheck  | Аудит не доступен<a href="#r2" id="t2"> \[ 2 \] </a> |
| Проверка использования дескриптора | Только на уровне приложений |   StrictHandle  | Аудит не доступен |
| Проверка целостности зависимостей изображения | Только на уровне приложений |   EnforceModuleDepencySigning  | Аудит не доступен |
| Проверка целостности стека (StackPivot) | Только на уровне приложений |   EnableRopStackPivot  | Аудит не доступен<a href="#r2" id="t2"> \[ 2 \] </a> |

<a href="#t1" id="r1"> \[ 1. \] </a>Используйте следующий формат, чтобы включить модули EAF для dlls для процесса:

```PowerShell
Set-ProcessMitigation -Name processName.exe -Enable EnableExportAddressFilterPlus -EAFModules dllName1.dll,dllName2.dll
```

<a href="#t2" id="r2"> \[ 2. \] </a>Аудит для этого смягчения не доступен с помощью cmdlets PowerShell.

## <a name="customize-the-notification"></a>Настройка уведомления

Дополнительные сведения о настройке уведомления при запуске правила и блокировке приложения или файла см. в [Безопасность Windows.](/windows/security/threat-protection/windows-defender-security-center/windows-defender-security-center#customize-notifications-from-the-windows-defender-security-center)

## <a name="see-also"></a>См. также:

* [Защита устройств от эксплойтов](exploit-protection.md)
* [Оценка защиты от эксплойтов](evaluate-exploit-protection.md)
* [Включить защиту от эксплойтов](enable-exploit-protection.md)
* [Импорт, экспорт и развертывание конфигураций защиты от эксплойтов](import-export-exploit-protection-emet-xml.md)
