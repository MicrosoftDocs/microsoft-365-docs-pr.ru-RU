---
title: Исследование сущностями на устройствах с использованием живого ответа в Microsoft Defender для endpoint
description: Доступ к устройству с использованием безопасного удаленного подключения к оболочке для следственных действий и немедленного реагирования на устройство в режиме реального времени.
keywords: удаленный, оболочка, подключение, живой, ответ, в режиме реального времени, команда, сценарий, исправление, охота, экспорт, журнал, падение, скачивание, файл,
search.product: eADQiWindows 10XVcnh
search.appverid: met150
ms.prod: m365-security
ms.mktglfcycl: deploy
ms.sitesec: library
ms.pagetype: security
ms.author: macapara
author: mjcaparas
localization_priority: Normal
manager: dansimp
audience: ITPro
ms.collection: M365-security-compliance
ms.topic: article
ms.technology: mde
ms.openlocfilehash: d5e48f1e4f6bc2cfaa836d90e24f2ce8ba3f2114
ms.sourcegitcommit: 4fb1226d5875bf5b9b29252596855a6562cea9ae
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/08/2021
ms.locfileid: "52845334"
---
# <a name="investigate-entities-on-devices-using-live-response"></a>Исследование сущностями на устройствах с использованием живого ответа

[!INCLUDE [Microsoft 365 Defender rebranding](../../includes/microsoft-defender.md)]

**Область применения:**
- [Microsoft Defender для конечной точки](https://go.microsoft.com/fwlink/p/?linkid=2154037)
- [Microsoft 365 Defender](https://go.microsoft.com/fwlink/?linkid=2118804)


> Хотите испытать Defender для конечной точки? [Зарегистрився для бесплатной пробной.](https://www.microsoft.com/microsoft-365/windows/microsoft-defender-atp?ocid=docs-wdatp-investigateip-abovefoldlink)

Живой ответ предоставляет группам операций безопасности мгновенный доступ к устройству (также именуемого машиной) с помощью удаленного подключения к оболочке. Это позволяет вам делать углубленные следственные действия и принимать срочные меры реагирования для оперативного сдерживания выявленных угроз в режиме реального времени. 

Live response предназначен для повышения эффективности расследований, позволяя группе операций безопасности собирать судебные данные, запускать сценарии, отправлять подозрительные объекты для анализа, устранения угроз и активной охоты на возникающие угрозы.<br/><br/>

> [!VIDEO https://www.microsoft.com/videoplayer/embed/RE4qLUW]

При живом отклике аналитики могут выполнять все следующие задачи:
- Запустите базовые и расширенные команды, чтобы выполнить следственные работы на устройстве.
- Скачайте файлы, такие как образцы вредоносных программ и результаты скриптов PowerShell.
- Скачайте файлы в фоновом режиме (новые!).
- Upload powerShell скрипт или исполняемый в библиотеку и запустите его на устройстве с уровня клиента.
- Принять или отменить действия по исправлению.

## <a name="before-you-begin"></a>Прежде чем начать

Прежде чем инициировать сеанс на устройстве, выполните следующие требования:

- **Убедитесь, что вы работаете с поддерживаемой версией Windows.** <br/>
Устройства должны запускать одну из следующих версий Windows

  - **Windows 10**
    - [Версия 1909 или](/windows/whats-new/whats-new-windows-10-version-1909) более поздней версии  
    - [Версия 1903 с](/windows/whats-new/whats-new-windows-10-version-1903) [KB4515384](https://support.microsoft.com/en-us/help/4515384/windows-10-update-kb4515384)
    - [Версия 1809 (RS 5)](/windows/whats-new/whats-new-windows-10-version-1809) с [KB4537818](https://support.microsoft.com/help/4537818/windows-10-update-kb4537818)
    - [Версия 1803 (RS 4)](/windows/whats-new/whats-new-windows-10-version-1803) с [KB4537795](https://support.microsoft.com/help/4537795/windows-10-update-kb4537795)
    - [Версия 1709 (RS 3)](/windows/whats-new/whats-new-windows-10-version-1709) с [KB4537816](https://support.microsoft.com/help/4537816/windows-10-update-kb4537816)
  
  - **Windows Server 2019 — применимо только для предварительного просмотра для общего просмотра**
    - Версия 1903 или (с [KB4515384)](https://support.microsoft.com/en-us/help/4515384/windows-10-update-kb4515384)позже 
    - Версия 1809 (с [KB4537818)](https://support.microsoft.com/en-us/help/4537818/windows-10-update-kb4537818)

- **Включить живой ответ со страницы расширенных параметров.**<br>
Необходимо включить функцию живого ответа на странице [Параметры расширенных функций.](advanced-features.md)

    >[!NOTE]
    >Изменить эти параметры могут только пользователи, у которых есть роли администратора безопасности или глобального администратора.

- **Включить живой ответ для серверов со страницы расширенных параметров** (рекомендуется).<br>

    >[!NOTE]
    >Изменить эти параметры могут только пользователи, у которых есть роли администратора безопасности или глобального администратора.
    
- **Убедитесь, что на устройстве** назначен уровень восстановления автоматизации.<br>
Необходимо включить, по крайней мере, минимальный уровень восстановления для данной группы устройств. В противном случае вы не сможете установить сеанс Live Response для члена этой группы.

    Вы получите следующую ошибку:

    ![Изображение сообщения об ошибке](images/live-response-error.png)

- **Включить живое выполнение сценария** без подписи ответа (необязательный). <br>

    >[!WARNING]
    >Разрешение использования неподписаных скриптов может повысить подверженность угрозам.
 
  Не рекомендуется запускать неподписаные скрипты, так как это может повысить подверженность угрозам. Однако если их необходимо использовать, необходимо включить параметр на странице [Расширенные параметры функций.](advanced-features.md)
    
- **Убедитесь, что у вас есть соответствующие разрешения.**<br>
    Инициировать сеанс могут только пользователи, которые получили соответствующие разрешения. Дополнительные сведения о назначениях ролей см. в дополнительных сведениях [о создании и управлении ролями.](user-roles.md) 

    > [!IMPORTANT]
    > Возможность отправки файла в библиотеку доступна только тем, у кого есть соответствующие разрешения RBAC. Кнопка серым цветом для пользователей с только делегированными разрешениями.

    В зависимости от роли, предоставленной вам, можно запускать базовые или расширенные команды живого ответа. Разрешения пользователей контролируются настраиваемой ролью RBAC. 

## <a name="live-response-dashboard-overview"></a>Обзор панели мониторинга ответов в прямом эфире
Когда вы инициируете сеанс живого ответа на устройстве, откроется панель мониторинга. Панель мониторинга предоставляет сведения о сеансе, такие как следующие: 

- Кто сеанса
- Когда сеанс начался
- Продолжительность сеанса

Панель мониторинга также предоставляет вам доступ к:
- Завершить сеанс.
- Upload файлы в библиотеку 
- Консоль команд
- Журнал команд


## <a name="initiate-a-live-response-session-on-a-device"></a>Инициировать сеанс живого ответа на устройстве 

1. Во входе в Центр безопасности в Microsoft Defender.

2. Перейдите на страницу списка устройств и выберите устройство для исследования. Откроется страница устройств.

3. Запустите сеанс живого ответа, выбрав **сеанс инициировать сеанс живого ответа.** Отображается командная консоль. Подождите, пока сеанс подключается к устройству.

4. Используйте встроенные команды для следственных действий. Дополнительные сведения см. в [live response commands.](#live-response-commands)

5. После завершения расследования выберите сеанс **Отключение,** а затем выберите **Подтвердите.**

## <a name="live-response-commands"></a>Команды ответа в прямом эфире

В зависимости от роли, предоставленной вам, можно запускать базовые или расширенные команды живого ответа. Разрешения пользователей контролируются пользовательскими ролями RBAC. Дополнительные сведения о назначениях ролей см. в дополнительных сведениях [о создании и управлении ролями.](user-roles.md) 


>[!NOTE]
>Live response — это облачная интерактивная оболочка, так как в зависимости от качества сети и системной нагрузки между конечным пользователем и целевым устройством время отклика может различаться.

### <a name="basic-commands"></a>Основные команды

Следующие команды доступны для ролей пользователей, которые могут выполнять базовые команды **живого** ответа. Дополнительные сведения о назначениях ролей см. в дополнительных сведениях [о создании и управлении ролями.](user-roles.md) 

| Команда | Описание |
|---|---|--- |
|`cd` | Изменение текущего каталога. | 
|`cls` | Очищает экран консоли.  |
|`connect` | Инициирует сеанс живого ответа на устройство. |
|`connections` | Отображает все активные подключения. |
|`dir` | Показывает список файлов и подтекстов в каталоге. |
|`drivers` |  Отображает все драйверы, установленные на устройстве. |
|`fg <command ID>` | Поместите указанное задание на переднем плане на переднем плане, что делает его текущим заданием. <br> ПРИМЕЧАНИЕ: fg принимает "командный ID", доступный с рабочих мест, а не с PID |
|`fileinfo` | Получение сведений о файле. |
|`findfile` | Находит файлы с заданным именем на устройстве. |
|`getfile <file_path>` | Скачивает файл. |
|`help` | Предоставляет сведения о справке для команд живого ответа. |
|`jobs` | Показывает в настоящее время запущенные задания, их ID и состояние. |
|`persistence` | Показывает все известные методы сохранения на устройстве. |
|`processes` | Отображает все процессы, запущенные на устройстве. |
|`registry` | Отображает значения реестра. |
|`scheduledtasks` | Отображает все запланированные задачи на устройстве. |
|`services` | Отображает все службы на устройстве. |
|`trace` | Задает режим ведения журнала терминала для отлаживания. |

### <a name="advanced-commands"></a>Расширенные команды
Для ролей пользователей, которые имеют возможность запускать расширенные команды живого ответа, доступны следующие команды.  Дополнительные сведения о назначениях ролей см. в дополнительных сведениях [о создании и управлении ролями.](user-roles.md) 

| Команда | Описание |
|---|---|
| `analyze` | Анализирует объект с различными двигателями инкриминации для вынесения вердикта. |
| `run` | Запускает скрипт PowerShell из библиотеки на устройстве. |
| `library` | Списки файлов, которые были загружены в библиотеку живого ответа. |
| `putfile` | Помещает файл из библиотеки на устройство. Файлы сохраняются в рабочей папке и удаляются при перезапуске устройства по умолчанию. |
| `remediate` | Исправление объекта на устройстве. Действие по исправлению будет отличаться в зависимости от типа объекта:<br>- Файл: удаление<br>- Процесс: остановка, удаление файла изображений<br>- Служба: остановка, удаление файла изображений<br>- Запись реестра: удаление<br>- Запланированная задача: удаление<br>- Элемент папки запуска: удаление файла <br> ПРИМЕЧАНИЕ. Эта команда имеет предпосылок команду. Вы можете использовать команду `-auto` совместно с `remediate` автоматическим запуском необходимой команды. 
|`undo` | Восстанавливает объект, который был исправлен. |


## <a name="use-live-response-commands"></a>Использование команд живого ответа

Команды, которые можно использовать в консоли, придерживаются аналогичных принципов [Windows команд.](/windows-server/administration/windows-commands/windows-commands#BKMK_c)

Расширенные команды предлагают более надежный набор действий, которые позволяют принимать более мощные действия, такие как скачивание и загрузка файла, запуск скриптов на устройстве и действия по исправлению на объекте.

### <a name="get-a-file-from-the-device"></a>Получить файл с устройства

Для сценариев, когда вы хотите получить файл с исследуемой вами устройства, можно использовать `getfile` команду. Это позволяет сохранить файл с устройства для дальнейшего исследования.

>[!NOTE]
>Применяются следующие ограничения размера файла:
>- `getfile` ограничение: 3 ГБ
>- `fileinfo` ограничение: 10 ГБ
>- `library` ограничение: 250 МБ

### <a name="download-a-file-in-the-background"></a>Скачайте файл в фоновом режиме

Чтобы группа операций безопасности продолжила изучение влияния устройства, файлы теперь можно скачивать в фоновом режиме.

- Чтобы скачать файл в фоновом режиме, в командной консоли живого ответа введите `download <file_path> &` .
- Если вы ожидаете скачивания файла, его можно переместить в фоновом режиме с помощью Ctrl + Z.
- Чтобы скачать файл на переднем плане, в командной консоли живого ответа введите `fg <command_id>` .

Ниже приводятся примеры:


|Команда  |Действие  |
|---------|---------|
|`getfile "C:\windows\some_file.exe" &`     |Начинается загрузка файла с *some_file.exe* в фоновом режиме.         |
|`fg 1234`     |Возвращает загрузку с командным ИД *1234* на переднем плане.         |


### <a name="put-a-file-in-the-library"></a>Поместите файл в библиотеку

В живом отклике есть библиотека, в которой можно вложить файлы. В библиотеке хранится файлы (например, сценарии), которые можно запускать в сеансе живого ответа на уровне клиента.

Живой отклик позволяет запускать скрипты PowerShell, однако прежде чем запустить их, необходимо сначала поместить файлы в библиотеку. 

Вы можете иметь коллекцию скриптов PowerShell, которые можно запускать на устройствах, с помощью которые вы инициируете сеансы живого ответа. 

#### <a name="to-upload-a-file-in-the-library"></a>Отправка файла в библиотеку

1. Щелкните **Upload файл в библиотеку.** 

2. Щелкните **Обзор** и выберите файл.

3. Краткое описание.

4. Укажите, хотите ли вы переписать файл с таким же именем.

5. Если вы хотите быть, узнайте, какие параметры необходимы для скрипта, выберите поле для проверки параметров скрипта. В текстовом поле введите пример и описание.

6. Нажмите **кнопку Подтвердить**. 

7. (Необязательный) Чтобы убедиться, что файл был загружен в библиотеку, запустите `library` команду.


### <a name="cancel-a-command"></a>Отмена команды
В любое время во время сеанса можно отменить команду, нажав CTRL + C.  

>[!WARNING]
>Использование этого ярлыка не остановит команду в стороне агента. Он отменит команду только на портале. Таким образом, изменение операций, таких как "исправление", может продолжаться, в то время как команда отменяется. 

## <a name="run-a-powershell-script"></a>Запуск сценария PowerShell 

Прежде чем запустить сценарий PowerShell, сначала необходимо отправить его в библиотеку. 

После отправки сценария в библиотеку используйте команду `run` для запуска сценария.

Если вы планируете использовать неподписаный скрипт в сеансе, необходимо включить параметр на странице [Расширенные параметры функций.](advanced-features.md)

>[!WARNING]
>Разрешение использования неподписаных скриптов может повысить подверженность угрозам.

## <a name="apply-command-parameters"></a>Применение параметров команды

- Просмотр справки консоли, чтобы узнать о параметрах команды. Чтобы узнать об отдельной команде, запустите:
 
    `help <command name>`

- При применении параметров к командам обратите внимание, что параметры обрабатываются на основе фиксированного порядка:
 
    `<command name> param1 param2` 

- При указании параметров за пределами фиксированного порядка укажите имя параметра с дефисом перед предоставлением значения:
 
    `<command name> -param2_name param2`

- При использовании команд с необходимыми командами можно использовать флаги:

    `<command name> -type file -id <file path> - auto` или `remediate file <file path> - auto`.

## <a name="supported-output-types"></a>Поддерживаемые типы выходных данных

Live response поддерживает типы вывода таблицы и формата JSON. Для каждой команды по умолчанию существует выходное поведение. Вы можете изменить выход в предпочтительном формате вывода с помощью следующих команд:

- `-output json`
- `-output table`

>[!NOTE]
>Меньше полей отображается в формате таблицы из-за ограниченного пространства. Чтобы узнать больше о результатах, можно использовать команду вывода JSON, чтобы показать дополнительные сведения.

## <a name="supported-output-pipes"></a>Поддерживаемые выходные трубы

Live response поддерживает выходные трубопроводы в CLI и файл. CLI — это поведение вывода по умолчанию. Вывод можно с помощью следующей команды: [command] > [filename].txt.  

Пример.

```console
processes > output.txt
```

## <a name="view-the-command-log"></a>Просмотр журнала команд

Выберите **вкладку Журнал Команд,** чтобы увидеть команды, используемые на устройстве во время сеанса. Каждая команда отслеживается с полными сведениями, такими как:
- ID
- Командная строка
- Длительность
- Боковая планка состояния и ввода или вывода

## <a name="limitations"></a>Ограничения

- Сеансы живого ответа ограничиваются 25 сеансами живого ответа одновременно.
- Время неактивного сеанса неактивного ответа в прямом эфире составляет 30 минут. 
- Пользователь может инициировать до 10 одновременно сеансов.
- Устройство может быть только в одном сеансе одновременно.
- Применяются следующие ограничения размера файла:
   - `getfile` ограничение: 3 ГБ
   - `fileinfo` ограничение: 10 ГБ
   - `library` ограничение: 250 МБ

## <a name="related-article"></a>Связанная статья
- [Примеры команд Live response](live-response-command-examples.md)
