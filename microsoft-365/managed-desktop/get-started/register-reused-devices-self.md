---
title: Самостоятельная регистрация существующих устройств
description: Зарегистрируйте повторноиспользованые устройства, которыми вы, возможно, уже управляете, чтобы ими могли управлять компьютеры, управляемые Майкрософт
ms.prod: w10
author: jaimeo
f1.keywords:
- NOCSH
ms.author: jaimeo
ms.localizationpriority: medium
ms.openlocfilehash: c2ba687b38f1de4d2ed09b0bd690e02b43f15f8d
ms.sourcegitcommit: 83a40facd66e14343ad3ab72591cab9c41ce6ac0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/13/2021
ms.locfileid: "49840519"
---
# <a name="register-existing-devices-yourself"></a>Самостоятельная регистрация существующих устройств

>[!NOTE]
>В этом разделе описаны действия, которые необходимо предпринять для повторного использования уже у вас устройств и их регистрации на компьютере, управляемом Майкрософт. Если вы работаете с совершенно новыми устройствами, самостоятельно выполните действия, которые необходимо предпринять при регистрации новых устройств на компьютерах, управляемых [Майкрософт.](register-devices-self.md)

Процесс регистрации устройств для партнеров описан в шагах для [партнеров.](register-devices-partner.md)

Компьютеры, управляемые Майкрософт, могут работать с совершенно новыми устройствами или вы можете повторно использовать устройства, которые у вас уже есть (для этого потребуется их повторное использование). Устройства можно зарегистрировать на портале Microsoft Endpoint Manager.

## <a name="prepare-to-register-existing-devices"></a>Подготовка к регистрации существующих устройств


Чтобы зарегистрировать существующие устройства, выполните следующие действия.

1. [Получите аппаратный hash для каждого устройства.](#obtain-the-hardware-hash)
2. [Объединение данных с hash](#merge-hash-data)
3. [Зарегистрируйте устройства на компьютере, управляемом Майкрософт.](#register-devices-by-using-the-admin-portal)
4. [Убедитесь, что изображение правильное.](#check-the-image)
5. [Доставка устройства](#deliver-the-device)

### <a name="obtain-the-hardware-hash"></a>Получение аппаратного hash

Компьютер, управляемый Майкрософт, идентифицирует каждое устройство уникальным образом, ссылаясь на его аппаратный hash. У вас есть четыре варианта получения этих сведений с уже использующихся устройств:

- Задайте поставщику оборудования файл регистрации AutoPilot, который будет включать в себя аппаратные хеши.
- Сбор сведений в [Microsoft Endpoint Configuration Manager.](#microsoft-endpoint-configuration-manager)
- Запустите Windows PowerShell с помощью [Active Directory](#active-directory-powershell-script-method) [](#manual-powershell-script-method) или вручную на каждом устройстве и соберите результаты в файле.
- Запустите каждое устройство, но не завершите настройку Windows, и соберите хеши на [съемный флэш-накопитель.](#flash-drive-method)

#### <a name="microsoft-endpoint-configuration-manager"></a>Microsoft Endpoint Configuration Manager

С помощью Microsoft Endpoint Configuration Manager вы можете собирать хеши оборудования с существующих устройств, которые необходимо зарегистрировать на компьютере, управляемом Майкрософт.

> [!IMPORTANT]
> Все устройства, для которые вы хотите получить эти сведения, должны работать под управлением Windows 10 версии 1703 или более поздней. 

Если вы выполнили все эти условия, вы можете собрать информацию, вы выполнили следующие действия:

1. В консоли Configuration Manager выберите **"Мониторинг".** 
2. В рабочей области мониторинга разоберем узел **"Отчеты",** **"Отчеты"** и выберите узел **"Оборудование — общие".** 
3. Запустите отчет, **сведения об устройстве Windows Autopilot** и просмотрете результаты.
4. В представлении отчета выберите **значок** "Экспорт" и выберите **параметр CSV (через запятую).**
5. После сохранения файла вам потребуется отфильтровать результаты только на тех устройствах, которые вы планируете зарегистрировать на компьютере, управляемом Майкрософт, и отправить данные на компьютер, управляемый Майкрософт. Откройте Microsoft Endpoint Manager и перейдите в **меню** "Устройства", найдите раздел "Компьютеры, управляемые Майкрософт" и выберите **"Устройства".** Выберите **+Регистрация устройств,** что открывает окно регистрации новых устройств.


Дополнительные [сведения о регистрации устройств](#register-devices-by-using-the-admin-portal) можно найти на портале администрирования.


#### <a name="active-directory-powershell-script-method"></a>Метод скрипта Active Directory PowerShell

В среде Active Directory с помощью powerShell можно удаленно собирать информацию с устройств в группах Active Directory с `Get-WindowsAutoPilotInfo` помощью WinRM. Вы также можете использовать этотлет и получить отфильтрованные результаты для определенного имени аппаратной модели, `Get-AD Computer` включенного в каталог. Прежде чем продолжить, сначала подтвердим эти предварительные условия, а затем вы сможете перейти к указанным далее шагам.

- WinRM включен.
- Устройства, которые вы хотите зарегистрировать, активны в сети (то есть они не отключены или отключены).
- Убедитесь, что у вас есть параметр учетных данных домена, который имеет разрешение на удаленное выполнение на устройствах.
- Убедитесь, что брандмауэр Windows разрешает доступ к WMI. Для этого выполните следующие действия:

    1. Откройте панель **Защитник Windows брандмауэра** и выберите "Разрешить приложение или функцию **через брандмауэр Защитник Windows брандмауэра".**
    
    2. Найдите **инструментарий управления Windows (WMI)** в списке, в качестве частного и открытого, а затем выберите **"ОК".**

1.  Откройте запрос PowerShell с правами администратора.

2.  Запустите *один из* этих сценариев:

    ```powershell
    Install-script -name Get-WindowsAutoPilotInfo 
    #example one – leverage Get-ADComputer to enumerate devices 
    Get-ADComputer -filter * | powershell -ExecutionPolicy Unrestricted Get-WindowsAutoPilotInfo.ps1 -credential Domainname\<accountname>
    ```

    ```powershell 
    #example two – target specific devices: 
    Set-ExecutionPolicy powershell -ExecutionPolicy Unrestricted Get-WindowsAutoPilotInfo.ps1 -credential Domainname\<accountname> -Name Machine1,Machine2,Machine3
    ```

3. Доступ к каталогам, в которых могут быть записи для устройств. Удалите записи для каждого устройства из *всех* каталогов, включая доменные службы Windows Server Active Directory и Azure Active Directory. Следует помнить, что процесс полного удаления может занять несколько часов.

4. Службы управления доступом, в которых могут быть записи для устройств. Удалите записи для  каждого устройства из всех служб управления, включая Microsoft Endpoint Configuration Manager, Microsoft Intune и Windows Autopilot. Следует помнить, что процесс полного удаления может занять несколько часов.

Теперь вы можете зарегистрировать [устройства.](#register-devices-by-using-the-admin-portal)

#### <a name="manual-powershell-script-method"></a>Метод скрипта PowerShell вручную

1.  Откройте запрос PowerShell с правами администратора.
2.  Run `Install-Script -Name Get-WindowsAutoPilotInfo`
3.  Run `powershell -ExecutionPolicy Unrestricted Get-WindowsAutoPilotInfo -OutputFile <path>\hardwarehash.csv`
4. [Объединение данных с hash.](#merge-hash-data)

#### <a name="flash-drive-method"></a>Метод Флэш-накопителя

1. Вставьте USB-накопитель на устройство, которое не регистрируется.
2. Откройте запрос PowerShell с правами администратора.
3. Run `Save-Script -Name Get-WindowsAutoPilotInfo -Path <pathToUsb>`
4. Включите устройство, которое вы регистрируете, *но не запускайте настройку.* Если вы случайно запустите установку, вам придется сбросить устройство или сделать его повторно.
5. Вставьте USB-накопитель и нажмите shift + F10.
6. Откройте запрос PowerShell с правами администратора и запустите `cd <pathToUsb>` .
7. Run `Set-ExecutionPolicy -ExecutionPolicy Unrestricted`
8. Run `.\Get-WindowsAutoPilotInfo -OutputFile <path>\hardwarehash.csv`
9. Удалите USB-накопитель, а затем выключите устройство, загонив `shutdown -s -t 0`
10. [Объединение данных с hash.](#merge-hash-data)

>[!IMPORTANT]
>Не велись на устройстве, которое вы регистрируете снова, пока не завершите регистрацию для него. 



### <a name="merge-hash-data"></a>Объединение данных с hash

Если вы собрали данные об оборудовании с помощью ручного метода PowerShell или флэш-накопителя, для завершения регистрации необходимо объединить данные в CSV-файлах в один файл. Вот пример скрипта PowerShell, который утестит его.

```powershell
Import-CSV -Path (Get-ChildItem -Filter *.csv) | ConvertTo-Csv -NoTypeInformation | % {$_.Replace('"', '')} | Out-File .\aggregatedDevices.csv
```

После слияния данных с помощью hash в один CSV-файл вы можете зарегистрировать [устройства.](#register-devices-by-using-the-admin-portal)


#### <a name="register-devices-by-using-the-admin-portal"></a>Регистрация устройств с помощью портала администрирования

В [Microsoft Endpoint Manager](https://endpoint.microsoft.com/)выберите **"Устройства"** в левой области навигации. Наберем раздел меню "Управляемые Майкрософт компьютеры" и выберите **"Устройства".** В рабочей области "Управляемые настольными устройствами Майкрософт" выберите **+зарегистрируйте** устройства, после чего откроется окно регистрации новых устройств.

<!-- Update with new picture [![Fly-in after selecting Register devices, listing devices with columns for assigned users, serial number, status, last-seen date, and age](../../media/new-registration-ui.png)](../../media/new-registration-ui.png) -->


<!--Registering any existing devices with Managed Desktop will completely re-image them; make sure you've backed up any important data prior to starting the registration process.-->


Выполните приведенные ниже действия.

1. При **отправке файла** ука между файлами у вас есть путь к ранее созданному CSV-файлу.

1. Выберите **"Регистрация устройств".** Система добавит устройства в список устройств в blade **"Устройства"** с пометкой "Ожидание **регистрации".** Регистрация обычно занимает менее 10 минут, и при  успешном запуске устройство будет показываться как готовое к использованию пользователем.


Вы можете отслеживать ход регистрации устройств на главной странице. Возможные состояния, о них сообщается:

| Состояние | Описание |
|---------------|-------------|
| Ожидающих регистрации | Регистрация еще не завершена. Проверьте позже. |
| Сбой регистрации | Не удалось завершить регистрацию. Дополнительные [сведения об устранении неполадок регистрации](#troubleshooting-device-registration) устройств. |
| Готово для пользователя | Регистрация была успешной, и теперь устройство готово к доставке пользователю. Компьютеры, управляемые Майкрософт, будут проходить их первую подготовку, поэтому нет необходимости в дальнейших подготовительные процессы. |
| Активное | Устройство доставлено пользователю и зарегистрировано в клиенте. Это также означает, что они регулярно используют устройство. |
| Неактивный | Устройство доставлено пользователю и зарегистрировано в клиенте. Однако они не использовали устройство в последнее время (за последние 7 дней).  | 

#### <a name="troubleshooting-device-registration"></a>Устранение неполадок регистрации устройств

| Сообщение об ошибке | Сведения |
|---------------|-------------|
| Устройство не найдено | Нам не удалось зарегистрировать это устройство, так как нам не удалось найти соответствие для предоставленного производителя, модели или серийного номера. Подтвердите эти значения у поставщика устройства. |
| Не является допустимым аппаратный hash | Аппаратный hash, предоставленный для этого устройства, был отформатирован неправильно. Дважды проверьте аппаратный hash и затем повторно откройте его. |
| Устройство уже зарегистрировано | Это устройство уже зарегистрировано в вашей организации. Дальнейшие действия не требуются. |
| Устройство, заявленное другой организацией | Это устройство уже было заявлено другой организацией. Обратитесь к поставщику устройства. |
| Непредвиденная ошибка | Не удалось автоматически обработать запрос. Обратитесь в службу поддержки ИД запроса: <requestId> |

### <a name="check-the-image"></a>Проверка изображения

Если ваше устройство пришло от партнера microsoft Managed Desktop, образ должен быть правильным.

При желании вы также можете применить образ самостоятельно. Для начала обратитесь к представителю Майкрософт, с помощью который вы работаете, и он предоставит вам расположение и действия для применения образа.

### <a name="deliver-the-device"></a>Доставка устройства

> [!IMPORTANT]
> Перед тем как передать устройство пользователю, убедитесь, что вы получили и применили соответствующие [лицензии](../get-ready/prerequisites.md) для этого пользователя.

Если применяются все лицензии, вы можете подготовить пользователей к использованию [устройств,](get-started-devices.md)а затем пользователь сможет запустить устройство и перейти к настройке Windows.









