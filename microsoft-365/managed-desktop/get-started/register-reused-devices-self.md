---
title: Самостоятельная регистрация существующих устройств
description: Регистрация повторно используемых устройств. возможно, у вас уже есть права для управления на настольном компьютере, управляемом Майкрософт
ms.prod: w10
author: jaimeo
f1.keywords:
- NOCSH
ms.author: jaimeo
ms.localizationpriority: medium
ms.openlocfilehash: a9ff0e76448df183ac5c34c5832155e0b135d313
ms.sourcegitcommit: 22dab0f7604cc057a062698005ff901d40771692
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/25/2020
ms.locfileid: "46868997"
---
# <a name="register-existing-devices-yourself"></a>Самостоятельная регистрация существующих устройств

>[!NOTE]
>В этом разделе описываются действия, которые необходимо выполнить, чтобы повторно использовать уже имеющиеся устройства и зарегистрировать их в системе, управляемой корпорацией Майкрософт. Если вы работаете с новыми устройствами, выполните действия, описанные в статье [Регистрация новых устройств на компьютере, управляемом Майкрософт](register-devices-self.md) , вместо этого.

Процесс для партнеров описан в [статье действия для партнеров по регистрации устройств](register-devices-partner.md).

Рабочий стол, управляемый Майкрософт, может работать с новыми устройствами или можно повторно использовать уже имеющиеся устройства (которые потребуют их повторного создания образа). Вы можете зарегистрировать устройства с помощью портала администрирования настольных компьютеров Майкрософт.

## <a name="prepare-to-register-existing-devices"></a>Подготовка к регистрации существующих устройств


Чтобы зарегистрировать существующие устройства, выполните указанные ниже действия.

1. [Получите хеш оборудования для каждого устройства.](#obtain-the-hardware-hash)
2. [Объединение хэш-данных](#merge-hash-data)
3. [Зарегистрируйте устройства на настольном компьютере, управляемом Майкрософт](#register-devices-by-using-the-admin-portal).
4. [Дважды проверьте правильность изображения.](#check-the-image)
5. [Доставка устройства](#deliver-the-device)

### <a name="obtain-the-hardware-hash"></a>Получение хэш-кода оборудования

Рабочий стол, управляемый Майкрософт, определяет каждое устройство уникальным образом, ссылаясь на хэш оборудования. Существует четыре способа получения этой информации с устройств, которые вы уже используете:

- Обратитесь к поставщику поставщика вычислительной техники для файла регистрации для автопилота, в котором будут содержаться хэши оборудования.
- Сбор сведений в [диспетчере конфигураций конечных точек Майкрософт](#microsoft-endpoint-configuration-manager).
- Запустите сценарий Windows PowerShell, используя [Active Directory](#active-directory-powershell-script-method) или [вручную](#manual-powershell-script-method) на каждом устройстве, и соберите результаты в файл.
- Запустите каждое устройство, но не завершите работу с программой установки Windows, и [Соберите хэши на съемном носителе флэш-памяти](#flash-drive-method).

#### <a name="microsoft-endpoint-configuration-manager"></a>Microsoft Endpoint Configuration Manager

С помощью диспетчера конфигураций конечных точек Майкрософт можно собирать аппаратные хэши с существующих устройств, которые вы хотите зарегистрировать с помощью управляемого рабочего стола Майкрософт.

> [!IMPORTANT]
> Все устройства, для которых вы хотите получить эту информацию, должны работать под управлением Windows 10 версии 1703 или более поздней. 

Если вы удовлетворены всеми необходимыми компонентами, вы готовы собрать эти сведения, выполнив указанные ниже действия.

1. В консоли диспетчера конфигураций выберите пункт **мониторинг**. 
2. В рабочей области мониторинга разверните узел **отчеты** , разверните элемент **отчеты**и выберите узел **Общий аппаратный** узел. 
3. Запустите отчет, **сведения об устройствах Windows для автопилота**и просмотрите результаты.
4. В средстве просмотра отчетов выберите значок **Экспорт** и выберите параметр **CSV (с разделителями-запятыми)** .
5. После сохранения файла необходимо отфильтровать результаты только на тех устройствах, которые планируется зарегистрировать с помощью управляемого рабочего стола Майкрософт, и загрузить данные на [портал администрирования](https://aka.ms/mmdportal)настольных компьютеров Майкрософт, выбрав пункт **устройства** в левой области навигации. Выберите **+ Регистрация устройств**; Откроется вспомогательная надстройка:


Для получения дополнительных сведений обратитесь к разделу [Регистрация устройств с помощью портала администрирования](#register-devices-by-using-the-admin-portal) .


#### <a name="active-directory-powershell-script-method"></a>Метод сценария PowerShell Active Directory

В среде Active Directory вы можете использовать `Get-WindowsAutoPilotInfo` командлет PowerShell для удаленного сбора сведений от устройств в группах Active Directory с помощью WinRM. Кроме того, можно использовать `Get-AD Computer` командлеты и получать отфильтрованные результаты для определенных аппаратных имен моделей, включенных в каталог. Для этого сначала подтвердите необходимые условия, а затем выполните действия, описанные ниже.

- Служба WinRM включена.
- Устройства, которые вы хотите зарегистрировать, активны в сети (то есть они не отключены и не отключены).
- Убедитесь, что у вас есть параметр учетных данных домена, у которого есть разрешение на удаленное выполнение на устройствах.
- Убедитесь, что брандмауэр Windows предоставляет доступ к WMI. Для этого выполните указанные ниже действия.

    1. Откройте панель управления **брандмауэром защитника Windows** и выберите пункт **Разрешить приложение или компонент через брандмауэр защитника Windows**.
    
    2. Найдите в списке **инструментарий управления Windows (WMI)** , включите как частный, так и **общедоступный**, а затем нажмите кнопку **ОК**.

1.  Откройте командную строку PowerShell с правами администратора.

2.  Выполните *один* из следующих сценариев:

    ```powershell
    Install-script -name Get-WindowsAutoPilotInfo 
    #example one – leverage Get-ADComputer to enumerate devices 
    Get-ADComputer -filter * | powershell -ExecutionPolicy Unrestricted Get-WindowsAutoPilotInfo.ps1 -credential Domainname\<accountname>
    ```

    ```powershell 
    #example two – target specific devices: 
    Set-ExecutionPolicy powershell -ExecutionPolicy Unrestricted Get-WindowsAutoPilotInfo.ps1 -credential Domainname\<accountname> -Name Machine1,Machine2,Machine3
    ```

3. Доступ к каталогам, в которых могут быть записи для устройств. Удалите записи для каждого устройства из *всех* каталогов, включая доменные службы Windows Server Active Directory и Azure Active Directory. Обратите внимание, что для полного выполнения этого процесса может потребоваться несколько часов.

4. Доступ к службам управления, в которых могут быть записи для устройств. Удалите записи для каждого устройства из *всех* служб управления, включая диспетчер конфигураций конечных точек Майкрософт, Microsoft Intune и Windows автопилот. Обратите внимание, что для полного выполнения этого процесса может потребоваться несколько часов.

Теперь вы можете перейти к разделу [Регистрация устройств](#register-devices-by-using-the-admin-portal).

#### <a name="manual-powershell-script-method"></a>Метод сценария PowerShell вручную

1.  Откройте командную строку PowerShell с правами администратора.
2.  Выполняем `Install-Script -Name Get-WindowsAutoPilotInfo`
3.  Выполняем `powershell -ExecutionPolicy Unrestricted Get-WindowsAutoPilotInfo -OutputFile <path>\hardwarehash.csv`
4. [Объединение хэш-данных.](#merge-hash-data)

#### <a name="flash-drive-method"></a>Метод флэш-накопителя

1. На устройстве, отличном от регистрируемого, вставьте USB-накопитель.
2. Откройте командную строку PowerShell с правами администратора.
3. Выполняем `Save-Script -Name Get-WindowsAutoPilotInfo -Path <pathToUsb>`
4. Включите регистрируемое устройство, но не *запускайте процесс установки*. Если вы случайно запустили программу установки, вам потребуется сбросить или переобразировать устройство.
5. Вставьте USB-накопитель, а затем нажмите клавиши SHIFT + F10.
6. Откройте командную строку PowerShell с правами администратора и запустите `cd <pathToUsb>` .
7. Выполняем `Set-ExecutionPolicy -ExecutionPolicy Unrestricted`
8. Выполняем `.\Get-WindowsAutoPilotInfo -OutputFile <path>\hardwarehash.csv`
9. Удалите USB-накопитель, а затем завершите работу устройства, выполнив `shutdown -s -t 0`
10. [Объединение хэш-данных.](#merge-hash-data)

>[!IMPORTANT]
>Не выключайте устройство, которое вы регистрируете повторно, пока не завершите его регистрацию. 



### <a name="merge-hash-data"></a>Слияние хэш-данных

Если вы собрали хэш-данные оборудования вручную с помощью методов PowerShell или устройства флэш-памяти, то теперь необходимо объединить данные CSV-файлов в один файл для завершения регистрации. Вот пример сценария PowerShell для упрощения:

```powershell
Import-CSV -Path (Get-ChildItem -Filter *.csv) | ConvertTo-Csv -NoTypeInformation | % {$_.Replace('"', '')} | Out-File .\aggregatedDevices.csv
```

После объединения хэш-данных в один CSV-файл можно приступить к [регистрации устройств](#register-devices-by-using-the-admin-portal).


#### <a name="register-devices-by-using-the-admin-portal"></a>Регистрация устройств с помощью портала администрирования

На [портале администрирования](https://aka.ms/mmdportal)рабочих столов, управляемом Майкрософт, выберите **устройства** в левой области навигации. Выберите **+ Регистрация устройств**; Откроется вспомогательная надстройка:

[![Вскрывающийся после выбора параметра Регистрация устройств, перечисление устройств со столбцами для назначенных пользователей, серийного номера, состояния, даты последнего рассмотрения и срока хранения](../../media/new-registration-ui.png)](../../media/new-registration-ui.png)


<!--Registering any existing devices with Managed Desktop will completely re-image them; make sure you've backed up any important data prior to starting the registration process.-->


Выполните приведенные ниже действия.

1. В поле **Отправка файла**укажите путь к созданному ранее CSV-файлу.

1. Выберите пункт **зарегистрировать устройства**. Система добавит устройства в список устройств в **колонке устройства**, помеченной как **аутопилотрегистратионрекуестед**. Регистрация обычно занимает менее 10 минут, и при успешном завершении работы устройство отображается как **готовое для пользователя** , что означает, что он готов к работе и ожидает, пока пользователь не запустится.


Вы можете отслеживать ход регистрации устройств на главной странице " **управляемые настольные устройства Майкрософт** ". В отчет могут воздержаться следующие сведения:

| Состояние | Описание |
|---------------|-------------|
| аутопилотрегистратионрекуестед | Регистрация еще не выполняется. Вернитесь позже. |
| Сбой регистрации | Не удалось выполнить регистрацию. Для получения дополнительных сведений обратитесь к разделу [Устранение неполадок Device Registration](#troubleshooting-device-registration) . |
| Готово для пользователя | Регистрация выполнена успешно, и теперь устройство готово к доставке конечному пользователю. Рабочий стол, управляемый Майкрософт, будет самостоятельно настраиваться, поэтому дальнейшие подготовительные действия не требуются. |
| Активное | Устройство было доставлено конечному пользователю и зарегистрировано в клиенте. Это также означает, что они регулярно используют устройство. |
| Отсутств | Устройство было доставлено конечному пользователю и зарегистрировано в клиенте. Однако они не использовали устройство недавно (за последние 7 дней).  | 

#### <a name="troubleshooting-device-registration"></a>Устранение неполадок при регистрации устройств

| Сообщение об ошибке | Сведения |
|---------------|-------------|
| Устройство не найдено | Не удалось зарегистрировать это устройство, так как не удалось найти соответствующее значение для указанного производителя, модели или серийного номера. Подтвердите эти значения с помощью поставщика устройств. |
| Недопустимый хеш оборудования | Аппаратный хеш, указанный для этого устройства, отформатирован неправильно. Дважды проверьте хэш оборудования, а затем повторите отправляются. |
| Устройство уже зарегистрировано | Это устройство уже зарегистрировано в вашей организации. Дальнейшие действия не требуются. |
| Устройство заявлено другой организацией | Это устройство уже заявлено другой организацией. Обратитесь к поставщику устройства. |
| Непредвиденная ошибка | Не удалось автоматически обработать запрос. Обратитесь в службу поддержки и введите идентификатор запроса: <requestId> |

### <a name="check-the-image"></a>Проверка изображения

Если ваше устройство поступило от поставщика управляемого партнера Майкрософт для настольных ПК, изображение должно быть правильным.

Вы также можете применить образ самостоятельно, если хотите. Чтобы приступить к работе, обратитесь к представителю Майкрософт, с которым вы работаете, и укажите расположение и действия по применению образа.

### <a name="deliver-the-device"></a>Доставка устройства

> [!IMPORTANT]
> Прежде чем вы перейдете на устройство для пользователя, убедитесь, что вы получили и применили [соответствующие лицензии](../get-ready/prerequisites.md) для этого пользователя.

Если все лицензии применяются, вы можете [приступить к работе с устройствами](get-started-devices.md), а затем, когда пользователь сможет запустить устройство и выполнить установку Windows.









