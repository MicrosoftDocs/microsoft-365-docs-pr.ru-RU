---
title: Работа в сети (в облаке) — точка зрения одного архитектора
description: Описание.
ms.author: bcarter
author: brendacarter
manager: bcarter
ms.audience: ITPro
ms.topic: article
ms.prod: microsoft-365-enterprise
localization_priority: Normal
ms.collection:
- M365-identity-device-management
- M365-security-compliance
ms.custom: ''
f1.keywords: NOCSH
ms.openlocfilehash: a005d56dcca08c05eb433ef75ca3870785b39f19
ms.sourcegitcommit: 555d756c69ac9031d1fb928f2e1f9750beede066
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/29/2020
ms.locfileid: "47308133"
---
# <a name="networking-up-to-the-cloud--one-architects-viewpoint"></a>Работа в сети (в облаке) — точка зрения одного архитектора

В этой статье, [ED Фишер](https://www.linkedin.com/in/edfisher/), Security & архитектору в Майкрософт, рассказывается о том, как оптимизировать сеть для облачного подключения, избегая наиболее распространенных ловушек. 

## <a name="about-the-author"></a>Об авторе

![ED Фишер фото](../media/solutions-architecture-center/ed-fisher-networking.jpg) 

В настоящее время я основной технический специалист в Южной Азии, на котором сосредоточена безопасность & соответствия требованиям. Я работал с клиентами, которые перемещаются в Office 365 за последние десять лет. Я работал с небольшим количеством компаний с несколькими расположениями для государственных учреждений и предприятий с миллионами пользователей, распространяемых по всему миру, и многими другими клиентами между ними, с большим числом десятков тысяч пользователей, несколькими расположениями в различных частях мира, потребность в повышенной степени безопасности и множеством требований соответствия требованиям. Я помог сотни предприятий и миллионов пользователей безопасно и безопасно переходят в облако.

С помощью заднего плана за последние 25 лет, включающих в себя безопасность, инфраструктуру и проектирование сети и поместив два из предыдущих работодателей в Office 365 до того, как присоединиться к корпорации Майкрософт, я находился на вашей стороне таблицы и забывать, как это делается. Несмотря на то, что ни один из двух клиентов не одинаков, большинство из них имеют похожие требования, и при использовании стандартизированной службы, например любой платформы SaaS или PaaS, наилучшие подходы обычно будут одинаковыми.



## <a name="its-not-the-network--its-how-youre-misusing-it"></a>Он не является сетью — это то, как вы (MIS) с помощью этой функции!

Независимо от того, сколько раз это происходит, никогда не отамазе меня от того, как группы *творческой* системы безопасности и сетевые Teams пытаются получить сведения о том, как они должны подключаться к облачным службам Майкрософт. Всегда существует определенная политика безопасности, стандарт соответствия требованиям или лучший способ научиться использовать, не требуя участия в беседе о том, что она пытается выполнить, или *о том, как* они работают лучше, быстрее, эффективнее и эффективнее. 

Когда такая сортировка распространена на меня, я обычно хочу выполнить запрос и пройти его через ховс и вхис и получить их там, где они должны быть. Но если я полностью являюсь Федором, мне нужно поделиться им, что нужно сделать, чтобы сделать это, а затем вернуться к тому, что когда бы они не работали. Мне может понадобиться сделать это иногда, но *не*так. Мы попытаемся объяснить все, что я хочу включить в эту запись. Если ваша организация хочет использовать облачные службы Майкрософт, то, возможно, некоторые Висдом, которые могут помочь вам, не зависимо от вашей роли.


## <a name="guiding-principles"></a>Принципы GUID
Давайте начнем с правил заземления, которые мы это сделали. Мы обсудим, как безопасно подключаться к облачным службам, чтобы обеспечить минимальную сложность и максимальную производительность, сохраняя реальную безопасность. Ни один из следующих элементов счетчика не будет использоваться, даже если вы или ваш клиент не будете использовать любимый прокси-сервер для всех.

- **Так как вы можете, не значит, не обязательно** — или в любую фразу Dr. Ян Малколм из фильма для парковки журассик ". . . Да, да, но ваша группа безопасности была ранее занята, так как она не была бы неостанавливаться.    
- **Безопасность не означает сложность** — вы не безопаснее, так как тратится больше денег, пересылаете больше устройств или нажмите Дополнительные кнопки.
- **Доступ к office 365 осуществляется через Интернет** , но это не то же самое, что Office 365 является Интернетом. Это служба SaaS, управляемая корпорацией Майкрософт и администрируемых вами. В отличие от веб-сайтов, которые вы посещаете в Интернете, вы фактически просматриваете куртаин, а также можете применять элементы управления, которые необходимы для соблюдения политик и стандартов соответствия требованиям, если вы знаете, что в то время, как вы можете отвечать вашим целям, вам может потребоваться сделать это другим способом.
- **Чокепоинтс являются неправильными, локализованные варианты хороши** , так как все пользователи всегда хотят получать весь Интернет-трафик для всех пользователей в какой-либо центральной точке, как правило, поэтому они могут отслеживать и применять политику, но зачастую потому, что это не так, как предоставление доступа к Интернету во всех их расположениях, или только то, как это делается. Но эти чокепоинтс именно так. Указывает, где выполняется внутренний трафик. Нет ничего страшного, чтобы пользователи не обращались к Инстаграм или потоку Cat-видео, но не обрабатывают критически важный трафик бизнес-приложений одинаковым образом.
- **Если DNS аин'т счастливого, аин'т ничего счастливого** — Лучшая общедоступная сеть может быть хамструнг с точки зрения неправильной работы DNS, будь то рекурсия запросов к серверам в других частях мира или с помощью DNS-серверов поставщика услуг Интернета или других общедоступных DNS-серверов, которые кэшируют информацию о разрешении DNS. 
- Так как это так, как это делается **, это не означает, что нужно сделать сейчас** — постоянно меняется технология и Office 365 не является исключением. Применение мер безопасности, развернутых и развернутых для локальных служб, или управление веб-сайтами не гарантирует такой же уровень безопасности и может оказать значительное негативное влияние на производительность.
- **Office 365 был разработан для доступа через Интернет** — это, по сути, все это. Независимо от того, что нужно сделать между пользователями и пограничным краем, трафик по-прежнему будет переноситься через Интернет, когда он покидает сеть и до нашей. Даже если вы используете Azure ExpressRoute для маршрутизации трафика, чувствительного к задержке, непосредственно из сети, связь с интернетом совершенно необходима. Принять. Не думайте.

## <a name="where-bad-choices-are-often-made"></a>Где часто создаются неправильные варианты

Несмотря на множество случаев, в которых в названии безопасности возникают неправильные решения, наиболее часто встречаются клиенты. Многие беседы с клиентами задействуют все сразу.

### <a name="insufficient-resources-at-the-edge"></a>Недостаточно ресурсов на границе
Несколько клиентов развертывают среды нуля, и у них есть годы, с которыми работают пользователи, и их функции выхода в Интернет. Независимо от того, имеют ли клиенты прокси-серверы или разрешают прямой доступ и просто исходящий трафик NAT, они выполнялись в течение нескольких лет и не расскажу о том, как больше они начинают переводить через пограничные приложения в облако.

Пропускная способность всегда важна, но устройства NAT могут не иметь достаточной мощностью для обработки повышенной нагрузки и могут начать преждевременное закрытие подключений для освобождения ресурсов. Большая часть клиентского программного обеспечения, подключающегося к Office 365, предполагает наличие постоянных подключений, а пользователь, полностью использующий Office 365, может иметь не более 32 или более одновременных подключений. Если устройство NAT отбрасывает их преждевременно, эти приложения могут перестать отвечать при попытке использовать подключения, которые больше не находятся. Когда они попытаются установить новые подключения, они попытаются еще больше загружаться на сетевом шестеренке.

### <a name="localized-breakout"></a>Локализованная версия
Все остальные в этом списке переключаются по одному из них — как можно быстрее отключать сеть и как можно быстрее. Обратное перенаправление трафика пользователей в центральную точку выхода, особенно если эта точка выхода находится в другом регионе, отличном от того, в котором находится пользователь, что приводит к ненужной задержке и влияет на взаимодействие с клиентом и скорость загрузки. Корпорация Майкрософт предоставляет баллы о присутствии в мире для всех наших служб и пирингов, установленных с практически всеми крупными поставщиками услуг Интернета, поэтому перенаправление трафика пользователей на *локальный* сервер обеспечивает быстрое получение в нашей сети минимальной задержки. 

### <a name="dns-resolution-traffic-should-follow-the-internet-egress-path"></a>Трафик разрешения DNS должен соответствовать пути выхода из Интернета
Конечно, чтобы клиент нашел конечную точку, он должен использовать DNS. DNS-серверы корпорации Майкрософт оценивают источник DNS-запросов, чтобы убедиться, что вы возвращаете ответ, который находится в Интернет-терминах, ближайший к источнику запроса. Убедитесь, что служба DNS настроена таким образом, что запросы на разрешение имен отправляются по тому же пути, что и трафик пользователей, лест их локальным выходом, но конечной точке в другом регионе. Это означает, что локальные DNS-серверы "переходит в корневую папку", а не пересылает их на DNS-серверы в удаленных центрах обработки данных. И примите участие в общедоступных и частных службах DNS, которые могут кэшировать результаты из одной части мира и обслуживать их на запросы от других частей мира.

### <a name="to-proxy-or-not-to-proxy-that-is-the-question"></a>К прокси-серверу или не к прокси-серверу, это вопрос
Первое, что следует учитывать, — это возможность подключения пользователей прокси-сервера к Office 365. Такой простой; не использовать прокси-сервер. Доступ к Office 365 осуществляется через Интернет, но это не Интернет. Это расширение основных служб и должно рассматриваться таким образом. Вы можете использовать прокси-сервер, например, защиту от потери вредоносных программ или проверку содержимого, который уже доступен в службе, и его можно использовать при масштабировании и без необходимости взломать подключения с шифрованием по протоколу TLS. Но если вы действительно хотите использовать прокси-трафик, который вы не можете контролировать в ином случае, обратите внимание на наши рекомендации [https://aka.ms/pnc](https://aka.ms/pnc) и категории трафика [https://aka.ms/ipaddrs](https://aka.ms/ipaddrs) . Существует три категории трафика для Office 365. Оптимизировать и разрешить в действительности должен идти прямой и обход прокси-сервера. Можно использовать прокси-сервер по умолчанию. Сведения содержатся в этих документах. . . Прочтите их.

Большинство клиентов, использующих прокси-сервер, при их фактическом продолжении Взгляните на то, что происходит, когда клиент делает запрос HTTP CONNECT прокси-серверу, прокси-сервер теперь просто является дорогостоящим дополнительным маршрутизатором. Используемые протоколы, такие как MAPI и RTC, не являются четными протоколами, понятными веб-прокси, поэтому даже при использовании TLS-взлома вы не получаете никаких дополнительных прав. Вы *получаете* дополнительную задержку. Дополнительные сведения см [https://aka.ms/pnc](https://aka.ms/pnc) . в этой статье, включая категории "оптимизировать", "разрешить" и "по умолчанию" для трафика Microsoft 365.

Наконец, обратите внимание на общее воздействие на прокси-сервер и соответствующий ответ на это воздействие. По мере увеличения числа подключений через прокси-сервер может уменьшить коэффициент масштабирования TCP таким образом, чтобы не попадать в буфер такое количество трафика. У меня есть клиенты, на которых были перезагружены прокси-серверы, которые использовали коэффициент масштабирования, равный 0. Так как коэффициент масштабирования является экспоненциальным значением и мы хотели использовать 8, каждое снижение значения коэффициента масштабирования является огромным отрицательным влиянием на пропускную способность.

Проверка TLS означает безопасность! Но не совсем! Многие клиенты с прокси-серверами хотят использовать их для проверки всего трафика, и это означает TLS "останов и проверка". При выполнении этого действия для веб-сайта, доступного по протоколу HTTPS (вопросы конфиденциальности нечетные), прокси-сервер может сделать это для десяти или даже двадцати параллельных потоков в течение нескольких сотен миллисекунд. При большом объеме скачивания или, возможно, в видеосвязи, одно или несколько из них могут быть последними, но в целом большинство из них устанавливают, переносят и закрываются очень быстро. Выполнение приостанова и проверки означает, что прокси-сервер должен выполнить удвоенный действия. Для каждого подключения клиента к прокси-серверу также необходимо установить отдельное соединение с конечной точкой. Таким образом, один из двух становится равен четырем, 32 становится 64. . . Посмотрите, где я хочу? Вы, вероятно, выделили свой прокси-сервер для типичного обзора в Интернете, но при попытке выполнить одно и то же действие для клиентских подключений к Office 365 количество одновременных подключений может быть больше, чем размер.

### <a name="streaming-isnt-important-except-that-it-is"></a>Потоковая передача не важна, за исключением *того,* что
Единственными службами в Office 365, использующими UDP, являются Skype (нескорое прекращение) и Microsoft Teams. Teams использует UDP для потокового трафика, в том числе звука, видео и общего доступа к презентации. Потоковый трафик находится в режиме реального времени, например при проведении собраний по сети с помощью голосовых и видеороликов, а также для показа колод и выполнения демонстраций. Они используют UDP, так как если пакеты отправляются или приходятся не по порядку, и поток может просто продолжить работу. 

Если вы не разрешаете исходящий трафик UDP от клиентов для службы, они могут вернуться к использованию протокола TCP. Но если отбросить пакет TCP, *все будет остановлено* до истечения времени ожидания повторной передачи (RTO), а отсутствующий пакет можно повторно передать. Если пакет выходит из порядка, все завершается до тех пор, пока остальные пакеты не будут получены и не будут собраны по порядку. Как в случае, в случае неправильного воспроизведения звука (запомнить максимальный запас?), так и видео (при нажатии кнопки Сомес. . . Да, есть), что приводит к низкой производительности и неправильному взаимодействию с пользователем. И помните, что я помещаю выше о прокси-серверах? Если клиент Teams будет вынужден использовать прокси-сервер, он будет принудительно использовать протокол TCP. Теперь вы негативно сказывается на производительности.

### <a name="split-tunneling-may-seem-scary"></a>Раздельное туннелирование может показаться страшной
Но это не так. Все подключения к Office 365 передаются по протоколу TLS. Мы предоставим TLS 1,2 в течение недостаточного времени, и мы будем сразу же отключить старые версии, так как устаревшие клиенты по-прежнему используют их, и это риск.

При принудительном подключении по протоколу TLS (или 32) для последующего перехода к службе не добавляется безопасность. Он добавляет задержку и уменьшает общую пропускную способность. В некоторых VPN-решениях она даже заставляет протокол UDP перетуннельить по протоколу TCP, что опять будет негативно влиять на потоковый трафик. Если вы не выполняете проверку протокола TLS, то нет ни одной перевернутой стороны. Очень распространенная тема между клиентами, теперь, когда большая часть их сотрудников является удаленным, заключается в том, что они могут понаблюдать за пропускной способностью и производительностью, чтобы все пользователи могли подключаться с помощью VPN, а не настраивать раздельное туннелирование для доступа к [оптимизации конечных точек Office 365](https://docs.microsoft.com/microsoft-365/enterprise/microsoft-365-network-connectivity-principles#new-office-365-endpoint-categories).

Это достаточно для упрощения создания разделенного туннелирования. Для получения дополнительных сведений ознакомьтесь со статьей [Оптимизация подключения Office 365 для удаленных пользователей с помощью VPN-туннеля с разделением](https://docs.microsoft.com/microsoft-365/enterprise/microsoft-365-vpn-split-tunnel).


## <a name="the-sins-of-the-past"></a>Грехов прошлого
Во многих случаях причина неправильного выбора заключается в том, чтобы не понять, как работает служба, (2) пытается придерживаться политик компании, написанных до внедрения облака, и (3) группы безопасности, которые могут быть непростоы, так как эти цели не являются одним способом. Надеюсь, что выше, и приведенные ниже ссылки помогут вам в первом. Для получения второго требования может потребоваться указать спонсор. Назначение целей политик безопасности, а не их методов, помогает в третьем. С условного доступа к содержимому, защите от потери данных, защиты от потери данных, проверки конечных точек до угроз с нулевым сроком действия конечная цель разумная политика безопасности может быть обеспечена с помощью доступных в Office 365 и без каких-либо зависимостей на локальных сетевых компонентах, принудительных туннельных туннелей и проверки подлинности TLS. 

В других случаях оборудование, которое было приобретено и приобретено до начала перемещения в облако, просто не может быть масштабировано для обработки новых шаблонов трафика и загрузки. Если вы действительно хотите маршрутизировать весь трафик через одну точку выхода, и/или прокси-сервер, будьте готовы к обновлению сетевого оборудования и полосы пропускания соответствующим образом. Аккуратно Следите за использованием в обоих случаях, так как при этом не будет работать медленнее, чем дополнительные пользователи. Все будет прекрасно, пока не будет достигнута эта точка, а затем все страдает. 

## <a name="exceptions-to-the-rules"></a>Исключения из правил

Если для Организации требуются [ограничения клиента](https://docs.microsoft.com/azure/active-directory/manage-apps/tenant-restrictions), необходимо использовать прокси-сервер с разбиением по протоколу TLS и проверить, чтобы принудительно выполнить некоторый трафик через прокси-сервер, но не обязательно затребовать весь трафик через него.  Это не все или ничего, поэтому обратите внимание на то, что необходимо изменить с помощью прокси-сервера. 

Если вы собираетесь разрешить Расщепленное туннелирование, но также используете прокси-сервер для общедоступного веб-трафика, убедитесь, что файл PAC определяет, что нужно сделать, а также определить интересный трафик, который проходит через туннель VPN. Мы предлагаем примеры файлов PAC [https://aka.ms/ipaddrs](https://aka.ms/ipaddrs) , которые упрощают управление.

## <a name="conclusion"></a>Заключение

Десятки тысяч организаций, в том числе почти все из Fortune 500, используют Office 365 ежедневно для критически важных функций. Они безопасны и переносятся через Интернет.

 Независимо от того, какие цели безопасности у вас есть, существуют способы их выполнения, которые не требуют VPN-подключений, прокси-серверов, TLS-разрывов и проверки, а также централизованного выхода из Интернета для того, чтобы трафик пользователей отходился от сети и как можно быстрее, что обеспечивает лучшую производительность, независимо от того, является ли сеть головным офисом компании, удаленным Office или этот пользователь работает дома. Наши рекомендации основаны на том, как создаются службы Office 365 и обеспечивают безопасный и производительный пользовательский интерфейс.

## <a name="further-reading"></a>Дополнительные материалы

[Принципы сетевого подключения к Office 365](https://docs.microsoft.com/microsoft-365/enterprise/microsoft-365-network-connectivity-principles)

[URL-адреса и диапазоны IP-адресов для Office 365](https://docs.microsoft.com/microsoft-365/enterprise/urls-and-ip-address-ranges)

[Управление конечными точками Office 365](https://docs.microsoft.com/microsoft-365/enterprise/managing-office-365-endpoints)

[Веб-служба IP-адресов и URL-адресов в Office 365](https://docs.microsoft.com/microsoft-365/enterprise/microsoft-365-ip-web-service)

[Доступ к сетевому подключению Office 365](https://docs.microsoft.com/microsoft-365/enterprise/assessing-network-connectivity)

[Сеть Office 365 и настройка производительности](https://docs.microsoft.com/microsoft-365/enterprise/network-planning-and-performance)

[Оценка сетевого подключения к Office 365](https://docs.microsoft.com/microsoft-365/enterprise/assessing-network-connectivity)

[Настройка производительности Office 365 с помощью базовых показателей и журнала производительности](https://docs.microsoft.com/microsoft-365/enterprise/performance-tuning-using-baselines-and-history)

[План устранения проблем с производительностью Office 365](https://docs.microsoft.com/microsoft-365/enterprise/performance-troubleshooting-plan)

[Сети доставки содержимого](https://docs.microsoft.com/microsoft-365/enterprise/content-delivery-networks)

[Проверка подключения Microsoft 365](https://connectivity.office.com/)

[Как Майкрософт строит свою быструю и надежную глобальную сеть](https://azure.microsoft.com/blog/how-microsoft-builds-its-fast-and-reliable-global-network/)

[Блог, посвященный сетям для Office 365](https://techcommunity.microsoft.com/t5/office-365-networking/bd-p/Office365Networking)

[Подключение к Office 365 для удаленных пользователей с использованием Расщепленного туннелирования VPN](https://docs.microsoft.com/microsoft-365/enterprise/microsoft-365-vpn-split-tunnel)


