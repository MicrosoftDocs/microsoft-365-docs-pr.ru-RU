---
title: Планирование корпоративных ресурсов Microsoft 365 — архитектура безопасности
description: Узнайте о главных стратегиях разработки архитектуры Microsoft Enterprise от Алекса Штайнберга( Alex Shteynberg), технического главного архитектора Корпорации Майкрософт.
ms.author: bcarter
author: brendacarter
manager: bcarter
ms.audience: ITPro
ms.topic: article
ms.prod: microsoft-365-enterprise
localization_priority: Normal
ms.collection:
- M365-identity-device-management
- M365-security-compliance
- M365solutions
ms.custom: seo-marvel-jun2020
f1.keywords: NOCSH
ms.openlocfilehash: 10cebf0ab74936d7275586f2e8f09c841c8c653f
ms.sourcegitcommit: 27b2b2e5c41934b918cac2c171556c45e36661bf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "50918318"
---
# <a name="to-identity-and-beyondone-architects-viewpoint"></a>Для удостоверения и за его пределами— точка зрения одного архитектора

В этой статье Алекс Штайнберг [(Alex Shteynberg),](https://www.linkedin.com/in/alex-shteynberg/)главный технический архитектор Корпорации Майкрософт, обсуждает основные стратегии разработки для корпоративных организаций, которые принимают Microsoft 365 и другие облачные службы Майкрософт.

## <a name="about-the-author"></a>Об авторе

![Фотография Алекса Штайнберга](../media/solutions-architecture-center/identity-and-beyond-alex-shteynberg.jpg)

Я главный технический архитектор в Нью-Йорке [Microsoft Technology Center](https://www.microsoft.com/mtc?rtc=1). В основном я работаю с крупными клиентами и сложными требованиями. Моя точка зрения и мнения основаны на этих взаимодействиях и не могут применяться к каждой ситуации. Однако, по моему опыту, если мы можем помочь клиентам с самыми сложными проблемами, мы можем помочь всем клиентам.

Обычно я работаю с 100+ клиентами каждый год. Хотя каждая организация обладает уникальными характеристиками, интересно видеть тенденции и общие черты. Например, одной из тенденций является межиндустрийный интерес для многих клиентов. В конце концов, филиал банка также может быть кофейней и центром сообщества.

В своей роли я уделяю основное внимание оказанию клиентам помощи в поиске наилучшего технического решения для решения их уникального набора бизнес-целей. Официально я уделяю основное внимание удостоверениям, безопасности, конфиденциальности и соответствия требованиям. Мне нравится, что они касаются всего, что мы делаем. Это дает мне возможность участвовать в большинстве проектов. Это позволяет мне очень занят и наслаждаться этой ролью.

Я живу в Нью-Йорке (лучший!) и действительно наслаждаюсь разнообразием его культуры, продуктов питания и людей (а не трафика). Я люблю путешествовать, когда я могу и надеюсь увидеть большую часть мира в моей жизни. В настоящее время я исследую поездку в Африку, чтобы узнать о дикой природе.

## <a name="guiding-principles"></a>Руководящие принципы

- **Простой часто лучше:** вы можете сделать (почти) все с помощью технологии, но это не означает, что вы должны. Особенно в области безопасности многие клиенты переинженер решений. Мне нравится [это видео с](https://www.youtube.com/watch?v=SOQgABDSYZE) конференции Полосы Google, чтобы подчеркнуть этот момент.
- **Люди, процессы, технологии:** [разработка для людей,](https://en.wikipedia.org/wiki/Human-centered_design) чтобы улучшить процесс, а не технология в первую очередь. Нет "идеальных" решений. Нам необходимо уравновешить различные факторы риска, и решения будут разными для каждого бизнеса. Слишком многие клиенты проектировать подход, который их пользователи позже избегать.
- **Сосредоточься на сначала "почему" и "как"** позже: будьте раздражающе 7-yr старый ребенок с миллионом вопросов. Мы не можем найти правильный ответ, если не знаем правильных вопросов. Многие клиенты делают предположения о том, как нужно работать, а не определять бизнес-проблемы. Всегда можно использовать несколько путей.
- **Длинный хвост из прошлых методов:** распознать, что лучшие практики изменяются с легкой скоростью. Если вы посмотрели Azure AD более трех месяцев назад, скорее всего, устарели. Все здесь подлежит изменению после публикации. Параметр "Лучший" сегодня может быть не таким же, как и через шесть месяцев.

## <a name="baseline-concepts"></a>Базовые понятия

Не пропустите этот раздел. Я часто считаю, что я должен вернуться к этим темам, даже для клиентов, которые используют облачные службы в течение многих лет.
Увы, язык не является точным средством. Мы часто используем одно и то же слово, чтобы означать разные понятия или разные слова, чтобы означать одно и то же понятие. Я часто использую эту схему ниже, чтобы установить базовую терминологию и "модель иерархии".
<br><br>

![Иллюстрация клиента, подписки, службы и данных](../media/solutions-architecture-center/Identity-and-beyond-tenant-level.png)  

<br>

Когда вы научитесь плавать, лучше начать в бассейне, а не в центре океана. Я не пытаюсь быть технически точным с помощью этой схемы. Это модель для обсуждения некоторых базовых концепций.

Пояснение к схеме

- Tenant = экземпляр Azure AD. Он находится в "верхней части" иерархии или уровне 1 в схеме. Мы можем считать это[](/azure/active-directory/users-groups-roles/licensing-directory-independence)"границей", где происходит все остальное[(в стороне Azure AD B2B).](/azure/active-directory/b2b/what-is-b2b) Все корпоративные облачные службы Майкрософт являются частью одного из этих клиентов. Потребительские службы являются отдельными. В документации "Tenant" отображается как клиент Office 365, клиент Azure, клиент WVD и так далее. Я часто нахожу, что эти варианты вызывают путаницу для клиентов.
- Службы/подписки, уровень 2 на схеме, принадлежат одному и только одному клиенту. Большинство служб SaaS 1:1 и не могут перемещаться без миграции. Azure отличается, вы можете [перенести](/azure/cost-management-billing/manage/billing-subscription-transfer) выставление счета и/или [подписку](/azure/active-directory/fundamentals/active-directory-how-subscriptions-associated-directory) на другого клиента. Существует множество клиентов, которые должны перемещать подписки Azure. Это имеет различные последствия. Объекты, которые существуют вне подписки, не перемещаются (например, управление доступом на основе ролей или Объекты Azure RBAC и Azure AD, включая группы, приложения, политики и т. п.). Кроме того, некоторые службы (например, Хранилище ключей Azure, кирпичи данных и так далее). Не переносите службы без необходимости ведения бизнеса. Некоторые скрипты, которые могут быть полезны для миграции, [делятся в GitHub.](https://github.com/lwajswaj/azure-tenant-migration)
- Дается служба обычно имеет своего рода "sublevel" границы, или уровень 3 (L3). Это полезно понять для разделения безопасности, политики, управления и так далее. К сожалению, не существует единого имени, которое я знаю. Некоторые имена примеров для L3: Azure Subscription = [ресурс;](/azure/azure-resource-manager/management/manage-resources-portal) Динамика 365 CE = [экземпляр;](/dynamics365/admin/new-instance-management) Power BI = [рабочее пространство;](/power-bi/service-create-the-new-workspaces) Power Apps = [окружающая среда;](/power-platform/admin/environments-overview) и так далее.
- Уровень 4 — это место, где живут фактические данные. Эта "плоскость данных" является сложной темой. Некоторые службы используют Azure AD для RBAC, другие — нет. Я немного обсудю это, когда мы примем к темам делегирования.

Некоторые дополнительные концепции, которые я нахожу многие клиенты (и сотрудники Майкрософт) путаются или имеют вопросы о включаем в себя следующие:

- Любой человек [может создать](/azure/active-directory/fundamentals/active-directory-access-create-new-tenant) множество клиентов [бесплатно.](https://azure.microsoft.com/pricing/details/active-directory/) Вам не нужна служба, предусмотренная в ней. У меня десятки. Каждое имя клиента уникально во всемирной облачной службе Майкрософт (другими словами, ни один из двух клиентов не может иметь одно и то же имя). Все они находятся в формате TenantName.onmicrosoft.com. Кроме того, существуют процессы, которые автоматически создают клиента[(неугодные клиенты).](/azure/active-directory/users-groups-roles/directory-self-service-signup) Например, это может произойти, когда пользователь подписывается на корпоративную службу с доменом электронной почты, который не существует ни в другом клиенте.
- В управляемом клиенте в нем можно зарегистрировать множество доменов [DNS.](/azure/active-directory/fundamentals/add-custom-domain) Это не меняет исходное имя клиента. В настоящее время нет простого способа переименовать клиента (кроме миграции). Несмотря на то, что имя клиента технически не является критическим в эти дни, некоторые могут найти это ограничение.
- Необходимо зарезервировать имя клиента для организации, даже если вы еще не планируете развертывать какие-либо службы. В противном случае кто-то может взять его у вас, и нет простого процесса, чтобы вернуть его (та же проблема, что и имена DNS). Я слишком часто слышу это от клиентов. Ваше имя клиента также должно быть предметом дискуссии.
- Если у вас есть пространство имен DNS(s), необходимо добавить все эти данные в клиент(ы). В противном случае можно создать [неуправимый](/azure/active-directory/users-groups-roles/directory-self-service-signup) клиент с этим именем, что затем приводит к сбоям, [чтобы сделать его управляемым](/azure/active-directory/users-groups-roles/domains-admin-takeover).
- Пространство имен DNS (например, contoso.com) может принадлежать одному и только одному клиенту. Это имеет последствия для различных сценариев (например, совместное использование домена электронной почты во время слияния или приобретения и так далее). Существует способ зарегистрировать подлодку DNS (например, div.contoso.com) в другом клиенте, но этого следует избегать. При регистрации доменного имени верхнего уровня предполагается, что все поддомены принадлежат одному и одному клиенту. В сценариях с несколькими клиентами (см. ниже) обычно рекомендуется использовать другое доменное имя верхнего уровня (например, contoso.ch или ch-contoso.com).
- Кто должен "владеть" клиентом? Я часто вижу клиентов, которые не знают, кто в настоящее время владеет их клиентом. Это большой красный флаг. Вызов службы поддержки Майкрософт как можно скорее. Так же проблематично, когда для управления клиентом назначается владелец службы (часто администратор Exchange). Клиент будет содержать все службы, которые могут потребоваться в будущем. Владельцем клиента должна быть группа, которая может принять решение о в том, чтобы включить все облачные службы в организации. Другая проблема заключается в том, что группе владельцев клиентов будет предложено управлять всеми службами. Это не масштабироваться для крупных организаций.
- Существует нет концепции суб/ супер клиента. Почему-то этот миф продолжает повторяться. Это относится и к [клиентам Azure AD B2C.](/azure/active-directory-b2c/) Я слышу слишком много раз: "Моя среда B2C находится в моем клиенте XYZ" или "Как переместить клиента Azure в клиента Office 365?"
- В основном в этом документе основное внимание уделяется коммерческому облаку во всем мире, так как это то, что используют большинство клиентов. Иногда полезно знать о [суверенных облаках](/azure/active-directory/develop/authentication-national-cloud). Суверенные облака имеют дополнительные последствия для обсуждения, которые не являются для этого обсуждения.

## <a name="baseline-identity-topics"></a>Базовые темы удостоверений

Существует много документации о платформе удостоверений Майкрософт — Azure Active Directory (Azure AD). Для тех, кто только начинается, он часто чувствует себя подавляющим. Даже после того, как вы узнаете об этом, идти в ногу с постоянными инновациями и изменениями может быть сложно. В моих взаимодействиях с клиентами я часто нахожусь в качестве "переводчика" между бизнес-целями и подходами "Хороший, лучший, лучший" для решения этих (и человеческие "заметки скалы" для этих тем). Существует редко идеальный ответ и "правильное" решение баланс различных факторов риска. Ниже приведены некоторые общие вопросы и области путаницы, которые я обычно обсуждаю с клиентами.

### <a name="provisioning"></a>Подготовка

Azure AD не решается из-за отсутствия управления в мире удостоверений! [Управление удостоверением](/azure/active-directory/governance/identity-governance-overview) должно быть критически важным элементом, не зависят от любых решений облака. Требования к управлению изменяются со временем, поэтому это программа, а не средство.

[Azure AD Connect](/azure/active-directory/hybrid/whatis-azure-ad-connect) vs. [Microsoft Identity Manager](/microsoft-identity-manager/microsoft-identity-manager-2016) (MIM) vs. something else (third party or custom)? Сохраните много головной боли сейчас и в будущем и перейдите с Azure AD Connect. В этом средстве есть все виды смарт-решений для решения специфических конфигураций клиентов и текущих инноваций.

Некоторые края, которые могут привести к более сложной архитектуре:

- У меня есть несколько лесов AD без подключения к сети между ними. Существует новый параметр под названием [Cloud Provisioning](/azure/active-directory/cloud-provisioning/what-is-cloud-provisioning).
- У меня нет Active Directory и я не хочу его устанавливать. Azure AD Connect можно настроить для синхронизации с [LDAP](/azure/active-directory/hybrid/plan-hybrid-identity-design-considerations-tools-comparison) (может потребоваться партнер).
- Мне нужно раздать одинаковые объекты нескольким арендаторам. Это не поддерживается технически, но зависит от определения "одно и то же".

Следует ли настраивать правила[](/azure/active-directory/hybrid/how-to-connect-sync-configure-filtering)синхронизации по умолчанию (объекты фильтра, [](/azure/active-directory/hybrid/reference-connect-sync-attributes-synchronized)атрибуты изменения, альтернативный [ИД](/azure/active-directory/hybrid/plan-connect-userprincipalname)входа и так далее)? Избегайте этого! Платформа удостоверений так же ценна, как и службы, которые ее используют. Хотя вы можете делать все виды ореховых конфигураций, чтобы ответить на этот вопрос, необходимо посмотреть на влияние на приложения. Если фильтровать объекты с поддержкой почты, то gal для онлайн-служб будет неполным; если приложение полагается на определенные атрибуты, фильтрация этих атрибутов будет иметь непредсказуемое влияние; и так далее. Это не решение группы удостоверений.

XYZ SaaS поддерживает подготовка just-in-Time (JIT), почему вы требуете, чтобы я синхронизировался? описание выше. Многие приложения нуждаются в "профиле" информации для функциональности. Вы не можете иметь GAL, если недоступны все объекты с поддержкой почты. То же самое относится и к подготовка [пользователей](/azure/active-directory/app-provisioning/user-provisioning) в приложениях, интегрированных с Azure AD.

### <a name="authentication"></a>Проверка подлинности

[Синхронизация хаширования паролей](/azure/active-directory/hybrid/how-to-connect-password-hash-synchronization) [](/azure/active-directory/hybrid/how-to-connect-pta-how-it-works) (PHS) против сквозной проверки подлинности (PTA) против [федерации.](/azure/active-directory/hybrid/how-to-connect-fed-compatibility)

Обычно вокруг федерации идет [страстная](/azure/active-directory/hybrid/choose-ad-authn) дискуссия. Проще, как правило, лучше и, следовательно, использовать PHS, если у вас есть веские причины не делать этого. Кроме того, можно настроить различные методы проверки подлинности для различных доменов DNS в одном клиенте. 

Некоторые клиенты позволяют федерации + PHS главным образом для:

- Возможность вернуться [к](/azure/active-directory/hybrid/plan-migrate-adfs-password-hash-sync) (для аварийного восстановления), если служба федерации недоступна.
- Дополнительные возможности (например: [Azure AD DS)](/azure/active-directory-domain-services/tutorial-configure-password-hash-sync)и службы безопасности (например: [учетные данные с утечкой)](/azure/active-directory/reports-monitoring/concept-risk-events#leaked-credentials)
- Поддержка служб в Azure, которые не понимают федерационную проверку подлинности (например, [Azure Files).](/azure/storage/files/storage-files-active-directory-overview)

Я часто хожу по клиентам через поток проверки подлинности клиентов, чтобы прояснить некоторые неправильные представления. Результат выглядит как изображение ниже, которое не так хорошо, как интерактивный процесс получения там.

![Пример беседы доски](../media/solutions-architecture-center/identity-beyond-whiteboard-example.png)

Этот тип рисунка доски иллюстрирует, где политики безопасности применяются в потоке запроса на проверку подлинности. В этом примере политики, применяемые через службу Федерации Active Directory (AD FS), применяются к первому запросу службы, но не последующим запросам службы. Это по крайней мере одна из причин максимального перемещения элементов управления безопасностью в облако.

Мы преследовали мечту о [](/azure/active-directory/manage-apps/what-is-single-sign-on) едином входе (SSO) до тех пор, как я помню. Некоторые клиенты считают, что они могут добиться этого, выбрав поставщика "правильной" федерации (STS). Azure AD может значительно помочь включить [возможности SSO,](/azure/active-directory/manage-apps/plan-sso-deployment) но ни одна служба stS не является волшебной. Существует слишком много "устаревших" методов проверки подлинности, которые по-прежнему используются для критически важных приложений. Расширение Azure AD с [помощью партнерских решений](/azure/active-directory/saas-apps/tutorial-list) может решить многие из этих сценариев. SSO — это стратегия и путешествие. Вы не можете добраться туда, не переходя к [стандартам для приложений](/azure/active-directory/develop/v2-app-types). Эта тема связана с [](/azure/active-directory/authentication/concept-authentication-passwordless) путешествием к проверке подлинности без паролей, которая также не имеет волшебного ответа.

[Многофакторная проверка подлинности](/azure/active-directory/authentication/concept-mfa-howitworks) (MFA) имеет важное значение сегодня[(подробнее см.](https://techcommunity.microsoft.com/t5/azure-active-directory-identity/your-pa-word-doesn-t-matter/ba-p/731984) здесь). Добавьте к ней [аналитику](/azure/active-directory/authentication/tutorial-risk-based-sspr-mfa) поведения пользователей и у вас есть решение, которое предотвращает наиболее распространенные кибератаки. Даже потребительские службы перемещаются, чтобы требовать MFA. Тем не менее, я по-прежнему встречаю многих клиентов, которые не хотят перейти к современным [подходам](../enterprise/hybrid-modern-auth-overview.md) проверки подлинности. Самый большой аргумент, который я слышу, это повлияет на пользователей и устаревшие приложения. Иногда хороший удар может помочь клиентам двигаться вперед - Exchange Online [объявил об изменениях](https://techcommunity.microsoft.com/t5/exchange-team-blog/basic-auth-and-exchange-online-february-2020-update/ba-p/1191282). Для помощи клиентам в этом переходе теперь доступно множество отчетов Azure [AD.](/azure/active-directory/fundamentals/concept-fundamentals-block-legacy-authentication)

### <a name="authorization"></a>Авторизация

В [](https://en.wikipedia.org/wiki/Authorization)"Википедии" необходимо определить политику доступа. Многие смотрят на него как на возможность определять элементы управления доступом к объекту (файл, служба и так далее). В текущем мире киберугроз эта концепция быстро развивается до динамической политики, которая может реагировать на различные векторы угроз и быстро настраивать элементы управления доступом в ответ на них. Например, если я получаю доступ к банковскому счету из необычного расположения, я получаю дополнительные шаги подтверждения. Чтобы подойти к этому, необходимо рассмотреть не только сам политик, но и экосистему методологий обнаружения угроз и корреляции сигналов.

Движок политики Azure AD реализуется с помощью политик [условного доступа.](/azure/active-directory/conditional-access/overview) Эта система зависит от информации из различных других систем обнаружения угроз для принятия динамических решений. Простое представление будет чем-то похожим на следующую иллюстрацию:

![Движок политики в Azure AD](../media/solutions-architecture-center/identity-and-beyond-illustration-3.png)

Объединение всех этих сигналов позволяет использовать динамические политики, такие как:

- Если на вашем устройстве обнаружена угроза, доступ к данным будет сокращен до веб-сайта только без возможности скачивания.
- Если вы скачиваете необычно высокий объем данных, все, что вы скачали, будет зашифровано и ограничено.
- Если вы получите доступ к службе с неувядаемого устройства, вам будут заблокированы высокочувствительные данные, но вам будет разрешен доступ к данным без возможности копирования в другое расположение.

Если вы согласны с этим расширенным определением авторизации, необходимо реализовать дополнительные решения. Решения, которые вы реализуете, будут зависеть от того, насколько динамичной должна быть политика и какие угрозы необходимо расставить приоритеты. Примеры таких систем:

- [Защита идентификации Azure AD](/azure/active-directory/identity-protection/) 
- [Microsoft Defender для удостоверений](/azure-advanced-threat-protection/)
- [Microsoft Defender для конечной точки](/windows/security/threat-protection/microsoft-defender-atp/microsoft-defender-advanced-threat-protection)
- [Microsoft Defender для Office 365](../security/office-365-security/office-365-atp.md?view=o365-worldwide)
- [Безопасность облачных приложений](/cloud-app-security/) Майкрософт (MCAS)
- [Microsoft 365 Defender](../security/mtp/microsoft-threat-protection.md?view=o365-worldwide)
- [Microsoft Intune](/mem/intune/)
- [Microsoft Information Protection](../compliance/information-protection.md?view=o365-worldwide) (MIP)
- [Azure Sentinel](/azure/sentinel/)

Конечно, помимо Azure AD различные службы и приложения имеют собственные модели авторизации. Некоторые из них обсуждаются позже в разделе делегирования.

### <a name="audit"></a>Аудит

Azure AD имеет подробные [возможности аудита и](/azure/active-directory/reports-monitoring/) отчетности. Однако это, как правило, не единственный источник информации, необходимый для принятия решений по безопасности. Подробнее об этом см. в разделе Делегирования.

## <a name="theres-no-exchange"></a>Нет Exchange

Не паникуйте! Это не означает, что Exchange является обесценив (или SharePoint, и так далее). Это по-прежнему является основной службой. Я имею в виду, что в течение довольно долгого времени поставщики технологий переходят пользовательские интерфейсы (UX) на компоненты нескольких служб. В Microsoft 365 простой пример[](https://support.office.com/article/Attach-files-or-insert-pictures-in-Outlook-email-messages-BDFAFEF5-792A-42B1-9A7B-84512D7DE7FC): "современные вложения", где вложения для электронной почты хранятся в SharePoint Online или OneDrive для бизнеса.

![Присоединение файла к электронной почте](../media/solutions-architecture-center/modern-attachments.png)

При взгляде на клиента Outlook можно увидеть множество "подключенных" служб, а не только Exchange. Это группы Azure AD, Microsoft Search, Apps, Profile, compliance и Office 365. 

![Интерфейс Outlook с вызовами](../media/solutions-architecture-center/identity-and-beyond-conceptual-screenshot.png)

Ознакомьтесь [с microsoft Fluid Framework для](https://techcommunity.microsoft.com/t5/microsoft-365-blog/microsoft-ignite-blog-microsoft-fluid-framework-preview/ba-p/978268) предварительного просмотра предстоящих возможностей. В предварительном просмотре теперь я могу читать и отвечать на беседы Teams непосредственно в Outlook. На самом деле клиент [Teams](https://products.office.com/microsoft-teams/download-app) является одним из наиболее ярких примеров этой стратегии. 

В целом становится сложнее провести четкую линию между Office 365 и другими службами в облаках Microsoft. Я считаю это большим преимуществом для клиентов, так как они могут извлечь выгоду из общей инновации во всем, что мы делаем, даже если они используют один компонент. Довольно прохладно и имеет далеко идущие последствия для многих клиентов.

Сегодня я считаю, что многие группы клиентских ИТ-клиентов структурированы вокруг "продуктов". Это логично для локального мира, так как для каждого конкретного продукта необходим эксперт. Тем не менее, я абсолютно рад, что мне больше не нужно отлаживка базы данных Active Directory или Exchange, так как эти службы переместились в облако. Автоматизация (какой вид облака) удаляет некоторые повторяющихся ручных заданий (посмотрите, что произошло с фабриками). Однако они заменяются более сложными требованиями для понимания взаимодействия между службами, влияния, потребностей бизнеса и так далее. Если вы готовы [учиться,](/learn/)есть большие возможности, включенные облачной трансформацией. Прежде чем прыгнуть в технологию, я часто говорю с клиентами об управлении изменениями навыков ИТ и структур команды.

Для всех фан-людей и разработчиков SharePoint не спрашивайте: "Как мне сделать XYZ в SharePoint online?" Используйте [Power Automate](/power-automate/) (или Flow) для рабочего процесса, это гораздо более мощная платформа. Используйте [Azure Bot Framework](/azure/bot-service/?view=azure-bot-service-4.0) для создания лучшего UX для списка элементов 500-K. Начните использовать [Microsoft Graph](https://developer.microsoft.com/graph/) вместо CSOM. [Microsoft Teams](/MicrosoftTeams/Teams-overview) включает SharePoint, но и мир больше. Есть много других примеров, которые я могу перечислить. Там есть обширная и замечательная вселенная. Откройте дверь и [приступить к изучению]().

Другие распространенные последствия в области соответствия требованиям. Этот подход к перекрестным службам, как представляется, полностью путает многие политики соответствия требованиям. Я постоянно вижу организации, в которые говорится: "Мне нужно вести журнал всех сообщений электронной почты в систему электронных расследований". Что это означает, если электронная почта больше не просто электронная почта, а окно в другие службы? Office 365 имеет комплексный подход к обеспечению соответствия [требованиям,](../compliance/index.yml)но изменять людей и процессы зачастую гораздо сложнее, чем технологии.

Есть много других людей и последствий процесса. На мой взгляд, это критическая и недоосудимая область. Возможно, больше в другой статье.

## <a name="tenant-structure-options"></a>Параметры структуры клиента

### <a name="single-tenant-vs-multi-tenant"></a>Один клиент против нескольких клиентов

В общем, у большинства клиентов должен быть только один производственный клиент. Есть много причин, почему несколько клиентов являются сложными (дать ему [поиск Bing](https://www.bing.com/search?q=office%20365%20multiple%20tenants)) или прочитать этот [whitepaper](https://aka.ms/multi-tenant-user). В то же время многие корпоративные клиенты, с ними я работаю, имеют другого (маленького) клиента для ИТ-обучения, тестирования и экспериментов. Междоменийный доступ к Azure упрощается с [помощью Azure Lighthouse.](https://azure.microsoft.com/services/azure-lighthouse/) Office 365 и многие другие службы SaaS имеют ограничения для сценариев меж клиента. В сценариях [Azure AD B2B](/azure/active-directory/b2b/what-is-b2b) необходимо рассмотреть множество вариантов.

Многие клиенты в конечном итоге с несколькими арендаторами производства после слияния и приобретения (M&A) и хотят консолидироваться. Сегодня это непросто, и для этого потребуется microsoft Consulting Services (MCS) или партнер плюс сторонное программное обеспечение. В настоящее время ведется инженерная работа по решению различных сценариев с клиентами с несколькими клиентами в будущем.

Некоторые клиенты предпочитают работать с более чем одним клиентом. Это должно быть очень тщательное решение и почти всегда бизнес-причины управляемый! Некоторые примеры включают в себя следующие:

- Структура компании типа холдинга, в которой не требуется легкое взаимодействие между различными сущностями и существует сильная административная и другая изоляция.
- После приобретения принимается бизнес-решение о раздельных действиях двух сущностями.
- Моделирование среды клиента, которая не меняет производственную среду клиента. 
- Разработка программного обеспечения для клиентов.

В этих сценариях с несколькими клиентами клиенты часто хотят сохранить конфигурацию одинаковой для всех клиентов или сообщать об изменениях конфигурации и сугробах. Это часто означает переход от ручных изменений к конфигурации в качестве кода. Поддержка Microsoft Premiere предлагает семинар по этим типам требований на основе этого общего IP: [https://Microsoft365dsc.com](https://Microsoft365dsc.com) .

### <a name="multi-geo"></a>Поддержка нескольких регионов

Для [Multi-Geo](../enterprise/microsoft-365-multi-geo.md) или не для Multi-Geo это вопрос. С помощью Office 365 Multi-Geo вы можете хранить и хранить данные в остальных географических расположениях, выбранных для удовлетворения требований оседлости данных. [](../enterprise/o365-data-locations.md) Существует множество неправильных представлений об этой возможности. Учитывайте следующее:

- Это не обеспечивает преимущества производительности. Это может ухудшить производительность, если [сетевой дизайн](https://aka.ms/office365networking) не является правильным. Подбирайте устройства "близко" к сети Майкрософт, не обязательно к вашим данным.
- Это не решение для [соответствия GDPR](https://www.microsoft.com/trust-center/privacy/gdpr-overview). GDPR не фокусируется на суверенитете данных или местах хранения данных. Для этого существуют другие рамки соответствия требованиям.
- Это не решает делегирования администрирования (см. ниже) или [информационных барьеров](../compliance/information-barriers.md).
- Это не то же самое, что много клиента и требует [дополнительных](https://github.com/MicrosoftDocs/azure-docs-pr/blob/master/articles/active-directory/hybrid/how-to-connect-sync-feature-preferreddatalocation.md) пользовательских процессов подготовка.
- Он не [перемещает клиента](../enterprise/moving-data-to-new-datacenter-geos.md) (Azure AD) в другую географию. 

## <a name="delegation-of-administration"></a>Делегирования администрирования

В большинстве крупных организаций разделение обязанностей и управление доступом на основе ролей (RBAC) является необходимой реальностью. Я собираюсь извиниться заранее. Это не так просто, как этого хотят некоторые клиенты. Требования клиентов, юридические, нормативные и другие требования отличаются друг от друга и иногда конфликтуют по всему миру. Простота и гибкость часто находятся по разные стороны друг от друга. Не пойми меня неправильно. Со временем были (и будут) значительные улучшения. Посетите местный [центр технологий Майкрософт,](https://www.microsoft.com/mtc) чтобы разработать модель, которая соответствует вашим бизнес-требованиям, не читая документы 379230! Здесь я сосредоточусь на том, о чем вы должны думать, а не о том, почему это так. Ниже приведены пять различных областей для планирования и некоторые из распространенных вопросов, с которыми я столкнулся.

### <a name="azure-ad-and-microsoft-365-admin-centers"></a>Центры администрирования Azure AD и Microsoft 365

Существует длинный и растущий список встроенных [ролей.](/azure/active-directory/users-groups-roles/directory-assign-admin-roles) Каждая роль состоит из списка разрешений на роль, сгруппив их вместе, чтобы разрешить выполнение определенных действий. Эти разрешения можно увидеть на вкладке "Описание" внутри каждой роли. Кроме того, в центре администрирования Microsoft 365 можно увидеть более читаемую версию для человека. Определения встроенных ролей не могут быть изменены. Как правило, сгруппив их в три категории:

- **Глобальный администратор.** Эта "вся [](../enterprise/protect-your-global-administrator-accounts.md) мощная" роль должна быть защищена так же, как и в других системах. Типичные рекомендации: отсутствие постоянного назначения и использование azure AD Privileged Identity Management (PIM); сильная проверка подлинности; и так далее. Интересно, что эта роль не дает доступ ко всему по умолчанию. Как правило, я вижу путаницу в отношении доступа к требованиям и доступа к Azure, которые обсуждаются позже. Однако эта роль всегда может назначать доступ к другим службам в клиенте. 
- **Отдельные администраторы** служб: некоторые службы (Exchange, SharePoint, Power BI и так далее) потребляют роли администрирования высокого уровня из Azure AD. Это не согласуется во всех службах, и позже будут рассмотрены дополнительные роли, определенные для служб.
- **Функциональный.** Существует длинный (и растущий) список ролей, ориентированных на конкретные операции (приглашенный приглашенный и так далее). Периодически добавляются дополнительные данные с учетом потребностей клиентов.

Невозможно делегировать все (хотя разрыв уменьшается), что означает, что роль глобального администратора иногда требуется использовать. Конфигурация как код и автоматизация должны рассматриваться вместо участия людей в этой роли.

**Примечание.** Центр администрирования Microsoft 365 имеет более понятный интерфейс, но имеет подмножество возможностей по сравнению с интерфейсом администрирования Azure AD. Оба портала используют одинаковые роли Azure AD, поэтому изменения происходят в одном месте. Совет. Если вы хотите, чтобы пользовательский интерфейс администрирования, ориентированный на управление удостоверением, не был засоряем Azure, используйте [https://aad.portal.azure.com](https://aad.portal.azure.com) . 

Что в имени? Не делайте предположений из имени роли. Язык — это не очень точный инструмент. Цель должна быть в том, чтобы определить операции, которые необходимо делегировать, прежде чем посмотреть, какие роли необходимы. Добавление кого-либо в роль "Читатель безопасности" не означает, что они видят параметры безопасности во всем.

Возможность создания [настраиваемой роли](/azure/active-directory/users-groups-roles/roles-custom-overview) — это распространенный вопрос. Это ограничено в Azure AD сегодня (см. ниже), но со временем будет расти в возможностях. Я думаю, что они применимы к функциям в Azure AD и не могут охватывать "вниз" модель иерархии (рассмотрено выше). Всякий раз, когда я говорю о "настраиваемом", я возвращался к основному принципу "проще лучше".

Другим распространенным вопросом является возможность масштабировать роли в подмножество каталога. В качестве примера можно привести "Администратор helpdesk только для пользователей в ЕС". [Административные подразделения](/azure/active-directory/users-groups-roles/directory-administrative-units) (AU) предназначены для решения этой проблемы. Как и выше, я думаю, что они применимы к функциям в Azure AD и не могут охватывать "вниз". Конечно, некоторые роли не имеет смысла в области (глобальные администраторы, администраторы служб и т. п.).

Сегодня все эти роли требуют прямого членства (или динамического назначения при использовании [PIM Azure AD).](/azure/active-directory/privileged-identity-management/) Это означает, что клиенты должны управлять ими непосредственно в Azure AD, и они не могут основываться на членстве группы безопасности. Я не поклонник создания скриптов для управления ими, так как для работы с повышенными правами необходимо работать. Обычно я рекомендую интеграцию API с процессными системами, например ServiceNow, или с помощью средств управления партнером, таких как Saviynt. Над этим со временем идут инженерные работы.

Несколько раз я [упоминал о службе PIM Azure AD.](/azure/active-directory/privileged-identity-management/) Существует соответствующее решение Microsoft Identity Manager (MIM) [Privileged Access Management](/microsoft-identity-manager/pam/privileged-identity-management-for-active-directory-domain-services) (PAM) для локального управления. Вы также можете посмотреть [](/windows-server/identity/securing-privileged-access/privileged-access-workstations) на рабочие станции привилегированного доступа (PAW) и Управление удостоверениями [Azure AD.](/azure/active-directory/governance/identity-governance-overview) Кроме того, существуют различные сторонние средства, которые могут включить повышение роли в срок, достаточное и динамическое. Это обычно является частью более широкого обсуждения для обеспечения безопасности среды. 

Иногда в сценариях необходимо добавить внешнего пользователя в роль (см. раздел multi-tenant, см. выше). Это работает просто отлично. [Azure AD B2B](/azure/active-directory/b2b/) — это еще одна большая и интересная тема, которая может быть посвящена пользователям, возможно, в другой статье.

### <a name="security-and-compliance-center-scc"></a>Центр безопасности и соответствия требованиям (SCC)

Разрешения в Центре безопасности [Office 365 &](../security/office-365-security/permissions-in-the-security-and-compliance-center.md) соответствия требованиям — это коллекция "групп ролей", которые отличаются от ролей Azure AD. Это может привести к путанице, так как некоторые из этих групп ролей имеют одно и то же имя, что и роли Azure AD (например, "Читатель безопасности"), но у них может быть другое членство. Я предпочитаю использовать роли Azure AD. Каждая группа ролей состоит из одной или нескольких "ролей" (см. то, что я имею в виду при повторном использование одного и того же слова?) и членов Azure AD, которые являются объектами с включенной электронной почтой. Кроме того, можно создать группу ролей с тем же именем, что и роль, которая может содержать или не содержать эту роль (избегайте этой путаницы).

В этом смысле это эволюция модели групп ролей Exchange. Однако у Exchange Online есть собственный интерфейс [управления группой](/exchange/permissions-exo) ролей. Некоторые группы ролей в Exchange Online заблокированы и управляются из Azure AD или Центра & безопасности, но другие могут иметь те же или аналогичные имена и управляются в Exchange Online (добавление путаницы). Рекомендуется избегать использования пользовательского интерфейса Exchange Online, если для управления Exchange не нужны области.

Нельзя создавать настраиваемые роли. Роли определяются службами, созданными Корпорацией Майкрософт, и будут расти по мере создания новых служб. В концепции это похоже на [роли, определенные приложениями](/azure/active-directory/develop/howto-add-app-roles-in-azure-ad-apps) в Azure AD. При включении новых служб часто необходимо создавать новые группы ролей, чтобы предоставить или [](../compliance/insider-risk-management-configure.md?view=o365-worldwide#step-1-required-enable-permissions-for-insider-risk-management)делегировать доступ к этим службам (например, к управлению рисками изнутри).

Эти группы ролей также требуют прямого членства и не могут содержать группы Azure AD. К сожалению, сегодня эти группы ролей не поддерживаются PIM Azure AD. Как и роли Azure AD, я склонен рекомендовать управление ими с помощью API или продукта управления партнером, например Saviynt или других.

Роли центра & безопасности охватывают Microsoft 365, и эти группы ролей нельзя использовать в подмножество среды (как это можно сделать с административными подразделениями в Azure AD). Многие клиенты спрашивают, как они могут подавлять. Например, "создание политики DLP только для пользователей ЕС". Сегодня, если у вас есть права на определенную функцию в Центре & безопасности, у вас есть права на все, охватываемых этой функцией в клиенте. Однако многие политики имеют возможности для целевого подмножества среды [](../compliance/create-sensitivity-labels.md#publish-sensitivity-labels-by-creating-a-label-policy) (например, "сделать эти метки доступными только для этих пользователей"). Правильное управление и связь являются ключевым компонентом, чтобы избежать конфликтов. Некоторые клиенты предпочитают реализовать подход "конфигурация как код" для решения проблемы подделегации в Центре & соответствия требованиям. Некоторые конкретные службы поддерживают подделегирование (см. ниже).

Стоит отметить, что элементы управления, управляемые в настоящее время через Центр соответствия требованиям & безопасности (protection.office.com), находятся в процессе переноса на два отдельных портала администрирования: security.microsoft.com и compliance.microsoft.com. Изменение — это единственная константа!

### <a name="service-specific"></a>Специфические службы

Как уже говорилось ранее, многие клиенты ищут возможность добиться более детальной модели делегирования. Распространенный пример: "Управление службой XYZ только для пользователей и местоположений Подразделения X" (или другого измерения). Возможность этого зависит от каждой службы и не согласуется между службами и возможностями. Кроме того, каждая служба может иметь отдельную и уникальную модель RBAC. Вместо того, чтобы обсуждать все эти вопросы (это займет вечность), я добавляю соответствующие ссылки для каждой службы. Это не полный список, но он поможет вам начать работу.

- **Exchange Online** - [https://docs.microsoft.com/exchange/permissions-exo/permissions-exo](/exchange/permissions-exo/permissions-exo) 
- **SharePoint Online** - [https://docs.microsoft.com/sharepoint/manage-site-collection-administrators](/sharepoint/manage-site-collection-administrators) 
- **Microsoft Teams**  -  [https://docs.microsoft.com/microsoftteams/itadmin-readiness](/microsoftteams/itadmin-readiness)
- **eDiscovery** - [https://docs.microsoft.com/microsoft-365/compliance/assign-ediscovery-permissions](../compliance/index.yml) 
  + **Фильтрация разрешений**  -  [https://docs.microsoft.com/microsoft-365/compliance/permissions-filtering-for-content-search](../compliance/index.yml)
  + **Границы соответствия требованиям**  -  [https://docs.microsoft.com/microsoft-365/compliance/set-up-compliance-boundaries](../compliance/set-up-compliance-boundaries.md)
  + **Advanced eDiscovery**  -  [https://docs.microsoft.com/microsoft-365/compliance/overview-ediscovery-20](../compliance/overview-ediscovery-20.md)
- **Yammer** - [https://docs.microsoft.com/yammer/manage-yammer-users/manage-yammer-admins](/yammer/manage-yammer-users/manage-yammer-admins) 
- **Multi-geo** - [https://docs.microsoft.com/microsoft-365/enterprise/add-a-sharepoint-geo-admin](../enterprise/add-a-sharepoint-geo-admin.md) 
- **Dynamics 365** — [https://docs.microsoft.com/dynamics365/](/dynamics365/) <br>
  Примечание. Эта ссылка является корневой частью документации. Существует несколько типов служб с изменениями в модели администрирования и делегирования.
- **Power Platform**  -  [https://docs.microsoft.com/power-platform/admin/admin-documentation](/power-platform/admin/admin-documentation)
  + **Power Apps**  -  [https://docs.microsoft.com/power-platform/admin/wp-security](/power-platform/admin/wp-security) <br>
    Примечание. Существует несколько типов с вариациями в моделях администрирования и делегирования.
  + **Power Automate**  -  [https://docs.microsoft.com/power-automate/environments-overview-admin](/power-automate/environments-overview-admin)
  + **Power BI**  -  [https://docs.microsoft.com/power-bi/service-admin-governance](/power-bi/service-admin-governance) <br>
Примечание. Безопасность платформы данных и делегирования (компонент которых Power BI) — это сложная область.
- **MEM/Intune**  -  [https://docs.microsoft.com/mem/intune/fundamentals/role-based-access-control](/mem/intune/fundamentals/role-based-access-control)
- **Microsoft Defender для конечной точки**  -  [https://docs.microsoft.com/windows/security/threat-protection/microsoft-defender-atp/user-roles](/windows/security/threat-protection/microsoft-defender-atp/user-roles)
- **Защитник Microsoft 365** - [https://docs.microsoft.com/microsoft-365/security/mtp/mtp-permissions](../security/mtp/mtp-permissions.md)
- **Безопасность облачных приложений Майкрософт** - [https://docs.microsoft.com/cloud-app-security/manage-admins](/cloud-app-security/manage-admins)
- **Stream**  -  [https://docs.microsoft.com/stream/assign-administrator-user-role](/stream/assign-administrator-user-role)
- **Информационные барьеры**  -  [https://docs.microsoft.com/microsoft-365/compliance/information-barriers](../compliance/information-barriers.md)

Для остальных поиск в Docs был действительно хорош в последнее время - [https://docs.microsoft.com/](../compliance/information-barriers.md) . 

### <a name="activity-logs"></a>Журналы действий

В Office 365 имеется [единый журнал аудита.](../compliance/search-the-audit-log-in-security-and-compliance.md) Это очень [подробный журнал,](/office/office-365-management-api/office-365-management-activity-api-schema)но не читайте слишком много в имя. Он может содержать не все необходимое или необходимое для обеспечения безопасности и соответствия требованиям. Кроме того, некоторые клиенты действительно заинтересованы в [расширенный аудит](../compliance/advanced-audit.md).

Примеры журналов Microsoft 365, доступных через другие API, включают следующие:

- [Azure AD](/azure/azure-monitor/platform/diagnostic-settings) (действия, не связанные с Office 365)
- [Отслеживание сообщений Exchange](/powershell/module/exchange/get-messagetrace)
- Системы threat/UEBA, рассмотренные выше (например, Azure AD Identity Protection, Microsoft Cloud App Security, Microsoft Defender for Endpoint и так далее)
- [Защита информации Майкрософт](../compliance/data-classification-activity-explorer.md?view=o365-worldwide)
- [Microsoft Defender для конечной точки](/windows/security/threat-protection/microsoft-defender-atp/api-power-bi)
- [Microsoft Graph](https://graph.microsoft.com)

Важно сначала определить все источники журналов, необходимые для программы безопасности и соответствия требованиям. Кроме того, обратите внимание, что в разных журналах имеются различные ограничения хранения в режиме он-лайн. 

С точки зрения делегирования администратора большинство журналов действий Microsoft 365 не имеют встроенной модели RBAC. Если у вас есть разрешение на просмотр журнала, в нем можно увидеть все. Распространенный пример требования клиента: "Я хочу иметь возможность запрашивать действия только для пользователей ЕС" (или какое-либо другое измерение). Для этого необходимо перенести журналы в другую службу. В облаке Майкрософт рекомендуется перенести его в [Azure Sentinel или](/azure/sentinel/overview) [Log Analytics.](/azure/azure-monitor/learn/quick-create-workspace) 

Схема высокого уровня:

![схема источников журналов для программы безопасности и соответствия требованиям](../media/solutions-architecture-center/identity-beyond-illustration-4.png)  

На приведенной выше схеме представлены встроенные возможности для отправки журналов в Центр событий и/или Azure Storage and/or Azure Log Analytics. Еще не все системы включают эту некафетную систему. Но есть и другие подходы к отправке этих журналов в тот же репозиторий. Например, см. [в примере Protecting your Teams with Azure Sentinel.](https://techcommunity.microsoft.com/t5/azure-sentinel/protecting-your-teams-with-azure-sentinel/ba-p/1265761)

Объединение всех журналов в одно хранилище включает дополнительные преимущества, такие как перекрестные корреляции, настраиваемые сроки хранения, увеличение данных, необходимых для поддержки модели RBAC, и так далее. После того как данные будут в этой системе хранения, можно создать панель мониторинга Power BI (или другой тип визуализации) с соответствующей моделью RBAC.

Журналы не должны быть направлены только в одно место. Кроме того, может быть полезно интегрировать [журналы Office 365](/cloud-app-security/connect-office-365-to-microsoft-cloud-app-security) в Microsoft Cloud App Security или настраиваемую модель RBAC в [Power BI.](../admin/usage-analytics/usage-analytics.md?view=o365-worldwide) Различные репозитории имеют различные преимущества и аудиторию.

Стоит отметить, что в службе [Microsoft 365 Defender](../security/mtp/microsoft-threat-protection.md?view=o365-worldwide)есть очень богатая встроенная система аналитики для безопасности, угроз, уязвимостей и так далее.

Многие крупные клиенты хотят передать эти данные журнала в сторонние системы (например, SIEM). Для этого существуют различные подходы, но в целом [Azure Event Hub](/azure/azure-monitor/platform/stream-monitoring-data-event-hubs) и [Graph](/graph/security-integration) являются хорошими отправными точками.

### <a name="azure"></a>Azure

Меня часто спрашивают, есть ли способ разделить роли с высокими привилегиями между Azure AD, Azure и SaaS (например: Глобальный администратор для Office 365, но не Azure).  Не так.  Архитектура с несколькими арендаторами необходима, если требуется полное административное разделение, но это добавляет значительные [сложности](https://aka.ms/multi-tenant-user) (см. выше). Все эти службы являются частью одной границы безопасности и удостоверений (см. выше модель иерархии).  

Важно понимать отношения между различными службами в одном клиенте. Я работаю со многими клиентами, которые работают над созданием бизнес-решений, охватывающих Azure, Office 365 и Power Platform (а зачастую и локальной и сторонних облачных служб). Один распространенный пример:

1. Я хочу совместно работать над набором документов/изображений и т. д. (Office 365)
2. Отправка каждого из них в процессе утверждения (Power Platform)
3.  После утверждения всех компонентов соберите их в единый [API](/azure/active-directory/develop/microsoft-graph-intro) Microsoft Graph (Azure).  Не невозможно, но значительно сложнее разработать решение, охватывающее [несколько клиентов.](/azure/active-directory/develop/single-and-multi-tenant-apps)

Azure Role-Based управления доступом (RBAC) позволяет управлять доступом для Azure с тонкой зернистой зернистой ской. С помощью RBAC можно управлять доступом к ресурсам, выдав пользователям меньше разрешений, необходимых для выполнения их заданий. Сведения не доступны для этого документа, но дополнительные сведения о RBAC см. в материале [What is role-based access control (RBAC) в Azure?](/azure/role-based-access-control/overview) RBAC является важным, но только частью соображений управления для Azure. [Cloud Adoption Framework](/azure/cloud-adoption-framework/govern/) — это отличная отправная точка для получения дополнительных данных. Мне нравится, как мой друг, Андрес Оврагет шаг за шагом ходит по клиентам, хотя различные компоненты, чтобы определиться с подходом. Представление на высоком уровне для различных элементов (не так хорошо, как процесс, чтобы добраться до фактической модели клиента) выглядит так:

![Представление компонентов Azure на высоком уровне для делегирования администрирования](../media/solutions-architecture-center/identity-beyond-illustration-5.png)

Как видно из рисунка выше, многие другие службы следует рассматривать как часть разработки (например: [Политики Azure,](/azure/governance/policy/overview) [Azure Blueprints,](/azure/governance/blueprints/overview) [Группы](/azure/governance/management-groups/)управления и так далее).

## <a name="conclusion"></a>Заключение

Начато как краткое сводка, завершив работу дольше, чем я ожидала.  Я надеюсь, что теперь вы готовы глубоко рассмотреть возможность создания модели делегирования для вашей организации.  Этот разговор очень распространен с клиентами. Существует не одна модель, которая работает для всех. Ожидание некоторых запланированных улучшений от инженерии Майкрософт, прежде чем документировать общие шаблоны, которые мы видим в разных клиентах. В то же время вы можете работать со своей командой учетных записей Майкрософт, чтобы организовать посещение ближайшего Центра технологий [Майкрософт.](https://www.microsoft.com/mtc)  Увидимся там!