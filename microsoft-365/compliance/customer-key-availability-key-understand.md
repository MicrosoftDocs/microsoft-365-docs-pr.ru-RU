---
title: Сведения о ключе доступности для ключа клиента
ms.author: krowley
author: kccross
manager: laurawi
ms.date: 02/05/2020
audience: ITPro
ms.topic: article
ms.service: O365-seccomp
localization_priority: Normal
search.appverid:
- MET150
description: Узнайте о ключе доступности, используемом для восстановления потерянных ключей клиента.
ms.openlocfilehash: bbad6ace0880c142a497bcac3469c579f13c7881
ms.sourcegitcommit: 27b2b2e5c41934b918cac2c171556c45e36661bf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "50907745"
---
# <a name="learn-about-the-availability-key-for-customer-key"></a>Сведения о ключе доступности для ключа клиента

Ключ доступности — это корневой ключ, автоматически созданный и созданный при создании политики шифрования данных. Microsoft 365 хранит и защищает ключ доступности. Ключ доступности функционально похож на два корневых ключа, которые вы поставляете для шифрования службы с помощью ключа клиента. Ключ доступности заворачивает клавиши на один уровень ниже в иерархии ключей. В отличие от ключей, которые вы предоставляете и управляете в Хранилище ключей Azure, вы не можете напрямую получить доступ к клавише доступности. Автоматизированные службы Microsoft 365 программным образом управляют ключом доступности. Эти службы инициируют автоматические операции, которые никогда не включают прямой доступ к клавише доступности.

Основная цель ключа доступности — обеспечить возможность восстановления от непредвиденных потерь корневых ключей, которые вы управляете. Потеря может быть результатом неправильного выполнения или вредоносных действий. Если вы потеряете контроль над корневыми ключами, обратитесь в Службу поддержки Майкрософт, и Корпорация Майкрософт поможет вам в процессе восстановления с помощью ключа доступности. Для перехода на новую политику шифрования данных с новыми корневыми ключами вы будете использовать ключ доступности.

Хранение и управление ключом доступности намеренно отличаются от ключей Хранилища ключей Azure по трем причинам:

- Ключ доступности обеспечивает восстановление, возможность "брейк-стекла" в случае потери контроля над обоими ключами Хранилища ключей Azure.
- Разделение логических элементов управления и безопасных мест хранения обеспечивает глубину защиты и защищает от потери всех ключей и данных от одной атаки или точки сбоя.
- Ключ доступности обеспечивает высокую доступность, если службы Microsoft 365 не могут получить ключи, которые находятся в хранилище ключей Azure из-за временных ошибок. Это правило применяется только к шифрованию служб Exchange Online и Skype для бизнеса. Файлы SharePoint Online, OneDrive для бизнеса и Teams никогда не используют ключ доступности, если только вы не назначит корпорации Майкрософт инициировать процесс восстановления.

Совместное использование ответственности за защиту данных с помощью различных защитных элементов и процессов для управления ключами в конечном счете снижает риск окончательной потери или уничтожения всех ключей (и, следовательно, ваших данных). Корпорация Майкрософт предоставляет вам единственные полномочия по отключению или уничтожению ключа доступности при уходе из службы. По проекту никто в Корпорации Майкрософт не имеет доступа к ключу доступности: он доступен только кодом службы Microsoft 365.

Дополнительные [сведения](https://www.microsoft.com/trustcenter/Privacy/govt-requests-for-data) о том, как обеспечить безопасность ключей, см. в центре доверия Майкрософт.
  
## <a name="availability-key-uses"></a>Использование ключа доступности

Ключ доступности предоставляет возможность восстановления для сценариев, в которых внешний злоумышленник или вредоносный инсайдер похищает контроль над хранилищем ключей, или если непреднамеренное неправильное управление приводит к потере корневых ключей. Эта возможность восстановления применяется ко всем службам Microsoft 365, совместимым с ключом клиента. Отдельные службы используют ключ доступности по-разному. Microsoft 365 использует только ключ доступности в описанных ниже способах.

### <a name="exchange-online-and-skype-for-business-uses"></a>Использование Exchange Online и Skype для бизнеса

Помимо возможностей восстановления, Exchange Online и Skype для бизнеса используют ключ доступности для обеспечения доступности данных во время временных или периодических операционных проблем, связанных с корневыми ключами доступа к службе. Если служба не может достичь ни одного из ключей клиента в хранилище Ключей Azure из-за временных ошибок, служба автоматически использует ключ доступности. Служба НИКОГДА не переходит непосредственно к клавише доступности.

Автоматизированные системы Exchange Online и Skype для бизнеса могут использовать ключ доступности во время временных ошибок для поддержки автоматизированных служб, таких как антивирусные, электронные обнаружения, предотвращение потери данных, перемещение почтовых ящиков и индексация данных.

### <a name="sharepoint-online-onedrive-for-business-and-teams-files-uses"></a>Файлы SharePoint Online, OneDrive для бизнеса и Teams используются

Для файлов SharePoint Online, OneDrive для бизнеса и Teams ключ доступности никогда не используется вне возможностей восстановления, и клиенты должны явно поручить Корпорации Майкрософт инициировать использование ключа доступности во время сценария восстановления. Автоматизированные операции службы зависят только от ключей клиентов в хранилище Azure Key. Подробную информацию о том, как работает иерархия ключей для этих служб, см. в разделе Как [файлы SharePoint Online, OneDrive для](#how-sharepoint-online-onedrive-for-business-and-teams-files-use-the-availability-key)бизнеса и Teams используют ключ доступности.

## <a name="availability-key-security"></a>Безопасность ключа доступности

Корпорация Майкрософт разделяет с вами ответственность за защиту данных, мгновенно переналадив ключ доступности и приняв обширные меры для ее защиты. Корпорация Майкрософт не предоставляет пользователям прямой контроль ключа доступности. Например, вы можете свернуть (повернуть) только ключи, которые принадлежат вам в Хранилище ключей Azure. Дополнительные сведения см. [в статью Roll или rotate a customer key or an availability key.](customer-key-availability-key-roll.md)

### <a name="availability-key-secret-stores"></a>Секретные хранилища ключей доступности

Корпорация Майкрософт защищает ключи доступности в контролируемых доступом внутренних секретных хранилищах, таких как хранилище Azure Key Vault с лицом клиента. Мы реализуем элементы управления доступом, чтобы не допустить непосредственного доступа администраторов Майкрософт к секретам, содержамся внутри. Операции Secret Store, включая поворот ключей и удаление, происходят с помощью автоматических команд, которые никогда не включают прямой доступ к клавише доступности. Операции управления секретным хранилищем ограничиваются конкретными инженерами и требуют эскалации привилегий с помощью внутреннего средства Lockbox. Эскалация привилегий требует утверждения и обоснования менеджера перед предоставлением. Lockbox гарантирует, что доступ связан с автоматическим отзывом доступа по истечении срока действия или выходом инженера.

**Ключи доступности Exchange Online и Skype для** бизнеса хранятся в секретном магазине Exchange Online Active Directory. Ключи доступности надежно хранятся в контейнерах клиента в контроллере домена Active Directory. Это безопасное хранилище хранения отделено и изолировано от секретного хранилища файлов SharePoint Online, OneDrive для бизнеса и Teams.

**Ключи доступности файлов SharePoint Online, OneDrive для** бизнеса и Teams хранятся во внутреннем хранилище секретов, управляемом командой служб. Эта защищенная служба хранения секретов имеет серверы с конечными точками приложения и SQL базы данных в качестве заднего конца. Ключи доступности хранятся в SQL базе данных и завернуты (зашифрованы) ключами шифрования секретного магазина, которые используют сочетание AES-256 и HMAC для шифрования ключа доступности в покое. Ключи шифрования секретного магазина хранятся в логически изолированном компоненте одной и той же SQL Базы данных и затем шифруются с ключами RSA-2048, которые содержатся в сертификатах, управляемых органом сертификации Майкрософт (CA). Эти сертификаты хранятся на серверах секретного магазина, которые выполняют операции с базой данных.

### <a name="defense-in-depth"></a>Глубинная защита

Корпорация Майкрософт использует стратегию глубокой защиты, чтобы предотвратить влияние злоумышленников на конфиденциальность, целостность или доступность данных клиентов, хранимых в Облаке Майкрософт. Для защиты секретного магазина и ключа доступности в рамках стратегии обеспечения безопасности реализованы специальные превентивные и детективные элементы управления.

Microsoft 365 создан для предотвращения неправильного использования ключа доступности. Слой приложений — это единственный метод, с помощью которого ключи, включая ключ доступности, можно использовать для шифрования и расшифровки данных. Только код службы Microsoft 365 может интерпретировать и пересекать иерархию ключей для действий шифрования и расшифровки. Существует логическая изоляция между расположениями ключей клиента, ключами доступности, другими иерархическими ключами и данными клиентов. Эта изоляция снижает риск воздействия данных в случае скомпрометации одного или нескольких местоположений. Каждый слой иерархии встроен в возможности обнаружения вторжений 24x7 для защиты хранимых данных и секретов.

Элементы управления доступом реализованы для предотвращения несанкционированного доступа к внутренним системам, включая секретные хранилища ключей доступности. Инженеры Microsoft не имеют прямого доступа к секретным хранилищам ключей доступности. Дополнительные подробности об элементе управления доступом просмотрите управление административным [доступом в Microsoft 365.](/Office365/securitycompliance/office-365-administrative-access-controls-overview)

Технические средства управления не помешали сотрудникам Корпорации Майкрософт войти в высоко привилегированные учетные записи служб, которые в противном случае могут использоваться злоумышленниками для выдающего себя за службы Майкрософт. Например, эти элементы управления препятствуют интерактивному логотипу.

Элементы управления ведением журналов и мониторинга безопасности — это еще одна защита на глубине, реализуемая, которая снижает риск для служб Майкрософт и ваших данных. Группы служб Майкрософт развернули решения активного мониторинга, которые создают оповещений и журналы аудита. Все группы служб загружают журналы в центральный репозиторий, где журналы агрегируются и обрабатываются. Внутренние средства автоматически проверяют записи, чтобы подтвердить, что службы работают в оптимальном, устойчивом и безопасном состоянии. Необычное действие помечено для дальнейшего рассмотрения.

Любое событие журнала, которое указывает на потенциальное нарушение политики безопасности Майкрософт, сразу же будет доведено до сведения групп безопасности Майкрософт. Служба безопасности Microsoft 365 настраивает оповещения для обнаружения попыток доступа к секретным хранилищам ключей доступности. Оповещения также создаются, если сотрудники Майкрософт пытаются использовать интерактивный логотип для учетных записей служб, которые запрещены и защищены средствами управления доступом. Безопасность Microsoft 365 также обнаруживает и оповещает об отклонениях службы Microsoft 365 от обычных базовых операций. Злоумышленники, пытающиеся неправомерно использовать службы Microsoft 365, запускают оповещения, в результате чего преступника выселяют из облачной среды Майкрософт.

## <a name="use-the-availability-key-to-recover-from-key-loss"></a>Используйте ключ доступности для восстановления после потери ключа

Если вы теряете контроль над ключами клиентов, ключ доступности предоставляет вам возможность восстановления и повторного шифрования данных.

### <a name="recovery-procedure-for-exchange-online-and-skype-for-business"></a>Процедура восстановления для Exchange Online и Skype для бизнеса

Если вы теряете контроль над ключами клиентов, ключ доступности позволяет восстановить данные и вернуть в сеть ресурсы Microsoft 365. Ключ доступности продолжает защищать данные во время восстановления. На высоком уровне, чтобы полностью восстановиться после потери ключей, необходимо создать новый deP и переместить в новую политику ресурсы, влияли на них.

Чтобы шифровать данные с помощью новых ключей клиента, создайте новые ключи в хранилище ключей Azure, создайте новый deP с помощью новых ключей клиента, а затем назначьте новый DEP почтовым ящикам, зашифрованным в настоящее время с предыдущим deP, для которого ключи были потеряны или скомпрометированы.

Процесс повторного шифрования может занять до 72 часов. Это стандартная продолжительность при изменении deP.
  
### <a name="recovery-procedure-for-sharepoint-online-onedrive-for-business-and-teams-files"></a>Процедура восстановления файлов SharePoint Online, OneDrive для бизнеса и Teams

Для файлов SharePoint Online, OneDrive для бизнеса и Teams ключ доступности никогда не используется вне возможности восстановления. Необходимо явно поручить Корпорации Майкрософт инициировать использование ключа доступности во время сценария восстановления. Чтобы инициировать процесс восстановления, свяжитесь с Корпорацией Майкрософт, чтобы активировать ключ доступности. После активации ключ доступности автоматически используется для расшифровки данных, что позволяет шифровать данные с помощью созданного deP, связанного с новыми ключами клиента.  

Эта операция пропорциональна количеству сайтов в организации. Если вы позвоните в Корпорацию Майкрософт, чтобы использовать ключ доступности, вы должны быть полностью в сети в течение четырех часов.

## <a name="how-exchange-online-and-skype-for-business-use-the-availability-key"></a>Использование ключа доступности Exchange Online и Skype для бизнеса

При создании DEP с ключом клиента Microsoft 365 создает ключ политики шифрования данных (DEP Key), связанный с этим DEP. Служба шифрует ключ DEP три раза: один раз с каждым из ключей клиента и один раз с ключом доступности. Хранятся только зашифрованные версии ключа DEP, а ключ DEP можно расшифровать только с ключами клиента или ключом доступности. Затем ключ DEP используется для шифрования ключей почтовых ящиков, которые шифруют отдельные почтовые ящики.
  
Microsoft 365 следует этому процессу для расшифровки и предоставления данных при использовании службы:
  
1. Расшифровка ключа DEP с помощью ключа клиента.

2. Для расшифровки ключа почтовых ящиков используйте расшифровку ключа DEP.

3. Для расшифровки самого почтового ящика используйте расшифровку ключа почтовых ящиков, что позволяет получать доступ к данным внутри почтового ящика.

## <a name="how-sharepoint-online-onedrive-for-business-and-teams-files-use-the-availability-key"></a>Использование ключа доступности файлов SharePoint Online, OneDrive для бизнеса и teams

Архитектура и реализация SharePoint Online и OneDrive для бизнеса и ключ доступности для клиента отличаются от Exchange Online и Skype для бизнеса.
  
Когда организация переходит на управляемые клиентом ключи, Microsoft 365 создает промежуточный ключ для конкретной организации (TIK). Microsoft 365 шифрует TIK дважды, один раз с каждым из ключей клиента, и сохраняет две зашифрованные версии TIK. Хранятся только зашифрованные версии TIK, а ТИК можно расшифровать только с помощью ключей клиента. Затем TIK используется для шифрования ключей сайта, которые затем используются для шифрования ключей blob (также называемых ключами фрагмента файлов). В зависимости от размера файла служба может разделить файл на несколько фрагментов каждого с уникальным ключом. Сами blobs (фрагменты файлов) шифруются с помощью ключей blob и хранятся в службе хранения Microsoft Azure Blob.
  
Microsoft 365 следует этому процессу для расшифровки и предоставления файлов клиентов при использовании службы:

1. Расшифровка TIK с помощью ключа клиента.

2. Использование расшифрованного TIK для расшифровки ключа сайта.

3. Для расшифровки ключа blob используйте расшифровку ключа сайта.

4. Используйте расшифрованный ключ blob для расшифровки blob.

Microsoft 365 расшифровывают TIK, выдавая два запроса на расшифровку в Хранилище ключей Azure с небольшим смещением. Первый из них, завершив предоставление результата, отменит другой запрос.
  
В случае, если вы потеряете доступ к ключам клиента, Microsoft 365 также шифрует TIK с ключом доступности и сохраняет его вместе с кодами TIKs, зашифрованными с каждым ключом клиента. Код TIK, зашифрованный с ключом доступности, используется только тогда, когда клиент вызывает Корпорацию Майкрософт для привлечения пути восстановления, когда он потерял доступ к своим ключам, злонамеренно или случайно.
  
По причинам доступности и масштабирования расшифровка TIKs кэширована в кэше памяти с ограниченным временем. За два часа до истечения срока действия кэша TIK Корпорация Майкрософт 365 пытается расшифровать каждый TIK. Расшифровка TIKs продлевает срок службы кэша. Если расшифровка TIK не удается в течение значительного времени, Microsoft 365 создает оповещение об этом перед истечением срока действия кэша. Только если клиент вызывает Microsoft, Microsoft 365 инициирует операцию восстановления, которая включает расшифровку TIK с ключом доступности, хранимым в секретном магазине Майкрософт, и повторное использование клиента с помощью расшифрованного TIK и нового набора ключей Azure Key Vault.
  
На сегодняшний день ключ клиента участвует в цепочке шифрования и расшифровки данных файлов SharePoint Online, хранимой в хранилище blob Azure, но не элементов списков SharePoint Online или метаданных, хранимых в SQL базе данных. Microsoft 365 не использует ключ доступности для файлов Exchange Online, Skype для бизнеса, SharePoint Online, OneDrive для бизнеса и Teams, кроме описанных выше дел, инициированных клиентами. Доступ человека к данным клиентов защищен клиентской блокировкой.

## <a name="availability-key-triggers"></a>Триггеры ключа доступности

Microsoft 365 запускает ключ доступности только в определенных обстоятельствах. Эти обстоятельства различаются по службе.

### <a name="triggers-for-exchange-online-and-skype-for-business"></a>Триггеры для Exchange Online и Skype для бизнеса
  
1. Microsoft 365 читает deP, которому назначен почтовый ящик, чтобы определить расположение двух ключей клиента в хранилище ключей Azure.

2. Microsoft 365 случайным образом выбирает один из двух ключей клиента от DEP и отправляет запрос в Хранилище ключей Azure для разверки ключа DEP с помощью ключа клиента.

3. Если запрос на разверчение ключа DEP с помощью ключа клиента не удается, Microsoft 365 отправляет второй запрос в Хранилище ключей Azure, на этот раз обязывая его использовать альтернативный (второй) ключ клиента.

4. Если второй запрос на разверфровку ключа DEP с помощью ключа клиента сбой, Microsoft 365 проверяет результаты обоих запросов.

    - Если экспертиза определяет, что запросы не вернули системную ошибку:

       - Microsoft 365 запускает ключ доступности для расшифровки ключа DEP.

       - Затем Microsoft 365 использует ключ DEP для расшифровки ключа почтового ящика и выполнения запроса пользователя. 

       - В этом случае хранилище ключей Azure не может отвечать или недостижимо из-за переходной ошибки.

    - Если экспертиза определяет, что запросы не удалось вернуть ACCESS DENIED:

       - Это означает, что были предприняты преднамеренные, непреднамеренные или вредоносные действия, чтобы сделать ключи клиента недоступными (например, во время процесса очистки данных при выходе из службы).

       - В этом случае ключ доступности будет использоваться только для системных действий, а не для действий пользователей, запрос пользователя сбой, и пользователь получает сообщение об ошибке.

>[!IMPORTANT]
>Код службы Microsoft 365 всегда имеет допустимый маркер входа для аргументов по данным клиентов для предоставления облачных служб с добавленной стоимостью. Поэтому до удаления ключа доступности его можно использовать в качестве отката для действий, инициированных Exchange Online или Skype для бизнеса, таких как создание индекса поиска или перемещение почтовых ящиков. Это относится как к временным ошибкам, так и к запросам ОТКАЗАНО В ДОСТУПе в Хранилище ключей Azure.

### <a name="triggers-for-sharepoint-online-onedrive-for-business-and-teams-files"></a>Триггеры для файлов SharePoint Online, OneDrive для бизнеса и Teams

Для файлов SharePoint Online, OneDrive для бизнеса и Teams ключ доступности никогда не используется вне возможностей восстановления, и клиенты должны явно поручить Корпорации Майкрософт инициировать использование ключа доступности во время сценария восстановления.

## <a name="audit-logs-and-the-availability-key"></a>Журналы аудита и ключ доступности

Автоматизированные системы в Microsoft 365 обучают все данные по мере их передачи через систему для предоставления облачных служб, например антивирусных, электронных открытий, предотвращения потери данных и индексации данных. Microsoft 365 не создает журналы, видимые клиентами для этого действия. Кроме того, сотрудники Корпорации Майкрософт не имеют доступа к вашим данным в рамках этих обычных системных операций.

### <a name="exchange-online-and-skype-for-business-availability-key-logging"></a>Ведение журнала ключей доступности Exchange Online и Skype для бизнеса

Когда Exchange Online и Skype для бизнеса имеют доступ к ключу доступности для предоставления службы, Microsoft 365 публикует клиентовидные журналы, доступные из Центра безопасности и соответствия требованиям. Запись журнала аудита для операции ключа доступности создается каждый раз, когда служба использует ключ доступности. Новый тип записи под названием "Шифрование службы ключа клиента" с типом [](./search-the-audit-log-in-security-and-compliance.md) действия "Fallback to Availability Key" позволяет администраторам фильтровать результаты поиска единого журнала аудита для просмотра записей ключевых данных доступности.

Записи журнала включают такие атрибуты, как дата, время, активность, ID организации и код политики шифрования данных. Запись доступна в рамках единого журнала аудита и доступна на вкладке Поиск журнала & центра аудита.

![Поиск журналов аудита для событий ключей доступности](../media/customerkeyauditlogsearchavailabilitykeyloggingimage.png)

В записях ключевых записей о доступности Exchange Online [](/office/office-365-management-api/office-365-management-activity-api-schema#common-schema) и Skype для бизнеса используется общая схема действий управления Office 365 с добавленными пользовательскими параметрами: Policy Id, Scope Key Version Id и Request Id.

![Настраиваемые параметры ключа доступности](../media/customerkeyauditlogsearchavailabilitykeyloggingcustomparam.png)

### <a name="sharepoint-online-onedrive-for-business-and-teams-files-availability-key-logging"></a>Журнал доступа к файлам SharePoint Online, OneDrive для бизнеса и Teams

Для этих служб журнал ключа доступности еще не доступен. Для файлов SharePoint Online, OneDrive для бизнеса и Teams ключ доступности активируется корпорацией Майкрософт только по инструкции для целей восстановления. В результате вы уже знаете каждое событие, в котором для этих служб используется ключ доступности.

## <a name="availability-key-in-the-customer-key-hierarchy"></a>Ключ доступности в иерархии ключа клиента
  
Microsoft 365 использует ключ доступности для обертывания уровня ключей ниже в иерархии ключей, установленной для шифрования службы клиентского ключа. Между службами существуют различные иерархии ключевых элементов. Ключевые алгоритмы также отличаются между клавишами доступности и другими ключами в иерархии каждой применимой службы. Ключевые алгоритмы доступности, используемые различными службами, являются следующими:

- Клавиши доступности Exchange Online и Skype для бизнеса используют AES-256.

- Ключи доступности файлов SharePoint Online, OneDrive для бизнеса и Teams используют RSA-2048.

### <a name="encryption-ciphers-used-to-encrypt-keys-for-exchange-online-and-skype-for-business"></a>Шифры шифрования, используемые для шифрования ключей для Exchange Online и Skype для бизнеса

![Шифры шифрования для ключа клиента Exchange Online](../media/customerkeyencryptionhierarchiesexchangeskype.png)

### <a name="encryption-ciphers-used-to-encrypt-keys-for-sharepoint-online-and-onedrive-for-business"></a>Шифры шифрования, используемые для шифрования ключей для SharePoint Online и OneDrive для бизнеса

![Шифры шифрования для ключа клиента SharePoint Online](../media/customerkeyencryptionhierarchiessharepointonedriveteamsfiles.png)

## <a name="related-articles"></a>Статьи по теме

- [Шифрование службы с помощью ключа клиента](customer-key-overview.md)

- [Настройка ключа клиента](customer-key-set-up.md)

- [Управление ключом клиента](customer-key-manage.md)

- [Смена или ротация ключа клиента или ключа доступности](customer-key-availability-key-roll.md)