---
title: Сведения о ключе доступности для ключа клиента
ms.author: krowley
author: kccross
manager: laurawi
ms.date: 02/05/2020
audience: ITPro
ms.topic: article
ms.service: O365-seccomp
localization_priority: Normal
search.appverid:
- MET150
description: Узнайте о ключе доступности, используемом для восстановления потерянных ключей клиента.
ms.openlocfilehash: 8e9903294d5fc25e51ef25c0ae6237c943dec6ab
ms.sourcegitcommit: 2614f8b81b332f8dab461f4f64f3adaa6703e0d6
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/21/2020
ms.locfileid: "43632028"
---
# <a name="learn-about-the-availability-key-for-customer-key"></a>Сведения о ключе доступности для ключа клиента

Ключ доступности — это корневой ключ, автоматически созданный и созданный при создании политики шифрования данных. Microsoft 365 хранит и защищает ключ доступности. Ключ доступности функционально похож на два корневых ключа, которые вы можете предоставить для шифрования службы с помощью ключа клиента. Ключ доступности обтекает ключи на один уровень ниже в иерархии ключей. В отличие от ключей, которые вы предоставляете и управляете в Azure Key Vault, вы не можете напрямую получить доступ к ключу доступности. Автоматические службы Microsoft 365 программным образом управляют ключом доступности. Эти службы инициируют автоматические операции, которые никогда не включают прямой доступ к ключу доступности.

Основная цель ключа доступности — предоставить возможность восстановления после непредвиденной потери корневых ключей, которые вы управляете. Потеря может быть результатом неуправляемого или вредоносного действия. Если вы теряете контроль над корневыми ключами, обратитесь в службу поддержки Майкрософт, и Майкрософт поможет вам в восстановлении с помощью ключа доступности. Ключ доступности используется для перехода на новую политику шифрования данных с новыми корневыми ключами.

Хранение и контроль ключа доступности намеренно отличаются от ключей Azure Key Vault по трем причинам:

- Ключ доступности обеспечивает возможность восстановления , «break-glass» в случае потери контроля над обоими ключами Azure Key Vault.
- Разделение логических элементов управления и безопасных мест хранения обеспечивает надежную защиту и защищает от потери всех ключей и данных от одной атаки или точки сбоя.
- Ключ доступности обеспечивает высокую доступность, если службы Microsoft 365 не могут получить доступ к ключам, которые находятся в Azure Key Vault из-за временных ошибок. Это правило применяется только к шифрованию служб Exchange Online и Skype для бизнеса. Файлы SharePoint Online, OneDrive для бизнеса и Teams никогда не используют ключ доступности, если вы не дали явное указание корпорации Майкрософт начать процесс восстановления.

Совместное использование ответственности за защиту данных с помощью различных методов защиты и процессов для управления ключами в конечном итоге снижает риск окончательной потери или уничтожения всех ключей (и, следовательно, ваших данных). Корпорация Майкрософт предоставляет вам единственные полномочия по отключению или уничтожению ключа доступности при уходе из службы. Никто в Корпорации Майкрософт не имеет доступа к ключу доступности: он доступен только с помощью кода службы Microsoft 365.

Дополнительные [сведения о](https://www.microsoft.com/trustcenter/Privacy/govt-requests-for-data) том, как мы защищены ключи, см. в центре управления безопасностью Майкрософт.
  
## <a name="availability-key-uses"></a>Использование ключа доступности

Ключ доступности предоставляет возможность восстановления для сценариев, в которых внешний злоумышленник или злоумышленник похищает контроль над хранилищем ключей или в случае непреднамеренного неправильного управления приводит к потере корневых ключей. Эта возможность восстановления применяется ко всем службам Microsoft 365, совместимым с ключом клиента. Отдельные службы используют ключ доступности по-разному. Microsoft 365 использует ключ доступности только в описанных ниже способах.

### <a name="exchange-online-and-skype-for-business-uses"></a>Использование Exchange Online и Skype для бизнеса

Помимо возможности восстановления Exchange Online и Skype для бизнеса используют ключ доступности для обеспечения доступности данных во время временных или периодических операционных проблем, связанных с доступом службы к корневым ключам. Если служба не может связаться ни с одним из ключей клиента в Azure Key Vault из-за временных ошибок, служба автоматически использует ключ доступности. Служба НИКОГДА не переходит непосредственно к ключу доступности.

Автоматизированные системы в Exchange Online и Skype для бизнеса могут использовать ключ доступности во время временных ошибок для поддержки автоматических серверных служб, таких как антивирусная программа, обнаружение электронных данных, предотвращение потери данных, перемещение почтовых ящиков и индексация данных.

### <a name="sharepointonlineonedriveforbusinessandteamsfiles-uses"></a>Файлы SharePoint Online, OneDrive для бизнеса и Teams используются

Для файлов SharePoint Online, OneDrive для бизнеса и Teams ключ доступности НИКОГДА не используется вне возможности восстановления, и клиенты должны явно проинструкировать корпорацию Майкрософт о том, что необходимо инициировать использование ключа доступности во время сценария восстановления. Автоматизированные операции службы зависят исключительно от ключей клиента в хранилище ключей Azure. Более подробную информацию о работе иерархии ключей для этих служб см. в файлах [SharePoint Online, OneDrive для](#how-sharepoint-online-onedrive-for-business-and-teams-files-use-the-availability-key)бизнеса и Teams с использованием ключа доступности.

## <a name="availability-key-security"></a>Безопасность ключа доступности

Корпорация Майкрософт делится с вами ответственностью за защиту данных, замеируя ключ доступности и принимая все меры для его защиты. Корпорация Майкрософт не предоставляет клиентам прямое управление ключом доступности. Например, вы можете свернуть (поворачивать) только ключи, которые вы владеете в Azure Key Vault. Дополнительные сведения см. в [подкатеголи или повороте ключа клиента или ключа доступности.](customer-key-availability-key-roll.md)

### <a name="availability-key-secret-stores"></a>Хранилища секретов ключей доступности

Корпорация Майкрософт защищает ключи доступности в контролируемых доступом внутренних хранилищах секретов, таких как клиентская служба Azure Key Vault. Мы реализуем элементы управления доступом, чтобы администраторы Майкрософт не могли напрямую получать доступ к секретам, которые содержатся в нем. Операции с секретным хранилищем, включая поворот и удаление ключей, происходят с помощью автоматических команд, которые никогда не включают прямой доступ к ключу доступности. Операции управления секретным хранилищем ограничены определенными инженерами и требуют эскалации привилегий через внутреннее средство Lockbox. Для эскалации привилегий требуется утверждение и обоснование руководителя перед предоставлением. Lockbox гарантирует, что доступ ограничен временем с автоматическим отзывом доступа по истечении срока действия или выходу инженера.

**Ключи доступности Exchange Online** и Skype для бизнеса хранятся в секретном хранилище Active Directory Exchange Online. Ключи доступности надежно хранятся в контейнерах определенного клиента в контроллере домена Active Directory. Это безопасное хранилище изолировано от хранилища секретов файлов SharePoint Online, OneDrive для бизнеса и Teams.

**Ключи доступности файлов SharePoint Online, OneDrive** для бизнеса и Teams хранятся во внутреннем хранилище секретов, управляемом командой службы. Эта защищенная служба хранения секретов имеет серверы переднего сервера с конечными точками приложений и SQL базы данных в качестве серверной части. Ключи доступности хранятся в базе данных SQL и заверяются (шифруются) ключами шифрования секретного хранения, которые используют сочетание AES-256 и HMAC для шифрования ключа доступности. Ключи шифрования секретного хранения хранятся в логически изолированном компоненте той же базы данных SQL и затем шифруются с помощью ключей RSA-2048, содержащихся в сертификатах, управляемых ЦС Майкрософт. Эти сертификаты хранятся на серверах переднего сервера секретного хранения, которые выполняют операции с базой данных.

### <a name="defense-in-depth"></a>Углубленный анализ защиты

Корпорация Майкрософт использует стратегию глубокой защиты, чтобы предотвратить влияние злоумышленников на конфиденциальность, целостность или доступность данных клиентов, хранимых в Microsoft Cloud. Специальные профилактические и оперативно-разыскные средства контроля реализуются для защиты секретного хранения и ключа доступности в рамках стратегии обеспечения безопасности.

Microsoft 365 создан для предотвращения неправильного использования ключа доступности. Уровень приложения — это единственный метод, с помощью которого ключи, включая ключ доступности, можно использовать для шифрования и расшифровки данных. Только код службы Microsoft 365 может интерпретировать и обходить иерархию ключей для действий шифрования и расшифровки. Существует логическая изоляция между расположениями хранилища ключей клиента, ключами доступности, другими иерархическими ключами и данными клиента. Такая изоляция снижает риск экспозиции данных в случае компрометации одного или нескольких местоположений. Каждый уровень иерархии имеет встроенные возможности обнаружения вторжений 24x7 для защиты хранимых данных и секретов.

Элементы управления доступом реализованы для предотвращения несанкционированного доступа к внутренним системам, включая секретные хранилища ключей доступности. Инженеры Майкрософт не имеют прямого доступа к секретным хранилищам ключей доступности. Дополнительные подробные информацию об средствах управления доступом можно просмотреть в [средствах контроля административного доступа в Microsoft 365.](https://docs.microsoft.com/Office365/securitycompliance/office-365-administrative-access-controls-overview)

Технические средства контроля не помешали персоналу Майкрософт войти в учетные записи служб с высокой привилегией, которые в противном случае могут использоваться злоумышленниками для подстановки служб Майкрософт. Например, эти элементы управления препятствуют интерактивному окну.

Средства ведения журнала безопасности и мониторинга — это еще одна реализованная защита, которая снижает риск для служб Майкрософт и ваших данных. Группы служб Майкрософт развернули активные решения мониторинга, которые создают оповещения и журналы аудита. Все группы обслуживания загружают свои журналы в центральный репозиторий, где они объединяются и обрабатываются. Внутренние средства автоматически проверяют записи, чтобы подтвердить, что службы работают в оптимальном, устойчивом и безопасном состоянии. Необычные действия помечаются для дальнейшего рассмотрения.

Любое событие журнала, которое указывает на возможное нарушение политики безопасности Майкрософт, сразу же привлекаем к себе внимание групп безопасности Майкрософт. Microsoft 365 security has configured alerts to detect attempted access to availability key secret stores. Оповещения также создаются, если персонал Майкрософт пытается в интерактивном режиме присоединения к учетным записям служб, что запрещено и защищено средствами управления доступом. Система безопасности Microsoft 365 также обнаруживает и оповещает о отклонениях службы Microsoft 365 от обычных базовых операций. Злоумышленники, пытающиеся неправильно использовать службы Microsoft 365, вызывают оповещения, что приводит к исключениям злоумышленников из облачной среды Майкрософт.

## <a name="use-the-availability-key-to-recover-from-key-loss"></a>Использование ключа доступности для восстановления после потери ключа

Если вы теряете контроль над ключами клиента, ключ доступности предоставляет возможность восстановления и повторного шифрования данных.

### <a name="recovery-procedure-for-exchange-online-and-skype-for-business"></a>Процедура восстановления для Exchange Online и Skype для бизнеса

Если вы теряете контроль над ключами клиента, ключ доступности предоставляет возможность восстановить данные и вернуть ресурсы Microsoft 365 к сети. Ключ доступности по-прежнему защищает данные при восстановлении. На высоком уровне, чтобы полностью восстановиться после потери ключа, необходимо создать deP и переместить в нее ресурсы.

Чтобы зашифровать данные с помощью новых ключей клиента, создайте новые ключи в Azure Key Vault, создайте deP с помощью новых ключей клиента, а затем назначьте новый DEP почтовым ящикам, зашифрованным с помощью предыдущего DEP, для которого ключи были потеряны или скомпрометированы.

Процесс повторного шифрования может занять до 72 часов. Это стандартная продолжительность при изменении DEP.
  
### <a name="recovery-procedure-for-sharepointonlineonedriveforbusinessandteamsfiles"></a>Процедура восстановления файлов SharePoint Online, OneDrive для бизнеса и Teams

Для файлов SharePoint Online, OneDrive для бизнеса и Teams ключ доступности НИКОГДА не используется вне возможности восстановления. Необходимо явно проинструкировать корпорацию Майкрософт о том, что необходимо инициировать использование ключа доступности во время сценария восстановления. Чтобы инициировать процесс восстановления, обратитесь в корпорацию Майкрософт, чтобы активировать ключ доступности. После активации ключ доступности автоматически используется для расшифровки данных, позволяя шифровать данные с помощью созданного DEP, связанного с новыми ключами клиента.  

Эта операция пропорциональна количеству сайтов в организации. После вызова Корпорации Майкрософт для использования ключа доступности вы должны быть полностью в сети в течение четырех часов.

## <a name="how-exchange-online-and-skype-for-business-use-the-availability-key"></a>Использование ключа доступности в Exchange Online и Skype для бизнеса

При создании DEP с ключом клиента Microsoft 365 создает ключ политики шифрования данных (DEP Key), связанный с этим DEP. Служба шифрует ключ DEP три раза: один раз с каждым ключом клиента и один раз с ключом доступности. Сохраняются только зашифрованные версии ключа DEP, а ключ DEP можно расшифровать только с помощью ключей клиента или ключа доступности. Затем ключ DEP используется для шифрования ключей почтовых ящиков, которые шифруют отдельные почтовые ящики.
  
Microsoft 365 следует этому процессу для расшифровки и предоставления данных при использовании службы клиентами:
  
1. Расшифровка ключа DEP с помощью ключа клиента.

2. Расшифровывать ключ почтового ящика с помощью расшифрованного ключа DEP.

3. Расшифровка самого почтового ящика с помощью расшифрованного ключа почтового ящика позволяет получить доступ к данным в почтовом ящике.

## <a name="how-sharepoint-online-onedrive-for-business-and-teams-files-use-the-availability-key"></a>Использование ключа доступности для файлов SharePoint Online, OneDrive для бизнеса и Teams

Архитектура и реализация SharePoint Online и OneDrive для бизнеса для ключа клиента и ключа доступности отличаются от Exchange Online и Skype для бизнеса.
  
Когда организация переходит к ключам, управляемым клиентом, Microsoft 365 создает специальный промежуточный ключ (TIK) для конкретной организации. Microsoft 365 дважды шифрует TIK, один раз с каждым ключом клиента, и сохраняет две зашифрованные версии этого ключа. Сохраняются только зашифрованные версии TIK, и их можно расшифровать только с помощью ключей клиента. Затем TIK используется для шифрования ключей сайта, которые затем используются для шифрования ключей BLOB-файлов (также называемых ключами блоков файлов). В зависимости от размера файла служба может разделить файл на несколько блоков с уникальным ключом. Сами большие объемы (блоки файлов) шифруются с помощью ключей BLOB-файлов и хранятся в службе хранилища BLOB-файлов Microsoft Azure.
  
Microsoft 365 следует этому процессу для расшифровки и предоставления файлов клиентов при использовании службы:

1. Расшифруйте TIK с помощью ключа клиента.

2. Расшифровка ключа сайта с помощью расшифрованного ключа TIK.

3. Расшифровывать ключ BLOB-объекта с помощью расшифрованного ключа сайта.

4. Расшифровывать этот BLOB-элемент можно с помощью расшифрованного ключа.

Microsoft 365 расшифровывают TIK, выдавая два запроса на расшифровку в Хранилище Ключей Azure с небольшим смещением. Первый из них, завершив предоставление результата, отменяет другой запрос.
  
На случай присоединения к ключам клиента Microsoft 365 также шифрует ключ доступности и сохраняет его вместе с ключами TIKs, зашифрованными с помощью каждого ключа клиента. Ключ TIK, зашифрованный с помощью ключа доступности, используется только в том случае, если клиент вызывает корпорацию Майкрософт для получения пути восстановления, если он случайно или злонамеренно теряет доступ к своим ключам.
  
Из соображений доступности и масштабирования расшифровка ключей TIKs кэширована в кэше памяти с ограниченным временем времени. За два часа до истечения срока действия кэша TIK Microsoft 365 пытается расшифровать каждый из них. Расшифровка ключей TIKs продлевает срок действия кэша. Если расшифровка TIK не удается в течение значительного количества времени, Microsoft 365 создает оповещение для уведомления инженеров до истечения срока действия кэша. Только если клиент вызывает Корпорацию Майкрософт, Microsoft 365 инициирует операцию восстановления, которая включает расшифровку TIK с ключом доступности, хранимым в секретном хранилище Майкрософт, и повторное вставку клиента с помощью расшифрованного ключа TIK и нового набора ключей Azure Key Vault, предоставленных клиентом.
  
На сегодняшний день ключ клиента участвует в цепочке шифрования и расшифровки данных файлов SharePoint Online, хранимой в хранилище BLOB-объектов Azure, но не элементов списков и метаданных SharePoint Online, которые хранятся в базе данных SQL. Microsoft 365 не использует ключ доступности для файлов Exchange Online, Skype для бизнеса, SharePoint Online, OneDrive для бизнеса и Teams, кроме описанных выше дел, инициированных клиентом. Доступ человека к данным клиента защищенным защищенным почтовым ящиком клиента.

## <a name="availability-key-triggers"></a>Триггеры клавиш доступности

Microsoft 365 активирует ключ доступности только при определенных обстоятельствах. Эти обстоятельства отличаются в разных службах.

### <a name="triggers-for-exchange-online-and-skype-for-business"></a>Триггеры для Exchange Online и Skype для бизнеса
  
1. Microsoft 365 считывал deP, которому назначен почтовый ящик, чтобы определить расположение двух ключей клиента в хранилище Azure Key Vault.

2. Microsoft 365 случайным образом выбирает один из двух ключей клиента из DEP и отправляет запрос в хранилище Azure Key Vault, чтобы отослать ключ DEP с помощью ключа клиента.

3. Если запрос на разверфровку ключа DEP с помощью ключа клиента не удается, Microsoft 365 отправляет второй запрос в Azure Key Vault, на этот раз поручив ему использовать альтернативный (второй) ключ клиента.

4. Если второй запрос на разверфровку ключа DEP с помощью ключа клиента не удается, Microsoft 365 проверяет результаты обоих запросов.

    - Если анализ определяет, что запросы не вернули системную ошибку:

       - Microsoft 365 активирует ключ доступности для расшифровки ключа DEP.

       - Затем Microsoft 365 использует ключ DEP для расшифровки ключа почтового ящика и выполнения запроса пользователя. 

       - В этом случае Azure Key Vault не может ответить или недостижим из-за временных ошибок.

    - Если анализ определяет, что запросы не вернули ACCESS DENIED:

       - Это означает, что были предприняты преднамеренное, непреднамеренное или вредоносное действие, чтобы сделать ключи клиента недоступными (например, во время процесса очистки данных при выходе из службы).

       - В этом случае ключ доступности будет использоваться только для системных действий, а не для действий пользователя, запрос пользователя не будет сбой, и пользователь получит сообщение об ошибке.

>[!IMPORTANT]
>Код службы Microsoft 365 всегда имеет действительный маркер входа для проверки данных клиента для предоставления облачных служб с добавлением значений. Таким образом, до удаления ключа доступности его можно использовать как резервную ставку для действий, инициированных Exchange Online или Skype для бизнеса, таких как создание индекса поиска или перемещение почтовых ящиков. Это относится как к временным ОШИБКАМ, так и к запросам ACCESS DENIED в Azure Key Vault.

### <a name="triggers-for-sharepoint-online-onedrive-for-business-and-teams-files"></a>Триггеры для файлов SharePoint Online, OneDrive для бизнеса и Teams

Для файлов SharePoint Online, OneDrive для бизнеса и Teams ключ доступности НИКОГДА не используется вне возможности восстановления, и клиенты должны явно проинструкировать корпорацию Майкрософт о том, что необходимо инициировать использование ключа доступности во время сценария восстановления.

## <a name="audit-logs-and-the-availability-key"></a>Журналы аудита и ключ доступности

Автоматизированные системы в Microsoft 365 обрабатывает все данные по мере их передачи в систему, чтобы предоставлять облачные службы, например антивирусные программы, обнаружение электронных данных, предотвращение потери данных и индексация данных. Microsoft 365 не создает журналы, видимые клиенту для этого действия. Кроме того, сотрудники майкрософт не имеют доступа к вашим данным в рамках этих обычных системных операций.

### <a name="exchange-online-and-skype-for-business-availability-key-logging"></a>Ведение журнала ключей доступности Exchange Online и Skype для бизнеса

Когда Exchange Online и Skype для бизнеса предоставляют доступ к ключу доступности для предоставления услуг, Microsoft 365 публикует доступные клиентам журналы, доступные в Центре безопасности и соответствия требованиям. Запись журнала аудита для операции с ключом доступности создается каждый раз, когда служба использует ключ доступности. Новый тип записи под названием "Шифрование службы ключа клиента" с типом [](https://docs.microsoft.com/microsoft-365/compliance/search-the-audit-log-in-security-and-compliance) действия "Откат к ключу доступности" позволяет администраторам фильтровать результаты поиска в едином журнале аудита для просмотра записей ключей доступности.

Записи журнала включают такие атрибуты, как дата, время, действие, код организации и код политики шифрования данных. Запись доступна в единых журналах аудита и доступна на вкладке поиска & журнала аудита Центра безопасности и соответствия требованиям.

![Поиск событий ключа доступности в журнале аудита](../media/customerkeyauditlogsearchavailabilitykeyloggingimage.png)

В записях ключей доступности Exchange Online и Skype для [](https://docs.microsoft.com/office/office-365-management-api/office-365-management-activity-api-schema#common-schema) бизнеса используется общая схема действий управления Office 365 с добавленными пользовательскими параметрами: ИД политики, ИД версии ключа области и ИД запроса.

![Настраиваемые параметры ключа доступности](../media/customerkeyauditlogsearchavailabilitykeyloggingcustomparam.png)

### <a name="sharepoint-online-onedrive-for-business-and-teams-files-availability-key-logging"></a>Ведение журнала доступности файлов SharePoint Online, OneDrive для бизнеса и Teams

Ведение журнала ключей доступности пока не доступно для этих служб. Для файлов SharePoint Online, OneDrive для бизнеса и Teams ключ доступности активируется только корпорацией Майкрософт в целях восстановления. В результате вы уже знаете все события, в которых для этих служб используется ключ доступности.

## <a name="availability-key-in-the-customer-key-hierarchy"></a>Ключ доступности в иерархии ключей клиента
  
Microsoft 365 использует ключ доступности для переноса уровня ключей ниже в иерархии ключей, установленной для шифрования службы ключа клиента. Между службами существуют разные иерархии ключей. Ключевые алгоритмы также различаются между ключами доступности и другими ключами в иерархии каждой применимой службы. Алгоритмы ключей доступности, используемые различными службами, следуют следующим образом:

- Ключи доступности Exchange Online и Skype для бизнеса используют AES-256.

- Ключи доступности файлов SharePoint Online, OneDrive для бизнеса и Teams используют RSA-2048.

### <a name="encryption-ciphers-used-to-encrypt-keys-for-exchange-online-and-skype-for-business"></a>Шифрование шифров, используемых для шифрования ключей для Exchange Online и Skype для бизнеса

![Шифры шифрования для ключа клиента Exchange Online](../media/customerkeyencryptionhierarchiesexchangeskype.png)

### <a name="encryption-ciphers-used-to-encrypt-keys-for-sharepoint-online-and-onedrive-for-business"></a>Шифры шифрования, используемые для шифрования ключей для SharePoint Online и OneDrive для бизнеса

![Шифрование шифров для ключа клиента SharePoint Online](../media/customerkeyencryptionhierarchiessharepointonedriveteamsfiles.png)

## <a name="related-articles"></a>Статьи по теме

- [Шифрование службы с помощью ключа клиента](customer-key-overview.md)

- [Настройка ключа клиента](customer-key-set-up.md)

- [Управление ключом клиента](customer-key-manage.md)

- [Смена или ротация ключа клиента или ключа доступности](customer-key-availability-key-roll.md)
