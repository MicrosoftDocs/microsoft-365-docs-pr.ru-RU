---
title: Экспорт, настройка и просмотр записей журнала аудита
f1.keywords:
- NOCSH
ms.author: markjjo
author: markjjo
manager: laurawi
audience: Admin
ms.topic: how-to
ms.service: O365-seccomp
localization_priority: Normal
ms.collection:
- Strat_O365_IP
- M365-security-compliance
search.appverid:
- MOE150
- MET150
ms.assetid: 0d4d0f35-390b-4518-800e-0c7ec95e946c
ms.custom: seo-marvel-apr2020
description: В этой статье вы узнаете, как экспортировать, настраивать и просматривать записи журналов аудита Microsoft 365.
ms.openlocfilehash: a7f731bb30ffdddfe7898ee4051060b8e22c093e
ms.sourcegitcommit: 375168ee66be862cf3b00f2733c7be02e63408cf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/04/2021
ms.locfileid: "50454670"
---
# <a name="export-configure-and-view-audit-log-records"></a>Экспорт, настройка и просмотр записей журнала аудита

После поиска журнала аудита и загрузки результатов поиска в CSV-файл файл содержит столбец **AuditData,** содержащий дополнительные сведения о каждом событии. Данные в этом столбце отформатированы как объект JSON, который содержит несколько свойств, настроенных как *свойства:пары* значений, разделенные запятой. Вы можете использовать функцию преобразования JSON в редакторе запроса питания в Excel, чтобы разделить каждое свойство объекта JSON в столбце **AuditData** на несколько столбцов, чтобы каждое свойство было иметь свой столбец. Это позволяет сортировать и фильтровать одно или несколько этих свойств, что поможет быстро найти определенные данные аудита, которые вы ищете.

## <a name="step-1-export-audit-log-search-results"></a>Шаг 1. Экспорт результатов поиска журнала аудита

Первым шагом является поиск журнала аудита, а затем экспорт результатов в разделенном запятой файле значения (CSV) на локальном компьютере.
  
1. Запустите [поиск журнала аудита](search-the-audit-log-in-security-and-compliance.md#search-the-audit-log) и при необходимости пересмотрите критерии поиска до тех пор, пока не будет желаемых результатов.

2. Нажмите **кнопку Экспорт результатов** и **выберите Скачать все результаты**. 

   ![Щелкните Скачать все результаты](../media/ExportAuditSearchResults.png)

   Этот параметр экспортирует все записи аудита из поиска журнала аудита, который вы запустили на шаге 1, и загружает необработанные данные из журнала аудита в CSV-файл. 

   В нижней части окна отображается сообщение, которое позволяет открыть или сохранить CSV-файл. 

3. Нажмите **кнопку Сохранить > сохранить** как и сохранить CSV-файл на локальном компьютере. Загрузка многих результатов поиска занимает некоторое время. Обычно это происходит при поиске всех действий или широкого диапазона дат. Сообщение в нижней части окна отображается при загрузке CSV-файла.

   ![Сообщение, отображаемая при загрузке CSV-файла](../media/ExportAuditSearchResultsFinish.png)

> [!NOTE]
  > В CSV-файл можно загрузить до 50 000 записей результатов одной операции поиска по журналу аудита. Если в CSV-файл загружено 50 000 записей, можно предположить, что условиям поиска соответствует более 50 000 событий. Чтобы экспортировать больше, чем это ограничение, попробуйте использовать диапазон дат, чтобы уменьшить количество записей журналов аудита. Чтобы экспортировать больше 50 000 записей, вы можете выполнить поиск несколько раз со смежными диапазонами дат.

## <a name="step-2-format-the-exported-audit-log-using-the-power-query-editor"></a>Шаг 2. Формат экспортируемой журнал аудита с помощью редактора power query

Следующим шагом является использование функции преобразования JSON в редакторе запроса питания в Excel, чтобы разделить каждое свойство объекта JSON в столбце **AuditData** на свой столбец. Затем вы фильтруете столбцы для просмотра записей на основе значений определенных свойств. Это поможет вам быстро найти определенные данные аудита, которые вы ищете.

1. Откройте пустую книгу в Excel для Office 365, Excel 2019 или Excel 2016.

2. На **вкладке Data** в **группе ленты Get & преобразование** данных нажмите **кнопку Текст/CSV**.

    ![На вкладке Data нажмите кнопку Text/CSV](../media/JSONTransformOpenCSVFile.png)

3. Откройте файл CSV, загруженный в шаге 1.

4. В отображаемом окне щелкните **Преобразование данных.**

   ![Щелкните Преобразование данных](../media/JSONOpenPowerQuery.png)

   Файл CSV открыт в **редакторе запроса.** Существует четыре столбца: **CreationDate,** **UserIds,** **Operations** и **AuditData.** Столбец **AuditData** — это объект JSON, содержащий несколько свойств. Следующий шаг — создание столбца для каждого свойства объекта JSON.

5. Щелкните правой кнопкой мыши название в столбце **AuditData,** щелкните **Преобразование** и нажмите **кнопку JSON**. 

   ![Щелкните правой кнопкой мыши столбец AuditData, щелкните Преобразование и выберите JSON](../media/JSONTransform.png)

6. В верхнем правом углу столбца **AuditData** щелкните значок расширения.

   ![В столбце AuditData щелкните значок расширения](../media/JSONTransformExpandIcon.png)

   Отображается неполный список свойств объектов JSON в столбце **AuditData.**

7. Щелкните **Загрузить больше,** чтобы отобразить все свойства в объектах JSON в столбце **AuditData.**

   ![Щелкните Загрузить больше, чтобы отобразить все свойства в объекте JSON](../media/JSONTransformLoadJSONProperties.png)

   Вы можете отключить почтовый ящик рядом с любым свойством, которое вы не хотите включать. Устранение столбцов, которые не являются полезными для вашего расследования, — это хороший способ уменьшить количество данных, отображающихся в журнале аудита. 

   > [!NOTE]
   > Свойства JSON, отображаемые на предыдущем скриншоте (после нажатия нагрузки **больше),** основаны на свойствах, найденных в столбце **AuditData** из первых 1000 строк в CSV-файле. Если после первых 1000 строк в записях имеются различные свойства JSON, эти свойства (и соответствующий столбец) не будут включены при разделении столбца **AuditData** на несколько столбцов. Чтобы предотвратить это, рассмотрите возможность повторного запуска поиска журнала аудита и сузить критерии поиска, чтобы было возвращено меньше записей. Другим обходным решением является фильтрация элементов в столбце **Operations,** чтобы уменьшить число строк (перед выполнением шага 5 выше) перед преобразованием объекта JSON в столбце **AuditData.**

   > [!TIP]
   > Чтобы просмотреть атрибут в списке, например AuditData.AffectedItems, щелкните значок Расширение в правом верхнем углу столбца, из чего нужно вытащить атрибут, а затем выберите Расширение до **New Row**.   Оттуда будет запись, и вы можете щелкнуть значок **Расширение** в верхнем правом углу столбца, просмотреть атрибуты и выбрать тот, который необходимо просмотреть или извлечь.

8. Сделайте одно из следующих вещей для формата заголовка столбцов, добавляемого для каждого выбранного свойства JSON.

    - Отклонйте исходное имя **столбца** в качестве почтового ящика префикса, чтобы использовать имя свойства JSON в качестве имен столбцов; например, **RecordType** или **SourceFileName.**

    - Оставьте **исходное имя столбца в** качестве почтового ящика префикса, выбранного для добавления префикса AuditData в имена столбцов; например, **AuditData.RecordType** или **AuditData.SourceFileName.**

9. Нажмите кнопку **ОК**.

    Столбец **AuditData** разделен на несколько столбцов. Каждый новый столбец соответствует свойству объекта AuditData JSON. Каждая строка в столбце содержит значение свойства. Если свойство не содержит значения, отображается *значение null.* В Excel ячейки со значениями null пусты.
  
10. На **вкладке Главная** **нажмите кнопку Закрыть &,** чтобы закрыть редактор запроса питания и открыть преобразованный CSV-файл в книге Excel.

## <a name="use-powershell-to-search-and-export-audit-log-records"></a>Использование PowerShell для поиска и экспорта записей журналов аудита

Вместо использования средства поиска журналов аудита в Центре & обеспечения [](https://docs.microsoft.com/powershell/module/exchange/search-unifiedauditlog) соответствия требованиям можно использовать в Exchange Online PowerShell для экспорта результатов поиска журнала аудита в CSV-файл. Затем вы можете следовать той же процедуре, описанной в шаге 2, чтобы форматирование журнала аудита с помощью редактора Power Query. Одно из преимуществ использования комлета PowerShell заключается в том, что вы можете искать события из определенной службы с помощью *параметра RecordType.* Вот несколько примеров использования PowerShell для экспорта записей аудита в CSV-файл, чтобы можно было использовать редактор Power Query для преобразования объекта JSON в столбце **AuditData,** как описано в шаге 2.

В этом примере запустите следующие команды, чтобы вернуть все записи, связанные с операциями общего доступа SharePoint.

```powershell
$auditlog = Search-UnifiedAuditLog -StartDate 06/01/2019 -EndDate 06/30/2019 -RecordType SharePointSharingOperation
```

```powershell
$auditlog | Select-Object -Property CreationDate,UserIds,RecordType,AuditData | Export-Csv -Path c:\AuditLogs\PowerShellAuditlog.csv -NoTypeInformation
```

Результаты поиска экспортируются в CSV-файл с именем *PowerShellAuditlog,* содержащий четыре столбца: CreationDate, UserIds, RecordType, AuditData.

В качестве значения параметра *RecordType* можно также использовать имя или значение переписи для типа записи. Список имен типов записей и соответствующих значений списка см. в таблице *AuditLogRecordType* в схеме API управления [Office 365.](https://docs.microsoft.com/office/office-365-management-api/office-365-management-activity-api-schema#enum-auditlogrecordtype---type-edmint32)

Можно включить только одно значение для *параметра RecordType.* Чтобы найти записи аудита для других типов записей, необходимо выполнить две предыдущие команды, чтобы указать другой тип записи и примедить эти результаты к исходному CSV-файлу. Например, вы запустите следующие две команды, чтобы добавить действия файла SharePoint из того же диапазона дат в PowerShellAuditlog.csv файл.

```powershell
$auditlog = Search-UnifiedAuditLog -StartDate 06/01/2019 -EndDate 06/30/2019 -RecordType SharePointFileOperation
```

```powershell
$auditlog | Select-Object -Property CreationDate,UserIds,RecordType,AuditData | Export-Csv -Append -Path c:\AuditLogs\PowerShellAuditlog.csv -NoTypeInformation
```

## <a name="tips-for-exporting-and-viewing-the-audit-log"></a>Советы по экспорту и просмотру журнала аудита

Ниже представлены некоторые советы и примеры экспорта и просмотра журнала аудита до и после использования функции преобразования JSON для разделения столбца **AuditData** на несколько столбцов.

- Фильтр **столбца RecordType** для отображения только записей из определенной службы или функциональной области. Например, чтобы показать события, связанные с совместной деятельностью SharePoint, необходимо выбрать **14** (значение enum для записей, запускаемой действиями совместного доступа SharePoint). Список служб, соответствующих значениям списка, отображаемого в столбце **RecordType,** см. в статье Подробные свойства в [журнале аудита.](detailed-properties-in-the-office-365-audit-log.md)

- Фильтр **столбца Operations** для отображения записей для определенных действий. Список большинства операций, соответствующих поисковой активности в средстве поиска журналов аудита в Центре соответствия требованиям & безопасности, см. в разделе "Аудит действий" в разделе Поиск журнала аудита в Центре соответствия требованиям & [безопасности.](search-the-audit-log-in-security-and-compliance.md#audited-activities)
