---
title: Экспорт, настройка и просмотр записей журнала аудита
f1.keywords:
- NOCSH
ms.author: markjjo
author: markjjo
manager: laurawi
audience: Admin
ms.topic: how-to
ms.service: O365-seccomp
localization_priority: Normal
ms.collection:
- Strat_O365_IP
- M365-security-compliance
search.appverid:
- MOE150
- MET150
ms.assetid: 0d4d0f35-390b-4518-800e-0c7ec95e946c
ms.custom: seo-marvel-apr2020
description: В этой статье вы узнаете, как экспортировать, настраивать и просматривать записи журнала аудита Microsoft 365.
ms.openlocfilehash: 688ba06fc9c5c2b26eef93fb1a68d311db9da5d8
ms.sourcegitcommit: 9ce9001aa41172152458da27c1c52825355f426d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/03/2020
ms.locfileid: "47358497"
---
# <a name="export-configure-and-view-audit-log-records"></a>Экспорт, настройка и просмотр записей журнала аудита

После поиска в журнале аудита и скачивания результатов поиска в CSV-файл он содержит столбец с именем **аудитдата**, который содержит дополнительные сведения о каждом событии. Данные в этом столбце отформатированы как объект JSON, который содержит несколько свойств, которые настроены как пары *свойство: значение* , разделенные запятыми. Можно использовать функцию преобразования JSON в редакторе Power Query в Excel, чтобы разделить каждое свойство в объекте JSON в столбце **аудитдата** на несколько столбцов, чтобы каждое свойство было иметь собственный столбец. Это позволяет сортировать и фильтровать по одному или нескольким из этих свойств, которые могут помочь быстро найти конкретные искомые данные аудита.

## <a name="step-1-export-audit-log-search-results"></a>Шаг 1: экспорт результатов поиска в журнал аудита

Первый шаг — Поиск в журнале аудита, а затем Экспорт результатов в файл с разделителями-запятыми (CSV) на локальный компьютер.
  
1. Выполните [Поиск по журналу аудита](search-the-audit-log-in-security-and-compliance.md#search-the-audit-log) и изменяйте критерии поиска, если это необходимо, до тех пор, пока не получите нужные результаты.

2. Нажмите кнопку **Экспорт результатов** и выберите **скачать все результаты**. 

   ![Щелкните скачать все результаты](../media/ExportAuditSearchResults.png)

   Этот параметр экспортирует все записи аудита из поиска журнала аудита, выполненного на шаге 1, и загружает необработанные данные из журнала аудита в CSV-файл. 

   В нижней части окна отобразится сообщение с предложением открыть или сохранить CSV-файл. 

3. Нажмите кнопку **сохранить > сохранить как** и сохраните CSV-файл на локальном компьютере. Загрузка множества результатов поиска занимает некоторое время. Обычно это относится к поиску всех действий или широкому диапазону дат. Сообщение в нижней части окна отображается после завершения загрузки CSV-файла.

   ![Сообщение, отображаемое при завершении скачивания CSV-файла](../media/ExportAuditSearchResultsFinish.png)

> [!NOTE]
  > В CSV-файл можно загрузить до 50 000 записей результатов одной операции поиска по журналу аудита. Если в CSV-файл загружено 50 000 записей, можно предположить, что условиям поиска соответствует более 50 000 событий. Чтобы экспортировать больше этого ограничения, попробуйте использовать диапазон дат, чтобы уменьшить количество записей в журнале аудита. Чтобы экспортировать больше 50 000 записей, вы можете выполнить поиск несколько раз со смежными диапазонами дат.

## <a name="step-2-format-the-exported-audit-log-using-the-power-query-editor"></a>Шаг 2: форматирование экспортированного журнала аудита с помощью редактора Power Query

Следующий шаг — использование функции преобразования JSON в редакторе Power Query в Excel, чтобы разделить каждое свойство в объекте JSON в столбце **аудитдата** на отдельный столбец. Затем вы фильтруете столбцы, чтобы просматривать записи на основе значений определенных свойств. Это поможет быстро найти конкретные искомые данные аудита.

1. Откройте пустую книгу в Excel для Office 365, Excel 2019 или Excel 2016.

2. На вкладке **данные** в группе " **Получение & преобразования данных** " щелкните **из текстового/CSV-** файла.

    ![На вкладке Данные щелкните из текста/CSV](../media/JSONTransformOpenCSVFile.png)

3. Откройте CSV-файл, скачанный в действии 1.

4. В появившемся окне нажмите кнопку **преобразовать данные**.

   ![Нажмите кнопку преобразования данных](../media/JSONOpenPowerQuery.png)

   CSV-файл открывается в **редакторе запросов**. Существует четыре столбца: **CreationDate**, **UserID**, **Operations**и **аудитдата**. Столбец **аудитдата** — это объект JSON, который содержит несколько свойств. Следующий шаг — создание столбца для каждого свойства в объекте JSON.

5. Щелкните правой кнопкой мыши заголовок в столбце **аудитдата** , выберите команду **преобразовать**, а затем — **JSON**. 

   ![Щелкните правой кнопкой мыши столбец Аудитдата, выберите команду Преобразовать, а затем выберите пункт JSON.](../media/JSONTransform.png)

6. В правом верхнем углу столбца **аудитдата** щелкните значок развернуть.

   ![В столбце Аудитдата щелкните значок развертывания](../media/JSONTransformExpandIcon.png)

   Отображается неполный список свойств в объектах JSON в столбце **аудитдата** .

7. Нажмите кнопку **загрузить еще** , чтобы отобразить все свойства в объектах JSON в столбце **аудитдата** .

   ![Нажмите кнопку Загрузить еще, чтобы отобразить все свойства в объекте JSON.](../media/JSONTransformLoadJSONProperties.png)

   Вы можете снять флажок рядом со свойством, которое вы не хотите включать. Удаление столбцов, которые не подходят для расследования, — это хороший способ уменьшить объем данных, отображаемых в журнале аудита. 

   > [!NOTE]
   > Свойства JSON, отображаемые на предыдущем снимке экрана (после нажатия кнопки **загрузить больше**), основываются на свойствах, найденных в столбце **аудитдата** из первых 1 000 строк в CSV-файле. Если в записях есть различные свойства JSON в записях после первой строки 1 000, эти свойства (и соответствующий столбец) не будут включены при разбиении столбца **аудитдата** на несколько столбцов. Чтобы избежать этого, рассмотрите возможность повторного запуска поиска в журнале аудита и сужения критериев поиска, чтобы возвращалось меньше записей. Другим обходным решением является фильтрация элементов в столбце " **операции** " для сокращения числа строк (перед выполнением шага 5 перед преобразованием объекта JSON в столбец **аудитдата**

8. Выполните одно из следующих действий, чтобы отформатировать название столбцов, добавляемых для каждого выбранного свойства JSON.

    - Снимите флажок **использовать исходное имя столбца в качестве префикса** , чтобы использовать имя свойства JSON в качестве имен столбцов; Например, **RecordType** или **саурцефиленаме**.

    - Для добавления префикса Аудитдата в имена столбцов оставьте установленным флажок **использовать исходное имя столбца в качестве префикса** ; Например, **аудитдата. RecordType** или **аудитдата. саурцефиленаме**.

9. Нажмите кнопку **ОК**.

    Столбец **аудитдата** разделяется на несколько столбцов. Каждый новый столбец соответствует свойству в объекте Аудитдата JSON. Каждая строка в столбце содержит значение свойства. Если свойство не содержит значение, отображается значение *null* . В Excel ячейки со значениями NULL пусты.
  
10. На вкладке **Главная** нажмите кнопку **Закрыть & загрузить** , чтобы закрыть редактор Power Query, и откройте преобразованный CSV-файл в книгу Excel.

## <a name="use-powershell-to-search-and-export-audit-log-records"></a>Поиск и экспорт записей журнала аудита с помощью PowerShell

Вместо использования средства поиска журнала аудита в центре безопасности & соответствия требованиям можно использовать командлет [Search-UnifiedAuditLog](https://docs.microsoft.com/powershell/module/exchange/search-unifiedauditlog) в Exchange Online PowerShell, чтобы экспортировать результаты поиска журнала аудита в CSV-файл. Затем вы можете выполнить процедуру, описанную в шаге 2, чтобы отформатировать журнал аудита с помощью редактора Power Query Editor. Одним из преимуществ использования командлета PowerShell является то, что вы можете искать события из определенной службы с помощью параметра *RecordType* . Ниже приведено несколько примеров использования PowerShell для экспорта записей аудита в CSV-файл, чтобы можно было использовать редактор Power Query для преобразования объекта JSON в столбец **аудитдата** , как описано в шаге 2.

В этом примере выполните следующие команды, чтобы возвратить все записи, связанные с операциями общего доступа SharePoint.

```powershell
$auditlog = Search-UnifiedAuditLog -StartDate 06/01/2019 -EndDate 06/30/2019 -RecordType SharePointSharingOperation
```

```powershell
$auditlog | Select-Object -Property CreationDate,UserIds,RecordType,AuditData | Export-Csv -Path c:\AuditLogs\PowerShellAuditlog.csv -NoTypeInformation
```

Результаты поиска экспортируются в CSV-файл с именем *повершеллаудитлог* , содержащий четыре столбца: CreationDate, UserID, RecordType, аудитдата).

Можно также использовать имя или значение перечисления для типа записи в качестве значения параметра *RecordType* . Список имен типов записей и соответствующих им значений перечисления представлен в таблице *аудитлогрекордтипе* в [схеме API действий управления Office 365](https://docs.microsoft.com/office/office-365-management-api/office-365-management-activity-api-schema#enum-auditlogrecordtype---type-edmint32).

В параметр *RecordType* можно включить только одно значение. Для поиска записей аудита для других типов записей необходимо повторно выполнить две приведенные выше команды, чтобы указать другой тип записи и добавить эти результаты в исходный CSV-файл. Например, чтобы добавить действия с файлами SharePoint из одного диапазона дат в файл PowerShellAuditlog.csv, выполните следующие две команды.

```powershell
$auditlog = Search-UnifiedAuditLog -StartDate 06/01/2019 -EndDate 06/30/2019 -RecordType SharePointFileOperation
```

```powershell
$auditlog | Select-Object -Property CreationDate,UserIds,RecordType,AuditData | Export-Csv -Append -Path c:\AuditLogs\PowerShellAuditlog.csv -NoTypeInformation
```

## <a name="tips-for-exporting-and-viewing-the-audit-log"></a>Советы по экспорту и просмотру журнала аудита

Ниже приведено несколько советов и примеров экспорта и просмотра журнала аудита до и после использования функции преобразования JSON для разделения столбца **аудитдата** на несколько столбцов.

- Отфильтровать столбец **RecordType** , чтобы отобразить только записи из определенной службы или функциональной области. Например, чтобы показать события, связанные с общим доступом к SharePoint, выберите **14** (значение перечисления для записей, инициированных действиями общего доступа к SharePoint). Список служб, соответствующих значениям перечислений, отображаемым в столбце **RecordType** , можно посмотреть в разделе [подробные свойства в журнале аудита](detailed-properties-in-the-office-365-audit-log.md).

- Фильтрация столбца " **операции** " для отображения записей для определенных действий. Список большинства операций, соответствующих действиям поиска в средстве поиска журнала аудита в центре безопасности & соответствия требованиям, приведен в разделе "аудитные действия" в разделе [Поиск в журнале аудита в центре безопасности &](search-the-audit-log-in-security-and-compliance.md#audited-activities).
