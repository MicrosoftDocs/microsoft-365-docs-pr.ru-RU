---
title: Экспорт, настройка и просмотр записей журнала аудита
f1.keywords:
- NOCSH
ms.author: markjjo
author: markjjo
manager: laurawi
audience: Admin
ms.topic: how-to
ms.service: O365-seccomp
localization_priority: Normal
ms.collection:
- Strat_O365_IP
- M365-security-compliance
search.appverid:
- MOE150
- MET150
ms.assetid: 0d4d0f35-390b-4518-800e-0c7ec95e946c
ms.custom: seo-marvel-apr2020
description: В этой статье вы узнаете, как экспортировать, настроить и просмотреть записи журнала аудита Microsoft 365.
ms.openlocfilehash: 688ba06fc9c5c2b26eef93fb1a68d311db9da5d8
ms.sourcegitcommit: 9ce9001aa41172152458da27c1c52825355f426d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/03/2020
ms.locfileid: "47358497"
---
# <a name="export-configure-and-view-audit-log-records"></a>Экспорт, настройка и просмотр записей журнала аудита

После поиска в журнале аудита и загрузки результатов поиска в CSV-файл файл содержит столбец **AuditData,** содержащий дополнительные сведения о каждом событии. Данные в этом столбце отформатированы в виде объекта JSON, который содержит несколько свойств, настроенных как пары *property:value,* разделенных запятой. Вы можете использовать функцию преобразования JSON в редакторе Power Query в Excel, чтобы разделить каждое свойство объекта JSON в столбце **AuditData** на несколько столбцов, чтобы каждое свойство было собственным столбцом. Это позволяет сортировать и фильтровать одно или несколько из этих свойств, что позволяет быстро находить конкретные данные аудита, которые вы ищете.

## <a name="step-1-export-audit-log-search-results"></a>Шаг 1. Экспорт результатов поиска в журнале аудита

Первый шаг — поиск в журнале аудита и экспорт результатов в CSV-файле на локальный компьютер.
  
1. Запустите [поиск в журнале аудита](search-the-audit-log-in-security-and-compliance.md#search-the-audit-log) и при необходимости исправите условия поиска до тех пор, пока не будут выявить нужные результаты.

2. Щелкните **"Экспорт результатов"** и выберите **"Скачать все результаты".** 

   ![Щелкните "Скачать все результаты"](../media/ExportAuditSearchResults.png)

   Этот параметр экспортирует все записи аудита из поиска в журнале аудита, который вы запустили на шаге 1, и скачивает необработанные данные из журнала аудита в CSV-файл. 

   В нижней части окна отображается сообщение с запросом на открытие или сохранение CSV-файла. 

3. Нажмите **кнопку "> сохранить как"** и сохраните CSV-файл на локальном компьютере. Скачивание множества результатов поиска занимает некоторое время. Обычно это происходит при поиске всех действий или широкого диапазона дат. Сообщение в нижней части окна отображается, когда загрузка CSV-файла завершена.

   ![Сообщение, отображаемая после завершения скачивания CSV-файла](../media/ExportAuditSearchResultsFinish.png)

> [!NOTE]
  > В CSV-файл можно загрузить до 50 000 записей результатов одной операции поиска по журналу аудита. Если в CSV-файл загружено 50 000 записей, можно предположить, что условиям поиска соответствует более 50 000 событий. Чтобы экспортировать больше, чем это ограничение, попробуйте использовать диапазон дат, чтобы уменьшить количество записей журнала аудита. Чтобы экспортировать больше 50 000 записей, вы можете выполнить поиск несколько раз со смежными диапазонами дат.

## <a name="step-2-format-the-exported-audit-log-using-the-power-query-editor"></a>Шаг 2. Форматирование экспортируемой журнала аудита с помощью редактора Power Query

Следующим шагом является использование функции преобразования JSON в редакторе Power Query в Excel, чтобы разделить каждое свойство объекта JSON в столбце **AuditData** на собственный столбец. Затем столбцы фильтруются для просмотра записей на основе значений определенных свойств. Это поможет вам быстро найти определенные данные аудита, которые вы ищете.

1. Откройте пустую книгу в Excel для Office 365, Excel 2019 или Excel 2016.

2. На **вкладке "Данные"** **в группе ленты "&** преобразования данных" щелкните **"Из текста" или "CSV".**

    ![На вкладке "Данные" щелкните "Текст/CSV".](../media/JSONTransformOpenCSVFile.png)

3. Откройте CSV-файл, загруженный на шаге 1.

4. В отображемом окне нажмите кнопку **"Преобразовать данные".**

   ![Click Transform Data](../media/JSONOpenPowerQuery.png)

   CSV-файл открывается в **редакторе запросов.** Существует четыре столбца: **CreationDate,** **UserIds,** **Operations** и **AuditData.** Столбец **AuditData** — это объект JSON, содержащий несколько свойств. Следующим шагом является создание столбца для каждого свойства в объекте JSON.

5. Щелкните правой кнопкой мыши заголовок в столбце **AuditData,** выберите **"Преобразование"** и щелкните **JSON.** 

   ![Щелкните правой кнопкой мыши столбец AuditData, выберите "Преобразование" и выберите JSON](../media/JSONTransform.png)

6. В правом верхнем углу столбца **AuditData** щелкните значок расширения.

   ![В столбце AuditData щелкните значок расширения](../media/JSONTransformExpandIcon.png)

   Отображается частичный список свойств объектов JSON в столбце **AuditData.**

7. Нажмите **кнопку** "Загрузить", чтобы отобразить все свойства объектов JSON в столбце **AuditData.**

   ![Нажмите кнопку "Загрузить", чтобы отобразить все свойства в объекте JSON](../media/JSONTransformLoadJSONProperties.png)

   Вы можете отключить этот контрольный список рядом с любым свойством, которое не нужно включать. Удаление столбцов, которые не являются полезными для расследования, — это хороший способ уменьшить объем данных, отображаемого в журнале аудита. 

   > [!NOTE]
   > Свойства JSON, показанные на предыдущем снимке экрана (после нажатия кнопки "Загрузить больше"), основаны на свойствах, найденных в столбце **AuditData** из первых 1000 строк в CSV-файле. Если после первых 1000 строк в записях есть другие свойства JSON, эти свойства (и соответствующий столбец) не будут включены при разделении столбца **AuditData** на несколько столбцов. Чтобы предотвратить это, рассмотрите возможность повторного запуска поиска в журнале аудита и сужение критериев поиска, чтобы возвращалось меньше записей. Другим обходным решением является  фильтрация элементов в столбце "Операции", чтобы уменьшить число строк (перед выполнением шага 5 выше) перед преобразованием объекта JSON в столбце **AuditData.**

8. Для формата заголовка столбцов, добавляемого для каждого выбранного свойства JSON, сделайте одно из следующих вещей.

    - Unselect the **Use original column name as prefix** checkbox to use the name of the JSON property as the column names; например, **RecordType** или **SourceFileName.**

    - Оставьте **имя исходного столбца** в качестве выбранного префикса, чтобы добавить префикс AuditData к именам столбцов; например, **AuditData.RecordType** или **AuditData.SourceFileName.**

9. Нажмите **ОК**.

    Столбец **AuditData** разделен на несколько столбцов. Каждый новый столбец соответствует свойству объекта AuditData JSON. Каждая строка в столбце содержит значение свойства. Если свойство не содержит значение, отображается значение *null.* В Excel ячейки со значениями NULL пусты.
  
10. На **вкладке "Главная"** **нажмите кнопку "& Загрузить",** чтобы закрыть редактор Power Query и открыть преобразованный CSV-файл в книге Excel.

## <a name="use-powershell-to-search-and-export-audit-log-records"></a>Поиск и экспорт записей журнала аудита с помощью PowerShell

Вместо использования средства поиска по журналу аудита в Центре безопасности и соответствия требованиям & можно использовать для экспорта результатов поиска в [CSV-файл](https://docs.microsoft.com/powershell/module/exchange/search-unifiedauditlog) результаты поиска в журнале аудита с помощью выполнения поиска в Exchange Online PowerShell. Затем можно использовать процедуру, описанную в шаге 2, для форматации журнала аудита с помощью редактора Power Query. Одно из преимуществ использования powerShell заключается в том, что вы можете искать события из определенной службы с помощью *параметра RecordType.* Вот несколько примеров использования PowerShell для экспорта записей аудита в CSV-файл, чтобы с помощью редактора Power Query преобразовать объект JSON в столбце **AuditData,** как описано в шаге 2.

В этом примере запустите следующие команды, чтобы вернуть все записи, связанные с операциями общего доступа к SharePoint.

```powershell
$auditlog = Search-UnifiedAuditLog -StartDate 06/01/2019 -EndDate 06/30/2019 -RecordType SharePointSharingOperation
```

```powershell
$auditlog | Select-Object -Property CreationDate,UserIds,RecordType,AuditData | Export-Csv -Path c:\AuditLogs\PowerShellAuditlog.csv -NoTypeInformation
```

Результаты поиска экспортируются в CSV-файл *PowerShellAuditlog,* содержащий четыре столбца: CreationDate, UserIds, RecordType, AuditData.

В качестве значения параметра *RecordType* можно также использовать имя или значение enum для типа записи. Список имен типов записей и соответствующих им значений перечисляемого списка см. в таблице *AuditLogRecordType* схемы API действий управления [Office 365.](https://docs.microsoft.com/office/office-365-management-api/office-365-management-activity-api-schema#enum-auditlogrecordtype---type-edmint32)

Параметр *RecordType* может включать только одно значение. Чтобы найти записи аудита для других типов записей, необходимо снова выполнить две предыдущие команды, чтобы указать другой тип записи и ввести эти результаты в исходный CSV-файл. Например, чтобы добавить действия с файлом SharePoint из одного диапазона дат в PowerShellAuditlog.csv, необходимо выполнить следующие две команды.

```powershell
$auditlog = Search-UnifiedAuditLog -StartDate 06/01/2019 -EndDate 06/30/2019 -RecordType SharePointFileOperation
```

```powershell
$auditlog | Select-Object -Property CreationDate,UserIds,RecordType,AuditData | Export-Csv -Append -Path c:\AuditLogs\PowerShellAuditlog.csv -NoTypeInformation
```

## <a name="tips-for-exporting-and-viewing-the-audit-log"></a>Советы по экспорту и просмотру журнала аудита

Ниже представлены советы и примеры экспорта и просмотра журнала аудита до и после использования функции преобразования JSON для разделения столбца **AuditData** на несколько столбцов.

- Отфильтруем **столбец RecordType,** чтобы отображались только записи из определенной службы или функциональной области. Например, чтобы показать события, связанные с совместным доступом SharePoint, выберите **14** (значение enum для записей, запускаемой действиями общего доступа SharePoint). Список служб, соответствующих значениям перечисляемого списка, отображаемого в столбце **RecordType,** см. в подробном описании свойств в [журнале аудита.](detailed-properties-in-the-office-365-audit-log.md)

- **Отфильтруем столбец** "Операции", чтобы отобразить записи для определенных действий. Список большинства операций, которые соответствуют действию поиска в средстве поиска в журнале аудита в Центре безопасности и соответствия требованиям &, см. в разделе "Аудит действий" в журнале аудита в Центре безопасности [& соответствия](search-the-audit-log-in-security-and-compliance.md#audited-activities)требованиям.
