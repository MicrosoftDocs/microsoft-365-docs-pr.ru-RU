---
title: Использование отправки по сети для импорта PST-файлов организации
f1.keywords:
- NOCSH
ms.author: markjjo
author: markjjo
manager: laurawi
audience: Admin
ms.topic: article
ms.service: O365-seccomp
localization_priority: Priority
ms.collection:
- Strat_O365_IP
- M365-security-compliance
search.appverid:
- MOE150
- MED150
- MET150
ms.assetid: 103f940c-0468-4e1a-b527-cc8ad13a5ea6
description: 'Для администраторов: узнайте, как использовать сетевую загрузку для массового импорта нескольких файлов PST в почтовые ящики пользователей в Microsoft 365.'
ms.custom: seo-marvel-apr2020
ms.openlocfilehash: b7c8621859d04f44b58719a86b4c159f8379b961
ms.sourcegitcommit: e8b9a4f18330bc09f665aa941f1286436057eb28
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/14/2020
ms.locfileid: "45127336"
---
# <a name="use-network-upload-to-import-your-organizations-pst-files-to-microsoft-365"></a>Используйте загрузку по сети, чтобы импортировать файлы PST вашей организации в Microsoft 365

> [!NOTE]
> Эта статья предназначена для администраторов. Вам необходимо импортировать PST-файлы в свой почтовый ящик? См. статью [Импорт писем, контактов и календаря Outlook из PST-файла](https://go.microsoft.com/fwlink/p/?LinkID=785075).
  
Вот пошаговые инструкции, необходимые для загрузки по сети для массового импорта нескольких файлов PST в почтовые ящики Microsoft 365. Часто задаваемые вопросы об использовании сетевой загрузки для массового импорта файлов PST в почтовые ящики Microsoft 365 см. В разделе [часто задаваемых вопросов об использовании сетевой загрузки для импорта файлов PST](faqimporting-pst-files-to-office-365.md#using-network-upload-to-import-pst-files).
  
[Шаг 1. Копирование URL-адреса SAS и установка AzCopy](#step-1-copy-the-sas-url-and-install-azcopy)

[Шаг 2: Загрузите ваши файлы PST в Microsoft 365](#step-2-upload-your-pst-files-to-office-365)

[(Необязательно) Шаг 3. Просмотр списка загруженных файлов PST](#optional-step-3-view-a-list-of-the-pst-files-uploaded-to-office-365)

[Шаг 4. Создание файла сопоставления для импорта PST-файлов](#step-4-create-the-pst-import-mapping-file)

[Шаг 5. Создание задания импорта PST](#step-5-create-a-pst-import-job)

[Шаг 6. Фильтрация данных и запуск задания импорта PST-файлов](#step-6-filter-data-and-start-the-pst-import-job)

Вы должны выполнить Шаг 1 только один раз, чтобы импортировать файлы PST в почтовые ящики Microsoft 365. После этого каждый раз, когда вам необходимо будет отправить и импортировать пакет PST-файлов, следует выполнить шаги 2–6.

## <a name="before-you-import-pst-files"></a>Перед импортом PST-файлов
  
- Для импорта файлов PST в почтовые ящики Microsoft 365 необходимо назначить роль экспорта-импорта почтовых ящиков в Exchange Online. По умолчанию эта роль не назначена ни одной группе ролей в Exchange Online. Вы можете добавить роль "Импорт и экспорт почтовых ящиков" в группу ролей "Управление организацией". Кроме того, вы можете создать группу ролей, назначить ей роль "Импорт и экспорт почтовых ящиков" и добавить себя в качестве участника группы. Дополнительные сведения см. в разделах "Добавление роли в группу ролей" или "Создание группы ролей" статьи [Управление группами ролей](https://go.microsoft.com/fwlink/p/?LinkId=730688).
    
    Кроме того, чтобы создать задания импорта в Центре безопасности и соответствия требованиям, должно быть выполнено одно из следующих условий:
    
  - Вам должна быть назначена роль "Получатели почты" в Exchange Online. По умолчанию эта роль назначается группам ролей "Управление организацией" и "Управление получателями".
    
    или
    
  - Вы должны быть глобальным администратором в своей организации.
    
  > [!TIP]
    > Попробуйте создать новую группу ролей в Exchange Online, специально предназначенную для импорта файлов PST. Для минимального уровня прав, необходимого для импорта PST-файлов, назначьте роли "Импорт и экспорт почтовых ящиков" и "Получатели почты" новой группе ролей, а затем добавьте участников.
  
- Единственный поддерживаемый метод импорта файлов PST в Microsoft 365 - это использование инструмента AzCopy, как описано в этом разделе. Использование обозревателя службы хранилища Microsoft Azure для загрузки PST-файлов непосредственно в хранилище Azure не поддерживается.
    
- Вам необходимо хранить файлы PST, которые вы хотите импортировать в Microsoft 365, на файловом сервере или в общей папке в вашей организации. На шаге 2 вы запускаете инструмент AzCopy для загрузки файлов PST, которые хранятся на файловом сервере или в общей папке, в Microsoft 365.
    
- Крупные PST-файлы могут повлиять на скорость импорта PST. По этой причине рекомендуется, чтобы размер каждого PST-файла, отправляемого в хранилище Azure на шаге 2, не превышал 20 ГБ.

- В этой процедуре необходимо будет скопировать URL-адрес, содержащий ключ доступа, а затем сохранить его копию. Эта информация будет использоваться на шаге 2 для отправки PST-файлов и на шаге 3 для просмотра списка PST-файлов, отправленных в Office 365. Необходимо защитить URL-адрес так же надежно, как вы защищаете пароли и прочую информацию, связанную с обеспечением безопасности. Например, можно сохранить его в документе Microsoft Word, защищенном паролем, или на зашифрованном USB-накопителе. Пример URL-адреса с ключом см. в разделе [Дополнительные сведения](#more-information).
    
- PST-файлы можно импортировать в неактивный почтовый ящик Office 365. Для этого нужно указать GUID неактивного почтового ящика в параметре `Mailbox` файла сопоставления для импорта PST-файлов. Дополнительные сведения см. в шаге 4 на вкладке **Инструкции**. 
    
- В гибридной среде Exchange вы можете импортировать PST-файлы в облачный архивный почтовый ящик пользователя, основной почтовый ящик которого является локальным. Для этого выполните следующие действия в файле сопоставления для импорта PST-файлов:
    
  - Укажите адрес электронной почты для локального почтового ящика пользователя в параметре `Mailbox`.
    
  - Укажите значение **TRUE** для параметра `IsArchive`.
    
    Дополнительные сведения см. [Шаг 4](#step-4-create-the-pst-import-mapping-file).
    
- После импорта файлов PST параметр удержания для почтового ящика включается на неопределенный срок. Это означает, что политика хранения, назначенная почтовому ящику, не будет обрабатываться, пока вы не отключите приостановку хранения или не назначите дату выполнения. Почему мы это делаем? Старые сообщения при импорте в почтовый ящик могут удаляться без возможности восстановления, так как их срок хранения, заданный в параметрах хранения почтового ящика, закончился. Приостановка хранения дает владельцу почтового ящика время для управления импортированными сообщениями или предоставляет вам время на изменение параметров хранения для почтового ящика. Рекомендации по управлению приостановкой хранения см. в разделе [Дополнительные сведения](#more-information) этой статьи.
    
- По умолчанию максимальный размер сообщения, которое может получить почтовый ящик Microsoft 365, составляет 35 МБ. Это обусловлено тем, что значение по умолчанию для свойства *MaxReceiveSize* почтового ящика равно 35 МБ. Тем не менее, максимальный размер сообщения в Microsoft 365 ограничен 150 МБ. Поэтому при импорте PST-файла, содержащего элемент размером более 35 МБ, служба импорта Office 365 автоматически меняет значение свойства *MaxReceiveSize* целевого почтового ящика на 150 МБ. Это позволяет импортировать в почтовые ящики пользователей сообщения размером до 150 МБ.
    
    > [!TIP]
    > Чтобы определить размер сообщения для почтового ящика, можно выполнить в Exchange Online PowerShell следующую команду: `Get-Mailbox <user mailbox> | FL MaxReceiveSize`.

- Общий обзор процесса импорта PST см. в разделе [Как работает процесс импорта](#how-the-import-process-works) в этой статье.

## <a name="step-1-copy-the-sas-url-and-install-azcopy"></a>Шаг 1. Копирование URL-адреса SAS и установка AzCopy

Прежде всего необходимо скачать и установить средство AzCopy, которое запускается на шаге 2 для отправки PST-файлов в Office 365. Вам также нужно скопировать URL-адрес SAS для своей организации. Этот URL-адрес является сочетанием сетевого URL-адреса хранилища Azure вашей организации в Microsoft Cloud и ключа подписанного URL-адреса (SAS). Этот ключ содержит необходимые разрешения для отправки PST-файлов в хранилище Azure. Примите меры предосторожности, чтобы защитить URL-адрес SAS. Он является уникальным для вашей организации и будет использован на шаге 2.

> [!IMPORTANT]
> Для импорта PST-файлов с помощью метода отправки по сети и синтаксиса команды, описанных в этой статье, используйте версию AzCopy, которую можно скачать на шаге 6б описанной ниже процедуры. Эту же версию AzCopy можно также скачать [здесь](https://aka.ms/downloadazcopy). Использование другой версии AzCopy не поддерживается.
  
1. Перейдите в [https://protection.office.com](https://protection.office.com) и войдите в систему, используя учетные данные для учетной записи администратора в вашей организации.
    
2. В левой области Центра безопасности и соответствия требованиям выберите **Управление информацией** \> **Импорт** \> **Импорт PST-файлов**.
    
    > [!NOTE]
    > Для доступа к странице **Импорт** в Центре безопасности и соответствия требованиям вам должны быть назначены соответствующие разрешения. Подробнее см. в разделе **Перед началом работы**. 
    
3. На странице **Импорт PST-файлов** нажмите ![Добавить](../media/ITPro-EAC-AddIcon.gif) **Новое задание импорта**.
    
    Откроется мастер заданий импорта.
    
4. Введите имя для задания импорта PST-файлов и нажмите кнопку **Далее**. Используйте строчные буквы, числа, дефисы и символы подчеркивания. Имя не должно содержать заглавных букв и пробелов.
    
5. На странице **Отправить или передать данные?** выберите **Отправка данных**, а затем нажмите кнопку **Далее**.
    
    ![Нажмите "Отправка данных", чтобы создать задание импорта для передачи по сети](../media/e59f9dc3-ccde-44ff-ac38-c4e39d76ae85.png)
  
6. На странице **Импорт данных** выполните следующие два действия. 
    
    ![Скопируйте URL-адрес SAS и скачайте средство AzCopy на странице "Импорт данных".](../media/74411014-ec4b-4e25-9065-404c934cce17.png)
  
    а. На шаге 2 щелкните ссылку **Отображение URL-адреса SAS для отправки данных по сети**. После отображения URL-адреса SAS выберите команду **Копировать в буфер**, а затем вставьте URL-адрес в новый текстовый файл и сохраните его, чтобы обращаться к нему позже.
    
    б. На шаге 3 щелкните **Скачать средство Azure AzCopy**, чтобы скачать и установить средство AzCopy. Во всплывающем окне нажмите кнопку **Выполнить**, чтобы установить AzCopy. 
    
> [!NOTE]
> Вы можете оставить страницу **Импорт данных** открытой (на случай, если потребуется еще раз скопировать URL-адрес SAS) или нажать кнопку **Отмена**, чтобы закрыть ее. 
 
## <a name="step-2-upload-your-pst-files-to-office-365"></a>Шаг 2. Отправка PST-файлов в Office 365

Теперь с помощью средства AzCopy.exe вы можете отправить PST-файлы в Office 365. Это средство отправляет и сохраняет файлы в хранилище Azure в Microsoft Cloud. Как указывалось ранее, расположение хранилища Azure, в которое вы загружаете файлы PST, находится в том же региональном центре обработки данных Microsoft, где расположена ваша организация. Чтобы выполнить это действие, необходимо, чтобы PST-файлы хранились в файловом ресурсе или на файловом сервере в вашей организации. В этой процедуре такое расположение называется исходным каталогом. При каждом запуске средства AzCopy можно будет указать другой исходный каталог. 

> [!NOTE]
> Как упоминалось ранее, размер каждого PST-файла, отправляемого в хранилище Azure, не должен превышать 20 ГБ. PST-файлы размером более 20 ГБ могут повлиять на скорость импорта PST, запускаемого на шаге 6.

1. Откройте окно командной строки на локальном компьютере.
    
2. Перейдите в каталог, в котором вы установили средство AzCopy.exe в действии 1. Если вы установили средство в расположение, используемое по умолчанию, перейдите в каталог `%ProgramFiles(x86)%\Microsoft SDKs\Azure\AzCopy`.
    
3. Выполните указанную ниже команду для отправки PST-файлов в Office 365.

    ```powershell
    AzCopy.exe /Source:<Location of PST files> /Dest:<SAS URL> /V:<Log file location> /Y
    ```

    > [!IMPORTANT] 
    > В предыдущей команде в качестве исходного расположения необходимо указать каталог; указать отдельный PST-файл нельзя. Будут отправлены все PST-файлы в исходном каталоге.
 
    В следующей таблице приведены параметры AzCopy.exe и необходимые значения для них. Для значений этих параметров используются данные, полученные на предыдущем шаге.
    
    |**Параметр**|**Описание**|**Пример**|
    |:-----|:-----|:-----|
    | `/Source:` <br/> |Задает исходный каталог в вашей организации, содержащий PST-файлы, которые будут отправлены в Office 365.  <br/> Обязательно заключите значение этого параметра в кавычки (" ").  <br/> | `/Source:"\\FILESERVER01\PSTs"` <br/> |
    | `/Dest:` <br/> |Задает URL-адрес SAS, полученный на шаге 1.  <br/> Обязательно заключите значение этого параметра в кавычки (" ").<br/><br/>**Примечание.** Если в скрипте или пакетном файле используется URL-адрес SAS, необходимо следить за определенными символами, которые должны пропускаться. Например, `%` необходимо заменить на `%%`, а `&` — на `^&`.<br/><br/>**Совет.** (Необязательно.) Вы можете выбрать в хранилище Azure вложенную папку, в которую будут передаваться PST-файлы. Для этого нужно указать ее расположение в URL-адресе SAS (после "ingestiondata"). В первом примере вложенная папка не указана. Это означает, что PST-файлы отправляются в корневой каталог хранилища Azure (который называется *ingestiondata*). Во втором примере PST-файлы добавляются во вложенную папку *PSTFiles* в корневой папке хранилища Azure.  <br/> | `/Dest:"https://3c3e5952a2764023ad14984.blob.core.windows.net/ingestiondata?sv=2012-02-12&amp;se=9999-12-31T23%3A59%3A59Z&amp;sr=c&amp;si=IngestionSasForAzCopy201601121920498117&amp;sig=Vt5S4hVzlzMcBkuH8bH711atBffdrOS72TlV1mNdORg%3D"` <br/> или  <br/>  `/Dest:"https://3c3e5952a2764023ad14984.blob.core.windows.net/ingestiondata/PSTFiles?sv=2012-02-12&amp;se=9999-12-31T23%3A59%3A59Z&amp;sr=c&amp;si=IngestionSasForAzCopy201601121920498117&amp;sig=Vt5S4hVzlzMcBkuH8bH711atBffdrOS72TlV1mNdORg%3D"` <br/> |
    | `/V:` <br/> |Отправляет подробные сообщения о состоянии в файл журнала. По умолчанию подробный файл журнала имеет имя AzCopyVerbose.log и находится в папке %LocalAppData%\Microsoft\Azure\AzCopy. Если для этого параметра указать расположение существующего файла, подробный журнал будет добавлен в него.  <br/> Обязательно заключите значение этого параметра в кавычки (" ").  <br/> | `/V:"c:\Users\Admin\Desktop\Uploadlog.log"` <br/> |
    | `/S` <br/> |Этот необязательный параметр указывает, что необходимо использовать рекурсивный режим, при котором средство AzCopy копирует PST-файлы, расположенные во вложенных папках исходного каталога, который указан параметром `/Source:`.  <br/> **Примечание.** Если включить этот параметр, после отправки PST-файлов из вложенных папок они будут иметь разные пути в хранилище Azure. Потребуется указать точный путь в CSV-файле, который будет создан на шаге 4.  <br/> | `/S` <br/> |
    | `/Y` <br/> |Этот обязательный параметр позволяет использовать маркеры SAS только для чтения при отправке PST-файлов в хранилище Azure. URL-адрес SAS, полученный на шаге 1 (и указанный в параметре `/Dest:`), доступен только для записи. По этой причине необходимо включить данный параметр. URL-адрес SAS, доступный только для записи, не предотвращает просмотр списка PST-файлов, отправленных в хранилище Azure, с помощью обозревателя службы хранилища Microsoft Azure.  <br/> | `/Y` <br/> |

Вот пример синтаксиса для средства AzCopy.exe, в котором использованы действительные значения для каждого параметра:
    
```powershell
  AzCopy.exe /Source:"\\FILESERVER1\PSTs" /Dest:"https://3c3e5952a2764023ad14984.blob.core.windows.net/ingestiondata?sv=2012-02-12&amp;se=9999-12-31T23%3A59%3A59Z&amp;sr=c&amp;si=IngestionSasForAzCopy201601121920498117&amp;sig=Vt5S4hVzlzMcBkuH8bH711atBffdrOS72TlV1mNdORg%3D" /V:"c:\Users\Admin\Desktop\AzCopy1.log" /Y
```

После того как вы запустите команду, будут отображаться сообщения о состоянии, показывающие ход отправки PST-файлов. В последнем сообщении о состоянии будет указано общее количество успешно отправленных файлов. 

> [!TIP]
> После успешного выполнения команды AzCopy.exe и проверки правильности всех параметров сохраните синтаксис командной строки в тот же (защищенный) файл, в котором вы сохранили сведения, полученные на шаге 1. После этого вы сможете копировать эту команду и вставлять ее в командную строку каждый раз, когда необходимо запустить средство AzCopy.exe для отправки PST-файлов в Office 365. Вам может потребоваться изменить только одно значение — значение параметра `/Source:`. Это зависит от исходного каталога, в котором расположены PST-файлы.

## <a name="optional-step-3-view-a-list-of-the-pst-files-uploaded-to-office-365"></a>Шаг 3 (необязательно). Просмотр списка PST-файлов, отправленных в Office 365

При желании можно установить и использовать бесплатное средство с открытым исходным кодом, обозреватель службы хранилища Microsoft Azure, для просмотра списка PST-файлов, отправленных в большой двоичный объект (BLOB) Azure. Это средство позволяет:
  
- убедиться, что PST-файлы из общей папки или файлового сервера в организации успешно отправлены в большой двоичный объект Azure;
    
- проверить имя файла (и путь к вложенной папке, если он включен) для каждого PST-файла, отправленного в большой двоичный объект Azure. Эти функции пригодятся при создании PST-файла сопоставления на следующем шаге, когда необходимо будет указать путь к папке и имя каждого PST-файла. Проверив эти имена, вы сможете уменьшить количество возможных ошибок в PST-файле сопоставления.
    
В настоящее время доступна предварительная версия обозревателя службы хранилища Microsoft Azure.
  
> [!IMPORTANT]
> Обозреватель службы хранилища Microsoft Azure нельзя использовать для отправки или изменения PST-файлов. Единственный поддерживаемый метод импорта файлов PST - это использование AzCopy. Кроме того, PST-файлы, отправленные в большой двоичный объект Azure, нельзя удалить. При попытке удалить PST-файл возникает сообщение о том, что у вас нет необходимых разрешений. Учтите, что все PST-файлы автоматически удаляются из хранилища Azure. При отсутствии выполняющихся заданий импорта все PST-файлы в контейнере **ingestiondata** удаляются через 30 дней после даты создания последнего задания импорта.
  
Чтобы установить обозреватель службы хранилища Microsoft Azure и подключиться к хранилищу Azure, выполните следующие действия.
  
1. Скачайте и установите [обозреватель службы хранилища Microsoft Azure](https://go.microsoft.com/fwlink/p/?LinkId=544842).
    
2. Запустите обозреватель службы хранилища Microsoft Azure, щелкните правой кнопкой мыши пункт **Учетные записи хранения** в левой области, а затем выберите команду **Подключиться к хранилищу Azure**.
    
    ![Щелкните правой кнопкой мыши "Учетные записи хранения" и выберите команду "Подключиться к хранилищу Azure"](../media/75b80cc3-c336-4f96-ad32-54ac9b96a7af.png)
  
3. Щелкните **Использовать URI подписанного URL-адреса (SAS) или строку подключения** и нажмите кнопку **Далее**.
    
4. Щелкните **Использовать URI SAS**, вставьте URL-адрес SAS, полученный на шаге 1, в поле **URI** и нажмите кнопку **Далее**.
    
5. На странице **Сводка подключения** просмотрите сведения о подключении и нажмите кнопку **Подключиться**.
    
    Открывается контейнер **ingestiondata**. Он содержит PST-файлы, отправленные на шаге 2. Контейнер **ingestiondata** находится в разделе **Учетные записи хранения** \> **(службы, подключенные к SAS)** \> **Контейнер BLOB-объектов**. 
    
    ![Список отправленных файлов PST в окне обозревателя службы хранилища Microsoft Azure](../media/12376fed-13a5-4a09-8fe6-e819e011b334.png)
  
6. После завершения работы с обозревателем службы хранилища Microsoft Azure щелкните правой кнопкой элемент **ingestiondata** и выберите пункт **Отсоединить**, чтобы отключиться от хранилища Azure. В противном случае при следующей попытке подключиться произойдет ошибка. 
    
    ![Щелкните правой кнопкой мыши элемент "ingestion" и нажмите кнопку "Отсоединить", чтобы отключиться от хранилища Azure](../media/1e8e5e95-4215-4ce4-a13d-ab5f826a0510.png)
  
## <a name="step-4-create-the-pst-import-mapping-file"></a>Шаг 4. Создание файла сопоставления для импорта PST-файлов

После загрузки файлов PST в расположение хранилища Azure для вашей организации следующим шагом будет создание файла значений с разделителями-запятыми (CSV), в котором указываются почтовые ящики пользователей, в которые будут импортироваться файлы PST. Этот CSV-файл будет отправлен на следующем шаге, когда будет создаваться задание на импорт PST-файлов.
  
1. [Скачайте файл сопоставления для импорта PST-файлов](https://go.microsoft.com/fwlink/p/?LinkId=544717).

2. Откройте или сохраните этот CSV-файл на локальный компьютер. В примере ниже показан готовый файл сопоставления для импорта PST-файлов (открытый в Блокноте). Для редактирования CSV-файла намного удобнее использовать Microsoft Excel.

    ```text
    Workload,FilePath,Name,Mailbox,IsArchive,TargetRootFolder,ContentCodePage,SPFileContainer,SPManifestContainer,SPSiteUrl
    Exchange,,annb.pst,annb@contoso.onmicrosoft.com,FALSE,/,,,,
    Exchange,,annb_archive.pst,annb@contoso.onmicrosoft.com,TRUE,,,,,
    Exchange,,donh.pst,donh@contoso.onmicrosoft.com,FALSE,/,,,,
    Exchange,,donh_archive.pst,donh@contoso.onmicrosoft.com,TRUE,,,,,
    Exchange,PSTFiles,pilarp.pst,pilarp@contoso.onmicrosoft.com,FALSE,/,,,,
    Exchange,PSTFiles,pilarp_archive.pst,pilarp@contoso.onmicrosoft.com,TRUE,/ImportedPst,,,,
    Exchange,PSTFiles,tonyk.pst,tonyk@contoso.onmicrosoft.com,FALSE,,,,,
    Exchange,PSTFiles,tonyk_archive.pst,tonyk@contoso.onmicrosoft.com,TRUE,/ImportedPst,,,,
    Exchange,PSTFiles,zrinkam.pst,zrinkam@contoso.onmicrosoft.com,FALSE,,,,,
    Exchange,PSTFiles,zrinkam_archive.pst,zrinkam@contoso.onmicrosoft.com,TRUE,/ImportedPst,,,,
    ```

    В первой строке (строке заголовков) CSV-файла перечислены параметры, которые будут использоваться службой импорта PST-файлов для импорта PST-файлов в почтовые ящики пользователей. Имена параметров отделяются друг от друга запятыми. Каждая строка, расположенная под строкой заголовков, содержит значения для импорта PST-файла в определенный почтовый ящик. Для каждого PST-файла, который необходимо импортировать в почтовый ящик пользователя, требуется отдельная строка. В файле CSV/сопоставлений теперь можно использовать до 500 строк. Чтобы импортировать более 500 PST-файлов, необходимо создать несколько файлов сопоставления и добавить несколько заданий импорта в Действии 5.

    > [!NOTE]
    > Не изменяйте ничего в строке заголовков, в том числе параметры SharePoint. Они будут проигнорированы в процессе импорта PST-файлов. Также не забудьте заменить данные-заполнители в файле сопоставления действительными данными.

 3. Для заполнения CSV-файла необходимой информацией воспользуйтесь сведениями из таблицы ниже.

    |**Параметр**|**Описание**|**Пример**|
    |:-----|:-----|:-----|
    | `Workload` <br/> |Определяет сервис, в который будут импортированы данные. Для импорта PST-файлов в почтовые ящики пользователей укажите `Exchange`.  <br/> | `Exchange` <br/> |
    | `FilePath` <br/> |Указывает расположение папки в хранилище Azure, в которую на шаге 2 были отправлены PST-файлы.  <br/> Если вы не включили необязательный путь к вложенной папке в URL-адрес SAS в параметре `/Dest:` на шаге 2, в CSV-файле оставьте этот параметр пустым. Если вы его добавили имя вложенной папки, укажите его в этом параметре (см. второй пример). Значение этого параметра нужно указывать с учетом регистра.  <br/> В любом случае *не* включайте "ingestiondata" в значение параметра `FilePath`.  <br/><br/> **Внимание!** Путь к файлу нужно указывать в том же регистре, который использовался для необязательного имени подпапки в URL-адресе SAS в параметре `/Dest:` на шаге 2. Например, если на шаге 2 вы указали подпапку `PSTFiles`, а для параметра `pstfiles` в CSV-файле используете значение `FilePath`, импорт PST-файла завершится сбоем. Используйте одинаковый регистр в обоих случаях.  <br/> |(Оставьте пустым)  <br/> или  <br/>  `PSTFiles` <br/> |
    | `Name` <br/> |Указывает имя PST-файла, который будет импортирован в почтовый ящик пользователя. Значение этого параметра нужно указывать с учетом регистра.  <br/> <br/>**Внимание!** Имя PST-файла должно быть указано в CSV-файле в том же регистре, что и имя PST-файла, переданного в хранилище Azure на шаге 2. Например, если вы указали `annb.pst` для параметра `Name` в CSV-файле, а сам файл называется `AnnB.pst`, импорт PST-файла завершится сбоем. Убедитесь, что для имени PST-файла в CSV-файле используется тот же регистр, что и для имени самого PST-файла.  <br/> | `annb.pst` <br/> |
    | `Mailbox` <br/> |Указывает электронный адрес почтового ящика, в который будет импортирован PST-файл. Указать общедоступную папку невозможно, так как служба импорта PST не поддерживает импорт PST-файлов в общедоступные папки.  <br/> Для импорта PST-файла в неактивный почтовый ящик необходимо указать GUID почтового ящика для этого параметра. Чтобы получить этот GUID, выполните в Exchange Online следующую команду PowerShell: `Get-Mailbox <identity of inactive mailbox> -InactiveMailboxOnly | FL Guid` <br/> <br/>**Примечание.** Иногда может существовать несколько почтовых ящиков с одинаковым адресом электронной почты, один из которых является активным, а другой — обратимо удаленным (неактивным). В этих ситуациях требуется указать GUID почтового ящика, в который нужно импортировать PST-файл. Чтобы получить этот GUID, выполните следующую команду PowerShell: `Get-Mailbox <identity of active mailbox> | FL Guid`. Для получения GUID обратимо удаленных (неактивных) почтовых ящиков выполните следующую команду: `Get-Mailbox <identity of soft-deleted or inactive mailbox> -SoftDeletedMailbox | FL Guid`.  <br/> | `annb@contoso.onmicrosoft.com` <br/> или  <br/>  `2d7a87fe-d6a2-40cc-8aff-1ebea80d4ae7` <br/> |
    | `IsArchive` <br/> | Указывает, следует ли импортировать PST-файл в архивный почтовый ящик пользователя. Возможны два варианта:  <br/><br/>**FALSE**: импортировать PST-файл в основной почтовый ящик пользователя.  <br/> **TRUE**: импортировать PST-файл в архивный почтовый ящик пользователя. При этом предполагается, что [архивный почтовый ящик пользователя включен](enable-archive-mailboxes.md). <br/><br/>Если для этого параметра задано значение `TRUE` и архивный почтовый ящик не включен, импорт для этого пользователя завершится ошибкой. В случае сбоя импорта для одного пользователя (например, если для него отключен архив и для данного свойства установлено значение `TRUE`) остальные пользователи, для которых выполняется импорт, не будут затронуты.  <br/>  Если этот параметр оставлен пустым, PST-файл импортируется в основной почтовый ящик пользователя.  <br/> <br/>**Примечание.** Чтобы импортировать PST-файл в облачный архивный почтовый ящик пользователя, основной почтовый ящик которого является локальным, просто укажите `TRUE` для этого параметра и задайте адрес электронной почты локального почтового ящика для параметра `Mailbox`.  <br/> | `FALSE` <br/> или  <br/>  `TRUE` <br/> |
    | `TargetRootFolder` <br/> | Указывает папку почтового ящика, в которую импортируется PST-файл.  <br/> <br/> Если оставить этот параметр пустым, PST-файл будет импортирован в новую папку с именем **Импортированные** на корневом уровне почтового ящика (на том же уровне, что и папка "Входящие" и другие стандартные папки почтового ящика).  <br/> <br/> Если указать параметр `/`, папки и элементы из PST-файла импортируются в верхнюю часть структуры папок в целевом почтовом ящике или архиве. Если папка существует в целевом почтовом ящике (например, стандартные папки, такие как "Входящие", "Отправленные" и "Удаленные"), элементы из этой папки PST-файла объединяются с существующей папкой целевого почтового ящика. Например, если PST-файл содержит папку "Входящие", элементы из нее импортируются в папку "Входящие" целевого почтового ящика. Новые папки создаются, если они отсутствуют в структуре папок целевого почтового ящика.  <br/><br/>  Если указать параметр `/<foldername>`, элементы и папки PST-файла импортируются в папку *\<foldername\>*. Например, если указан параметр `/ImportedPst`, элементы будут импортированы в папку с именем **ImportedPst**. Эта папка будет расположена в почтовом ящике пользователя на том же уровне, что и папка "Входящие".  <br/><br/> **Совет.** Вы можете запустить несколько тестовых пакетов, чтобы поэкспериментировать с этим параметром и определить лучшее расположение для папки, в которую необходимо импортировать PST-файлы.  <br/> |(Оставьте пустым)  <br/> или  <br/>  `/` <br/> или  <br/>  `/ImportedPst` <br/> |
    | `ContentCodePage` <br/> |Этот необязательный параметр задает числовое значение кодовой страницы, которую следует использовать для импорта PST-файлов в формате ANSI. Этот параметр применяется при импорте PST-файлов на китайском, японском и корейском языках, так как в них обычно используется двухбайтовая кодировка (DBCS). Если не использовать этот параметр, названия папок почтовых ящиков могут быть искажены после импорта.  <br/><br/> Список поддерживаемых значений для этого параметра см. в статье [Идентификаторы кодовых страниц](https://go.microsoft.com/fwlink/p/?LinkId=328514).  <br/> <br/>**Примечание.** Как говорилось выше, этот необязательный параметр можно не включать в CSV-файл. Кроме того, вы можете добавить его и оставить поле пустым для одной или нескольких строк.  <br/> |(Оставьте пустым)  <br/> Или  <br/>  `932` (идентификатор кодовой страницы для японского языка ANSI/OEM)  <br/> |
    | `SPFileContainer` <br/> |При импорте PST-файлов оставьте этот параметр пустым.  <br/> |Неприменимо  <br/> |
    | `SPManifestContainer` <br/> |При импорте PST-файлов оставьте этот параметр пустым.  <br/> |Неприменимо  <br/> |
    | `SPSiteUrl` <br/> |При импорте PST-файлов оставьте этот параметр пустым.  <br/> |Неприменимо  <br/> |

## <a name="step-5-create-a-pst-import-job"></a>Шаг 5. Создание задания импорта PST

Следующим шагом является создание задания импорта PST в службе импорта в Microsoft 365. Как указано выше, вам необходимо отправить файл сопоставления для импорта PST-файлов, созданный на шаге 4. После создания задания Microsoft 365 анализирует данные в файлах PST, а затем дает возможность фильтровать данные, которые фактически импортируются в почтовые ящики, указанные в файле отображения импорта PST (см. [Шаг 6](#step-6-filter-data-and-start-the-pst-import-job)).
  
1. Перейдите в [https://protection.office.com](https://protection.office.com) и войдите в систему, используя учетные данные для учетной записи администратора в вашей организации. 

2. В левой области Центра безопасности и соответствия требованиям выберите **Управление информацией > Импорт > Импорт PST-файлов**.

3. На странице **Импорт PST-файлов** нажмите ![Добавить](../media/ITPro-EAC-AddIcon.gif) **Новое задание импорта**.

   > [!NOTE]
   > Для создания задания импорта вам должны быть назначены соответствующие разрешения для доступа к странице **Импорт** в Центре безопасности и соответствия требованиям. Подробнее см. в разделе **Перед началом работы**. 

4. Введите имя для задания импорта PST-файлов и нажмите кнопку **Далее**. Используйте строчные буквы, числа, дефисы и символы подчеркивания. Имя не должно содержать заглавных букв и пробелов.

5. На странице **Отправить или передать данные?** выберите **Отправка данных**, а затем нажмите кнопку **Далее**.

    ![Нажмите "Отправка данных", чтобы создать задание импорта для передачи по сети](../media/e59f9dc3-ccde-44ff-ac38-c4e39d76ae85.png)
  
6. На шаге 4 на странице **Импорт данных** установите флажки **Все файлы отправлены** и **У меня есть доступ к файлу сопоставления**, а затем нажмите кнопку **Далее**.

    ![Установите два флажка на шаге 4.](../media/9f2427e8-3af2-4e27-95e6-a9f08430d3d8.png)
  
7. На странице **Выбор файла сопоставления** щелкните **Выбрать файл сопоставления**, чтобы отправить файл CSV/сопоставления, созданный в Действии 4. 

    ![Щелкните "Выбрать файл сопоставления", чтобы отправить файл сопоставления для импорта PST-файлов, созданный на шаге 3.](../media/d30b1d73-80bb-491e-a642-a21673d06889.png)
  
8. Когда имя CSV-файла появится в разделе **Имя файла сопоставления**, выберите его и щелкните **Проверить**, чтобы проверить CSV-файл на наличие ошибок. 

    ![Нажмите кнопку "Проверить", чтобы проверить CSV-файл на наличие ошибок.](../media/4680999d-5538-4059-b878-2736a5445037.png)
  
    Чтобы можно было создать задание импорта PST-файлов, CSV-файл должен успешно пройти проверку. Имя файла становится зеленым после успешной проверки. Если проверка завершилась сбоем, щелкните ссылку **Просмотреть журнал**. Откроется журнал ошибок, в котором для каждой строки со сбоем будет соответствующее сообщение об ошибке.

   > [!NOTE]
   > Как было сказано выше, в файле сопоставления может быть не более 500 строк. Если файл сопоставления содержит более 500 строк, то проверка завершится сбоем. Чтобы импортировать более 500 PST-файлов, необходимо создать несколько файлов сопоставления и несколько заданий импорта в Действии 5.

9. После успешной проверки файла сопоставления прочитайте документ с условиями, а затем установите флажок.

10. Нажмите кнопку **Сохранить**, чтобы отправить задание, а затем нажмите кнопку **Закрыть**, когда задание будет успешно создано. 

    Появится всплывающее окно со статусом **Анализ выполняется**, а новое задание импорта появится в списке на странице **Импорт PST-файлов**. 

11. Нажмите кнопку **Обновить** ![Значок "Обновить"](../media/O365-MDM-Policy-RefreshIcon.gif), чтобы обновить данные, отображаемые в столбце **Состояние**. Когда анализ будет завершен, а данные станут готовы к импорту, состояние изменится на **Анализ выполнен**.

    Вы можете щелкнуть задание импорта, чтобы открыть всплывающее окно состояния, которое содержит более подробные сведения о задании импорта, такие как состояние каждого PST-файла, перечисленного в файле сопоставления.
 
## <a name="step-6-filter-data-and-start-the-pst-import-job"></a>Шаг 6. Фильтрация данных и запуск задания импорта PST-файлов

После создания задания импорта на шаге 5 Microsoft 365 анализирует данные в файлах PST (безопасным и надежным способом), определяя возраст элементов и различные типы сообщений, включенные в файлы PST. После завершения анализа и подготовки вы можете импортировать все данные в PST-файлах или настроить фильтры.
  
1. На странице **Импорт PST-файлов** в Центре безопасности и соответствия требованиям щелкните **Готово к импорту в Office 365**, чтобы выполнить задание, созданное на шаге 5. 
    
    ![Нажмите Готово для импорта в Microsoft 365 рядом с созданным вами заданием на импорт.](../media/5760aac3-300b-4e31-b894-253c42a4b82b.png)
  
    Появится страница со сведениями о PST-файлах и другой информацией о задании импорта.
    
2. На всплывающей странице щелкните **Импорт в Office 365**.
    
    Откроется страница **Отфильтровать данные**. На ней представлены результаты анализа PST-файлов, выполненного в Office 365, в том числе сведения о возрасте данных. На этом этапе вы можете отфильтровать данные или импортировать их все. 
    
    ![Можно обрезать данные в PST-файлах или импортировать их полностью](../media/287fc030-99e9-417b-ace7-f64617ea5d4e.png)
  
3. Выполните одно из указанных ниже действий.
    
    а. Чтобы ограничить объем импортируемых данных, щелкните **Да, я хочу отфильтровать данные перед импортом**.
    
    Пошаговые инструкции по фильтрации данных в PST-файлах и запуску задания импорта можно найти [здесь](filter-data-when-importing-pst-files.md).
    
    или
    
    б. Чтобы импортировать все данные из PST-файлов, щелкните **Нет, импортировать все**, а затем нажмите кнопку **Далее**.
    
4. Если вы решили импортировать все данные, нажмите кнопку **Импорт данных**, чтобы запустить задание импорта. 
    
    Состояние задания отображается на странице **Импорт PST-файлов**. Щелкните ![значок "Обновить"](../media/O365-MDM-Policy-RefreshIcon.gif) **Обновить**, чтобы обновить данные, отображаемые в столбце **Состояние**. Щелкните задание импорта, чтобы открыть всплывающее окно, в котором отображаются сведения о состоянии каждого импортируемого PST-файла. 


  
## <a name="more-information"></a>Дополнительные сведения

- Зачем импортировать файлы PST в Microsoft 365?
    
  - Это хороший способ импортировать данные архивных сообщений вашей организации в Microsoft 365.
    
  - Данные доступны пользователю на любых устройствах, так как они хранятся в облаке.
    
  - Он помогает удовлетворить требования соответствия вашей организации, позволяя вам применять функции соответствия Microsoft 365 к данным из импортированных вами файлов PST. К ним относятся:
    
  - использовать [архивные почтовые ящики](enable-archive-mailboxes.md) и [архивацию с автоматическим расширением](enable-unlimited-archiving.md) для расширения доступного пользователям места в почтовых ящиках для хранения импортированных данных; 
    
  - помещать почтовые ящики на [хранение для судебного разбирательства](https://go.microsoft.com/fwlink/?linkid=856286) с целью сохранения импортированных данных. 
    
  - с помощью [средства Microsoft для обнаружения электронных данных](search-for-content.md) проводить поиск в импортированных данных; 
    
  - Использование [политик хранения Microsoft 365](retention.md) для контроля того, как долго будут храниться импортированные вами данные и какие действия предпринять после истечения срока хранения. 
    
  - Поиск в журнале [аудита событий](search-the-audit-log-in-security-and-compliance.md), связанных с почтовыми ящиками, которые влияют на импортированные данные. 
    
  - импортировать данные в [неактивные почтовые ящики](create-and-manage-inactive-mailboxes.md) для архивации данных согласно нормативным требованиям; 
    
  - использовать [политики защиты от потери данных](data-loss-prevention-policies.md) для предотвращения утечки секретных данных из организации. 
  
- Вот пример подписанного URL-адреса (SAS), полученного на шаге 1. Этот пример также содержит синтаксис команды, которую вы запускаете в средстве AzCopy.exe для загрузки файлов PST. Необходимо защитить URL-адрес SAS так же надежно, как вы защищаете пароли и прочую информацию, связанную с обеспечением безопасности.

    ```text
    SAS URL: https://3c3e5952a2764023ad14984.blob.core.windows.net/ingestiondata?sv=2012-02-12&amp;se=9999-12-31T23%3A59%3A59Z&amp;sr=c&amp;si=IngestionSasForAzCopy201601121920498117&amp;sig=Vt5S4hVzlzMcBkuH8bH711atBffdrOS72TlV1mNdORg%3D

    AzCopy.exe /Source:<Location of PST files> /Dest:<SAS URL> /V:<Log file location> /Y

    EXAMPLES

    This example uploads PST files to the root of the Azure storage location:

    AzCopy.exe /Source:"\\FILESERVER1\PSTs" /Dest:"https://3c3e5952a2764023ad14984.blob.core.windows.net/ingestiondata?sv=2012-02-12&amp;se=9999-12-31T23%3A59%3A59Z&amp;sr=c&amp;si=IngestionSasForAzCopy201601121920498117&amp;sig=Vt5S4hVzlzMcBkuH8bH711atBffdrOS72TlV1mNdORg%3D" /V:"c:\Users\Admin\Desktop\AzCopy1.log" /Y
    
    This example uploads PST files to a subfolder named PSTFiles  in the Azure storage location:

    AzCopy.exe /Source:"\\FILESERVER1\PSTs" /Dest:"https://3c3e5952a2764023ad14984.blob.core.windows.net/ingestiondata/PSTFiles?sv=2012-02-12&amp;se=9999-12-31T23%3A59%3A59Z&amp;sr=c&amp;si=IngestionSasForAzCopy201601121920498117&amp;sig=Vt5S4hVzlzMcBkuH8bH711atBffdrOS72TlV1mNdORg%3D" /V:"c:\Users\Admin\Desktop\AzCopy1.log" /Y
    ```

- Как упоминалось выше, служба импорта Office 365 включает параметр приостановки хранения (на неопределенное время) после импорта PST-файлов в почтовый ящик. Это означает, что для свойства *RetentionHoldEnabled* установлено значение **True**, чтобы политика хранения, назначенная почтовому ящику, не обрабатывалась. Это предоставляет владельцу почтового ящика время управлять только что импортированными сообщениями, не давая политике удаления или архивации удалить или архивировать более старые сообщения. Вот как можно управлять приостановкой хранения: 
    
    - По прошествии определенного времени вы можете отключить приостановку хранения, выполнив команду **Set-Mailbox -RetentionHoldEnabled $false**. Инструкции для этого см. в статье [Включение функции приостановки хранения для почтового ящика](https://go.microsoft.com/fwlink/p/?LinkId=544749).
    
   - Приостановку хранения можно настроить таким образом, чтобы она отключилась в определенную дату. Это можно сделать, выполнив команду **Set-Mailbox -EndDateForRetentionHold *date***. Предположим, например, что сегодня 1 июля 2016 года и вы хотите, чтобы приостановка хранения отключилась через 30 дней. Для этого нужно выполнить такую команду: **Set-Mailbox -EndDateForRetentionHold 7/1/2016**. В данном случае для свойства **RetentionHoldEnabled** нужно оставить значение *True*. Дополнительные сведения см. в статье [Set-Mailbox](https://go.microsoft.com/fwlink/p/?LinkId=150317).
    
   - Параметры назначенной почтовому ящику политики хранения можно изменить таким образом, чтобы более старые из импортированных элементов не удалялись и не перемещались в архивный почтовый ящик пользователя сразу. Например, можно продлить срок хранения для назначенной почтовому ящику политики удаления или архивации. В таком случае после того, как вы измените параметры политики хранения, нужно отключить приостановку хранения в почтовом ящике. Для получения дополнительной информации см. [Настройка политики архивирования и удаления для почтовых ящиков в вашей организации](set-up-an-archive-and-deletion-policy-for-mailboxes.md).

### <a name="how-the-import-process-works"></a>Как протекает процесс импорта
  
Для импорта PST-файлы в почтовые ящики пользователей можно использовать функцию отправки по сети и службу импорта Office 365. При отправке по сети PST-файлы отправляются во временное хранилище в Microsoft Cloud. Затем с помощью службы импорта Office 365 они копируются из хранилища в целевые почтовые ящики пользователей.
  
На схеме ниже показан процесс отправки по сети для импорта PST-файлов в почтовые ящики Office 365.
  
![Процесс отправки по сети для импорта PST-файлов в Office 365](../media/9e05a19e-1e7a-4f1f-82df-9118f51588c4.png)
  
1. **Скачивание средства импорта PST и ключа для частного хранилища Azure.** Сначала скачайте программу командной строки AzCopy и ключ доступа, используемый для отправки PST-файлов в хранилище Azure в Microsoft Cloud. Их можно получить на странице **Импорт** в Центре безопасности и соответствия требованиям. Ключ подписи безопасного доступа (SAS) содержит необходимые разрешения для отправки PST-файлов в защищенное частное хранилище Azure. Этот ключ является уникальным и помогает предотвратить несанкционированный доступ к PST-файлам, переданным в Microsoft Cloud. Для импорта файлов PST не требуется, чтобы ваша организация имела отдельную подписку Azure. 
    
2. **Загрузите PST-файлы в хранилище Azure:** Следующим шагом является использование инструмента AzCopy.exe (загруженного на шаге 1) для загрузки и сохранения ваших PST-файлов в хранилище Azure, которое находится в том же региональном центре обработки данных Microsoft, где находится ваша организация. расположен. Для их загрузки PST-файлы, которые вы хотите импортировать, должны находиться в общей папке или на файловом сервере в вашей организации.
    
    После отправки PST-файлов в хранилище Azure можно просмотреть их список.
    
3. **Создание файла сопоставления для импорта PST-файлов.** После отправки PST-файлов в хранилище Azure необходимо создать файл данных с разделителями-запятыми (CSV-файл), определяющий, в какие почтовые ящики пользователей нужно импортировать PST-файлы: в основные или архивные. Служба импорта Office 365 использует информацию в CSV-файле для импорта PST-файлов.
    
4. **Создание задания импорта PST-файлов.** Теперь нужно создать задание импорта PST-файлов на странице **Импорт PST-файлов** Центра безопасности и соответствия требованиям и отправить файл сопоставления, созданный на предыдущем шаге. После создания задания импорта Microsoft 365 анализирует данные в файлах PST, а затем дает возможность установить фильтры, которые управляют тем, какие данные фактически импортируются в почтовые ящики, указанные в файле сопоставления импорта PST. 
    
5. **Фильтрация данных PST, которые будут импортированы в почтовые ящики:** После создания и запуска задания импорта Microsoft 365 анализирует данные в файлах PST (безопасно и надежно), определяя возраст элементов и различные типы сообщений, включенных в PST. файлы. После завершения анализа и подготовки вы можете импортировать все данные в PST-файлах или настроить фильтры.
    
6. **Запустите задание импорта PST:** После запуска задания импорта Microsoft 365 использует информацию из файла сопоставления импорта PST для импорта файлов PST из расположения хранилища Azure в почтовые ящики пользователей. Состояние задания импорта (включая информацию о каждом импортируемом PST-файле) отображается на странице **Импорт PST-файлов** в Центре безопасности и соответствия требованиям. После завершения импорта состояние изменяется на **Выполнено**.