---
title: Смена или ротация ключа клиента или ключа доступности
ms.author: krowley
author: kccross
manager: laurawi
audience: ITPro
ms.topic: article
ms.service: O365-seccomp
localization_priority: Normal
search.appverid:
- MET150
ms.collection:
- M365-security-compliance
description: Узнайте, как свернуть корневые ключи клиента, хранимые в Хранилище ключей Azure, которые используются с ключом клиента. Службы включают Exchange Online, Skype для бизнеса, SharePoint Online, OneDrive для бизнеса и Teams файлы.
ms.openlocfilehash: 892d77959bec1fb33b0ea6bcfaa8c530dd9b8911
ms.sourcegitcommit: 94e64afaf12f3d8813099d8ffa46baba65772763
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/12/2021
ms.locfileid: "52345122"
---
# <a name="roll-or-rotate-a-customer-key-or-an-availability-key"></a>Смена или ротация ключа клиента или ключа доступности

> [!CAUTION]
> Только свернуть ключ шифрования, который используется с ключом клиента, когда требования безопасности или соответствия требованиям диктуют, что вы должны свернуть ключ. Кроме того, не удаляйте ключи, связанные или связанные с политиками. При откате ключей будет зашифровано содержимое с предыдущими ключами. Например, в то время как активные почтовые ящики будут часто повторно шифроваться, неактивные, отключенные и отключенные почтовые ящики могут по-прежнему шифроваться с предыдущими ключами. SharePoint В Интернете выполняется резервное копирование контента для восстановления и восстановления, поэтому может по-прежнему архивироваться содержимое с помощью старых ключей.

## <a name="about-rolling-the-availability-key"></a>О перекатке ключа доступности

Корпорация Майкрософт не предоставляет пользователям прямой контроль ключа доступности. Например, вы можете свернуть (повернуть) только ключи, которые принадлежат вам в Хранилище ключей Azure. Microsoft 365 перекатываю клавиши доступности по внутренне определенному расписанию. Для этих рулонов ключей не существует соглашения на уровне обслуживания с клиентом. Microsoft 365 поворот ключа доступности с Microsoft 365 кодом службы в автоматизированном, не ручном процессе. Администраторы Майкрософт могут инициировать процесс ролла. Ключ свернут с помощью автоматизированных механизмов без прямого доступа к хранилище ключей. Доступ к хранилище секретного ключа доступности не предусмотрен администраторам Майкрософт. Прокатка ключа доступности использует тот же механизм, который использовался для первоначального создания ключа. Дополнительные сведения о ключе доступности см. в дополнительных сведениях [о ключе доступности.](customer-key-availability-key-understand.md)

> [!IMPORTANT]
> Exchange Online и Skype для бизнеса могут эффективно свернуться клиентами, создавав новый deP, так как для каждого создаваемого deP создается уникальный ключ доступности. Ключи доступности для SharePoint, OneDrive для бизнеса и Teams файлов существуют на уровне леса и делятся между dePs и клиентами, что означает, что развертывание происходит только в определенном microsoft расписания. Чтобы уменьшить риск не перекатывания ключа доступности каждый раз, когда создается новый deP, SharePoint, OneDrive и Teams перекатывать промежуточный ключ клиента (TIK), ключ, завернутый корневыми ключами клиента и ключом доступности, каждый раз, когда создается новый deP.

## <a name="request-a-new-version-of-each-existing-root-key-you-want-to-roll"></a>Запрос новой версии каждого существующего корневого ключа, который необходимо свернуть

При скатыве ключа необходимо запросить новую версию существующего ключа. Чтобы запросить новую версию существующего ключа, вы используете тот же кодлет [Add-AzKeyVaultKey](/powershell/module/az.keyvault/add-azkeyvaultkey)с тем же синтаксисом, что и для создания ключа. После завершения проката любого ключа, связанного с политикой шифрования данных (DEP), вы запустите еще один комдлет, чтобы клиентский ключ начал использовать новый ключ. Сделайте этот шаг в каждом хранилище ключей Azure (AKV).

Пример.

1. Вопишите свою подписку Azure с помощью Azure PowerShell. Инструкции см. в [Azure PowerShell.](/powershell/azure/authenticate-azureps)

2. Запустите Add-AzKeyVaultKey, как показано в следующем примере:

   ```powershell
   Add-AzKeyVaultKey -VaultName Contoso-CK-EX-NA-VaultA1 -Name Contoso-CK-EX-NA-VaultA1-Key001 -Destination HSM -KeyOps @('wrapKey','unwrapKey') -NotBefore (Get-Date -Date "12/27/2016 12:01 AM")
   ```

   В этом примере, так как ключ **Contoso-CK-EX-NA-VaultA1-Key001** существует в хранилище **Contoso-CK-EX-NA-VaultA1,** в этом ключе создается новая версия ключа. Эта операция сохраняет предыдущие ключевые версии в истории версий для ключа. Для расшифровки данных, которые она по-прежнему шифрует, нужна предыдущая версия ключа. После завершения проката любого ключа, связанного с deP, запустите дополнительный кодлет, чтобы убедиться, что ключ клиента начинает использовать новый ключ. В следующих разделах описаны более подробные разделы.
  
## <a name="update-the-keys-for-multi-workload-deps"></a>Обновление ключей для многопрофильных dePs

Когда вы свернуть любой из ключей Хранилища Azure, связанных с deP, используемым с несколькими рабочими нагрузками, необходимо обновить DEP, чтобы указать на новый ключ. Этот процесс не вращает ключ доступности.

Чтобы поручить ключу клиента использовать новый ключ для шифрования нескольких рабочих нагрузок, выполните следующие действия:

1. На локальном компьютере с помощью учетной записи работы или учебного заведения с разрешениями администратора глобального администратора или администратора соответствия требованиям подключайтесь к Exchange Online [PowerShell](/powershell/exchange/connect-to-exchange-online-powershell) в Windows PowerShell окне.

2. Запустите Set-M365DataAtRestEncryptionPolicy.
  
   ```powershell
   Set-M365DataAtRestEncryptionPolicy -[Identity] "PolicyName" -Refresh
   ```

Где *PolicyName* — это имя или уникальный ID политики. Например, Contoso_Global.

Пример.

```powershell
Set-M365DataAtRestEncryptionPolicy -Identity "Contoso_Global" -Refresh
```

## <a name="update-the-keys-for-exchange-online-deps"></a>Обновление ключей для Exchange Online dePs

Когда вы свернуть один из ключей Хранилища Azure, связанных с deP, используемым с Exchange Online и Skype для бизнеса, необходимо обновить deP, чтобы указать на новый ключ. Это не вращает ключ доступности.

Чтобы поручить ключу клиента использовать новый ключ для шифрования почтовых ящиков, выполните Set-DataEncryptionPolicy кодлета следующим образом:

1. Запустите Set-DataEncryptionPolicy в Azure PowerShell:
  
   ```powershell
   Set-DataEncryptionPolicy -Identity <DataEncryptionPolicyID> -Refresh
   ```

2. Чтобы проверить значение свойства DataEncryptionPolicyID для почтового ящика, используйте шаги в Определении deP, назначенного [почтовому ящику.](customer-key-manage.md#determine-the-dep-assigned-to-a-mailbox) Значение этого свойства изменяется после того, как служба применяет обновленный ключ.
  
## <a name="update-the-keys-for-sharepoint-online-onedrive-for-business-and-teams-files"></a>Обновление ключей для SharePoint, OneDrive для бизнеса и Teams файлов

SharePoint Он-лайн позволяет одновременно свернуть только один ключ. Если вы хотите свернуть оба ключа в хранилище ключей, дождись завершения первой операции. Корпорация Майкрософт рекомендует шатания операций, чтобы избежать этой проблемы. Когда вы свернуть один из ключей Хранилища Azure, связанных с deP, используемым с SharePoint Online и OneDrive для бизнеса, необходимо обновить deP, чтобы указать на новый ключ. Это не вращает ключ доступности.

1. Выполните Update-SPODataEncryptionPolicy следующим образом:
  
   ```powershell
   Update-SPODataEncryptionPolicy -Identity <SPOAdminSiteUrl> -KeyVaultName <ReplacementKeyVaultName> -KeyName <ReplacementKeyName> -KeyVersion <ReplacementKeyVersion> -KeyType <Primary | Secondary>
   ```

   Несмотря на то, что этот комдлет запускает операцию переката ключей для SharePoint Online и OneDrive для бизнеса, действие не завершается сразу.

2. Чтобы увидеть ход операции рулона ключей, выполните Get-SPODataEncryptionPolicy следующим образом:

   ```powershell
   Get-SPODataEncryptionPolicy -Identity <SPOAdminSiteUrl>
   ```

## <a name="related-articles"></a>Связанные статьи

- [Шифрование службы с ключом клиента для Office 365](customer-key-overview.md)

- [Настройка ключа клиента для Office 365](customer-key-set-up.md)

- [Управление ключом клиента для Office 365](customer-key-manage.md)

- [Узнайте о ключе доступности](customer-key-availability-key-understand.md)