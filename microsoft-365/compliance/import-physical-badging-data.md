---
title: Настройка соединителя для импорта физических данных награды
f1.keywords:
- NOCSH
ms.author: markjjo
author: markjjo
manager: laurawi
ms.date: ''
audience: Admin
ms.topic: how-to
ms.service: O365-seccomp
localization_priority: Normal
search.appverid:
- MET150
ms.collection: M365-security-compliance
description: Администраторы могут настроить соединитель данных для импорта данных из физической системы награды Организации в Microsoft 365. Это позволяет использовать эти данные в политиках управления рисками, чтобы помочь вам определить доступ к физическим зданиям по определенным пользователям, которые могут указывать на потенциальную внутреннюю угрозу для Организации.
ms.openlocfilehash: 71f43d8e6abd53454b6c81d811d0dca2e8b08388
ms.sourcegitcommit: 3c39866865c8c61bce2169818d8551da65033cfe
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/30/2020
ms.locfileid: "48816652"
---
# <a name="set-up-a-connector-to-import-physical-badging-data-preview"></a>Настройка соединителя для импорта физических данных награды (Предварительная версия)

Вы можете настроить соединитель данных в центре соответствия требованиям Microsoft 365 для импорта физических данных награды, таких как необработанные события физического доступа сотрудника или оповещения о физическом доступе, создаваемые системой награды Организации. Примерами физических точек доступа является запись для здания или записи в серверном помещении или центре обработки данных. Физические данные награды могут использоваться [решением по управлению рисками](insider-risk-management.md) Microsoft 365 для защиты Организации от вредоносных действий или кражи данных в Организации.

Настройка физического соединителя награды состоит из следующих задач:

- Создание приложения в Azure Active Directory (Azure AD) для доступа к конечной точке API, которая принимает полезные данные JSON, содержащие физические данные награды.

- Создание полезных данных JSON с помощью схемы, определенной физическим соединителем данных награды.

- Создание физического соединителя данных награды в центре соответствия требованиям Microsoft 365.

- Выполнение скрипта для передачи физических данных награды в конечную точку API.

- При необходимости можно запланировать автоматический запуск скрипта для импорта данных физического награды в текущий момент.

## <a name="before-you-set-up-the-connector"></a>Перед настройкой соединителя

- Ваша организация должна предоставить согласие, чтобы разрешить службе импорта Office 365 доступ к данным в Организации. Чтобы согласиться с этим запросом, перейдите на [эту страницу](https://login.microsoftonline.com/common/oauth2/authorize?client_id=570d0bec-d001-4c4e-985e-3ab17fdc3073&response_type=code&redirect_uri=https://portal.azure.com/&nonce=1234&prompt=admin_consent), войдите с помощью учетных данных глобального администратора Microsoft 365 и примите запрос. Необходимо выполнить это действие, прежде чем вы сможете успешно создать физический соединитель награды в действии 3.

- Пользователю, создающему физический соединитель награды в действии 3, должна быть назначена роль импорта почтовых ящиков в Exchange Online. По умолчанию эта роль не назначена ни одной группе ролей в Exchange Online. Вы можете добавить роль экспорта для импорта почтовых ящиков в группу ролей Управление организацией в Exchange Online. Вы также можете создать новую группу ролей, назначить роль импорта почтовых ящиков, а затем добавить соответствующих пользователей в качестве участников. Для получения дополнительных сведений обратитесь к разделу [Создание](https://docs.microsoft.com/Exchange/permissions-exo/role-groups#create-role-groups) групп ролей или [изменение групп ролей](https://docs.microsoft.com/Exchange/permissions-exo/role-groups#modify-role-groups) статьи "Управление группами ролей в Exchange Online".

- Необходимо определить способ извлечения и экспорта данных из физической системы награды Организации (ежедневно) и создать JSON-файл, описанный в шаге 2. Скрипт, выполняемый в шаге 4, передает данные из JSON-файла в конечную точку API.

- Пример скрипта, выполняемого в шаге 4, передает физические данные награды из JSON-файла в API соединителя, чтобы его можно было использовать в решении по управлению рисками для оценки. Этот пример скрипта не поддерживается ни в одной из стандартных программ или услуг поддержки Майкрософт. Пример сценария предоставляется без каких-либо гарантий. Кроме того, корпорация Майкрософт отказывается от всех подразумеваемых гарантий, включая, но не ограничиваясь указанным, все подразумеваемые гарантии пригодности для продажи или определенной цели. Весь риск, возникающий из примера использования или производительности примера сценария и документации, остается без вас. Корпорация Майкрософт, ее штатные авторы и другие лица, принимающие участие в создании, подготовке и выпуске сценариев, ни при каких обстоятельствах не несут ответственность за какой-либо ущерб (в том числе, ущерб, вызванный потерей доходов предприятия, остановкой его работы, потерей бизнес-данных и другими материальными потерями), вызванный использованием или неспособностью использовать примеры сценариев и документацию, даже если корпорации Майкрософт известно о возможности нанесения такого ущерба.

## <a name="step-1-create-an-app-in-azure-active-directory"></a>Шаг 1: создание приложения в Azure Active Directory

Первым шагом является создание и регистрация нового приложения в Azure Active Directory (Azure AD). Приложение будет соответствовать физическому соединителю награды, созданному на шаге 3. Создание этого приложения позволит Azure AD выполнить проверку подлинности запроса Push для полезных данных JSON, содержащих физические данные награды. Во время создания приложения Azure AD обязательно сохраните следующие сведения. Эти значения будут использоваться на последующих этапах.

- Идентификатор приложения Azure AD (также называемый *идентификатором приложения* или *идентификатором клиента* )

- Секрет приложения Azure AD (также называемый *секретом клиента* )

- Идентификатор клиента (также называемый *идентификатором каталога* )

Пошаговые инструкции по созданию приложения в Azure AD приведены в статье [Регистрация приложения с помощью платформы удостоверений Майкрософт](https://docs.microsoft.com/azure/active-directory/develop/quickstart-register-app).

## <a name="step-2-prepare-a-json-file-with-physical-badging-data"></a>Шаг 2: подготовка JSON file с физическими данными награды

Следующий шаг — создание JSON-файла, который содержит сведения о данных физического доступа сотрудников. Как описано в разделе до начала работы, необходимо определить, как создать этот файл JSON из физической системы награды Организации.

Файл JSON должен соответствовать определению схемы, требуемому соединителем. Ниже приведены описания необходимых свойств схемы для JSON file:

| Свойство | Описание | Тип данных |
|:-----------|:--------------|:------------|
|UserId|Сотрудник может иметь несколько цифровых удостоверений в системах. Вход должен иметь идентификатор Azure AD, уже разрешенный исходной системой. |Имя участника-пользователя или адрес электронной почты|
|ассетид|Идентификатор ссылки на физический ресурс или физическую точку доступа.| Буквенно-цифровая строка|
|ассетнаме|Понятное имя физического ресурса или точки физического доступа.|Буквенно-цифровая строка|
|евенттиме|Метка времени доступа.|Дата и время в формате UTC|
|акцессстатус|Значение `Success` или `Failed`| String|
|||

Ниже приведен пример файла JSON, который соответствует требуемой схеме:

```json
[
    {
        "UserId":"sarad@contoso.com"
        "AssetId":"Mid-Sec-7",
        "AssetName":"Main Building 1st Floor Mid Section",
        "EventTime":"2019-07-04T01:57:49",
        "AccessStatus":"Failed",
    },
    {
        "UserId":"pilarp@contoso.com",        
        "AssetId":"Mid-Sec-7",
        "AssetName":"Main Building 1st Floor Mid Section",
        "EventTime":"2019-07-04T02:57:49",        
        "AccessStatus":"Success",
    }
]
```
Вы также можете скачать следующее определение схемы для JSON файла из мастера, когда вы создадите физический соединитель награды в действии 3.

```text
{
    "title" : "Physical Badging Signals",
    "description" : "Access signals from physical badging systems",
    "DataType" : {
        "description" : "Identify what is the data type for input signal",
        "type" : "string",
    },
    "type" : "object",
    "properties": {
        "UserId" : {
            "description" : "Unique identifier AAD Id resolved by the source system",
            "type" : "string",
        },
        "AssetId": {
            "description" : "Unique ID of the physical asset/access point",
            "type" : "string",
        },
        "AssetName": {
            "description" : "friendly name of the physical asset/access point",
            "type" : "string",
        },
        "EventTime" : {
            "description" : "timestamp of access",
            "type" : "string",
        },
        "AccessStatus" : {
            "description" : "what was the status of access attempt - Success/Failed",
            "type" : "string",
        },
    }
    "required" : ["UserId", "AssetId", "EventTime" "AccessStatus"]
}
```

## <a name="step-3-create-the-physical-badging-connector"></a>Шаг 3: создание физического награды Connector

Следующий шаг — создание физического соединителя награды в центре соответствия требованиям Microsoft 365. После выполнения скрипта на шаге 4 файл JSON, созданный в шаге 3, будет обработан и помещен в конечную точку API, настроенную в шаге 1. На этом этапе необходимо скопировать значение JobId, созданное при создании соединителя. При запуске скрипта вы будете использовать идентификатор задания.

1. [https://compliance.microsoft.com](https://compliance.microsoft.com/)В левой панели навигации выберите элемент **соединители данных и нажмите кнопку соединители данных** .

2. На странице " **соединители данных** " в разделе **физический награды** нажмите кнопку **Просмотр** .

3. На странице **физический награды** нажмите кнопку **Добавить соединитель** .

4. На странице **учетные данные проверки подлинности** выполните следующие действия, а затем нажмите кнопку **Далее** .
  
   1. Введите или вставьте идентификатор приложения Azure AD для приложения Azure, созданного на шаге 1.
  
   2. Скачайте образец схемы для ссылки на создание файла JSON.
  
   3. Введите уникальное имя для физического соединителя награды.

5. На странице " **Проверка** " Проверьте параметры и нажмите кнопку **Готово** , чтобы создать соединитель.

6. Отображается страница состояния, которая подтверждает, что соединитель был создан. Эта страница также содержит идентификатор задания. Вы можете скопировать идентификатор задания с этой страницы или из всплывающей страницы для соединителя. Этот идентификатор задания необходим при запуске скрипта.

   Страница состояния также содержит ссылку на скрипт. Чтобы узнать, как опубликовать JSON-файл в конечной точке API, обратитесь к этому сценарию.

7. Нажмите кнопку **Готово** .

   Новый соединитель отображается в списке на вкладке **соединители** .

8. Щелкните физический соединитель награды, который вы только что создали, чтобы отобразить всплывающую страницу, содержащую свойства и другие сведения о соединителе.

## <a name="step-4-run-the-script-to-post-your-json-file-containing-physical-badging-data"></a>Шаг 4: запуск скрипта для публикации файла JSON, содержащего физические данные награды

Следующий шаг в настройке физического награды Connector заключается в выполнении сценария, который передает физические данные награды в JSON-файл (созданный на шаге 2) в конечную точку API, созданную на этапе 1. Мы предоставляем пример скрипта для вашей ссылки и можем использовать его или создавать собственный скрипт для публикации JSON-файла в конечной точке API.

После выполнения скрипта файл JSON, содержащий физические данные награды, помещается в организацию Microsoft 365, к которой он может получить доступ с помощью решения по управлению рисками для оценки. Мы рекомендуем отправлять данные физического награды ежедневно. Это можно сделать, автоматизируя процесс создания JSON-файла каждый день из физической системы награды, а затем запланируя сценарий для отправки данных.

> [!NOTE]
> Интерфейс API может обрабатывать не более 50 000 записей в JSON-файле.

1. Перейдите на [этот сайт GitHub](https://github.com/microsoft/m365-hrconnector-sample-scripts/blob/master/upload_termination_records.ps1) , чтобы получить доступ к образцу скрипта.

2. Нажмите кнопку **RAW** , чтобы отобразить скрипт в текстовом представлении.

3. Скопируйте все строки в примере сценария и сохраните их в текстовом файле.

4. При необходимости измените пример сценария для Организации.

5. Сохраните текстовый файл в виде файла сценария Windows PowerShell с использованием суффикса имени файла PS1; Например, PhysicalBadging.ps1.

6. Откройте командную строку на локальном компьютере и перейдите к каталогу, в котором был сохранен сценарий.

7. Выполните следующую команду, чтобы переместить физические данные награды в JSON-файл в облако Майкрософт; Например:

   ```powershell
   .\PhysicalBadging.ps1 -tenantId "<Tenant Id>" -appId "<Azure AD App Id>" -appSecret "<Azure AD App Secret>" -jobId "Job Id" -jsonFilePath "<records file path>"
   ```

   В следующей таблице описаны параметры, которые необходимо использовать с этим сценарием и их обязательные значения. Сведения, полученные на предыдущих этапах, используются в значениях этих параметров.

   | Параметр | Описание |
   |:-------------|:--------------|
   |tenantId | Это идентификатор вашей организации Microsoft 365, полученной на шаге 1. Вы также можете получить значение tenantId для вашей организации в колонке **Обзор** в центре администрирования Azure AD. Используется для идентификации Организации. |
   |appId | Это идентификатор приложения Azure AD для приложения, созданного в Azure AD в действии 1. Это используется Azure AD для проверки подлинности при попытке сценария получить доступ к организации Microsoft 365.                    |
   |appSecret | Это секрет приложения Azure AD для приложения, созданного в Azure AD в действии 1. Он также используется для проверки подлинности.                                                        |
   |jobId | Это идентификатор задания для физического соединителя награды, созданного на шаге 3. Используется для связи физических данных награды, которые передаются в облако Майкрософт с физическим соединителем награды.              |
   |жсонфилепас | Это путь к файлу на локальном компьютере (то, который вы используете для запуска скрипта) для JSON-файла, созданного в шаге 2. Этот файл должен соответствовать образцу схемы, описанному в шаге 3.|
   |||

   Ниже приведен пример синтаксиса для сценария физического награды Connector с использованием фактических значений для каждого параметра:

   ```powershell
   .\PhysicalBadging.ps1 -tenantId d5723623-11cf-4e2e-b5a5-01d1506273g9 -appId 29ee526e-f9a7-4e98-a682-67f41bfd643e -appSecret MNubVGbcQDkGCnn -jobId b8be4a7d-e338-43eb-a69e-c513cd458eba -csvFilePath 'C:\Users\contosoadmin\Desktop\Data\physical_badging_data.json'
   ```

   Если отправка выполнена успешно, сценарий отображает сообщение об **успешном выполнении отправки** .

   Если у вас есть несколько файлов JSON, необходимо выполнить сценарий для каждого файла.

> [!NOTE]
> Вы также можете отправить физические данные награды в конечную точку API, не выполняя предыдущий скрипт. Например, Вот пример использования POST для отправки данных в конечную точку API.

## <a name="step-5-monitor-the-physical-badging-connector"></a>Шаг 5: мониторинг физического награды Connector

После того как вы создадите физический соединитель награды и переносите данные физического награды, вы можете просмотреть соединитель и состояние отправки в центре соответствия требованиям Microsoft 365. Если вы планируете регулярное выполнение скрипта, вы также можете просмотреть текущее состояние после последнего запуска сценария.

1. Перейдите к разделу [https://compliance.microsoft.com](https://compliance.microsoft.com/) **соединители данных** в левой панели навигации и нажмите кнопку соединители данных.

2. Перейдите на вкладку **соединители** и выберите физический соединитель награды, чтобы отобразить всплывающую страницу. На этой странице представлены свойства и сведения о соединителе.

   ![Всплывающая страница состояния для физического награды Connector](..\media\PhysicalBadgingStatusFlyout.png)

3. В разделе **Последний импорт** щелкните ссылку **Журнал скачивания** , чтобы открыть (или сохранить) журнал состояний для соединителя. Этот журнал содержит сведения о каждом запуске скрипта и передает данные из CSV-файла в Microsoft Cloud.

   ![Физический файл журнала награды Connector отображает числовые строки из файла JSON, которые были отправлены](..\media\PhysicalBadgingConnectorLogFile.png)

   Поле **рекордссавед** указывает количество строк в CSV-файле, который был отправлен. Например, если CSV-файл содержит четыре строки, то значение полей **рекордссавед** равно 4, если сценарий успешно отправил все строки в CSV-файле.

Если вы еще не запустили сценарий на шаге 4, в разделе **Последний импорт** отображается ссылка для скачивания сценария. Вы можете скачать сценарий, а затем выполнить действия, описанные в шаге 4, чтобы запустить его.

## <a name="optional-step-6-schedule-the-script-to-run-automatically"></a>Необязательно Шаг 6: Планирование автоматического запуска скрипта

Чтобы убедиться, что последние сведения о физических награды из вашей организации доступны для таких средств, как решение для управления рисками, рекомендуется автоматически запускать сценарий регулярно, например, раз в день. Для этого также необходимо обновить файл данных физического награды до JSON в похожем (если не аналогичном) расписании, чтобы он содержал последние сведения о сотрудниках, которые покинут вашу организацию. Задача заключается в том, чтобы загрузить самую актуальную физическую награды данные, чтобы физический соединитель награды мог сделать его доступным для решения по управлению рисками для оценки.

Вы можете использовать приложение планировщика заданий в Windows для автоматического запуска скрипта каждый день.

1. На локальном компьютере нажмите кнопку " **Пуск** " Windows и введите **планировщик задач** .

2. Щелкните приложение **планировщика заданий** , чтобы открыть его.

3. В разделе **действия** выберите команду **создать задачу** .

4. На вкладке **Общие** введите описательное имя запланированной задачи. Например, **физический сценарий награды Connector** . Кроме того, можно добавить необязательное описание.

5. В разделе **Параметры безопасности** выполните следующие действия:

   1. Определите, следует ли запускать сценарий только при входе в систему или при выполнении входа в систему.

   2. Убедитесь, что установлен флажок **запускать с максимальными привилегиями** .

6. Перейдите на вкладку **триггеры** , нажмите кнопку **создать** , а затем выполните следующие действия:

   1. В разделе **Параметры** выберите параметр **ежедневно** , а затем выберите дату и время для первого запуска скрипта. Скрипт будет ежедневно в одно и то же время.

   2. В разделе **Дополнительные параметры** убедитесь, что установлен флажок **включен** .

   3. Нажмите кнопку **ОК** .

7. Перейдите на вкладку **действия** , нажмите кнопку **создать** , а затем выполните следующие действия:

   ![Параметры действий для создания новой запланированной задачи для физического сценария награды Connector](..\media\SchedulePhysicalBadgingScript1.png)

   1. В раскрывающемся списке **действий** убедитесь, что выбран пункт **запустить программу** .

   2. В поле **Программа/сценарий** нажмите кнопку **Обзор** и перейдите к следующему расположению и выберите его, чтобы отобразить путь в поле: C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe.

   3. В поле **Добавить аргументы (необязательно)** вставьте ту же команду сценария, что была выполнена в шаге 4. Например, .\PhysicalBadging.ps1 – tenantId "d5723623 – 11CF — 4e2e – b5a5 – 01d1506273g9" – appId "c12823b7 – b55a – 4989 Фаба 02de41bb97c3" appSecret "Мнубвгбккдкгкнн" – e081f4f4-3831-48d6-7bb3-fcfab1581458 "жсонфилепас" "C:\Users\contosoadmin\Desktop\Data\physical_badging_data.csv"

   4. В поле **Запуск в (необязательно)** вставьте путь к папке сценария, который был выполнен на шаге 4. Например, К:\усерс\контосоадмин\десктоп\скриптс.

   5. Нажмите кнопку **ОК** , чтобы сохранить параметры для нового действия.

8. В окне **Создание задачи** нажмите кнопку **ОК** , чтобы сохранить запланированную задачу. Возможно, вам будет предложено ввести учетные данные учетной записи пользователя.

   Новая задача отображается в библиотеке планировщика задач.

   ![Новая задача отображается в библиотеке планировщика задач](..\media\SchedulePhysicalBadgingScript2.png)

Время последнего запуска сценария и его последующего запланированного запуска. Можно дважды щелкнуть задачу, чтобы изменить ее.

Кроме того, вы можете проверить время последнего запуска сценария на всплывающей странице соответствующего физического награды Connector в центре соответствия требованиям.
