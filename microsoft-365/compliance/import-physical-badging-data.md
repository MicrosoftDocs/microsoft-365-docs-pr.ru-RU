---
title: Настройка соединитетеля для импорта физических данных плохой обработки
f1.keywords:
- NOCSH
ms.author: markjjo
author: markjjo
manager: laurawi
ms.date: ''
audience: Admin
ms.topic: how-to
ms.service: O365-seccomp
localization_priority: Normal
search.appverid:
- MET150
ms.collection: M365-security-compliance
description: Администраторы могут настроить соединители данных для импорта данных из физической системы плохой работы своей организации в Microsoft 365. Это позволяет использовать эти данные в политиках управления рисками для обнаружения доступа к физическим зданиям определенными пользователями, которые могут указывать на возможную внутреннюю угрозу для вашей организации.
ms.openlocfilehash: a300107af1d3fe07f208f7e3f239f75a9cd6e5af
ms.sourcegitcommit: f000358c01a8006e5749a86b256300ee3a73174c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/24/2021
ms.locfileid: "51994830"
---
# <a name="set-up-a-connector-to-import-physical-badging-data-preview"></a>Настройка соединитетеля для импорта физических данных плохой обработки (предварительный просмотр)

Вы можете настроить соединители данных в центре Microsoft 365 для импорта физических данных, например необработанных событий физического доступа сотрудника или любых физических сигналов тревоги доступа, созданных системой злонастроя вашей организации. Примерами физических точек доступа являются вход в здание или запись в серверную комнату или центр обработки данных. Физические плохие данные могут использоваться Microsoft 365 [](insider-risk-management.md) управления рисками, чтобы защитить организацию от вредоносных действий или кражи данных внутри организации.

Настройка физического соединитетеля плохой настройки состоит из следующих задач:

- Создание приложения в Azure Active Directory Azure AD для доступа к конечной точке API, которая принимает полезной нагрузки JSON, которая содержит физические данные о плохом результате.

- Создание полезной нагрузки JSON с помощью схемы, определяемой физическим соединителем данных для ненадежных данных.

- Создание физического соединитетеля данных для ненадежных данных в центре Microsoft 365 соответствия требованиям.

- Запуск скрипта для нажатия физических данных плохой работы в конечную точку API.

- Необязательно, запланировать автоматический запуск скрипта для импорта данных физического плохие в настоящее время.

## <a name="before-you-set-up-the-connector"></a>Перед настройками соединитетеля

- Пользователю, создававшего физический соединитатель плохой точки в шаге 3, необходимо уступить роль экспорта импорта почтовых ящиков в Exchange Online. По умолчанию эта роль не назначена ни одной группе ролей в Exchange Online. Вы можете добавить роль экспорта импорта почтовых ящиков в группу ролей управления организацией в Exchange Online. Или можно создать новую группу ролей, назначить роль экспортировать импорт почтовых ящиков, а затем добавить соответствующих пользователей в качестве участников. Дополнительные сведения см. в разделах [Создание](/Exchange/permissions-exo/role-groups#create-role-groups) групп ролей или [изменение](/Exchange/permissions-exo/role-groups#modify-role-groups) групп ролей в статье "Управление группами ролей в Exchange Online".

- Необходимо определить, как извлекать или экспортировать данные из физической системы злоуголизненных организаций (ежедневно) и создавать JSON-файл, описанный в шаге 2. Сценарий, который вы запустите в шаге 4, будет подталкивать данные в файле JSON к конечной точке API.

- Пример скрипта, который вы запустите в шаге 4, подталкивает физические плохие данные из JSON-файла к API соединителов, чтобы они могли использоваться в решении по управлению рисками. Этот пример сценария не поддерживается ни в одной стандартной программе поддержки Майкрософт или службе. Пример сценария приводится в виде "как есть", без каких-либо гарантий. Кроме того, корпорация Microsoft отказывается от всех подразумеваемых гарантий, включая в том числе все подразумеваемые гарантии пригодности для продажи или определенной цели. Все риски, возникающие в результате использования примера сценария и документации, берет на себя пользователь. Корпорация Майкрософт, ее штатные авторы и другие лица, принимающие участие в создании, подготовке и выпуске сценариев, ни при каких обстоятельствах не несут ответственность за какой-либо ущерб (в том числе, ущерб, вызванный потерей доходов предприятия, остановкой его работы, потерей бизнес-данных и другими материальными потерями), вызванный использованием или неспособностью использовать примеры сценариев и документацию, даже если корпорации Майкрософт известно о возможности нанесения такого ущерба.

## <a name="step-1-create-an-app-in-azure-active-directory"></a>Шаг 1. Создание приложения в Azure Active Directory

Первым шагом является создание и регистрация нового приложения в Azure Active Directory Azure AD. Приложение будет соответствовать физическому соединитеку плохой связи, создаваемой в шаге 3. Создание этого приложения позволит Azure AD проверить подлинность push-запроса для полезной нагрузки JSON, содержащей физические плохие данные. При создании этого приложения Azure AD обязательно сохраните следующую информацию. Эти значения будут использоваться в последующих действиях.

- ID приложения Azure AD (также называемый *ИД приложения* или *клиентский id)*

- Секрет приложения Azure AD (также называемый секрет *клиента)*

- Tenant Id (также называемый *ИД каталога)*

Пошаговая инструкция по созданию приложения в Azure AD см. в примере Регистрация приложения с помощью [платформа удостоверений Майкрософт.](/azure/active-directory/develop/quickstart-register-app)

## <a name="step-2-prepare-a-json-file-with-physical-badging-data"></a>Шаг 2. Подготовка файла JSON с физическими данными о плохом качестве

Следующим шагом является создание JSON-файла, который содержит сведения о физических данных доступа сотрудников. Как поясняется в разделе перед началом работы, необходимо определить, как создать этот JSON-файл из физической системы злонабчения организации.

Файл JSON должен соответствовать определению схемы, требуемой соединителем. Ниже описаны необходимые свойства схемы для файла JSON:

|Свойство|Описание|Тип данных|
|---|---|---|
|UserId|Сотрудник может иметь несколько цифровых удостоверений в системах. Для ввода необходимо, чтобы код Azure AD уже был разрешен в исходных системах.|UPN или адрес электронной почты|
|AssetId|Справочный ID физического актива или физической точки доступа.|Альфанумерная строка|
|AssetName|Удобное имя физического актива или точки физического доступа.|Альфанумерная строка|
|EventTime|Штамп времени доступа.|Дата и время в формате UTC|
|AccessStatus|Значение `Success` или `Failed`|String|
|||

Вот пример файла JSON, соответствующего необходимой схеме:

```json
[
    {
        "UserId":"sarad@contoso.com"
        "AssetId":"Mid-Sec-7",
        "AssetName":"Main Building 1st Floor Mid Section",
        "EventTime":"2019-07-04T01:57:49",
        "AccessStatus":"Failed",
    },
    {
        "UserId":"pilarp@contoso.com",
        "AssetId":"Mid-Sec-7",
        "AssetName":"Main Building 1st Floor Mid Section",
        "EventTime":"2019-07-04T02:57:49",
        "AccessStatus":"Success",
    }
]
```

Вы также можете скачать следующее определение схемы для файла JSON из мастера при создании физического соединителем плохой связи в шаге 3.

```text
{
   "title" : "Physical Badging Signals",
   "description" : "Access signals from physical badging systems",
   "DataType" : {
      "description" : "Identify what is the data type for input signal",
      "type" : "string",
   },
   "type" : "object",
   "properties": {
      "UserId" : {
         "description" : "Unique identifier AAD Id resolved by the source system",
         "type" : "string",
      },
      "AssetId": {
         "description" : "Unique ID of the physical asset/access point",
         "type" : "string",
      },
      "AssetName": {
         "description" : "friendly name of the physical asset/access point",
         "type" : "string",
      },
      "EventTime" : {
         "description" : "timestamp of access",
         "type" : "string",
      },
      "AccessStatus" : {
         "description" : "what was the status of access attempt - Success/Failed",
         "type" : "string",
      },
   }
   "required" : ["UserId", "AssetId", "EventTime" "AccessStatus"]
}
```

## <a name="step-3-create-the-physical-badging-connector"></a>Шаг 3. Создание физического соединитетеля ненадежных подключений

Следующий шаг — создание физического соединитетеля плохой обработки в центре Microsoft 365 соответствия требованиям. После запуска сценария в шаге 4 файл JSON, созданный в шаге 3, будет обработан и отодвигается к конечной точке API, настроенной в шаге 1. На этом шаге обязательно скопируйте JobId, созданный при создании соединитетеля. При запуске сценария вы будете использовать JobId.

1. Перейдите <https://compliance.microsoft.com> к и нажмите **соединители данных** в левом nav.

2. На странице **Соединители данных в** **статье Физическое плохое состояние,** щелкните **Просмотр**.

3. На странице **Физическое злонастроение** нажмите **кнопку Добавить соединителю**.

4. На странице **Учетные данные проверки подлинности** сделайте следующее и нажмите **кнопку Далее:**

   1. Введите или введите ID приложения Azure AD для приложения Azure, созданного в шаге 1.

   2. Скачайте пример схемы для ссылки для создания файла JSON.

   3. Введите уникальное имя для физического соединитетеля плохой нагрузки.

5. На странице **Обзор** просмотрите параметры и нажмите **кнопку Готово** для создания соединитетеля.

6. Отображается страница состояния, которая подтверждает, что соединитектор был создан. На этой странице также содержится ИД задания. Вы можете скопировать ID задания на этой странице или на странице вылетов для соединиттеля. Этот ID задания необходим при запуске сценария.

   Страница состояния также содержит ссылку на сценарий. Обратитесь к этому скрипту, чтобы понять, как разместить файл JSON в конечной точке API.

7. Нажмите кнопку **Готово**.

   Новый соединитатель отображается в списке на вкладке **Соединители.**

8. Щелкните физический соединитатель плохой связи, который только что был создан, чтобы отобразить страницу вылетов, которая содержит свойства и другие сведения о соединителе.

## <a name="step-4-run-the-script-to-post-your-json-file-containing-physical-badging-data"></a>Шаг 4. Запустите сценарий для публикации файла JSON, содержащего физические данные о плохом

Следующим шагом в настройке физического соединитетеля плохой настройки является запуск скрипта, который будет толкать физические данные плохой настройки в файлЕ JSON (созданный в шаге 2) в конечную точку API, созданную на шаге 1. Мы предоставляем пример сценария для вашей ссылки, и вы можете использовать его или создать собственный сценарий для публикации файла JSON в конечную точку API.

После запуска скрипта файл JSON, содержащий физические данные о плохом управлении, перенаправлен в организацию Microsoft 365, к которой можно получить доступ с помощью решения по управлению рисками изнутри. Мы рекомендуем ежедневно размещать физические данные о плохой обработке. Это можно сделать, автоматизируя процесс создания файла JSON каждый день из вашей физической системы плохой работы, а затем запланировать сценарий, чтобы нажать данные.

> [!NOTE]
> Максимальное число записей в файле JSON, которое может обрабатывать API, — 50 000 записей.

1. Перейдите [на этот GitHub,](https://github.com/microsoft/m365-hrconnector-sample-scripts/blob/master/upload_termination_records.ps1) чтобы получить доступ к примеру сценария.

2. Нажмите **кнопку Raw,** чтобы отобразить сценарий в текстовом представлении

3. Скопируйте все строки в примере сценария и сохраните их в текстовом файле.

4. При необходимости измените пример сценария для организации.

5. Сохраните текстовый файл в виде Windows PowerShell скрипта с помощью суффикса .ps1; например, PhysicalBadging.ps1.

6. Откройте командную подсказку на локальном компьютере и перейдите в каталог, в котором сохранен сценарий.

7. Запустите следующую команду, чтобы нажать физические плохие данные в файле JSON в облако Microsoft; Например:

   ```powershell
   .\PhysicalBadging.ps1 -tenantId "<Tenant Id>" -appId "<Azure AD App Id>" -appSecret "<Azure AD App Secret>" -jobId "Job Id" -jsonFilePath "<records file path>"
   ```

   В следующей таблице описываются параметры, которые необходимо использовать с помощью этого скрипта, и их необходимые значения. Сведения, полученные в предыдущих действиях, используются в значениях для этих параметров.

   |Параметр|Описание|
   |---|---|
   |tenantId|Это Id для вашей Microsoft 365 организации, полученный в шаге 1. Вы также можете получить tenantId для организации на лезвии **Обзор** в центре администрирования Azure AD. Это используется для идентификации организации.|
   |appId|Это Id приложения Azure AD для приложения, созданного в Azure AD на шаге 1. Это используется Azure AD для проверки подлинности, когда сценарий пытается получить доступ к Microsoft 365 организации.|
   |appSecret|Это секрет приложения Azure AD для приложения, созданного в Azure AD на шаге 1. Это также используется для проверки подлинности.|
   |jobId|Это ИД задания для физического соединитетеля плохой работы, созданного в шаге 3. Это используется для связывания физических данных, которые отодвигаются в облако Майкрософт, с физическим соединитетелем ненадежных подключений.|
   |JsonFilePath|Это путь к файлу на локальном компьютере (который используется для запуска скрипта) для файла JSON, созданного в шаге 2. Этот файл должен следовать схеме примера, описанной в шаге 3.|
   |||

   Вот пример синтаксиса для скрипта соединитель физического ненадежного подключения с использованием фактических значений для каждого параметра:

   ```powershell
   .\PhysicalBadging.ps1 -tenantId d5723623-11cf-4e2e-b5a5-01d1506273g9 -appId 29ee526e-f9a7-4e98-a682-67f41bfd643e -appSecret MNubVGbcQDkGCnn -jobId b8be4a7d-e338-43eb-a69e-c513cd458eba -csvFilePath 'C:\Users\contosoadmin\Desktop\Data\physical_badging_data.json'
   ```

   Если загрузка будет успешной, скрипт отображает Upload **успешное** сообщение.

   Если у вас несколько JSON-файлов, необходимо запустить сценарий для каждого файла.

> [!NOTE]
> Вы также можете нажать физические данные плохой работы в конечную точку API методами, не работающими с предыдущим сценарием. Например, вот пример использования Postman для нажатия данных на конечную точку API.

## <a name="step-5-monitor-the-physical-badging-connector"></a>Шаг 5. Мониторинг физического соединитетеля ненадежных подключений

После создания физического соединиттеля плохой защиты и нажатия данных физического плохие, вы можете просмотреть соединители и загрузить состояние в центре Microsoft 365 соответствия требованиям. Если вы запланировать автоматический запуск скрипта на регулярной основе, вы также можете просмотреть текущее состояние после последнего запуска сценария.

1. Перейдите <https://compliance.microsoft.com> и щелкните **соединители данных** в левом nav.

2. Щелкните **вкладку** Соединители, а затем выберите физический соединитатель плохой платы, чтобы отобразить страницу вылетов. На этой странице содержатся свойства и сведения о соединители.

   ![Страница вылетов состояния для физического соединитетеля ненадежных подключений](..\media\PhysicalBadgingStatusFlyout.png)

3. В **статье Последний импорт** щелкните ссылку **Журнал** загрузки, чтобы открыть (или сохранить) журнал состояния соединиттеля. В этом журнале содержатся сведения о каждом запуске сценария и отправке данных из CSV-файла в облако Майкрософт.

   ![Файл журнала журнала физических ненадежных подключений отображает строки номеров из файла JSON, которые были загружены](..\media\PhysicalBadgingConnectorLogFile.png)

   Поле **RecordsSaved** указывает количество строк в загруженном CSV-файле. Например, если файл CSV содержит четыре строки, то значение полей **RecordsSaved** составляет 4, если сценарий успешно загрузил все строки в CSV-файле.

Если вы еще не запускали сценарий в шаге 4, ссылка на скачивание скрипта отображается в **статье Последний импорт**. Вы можете скачать сценарий, а затем выполнить действия в шаге 4 для его запуска.

## <a name="optional-step-6-schedule-the-script-to-run-automatically"></a>(Необязательный) Шаг 6. Запланировать автоматический запуск сценария

Чтобы убедиться, что последние физические плохие данные из организации доступны таким средствам, как решение по управлению рисками, рекомендуется запланировать автоматический запуск сценария, например один раз в день. Это также требует обновления данных физического плохие сведения в файл JSON по аналогичному (если не одному) расписанию, чтобы в нем содержались последние сведения о сотрудниках, покидающих организацию. Цель заключается в том, чтобы загрузить самые актуальные физические плохие данные, чтобы физический соединитатель ненадежных подключений стал доступным для решения по управлению рисками изнутри.

Вы можете использовать приложение Scheduler задач в Windows, чтобы автоматически запускать сценарий каждый день.

1. На локальном компьютере нажмите кнопку Windows **и** введите **план-график задач.**

2. Щелкните **приложение Scheduler** задач, чтобы открыть его.

3. В разделе **Действия** нажмите кнопку **Создать задачу**.

4. На **вкладке General** введите описательное имя для запланированной задачи; например, **скрипт соединитетеля физического ненадежного подключения.** Вы также можете добавить необязательное описание.

5. В **параметрах Безопасности** сделайте следующие вещи:

   1. Определите, следует ли запускать сценарий только в том случае, если вы вошли на компьютер или запустите его при входе в систему или нет.

   2. Убедитесь, что **выбран почтовый** ящик Run с наивысшими привилегиями.

6. Выберите **вкладку Триггеры,** нажмите **кнопку New** и затем сделайте следующие вещи:

   1. В **Параметры** выберите параметр **Daily,** а затем выберите дату и время для первого запуска сценария. Сценарий будет каждый день в указанное время.

   2. В **расширенных параметрах** убедитесь, что выбран почтовый ящик **Включен.**

   3. Нажмите кнопку **ОК**.

7. Выберите **вкладку Действия,** **нажмите кнопку New** и затем сделайте следующие действия:

   ![Параметры действий для создания новой запланированной задачи для скрипта соединитетеля физической ненадежной настройки](..\media\SchedulePhysicalBadgingScript1.png)

   1. В **списке "Действие"** убедитесь, что **выбрана** программа Start.

   2. В поле **Program/script** щелкните **Обзор** и перейдите к следующему расположению и выберите его таким образом, чтобы путь отображался в поле: C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe.

   3. В поле **Добавление аргументов (необязательный)** вклейте ту же команду скрипта, которую вы запустили в шаге 4. Например, .\PhysicalBadging.ps1-tenantId "d5723623-11cf-4e2e-b5a5-01d1d1506273g9" -appId "c12823b7-b55a-4989-faba-02de41bb97c3" -appSecret "MNubVGbcQDKGCnn" -jobId "e081f4f4-3831-48d6-7bb3-fcfab1581458" -jsonFilePath "C:\Users\contosoadmin\Desktop\Data\physical_badging_data.csv"

   4. В поле **Начните (необязательно)** вложите расположение папки скрипта, который вы запустили в шаге 4. Например, C:\Users\contosoadmin\Desktop\Scripts.

   5. Нажмите **кнопку Ок,** чтобы сохранить параметры для нового действия.

8. В **окне Создать задачу** **щелкните Ок,** чтобы сохранить запланированную задачу. Возможно, вам будет предложено ввести учетные данные учетных данных учетных записей пользователей.

   Новая задача отображается в библиотеке планиров задач.

   ![Новая задача отображается в библиотеке планиров задач](..\media\SchedulePhysicalBadgingScript2.png)

При последнем запуске сценария и при следующем его запуске отображается. Вы можете дважды щелкнуть задачу, чтобы изменить ее.

Вы также можете проверить последний раз, когда сценарий запустился на странице вылетов соответствующего физического соединиттеля плохой работы в центре соответствия требованиям.
