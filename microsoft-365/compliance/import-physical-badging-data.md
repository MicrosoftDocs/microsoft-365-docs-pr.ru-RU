---
title: Настройка соединители для импорта физических ненадежных данных
f1.keywords:
- NOCSH
ms.author: markjjo
author: markjjo
manager: laurawi
ms.date: ''
audience: Admin
ms.topic: how-to
ms.service: O365-seccomp
localization_priority: Normal
search.appverid:
- MET150
ms.collection: M365-security-compliance
description: Администраторы могут настроить соединители данных для импорта данных из физической системы плохой защиты организации в Microsoft 365. Это позволяет использовать эти данные в политиках управления внутренними рисками, чтобы помочь обнаруживать доступ к физическим зданиям определенным пользователям, что может указывать на возможную внутреннюю угрозу для вашей организации.
ms.openlocfilehash: 7e745b42d0df79f5c39f9fa02cb1b63f164ec2a5
ms.sourcegitcommit: 6fc6aaa2b7610e148f41018abd229e3c55b2f3d0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/10/2020
ms.locfileid: "49620135"
---
# <a name="set-up-a-connector-to-import-physical-badging-data-preview"></a>Настройка соединители для импорта физических ненадежных данных (предварительная версия)

В Центре соответствия требованиям Microsoft 365 можно настроить соединители данных для импорта физических данных, например необработанных событий физического доступа сотрудника или любых сигналов физического доступа, созданных системой защиты от хламов вашей организации. Примерами физических точек доступа является запись в здание или запись в комнату сервера или центр обработки данных. Решение по управлению рисками, которое поможет [](insider-risk-management.md) защитить организацию от вредоносных действий или кражи данных внутри организации, могут использоваться физические данные о вредоносных действиях.

Настройка физического соединитела плохой нагрузки состоит из следующих задач:

- Создание приложения в Azure Active Directory (Azure AD) для доступа к конечной точке API, которая принимает полезной нагрузки JSON, которая содержит физические ненадежные данные.

- Создание полезной нагрузки JSON со схемой, определенной физическим соединителем данных с ненадежными данными.

- Создание физического соединители данных с плохой нагрузкой в Центре соответствия требованиям Microsoft 365.

- Запуск сценария для передачи физических данных о некаблистике в конечную точку API.

- При желании можно запланировать автоматический запуск скрипта для импорта физических данных, не включающих в себя данные.

## <a name="before-you-set-up-the-connector"></a>Перед настройками соединители

- Пользователю, который создает физический соединитель плохой связи на шаге 3, должна быть назначена роль импорта и экспорта почтовых ящиков в Exchange Online. По умолчанию эта роль не назначена ни одной группе ролей в Exchange Online. Вы можете добавить роль "Импорт и экспорт почтового ящика" в группу ролей "Управление организацией" в Exchange Online. Можно также создать новую группу ролей, назначить роль "Импорт и экспорт почтового ящика" и добавить соответствующих пользователей в качестве участников. Дополнительные сведения см. в [](https://docs.microsoft.com/Exchange/permissions-exo/role-groups#modify-role-groups) разделах ["Создание](https://docs.microsoft.com/Exchange/permissions-exo/role-groups#create-role-groups) групп ролей" или "Изменение групп ролей" статьи "Управление группами ролей в Exchange Online".

- Необходимо определить, как получить или экспортировать данные из физической системы защиты от хламов организации (ежедневно) и создать JSON-файл, описанный в шаге 2. Сценарий, который вы запустите в шаге 4, будет переназначить данные в JSON-файле в конечную точку API.

- Пример скрипта, который вы запустите в шаге 4, перенаправление физических данных из JSON-файла в API соединителов, чтобы их можно было использовать в решении для управления рисками внутри организации. Этот пример сценария не поддерживается ни в одной стандартной программе или службе поддержки Майкрософт. Пример сценария приводится в виде "как есть", без каких-либо гарантий. Кроме того, корпорация Microsoft отказывается от всех подразумеваемых гарантий, включая в том числе все подразумеваемые гарантии пригодности для продажи или определенной цели. Все риски, возникающие в результате использования примера сценария и документации, берет на себя пользователь. Корпорация Майкрософт, ее штатные авторы и другие лица, принимающие участие в создании, подготовке и выпуске сценариев, ни при каких обстоятельствах не несут ответственность за какой-либо ущерб (в том числе, ущерб, вызванный потерей доходов предприятия, остановкой его работы, потерей бизнес-данных и другими материальными потерями), вызванный использованием или неспособностью использовать примеры сценариев и документацию, даже если корпорации Майкрософт известно о возможности нанесения такого ущерба.

## <a name="step-1-create-an-app-in-azure-active-directory"></a>Шаг 1. Создание приложения в Azure Active Directory

Сначала необходимо создать и зарегистрировать новое приложение в Azure Active Directory (Azure AD). Приложение будет соответствовать физическому соединитесу плохой связи, который вы создали на шаге 3. Создание этого приложения позволит Azure AD проверить подлинность push-запроса для полезной нагрузки JSON, содержащей физические ненадежные данные. Во время создания этого приложения Azure AD обязательно сохраните следующие сведения. Эти значения будут использоваться на последующих шагах.

- ИД приложения Azure AD (также называемый *ИД приложения* или ид *клиента)*

- Секрет приложения Azure AD (также называемый *секретом клиента)*

- ИД клиента (также называемый *ид каталога)*

Пошаговая инструкция по созданию приложения в Azure AD см. в записи "Регистрация приложения с помощью платформы удостоверений [Майкрософт".](https://docs.microsoft.com/azure/active-directory/develop/quickstart-register-app)

## <a name="step-2-prepare-a-json-file-with-physical-badging-data"></a>Шаг 2. Подготовка JSON-файла с физическими данными о плохом качестве

Далее необходимо создать JSON-файл, содержащий сведения о физических данных доступа сотрудников. Как поясняется в разделе перед началом работы, необходимо определить, как создать этот JSON-файл из физической системы плохой работы вашей организации.

JSON-файл должен соответствовать определению схемы, необходимому соединителем. Ниже описаны свойства схемы, необходимые для JSON-файла.

| Свойство | Описание | Тип данных |
|:-----------|:--------------|:------------|
|UserId|Сотрудник может иметь несколько цифровых удостоверений в различных системах. Для ввода необходимо, чтобы код Azure AD уже был разрешен в исходных системах. |UpN или адрес электронной почты|
|AssetId|ИД ссылки физического актива или физической точки доступа.| Буквано-цифровая строка|
|AssetName|Удобное имя физического актива или физической точки доступа.|Буквано-цифровая строка|
|EventTime|Отметка времени доступа.|Дата и время в формате UTC|
|AccessStatus|Значение `Success` или `Failed`| String|
|||

Вот пример JSON-файла, соответствующего требуемой схеме:

```json
[
    {
        "UserId":"sarad@contoso.com"
        "AssetId":"Mid-Sec-7",
        "AssetName":"Main Building 1st Floor Mid Section",
        "EventTime":"2019-07-04T01:57:49",
        "AccessStatus":"Failed",
    },
    {
        "UserId":"pilarp@contoso.com",        
        "AssetId":"Mid-Sec-7",
        "AssetName":"Main Building 1st Floor Mid Section",
        "EventTime":"2019-07-04T02:57:49",        
        "AccessStatus":"Success",
    }
]
```
Вы также можете скачать следующее определение схемы для JSON-файла в мастере при создании физического соединителем плохой связи на шаге 3.

```text
{
    "title" : "Physical Badging Signals",
    "description" : "Access signals from physical badging systems",
    "DataType" : {
        "description" : "Identify what is the data type for input signal",
        "type" : "string",
    },
    "type" : "object",
    "properties": {
        "UserId" : {
            "description" : "Unique identifier AAD Id resolved by the source system",
            "type" : "string",
        },
        "AssetId": {
            "description" : "Unique ID of the physical asset/access point",
            "type" : "string",
        },
        "AssetName": {
            "description" : "friendly name of the physical asset/access point",
            "type" : "string",
        },
        "EventTime" : {
            "description" : "timestamp of access",
            "type" : "string",
        },
        "AccessStatus" : {
            "description" : "what was the status of access attempt - Success/Failed",
            "type" : "string",
        },
    }
    "required" : ["UserId", "AssetId", "EventTime" "AccessStatus"]
}
```

## <a name="step-3-create-the-physical-badging-connector"></a>Шаг 3. Создание физического соединитела плохой нагрузки

Следующим шагом является создание физического соединитела для ненадежных подключений в Центре соответствия требованиям Microsoft 365. После запуска сценария на шаге 4 JSON-файл, созданный на шаге 3, будет обработан и переназначирован в конечную точку API, настроенную на шаге 1. На этом этапе обязательно скопируйте JobId, созданный при создании соединители. При запуске сценария вы будете использовать JobId.

1. Go to [https://compliance.microsoft.com](https://compliance.microsoft.com/) and then click Data **connectors** in the left nav.

2. On the **Data connectors** page under **Physical badging,** click **View**.

3. На странице **"Физическая ненадежная** связь" нажмите **кнопку "Добавить соединителю".**

4. На странице **"Учетные данные** проверки подлинности" сделайте следующее и нажмите кнопку **"Далее".**
  
   1. Введите или введите и введите ИД приложения Azure AD для приложения Azure, созданного на шаге 1.
  
   2. Скачайте пример схемы для справки, чтобы создать JSON-файл.
  
   3. Введите уникальное имя физического соединитела плохой нагрузки.

5. На странице **"Проверка"** просмотрите параметры и нажмите кнопку **"Готово",** чтобы создать соединители.

6. Отобразилась страница состояния, подтверждая, что соединитегор создан. На этой странице также содержится ИД задания. Вы можете скопировать ид задания с этой страницы или со страницы выдавателя для соединители. Этот ИД задания требуется при запуске сценария.

   Страница состояния также содержит ссылку на сценарий. Чтобы понять, как опубликовать JSON-файл в конечной точке API, обратитесь к этому сценарию.

7. Нажмите кнопку **Готово**.

   Новый соединитер отображается в списке на вкладке **"Соединители".**

8. Щелкните только что созданный физический соединиталь, чтобы отобразить только что отображаемую страницу с свойствами и другими сведениями о соединителе.

## <a name="step-4-run-the-script-to-post-your-json-file-containing-physical-badging-data"></a>Шаг 4. Запуск скрипта для POST-файла JSON, содержащего физические данные о плохом сечении

Следующий шаг в настройке физического соединитела плохой нагрузки состоит в запуске сценария, который будет переназначить физические данные в файле JSON (созданном на шаге 2) в конечную точку API, созданную на шаге 1. Мы предоставляем пример сценария для вашей ссылки, и вы можете выбрать его использование или создать собственный сценарий для публикации JSON-файла в конечной точке API.

После запуска сценария JSON-файл, содержащий физические данные о плохой нагрузке, будет перенаправлен в организацию Microsoft 365, где к нему можно получить доступ с помощью решения для управления рисками внутри организации. Рекомендуется ежедневно размещать данные о физических плохом сегежных данных. Это можно сделать, автоматизируя процесс создания JSON-файла каждый день из физической системы плохой нагрузки, а затем запланируя сценарий для передачи данных.

> [!NOTE]
> Максимальное число записей в JSON-файле, которые могут быть обработаны API, составляет 50 000 записей.

1. Перейдите [на этот сайт GitHub,](https://github.com/microsoft/m365-hrconnector-sample-scripts/blob/master/upload_termination_records.ps1) чтобы получить доступ к примеру сценария.

2. Нажмите **кнопку "Необработанные",** чтобы отобразить сценарий в текстовом представлении

3. Скопируйте все строки примера сценария и сохраните их в текстовый файл.

4. При необходимости измените пример сценария для организации.

5. Сохраните текстовый файл в Windows PowerShell с помощью суффикса имени файла PS1; например, PhysicalBadging.ps1.

6. Откройте командную подсказку на локальном компьютере и перейдите в каталог, в котором сохранен сценарий.

7. Запустите следующую команду, чтобы перенажать физические данные в файле JSON в Microsoft Cloud; Например:

   ```powershell
   .\PhysicalBadging.ps1 -tenantId "<Tenant Id>" -appId "<Azure AD App Id>" -appSecret "<Azure AD App Secret>" -jobId "Job Id" -jsonFilePath "<records file path>"
   ```

   В следующей таблице описываются параметры, которые необходимо использовать с этим сценарием, и их необходимые значения. Сведения, полученные на предыдущих шагах, используются в значениях этих параметров.

   | Параметр | Описание |
   |:-------------|:--------------|
   |tenantId | Это ИД вашей организации Microsoft 365, полученный на шаге 1. Вы также можете получить tenantId для своей организации в blade **Overview** в Центре администрирования Azure AD. Это используется для идентификации организации. |
   |appId | Это ИД приложения Azure AD, созданного в Azure AD на шаге 1. Это используется Azure AD для проверки подлинности при попытке сценария получить доступ к вашей организации Microsoft 365.                    |
   |appSecret | Это секрет приложения Azure AD для приложения, созданного в Azure AD на шаге 1. Это также используется для проверки подлинности.                                                        |
   |jobId | Это ид задания для физического соединители, созданного на шаге 3. Он используется для связывания физических данных о ненадежных данных, отаваемых в Microsoft Cloud, с физическим соединитетелем.              |
   |JsonFilePath | Это путь к файлу на локальном компьютере (который используется для запуска сценария) для JSON-файла, созданного на шаге 2. Этот файл должен следовать примеру схемы, описанной в шаге 3.|
   |||

   Вот пример синтаксиса для скрипта физического соединители с плохой нагрузкой с использованием фактических значений для каждого параметра:

   ```powershell
   .\PhysicalBadging.ps1 -tenantId d5723623-11cf-4e2e-b5a5-01d1506273g9 -appId 29ee526e-f9a7-4e98-a682-67f41bfd643e -appSecret MNubVGbcQDkGCnn -jobId b8be4a7d-e338-43eb-a69e-c513cd458eba -csvFilePath 'C:\Users\contosoadmin\Desktop\Data\physical_badging_data.json'
   ```

   Если отправка будет успешной, сценарий отобразит сообщение **об успешной отправке.**

   Если у вас несколько JSON-файлов, необходимо запустить сценарий для каждого файла.

> [!NOTE]
> Вы также можете перенажать физические данные о плохом результате в конечную точку API с помощью других методов, кроме запуска предыдущего сценария. Например, вот пример использования Postman для передачи данных в конечную точку API.

## <a name="step-5-monitor-the-physical-badging-connector"></a>Шаг 5. Отслеживание физического соединитела плохой нагрузки

После создания физического соединитела плохой нагрузки и передачи данных о ненадежных данных вы можете просмотреть его и отправить состояние в Центре соответствия требованиям Microsoft 365. Если сценарий должен запускаться регулярно, можно также просмотреть текущее состояние после последнего запуска сценария.

1. Go to [https://compliance.microsoft.com](https://compliance.microsoft.com/) and click **Data connectors** in the left nav.

2. Перейдите **на вкладку** "Соединители", а затем выберите физический некорничный соединиталь, чтобы отобразить вылетную страницу. На этой странице содержатся свойства и сведения о соединители.

   ![Страница "Состояние" для физического соединитела плохой связи](..\media\PhysicalBadgingStatusFlyout.png)

3. В **окне**"Последний импорт" щелкните **ссылку** на журнал загрузки, чтобы открыть (или сохранить) журнал состояния соединители. Этот журнал содержит сведения о каждом запуске сценария и отправке данных из CSV-файла в облако Майкрософт.

   ![Файл журнала физических ненадежных соединителя отображает строки номеров из JSON-файла, которые были загружены](..\media\PhysicalBadgingConnectorLogFile.png)

   Поле **RecordsSaved** указывает количество строк в загруженном CSV-файле. Например, если CSV-файл содержит четыре строки, то значение полей **RecordsSaved** — 4, если сценарий успешно загрузил все строки в CSV-файле.

Если вы еще не запускали сценарий на шаге 4, ссылка для скачивания скрипта отображается в области **"Последний импорт".** Вы можете скачать сценарий, а затем выполнить действия, которые необходимо выполнить на шаге 4, чтобы запустить его.

## <a name="optional-step-6-schedule-the-script-to-run-automatically"></a>(Необязательно) Шаг 6. Запланировать автоматический запуск сценария

Чтобы убедиться, что последние физические данные о плохом качестве доступны для таких средств, как решение для управления рисками внутри организации, рекомендуется запланировать автоматический запуск сценария, например один раз в день. Кроме того, для этого необходимо обновить физические данные о плохом качестве в JSON-файл по аналогичному (если не тому же) расписанию, чтобы в нем содержались последние сведения о сотрудниках, уехавших из организации. Цель заключается в отправке самых актуальных физических данных о ненадежных данных, чтобы физический соединителичные соединители могли сделать их доступными для решения по управлению рисками внутри организации.

Вы можете использовать приложение планировщика задач в Windows, чтобы автоматически запускать сценарий каждый день.

1. На локальном компьютере  нажмите кнопку "Начните" в Windows и введите **планировать задачи.**

2. Щелкните **приложение планировщика** задач, чтобы открыть его.

3. В разделе **"Действия"** щелкните **"Создать задачу".**

4. На **вкладке "Общие"** введите описательное имя запланированной задачи; например, **сценарий физического соединитела плохой нагрузки.** Вы также можете добавить необязательное описание.

5. В **параметрах безопасности** сделайте следующее:

   1. Определите, следует ли запускать сценарий только при входе на компьютер или при входе в систему.

   2. Убедитесь, что **для запуска с самыми** высокими привилегиями выбран этот контрольный ящик.

6. Выберите **вкладку "Триггеры",** нажмите **кнопку "Новый"** и сделайте следующее:

   1. В **области "Параметры"** выберите параметр **"Ежедневно",** а затем выберите дату и время для первого запуска сценария. Сценарий будет ежедневно работать в одно и то же время.

   2. В **области "Дополнительные параметры"** убедитесь, что выбран этот параметр. 

   3. Нажмите кнопку **ОК**.

7. Выберите **вкладку "Действия",** нажмите **кнопку "Новый"** и сделайте следующее:

   ![Параметры действий для создания новой запланированной задачи для сценария физического соединитела плохой нагрузки](..\media\SchedulePhysicalBadgingScript1.png)

   1. **Убедитесь,** что в списке действий **выбран** запуск программы.

   2. В **окне "Программа/сценарий"** нажмите кнопку "Обзор", перейдите в следующее расположение и выберите его, чтобы путь отображался в поле: C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe. 

   3. В поле **"Добавить аргументы" (необязательно)** в поле "Добавить аргументы" в поле "Шаг 4" в поле "Добавить аргументы" в paste the same script command that you ran in Step 4. Например, .\PhysicalBadging.ps1-tenantId "d5723623-11cf-4e2e-b5a5-01d1506273g9" -appId "c12823b7-b55a-4989-faba-02de41bb97c3" -appSecret "MNubVGbcQDkGCnn" -jobId "e081f4f4-3831-48d6-7bb3-fcfab1581458" -jsonFilePath "C:\Users\contosoadmin\Desktop\Data\physical_badging_data.csv"

   4. В поле **"Начните (необязательно)** вложите расположение папки сценария, который вы запустили на шаге 4. Например, C:\Users\contosoadmin\Desktop\Scripts.

   5. Нажмите **кнопку** "ОК", чтобы сохранить параметры для нового действия.

8. В **окне "Создание задачи"** нажмите **кнопку "ОК",** чтобы сохранить запланированную задачу. Вам может быть предложено ввести учетные данные учетной записи пользователя.

   Новая задача отображается в библиотеке планировщика задач.

   ![Новая задача отображается в библиотеке планировщика задач](..\media\SchedulePhysicalBadgingScript2.png)

Отображается время последнего запуска сценария и его запланированного запуска. Можно дважды щелкнуть задачу, чтобы изменить ее.

Вы также можете проверить, когда сценарий в последний раз запустился на странице вылета соответствующего физического соединитела плохой связи в Центре соответствия требованиям.
