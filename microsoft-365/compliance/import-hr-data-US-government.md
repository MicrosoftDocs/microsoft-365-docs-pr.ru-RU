---
title: Настройка соединителя для импорта данных отдела кадров в облако США
f1.keywords:
- NOCSH
ms.author: markjjo
author: markjjo
manager: laurawi
ms.date: ''
audience: Admin
ms.topic: how-to
ms.service: O365-seccomp
localization_priority: Normal
search.appverid:
- MET150
ms.collection: M365-security-compliance
ROBOTS: NOINDEX, NOFOLLOW
description: Администраторы в облаке США могут настроить соединитель данных для импорта данных о сотрудниках из системы отдела кадров (HR) своей организации в Microsoft 365. Это позволяет использовать данные о ПЕРСОНАЛе в политиках по управлению рисками для оценки активности для определенных пользователей, которые могут представлять внутреннюю угрозу организации.
ms.openlocfilehash: 28f4c77ec626e2035451ec6e7c9562c5bf20f101
ms.sourcegitcommit: 3c39866865c8c61bce2169818d8551da65033cfe
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/30/2020
ms.locfileid: "48816844"
---
# <a name="set-up-a-connector-to-import-hr-data-in-us-government"></a>Настройка соединителя для импорта данных о ПЕРСОНАЛе в правительство США

Вы можете настроить соединитель данных в центре соответствия требованиям Microsoft 365 для импорта данных отдела кадров в организацию государственных учреждений США. Данные, связанные с персоналом, включают дату, когда сотрудник отправил ресигнатион и дату последнего дня сотрудника. Эти данные о ПЕРСОНАЛе можно использовать в решениях Microsoft Information Protection, таких как [решение по управлению рисками для оценки](insider-risk-management.md)безопасности, чтобы обеспечить защиту Организации от вредоносных действий или кражи данных внутри Организации. Настройка разъема HR состоит из создания приложения в Azure Active Directory, используемого для проверки подлинности по соединителю, создания CSV-файлов, содержащих данные о ПЕРСОНАЛе, создания соединителя данных в центре соответствия требованиям, а затем запуска сценария (по расписанию), который применяет данные HR в CSV-файле к Microsoft Cloud. Затем этот соединитель используется средством "Управление рисками" для получения доступа к данным о HR, которые были импортированы в организацию Microsoft 365 для государственных учреждений США.

## <a name="before-you-begin"></a>Прежде чем начать

- Ваша организация должна предоставить согласие, чтобы разрешить службе импорта Office 365 доступ к данным в Организации. Чтобы согласиться с этим запросом, перейдите на [эту страницу](https://login.microsoftonline.com/common/oauth2/authorize?client_id=570d0bec-d001-4c4e-985e-3ab17fdc3073&response_type=code&redirect_uri=https://portal.azure.com/&nonce=1234&prompt=admin_consent), войдите с помощью учетных данных глобального администратора Microsoft 365 и примите запрос. Необходимо выполнить это действие, прежде чем вы сможете успешно создать соединитель кадров в действии 3.

- Пользователю, создающему соединитель HR в действии 3, должна быть назначена роль импорта почтовых ящиков в Exchange Online. По умолчанию эта роль не назначена ни одной группе ролей в Exchange Online. Вы можете добавить роль экспорта для импорта почтовых ящиков в группу ролей Управление организацией в Exchange Online. Вы также можете создать новую группу ролей, назначить роль импорта почтовых ящиков, а затем добавить соответствующих пользователей в качестве участников. Для получения дополнительных сведений обратитесь к разделу [Создание](https://docs.microsoft.com/Exchange/permissions-exo/role-groups#create-role-groups) групп ролей или [изменение групп ролей](https://docs.microsoft.com/Exchange/permissions-exo/role-groups#modify-role-groups) статьи "Управление группами ролей в Exchange Online".

- Вам потребуется определить способ извлечения и экспорта данных из системы отдела кадров Организации (регулярно) и добавить его в CSV-файл, описанный в шаге 2. Скрипт, который вы запускаете на шаге 4, будет отправлять данные HR в CSV-файле в Microsoft Cloud.

- Пример скрипта, выполняемого в шаге 4, будет отправлять данные HR в облако Майкрософт, чтобы их можно было использовать в других средствах Майкрософт, таких как решение для управления рисками для оценки. Этот пример скрипта не поддерживается ни в одной из стандартных программ или услуг поддержки Майкрософт. Пример сценария предоставляется без каких-либо гарантий. Кроме того, корпорация Майкрософт отказывается от всех подразумеваемых гарантий, включая, но не ограничиваясь указанным, все подразумеваемые гарантии пригодности для продажи или определенной цели. Весь риск, возникающий из примера использования или производительности примера сценария и документации, остается без вас. Корпорация Майкрософт, ее штатные авторы и другие лица, принимающие участие в создании, подготовке и выпуске сценариев, ни при каких обстоятельствах не несут ответственность за какой-либо ущерб (в том числе, ущерб, вызванный потерей доходов предприятия, остановкой его работы, потерей бизнес-данных и другими материальными потерями), вызванный использованием или неспособностью использовать примеры сценариев и документацию, даже если корпорации Майкрософт известно о возможности нанесения такого ущерба.

## <a name="step-1-create-an-app-in-azure-active-directory"></a>Шаг 1: создание приложения в Azure Active Directory

Первым шагом является создание и регистрация нового приложения в Azure Active Directory (Azure AD). Приложение будет соответствовать соединителю HR, созданному на шаге 3. Создание этого приложения позволит Azure AD выполнить проверку подлинности для соединителя HR, когда он работает, и пытается получить доступ к Организации. Это приложение также будет использоваться для проверки подлинности скрипта, выполняемого на шаге 4, для отправки данных отдела кадров в Microsoft Cloud. Во время создания приложения Azure AD обязательно сохраните следующие сведения. Эти значения будут использоваться на последующих этапах.

- Идентификатор приложения Azure AD (также называемый *идентификатором приложения* или *идентификатором клиента* )

- Секрет приложения Azure AD (также называемый *секретом клиента* )

- Идентификатор клиента (также называемый *идентификатором каталога* )

Пошаговые инструкции по созданию приложения в Azure AD приведены в статье [Регистрация приложения с помощью платформы удостоверений Майкрософт](https://docs.microsoft.com/azure/active-directory/develop/quickstart-register-app).

## <a name="step-2-prepare-a-csv-file-with-your-hr-data"></a>Шаг 2: Подготовка CSV-файла к данным отдела кадров

Следующий шаг — создание CSV-файла, который содержит сведения о сотрудниках, которые оставили вашу организацию. Как описано в разделе до начала работы, необходимо определить, как создать этот CSV-файл из системы отдела кадров Организации. В следующем примере показан завершенный CSV-файл (открытый в панели заметок), содержащий три обязательных параметра (столбцов). Редактирование CSV-файла значительно упрощается в Microsoft Excel.

```text
EmailAddress,TerminationDate,LastWorkingDate
sarad@contoso.com,2019-04-23T15:18:02.4675041+05:30,2019-04-29T15:18:02.4675041+05:30
pilarp@contoso.com,2019-04-24T09:15:49Z,2019-04-29T15:18:02.7117540
```

В первой строке (строке заголовков) CSV-файла перечислены необходимые имена столбцов. Имя, используемое в каждом заголовке столбца, имеет свой характер (то, что в предыдущем примере является предложением). Тем не менее имена столбцов, которые вы используете в CSV-файле, *необходимо* указать при создании соединителя HR в шаге 3. Не включайте пробелы в имена столбцов.

В следующей таблице приведено описание каждого столбца в CSV-файле:

| Столбец | Описание |
|:-----|:-----|
| **EmailAddress** <br/> |Указывает адрес электронной почты завершенного сотрудника.|
| **терминатиондате** <br/> |Указывает дату официального прекращения приема сотрудника в Организации. Например, это может быть Дата, когда сотрудник выдает уведомление о выходе из вашей организации. Эта дата может отличаться от даты последнего дня работы человека. Используйте следующий формат даты: `yyyy-mm-ddThh:mm:ss.nnnnnn+|-hh:mm` , представляющий собой [Формат даты и времени ISO 8601](https://www.iso.org/iso-8601-date-and-time-format.html).|
|**ластворкингдате**|Указывает последний день работы для завершенного сотрудника. Используйте следующий формат даты: `yyyy-mm-ddThh:mm:ss.nnnnnn+|-hh:mm` , представляющий собой [Формат даты и времени ISO 8601](https://www.iso.org/iso-8601-date-and-time-format.html).|
|||

После создания CSV-файла с требуемыми данными HR сохраните его в той же системе, что и скрипт, выполняемый на шаге 4. Обязательно Реализуйте стратегию обновления, чтобы CSV-файл всегда содержал самую актуальную информацию. Это гарантирует, что все данные о завершении работы со сценарием передаются в облако Майкрософт.

## <a name="step-3-create-the-hr-connector"></a>Шаг 3: Создание соединителя кадров

Следующий шаг — создание соединителя кадров в центре соответствия требованиям Microsoft 365. После выполнения сценария, созданного на шаге 4, созданный соединитель кадров будет отправит данные отдела кадров из CSV-файла в организацию Microsoft 365. На этом этапе обязательно скопируйте идентификатор задания, созданный при создании соединителя. При запуске скрипта вы будете использовать идентификатор задания.

1. [https://compliance.microsoft.com](https://compliance.microsoft.com)В левой панели навигации выберите элемент **соединители данных и нажмите кнопку соединители данных** .

2. На странице " **соединители данных** " в разделе **HR** нажмите кнопку **Просмотр** .

3. На странице **HR** нажмите кнопку **Добавить соединитель** .

4. На странице **учетные данные проверки подлинности** выполните следующие действия, а затем нажмите кнопку **Далее** .

   1. Введите или вставьте идентификатор приложения Azure AD для приложения Azure, созданного на шаге 1.

   1. Введите имя для соединителя кадров.

5. На странице **Сопоставление файлов** введите имена трех заголовков столбцов (также называемых *параметрами* ) из CSV-файла, созданного в шаге 2 в соответствующих полях. В именах не учитывается регистр. Как описывалось ранее, имена, введенные в этих полях, должны быть совпадают с именами параметров в CSV-файле. Например, на следующем снимке экрана показаны имена параметров из примера в примере CSV-файла, показанного в шаге 2.

   ![Имена заголовков столбцов совпадают с теми, которые находятся в CSV-файле](../media/HRConnectorWizard3.png)

6. На странице " **Проверка** " Проверьте параметры и нажмите кнопку **Готово** , чтобы создать соединитель.

   Отображается страница состояния, которая подтверждает, что соединитель был создан. Эта страница содержит две важные вещи, которые необходимо выполнить, чтобы выполнить пример сценария для отправки данных отдела кадров.

   ![Страница проверки с ИДЕНТИФИКАТОРом задания и ссылкой на GitHub для примера сценария](../media/HRConnector_Confirmation.png)

   1. **Идентификатор задания.** Этот код задания потребуется для запуска скрипта на следующем шаге. Вы можете скопировать его с этой страницы или из всплывающей страницы соединителя.
   
   1. **Ссылка на пример скрипта.** Щелкните ссылку **здесь** , чтобы перейти на сайт GitHub для доступа к образцу скрипта (ссылка открывает новое окно). Оставьте это окно открытым, чтобы можно было скопировать скрипт на шаге 4. Кроме того, вы можете закладка или скопировать URL-адрес, чтобы вы могли снова получить к нему доступ на шаге 4. Эта ссылка также доступна на всплывающей странице соединителя.

7. Нажмите кнопку **Готово** .

   Новый соединитель отображается в списке на вкладке **соединители** . 

8. Щелкните соединитель кадров, который вы только что создали для отображения всплывающей страницы, содержащей свойства и другие сведения о соединителе.

   ![Всплывающая страница для нового соединителя кадров](../media/HRConnectorWizard7.png)

   Если вы еще не сделали это, вы можете скопировать значения **идентификатора приложения Azure** и **идентификатора задания соединителя** . Они понадобятся вам для запуска скрипта на следующем шаге. Вы также можете скачать скрипт со всплывающей страницы (или скачать его, используя ссылку на следующем шаге).

   Вы также можете нажать кнопку **изменить** , чтобы изменить идентификатор приложения Azure или имена заголовков столбцов, определенных на странице **сопоставления файлов** .

## <a name="step-4-run-the-sample-script-to-upload-your-hr-data"></a>Шаг 4: выполнение примера сценария для отправки данных отдела кадров

Последний шаг при настройке соединителя кадров — выполнение примера сценария, который отправляет данные HR в CSV-файл (созданный на шаге 2) в Microsoft Cloud. В частности, сценарий передает данные в соединитель HR. После выполнения скрипта соединитель кадров, созданный на шаге 3, импортирует данные отдела кадров в организацию Microsoft 365, к которой он может получить доступ с помощью других средств обеспечения соответствия, таких как решение по управлению рисками для оценки. После выполнения сценария рассмотрите возможность планирования задачи для ежедневного запуска, чтобы последние данные о прекращении работы сотрудников передавались в облако Майкрософт. Просмотрите [расписание автоматического запуска скрипта](#optional-step-6-schedule-the-script-to-run-automatically).

1. Откройте окно, слева от предыдущего шага, чтобы получить доступ к сайту GitHub с помощью примера скрипта. В качестве альтернативного варианта откройте сайт с закладками или воспользуйтесь скопированным URL-адресом.

2. Нажмите кнопку **RAW** , чтобы отобразить скрипт в текстовом представлении.

3. Скопируйте все строки в примере сценария и сохраните их в текстовом файле.

4. При необходимости измените пример сценария для Организации.

5. Сохраните текстовый файл в виде файла сценария Windows PowerShell, используя суффикс имени файла `.ps1` , например `HRConnector.ps1` .

6. Откройте командную строку на локальном компьютере и перейдите к каталогу, в котором был сохранен сценарий.

7. Выполните следующую команду, чтобы отправить данные отдела кадров в CSV-файл в Microsoft Cloud; Например:

    ```powershell
    .\HRConnector.ps1 -tenantId <tenantId> -appId <appId>  -appSecret <appSecret>  -jobId <jobId>  -csvFilePath '<csvFilePath>'
    ```

   В следующей таблице описаны параметры, которые необходимо использовать с этим сценарием и их обязательные значения. Сведения, полученные на предыдущих этапах, используются в значениях этих параметров.

   | Параметр | Описание |
   |:-----|:-----|:-----|
   |`tenantId`|Идентификатор вашей организации Microsoft 365, полученной на шаге 1. Вы также можете получить идентификатор клиента для своей организации в колонке **Обзор** в центре администрирования Azure AD. Используется для идентификации Организации.|
   |`appId` |Идентификатор приложения Azure AD для приложения, созданного в Azure AD в действии 1. Это используется Azure AD для проверки подлинности при попытке сценария получить доступ к организации Microsoft 365. |
   |`appSecret`|Секрет приложения Azure AD для приложения, созданного в Azure AD в действии 1. Он также используется для проверки подлинности.|
   |`jobId`|Идентификатор задания для соединителя HR, созданного на шаге 3. Используется для связывания данных отдела кадров, которые передаются в облако Майкрософт с помощью соединителя HR.|
   |`csvFilePath`|Путь к файлу для CSV-файла (хранящегося в той же системе, что и скрипт), созданном в шаге 2. Старайтесь не использовать пробелы в пути к файлу; в противном случае используйте одинарные кавычки.|
   |||
   
   Ниже приведен пример синтаксиса сценария HR Connector с использованием фактических значений для каждого параметра:

   ```powershell
    .\HRConnector.ps1 -tenantId d5723623-11cf-4e2e-b5a5-01d1506273g9 -appId 29ee526e-f9a7-4e98-a682-67f41bfd643e -appSecret MNubVGbcQDkGCnn -jobId b8be4a7d-e338-43eb-a69e-c513cd458eba -csvFilePath 'C:\Users\contosoadmin\Desktop\Data\employee_termination_data.csv'
    ```

   Если отправка выполнена успешно, сценарий отображает сообщение об **успешном выполнении отправки** .

   > [!NOTE]
   > Если у вас возникли проблемы с выполнением предыдущей команды из-за политик выполнения, ознакомьтесь со статьями [о политиках выполнения](https://docs.microsoft.com/powershell/module/microsoft.powershell.core/about/about_execution_policies) и [Set-ExecutionPolicy](https://docs.microsoft.com/powershell/module/microsoft.powershell.security/set-executionpolicy) для получения инструкций по настройке политик выполнения.

## <a name="step-5-monitor-the-hr-connector"></a>Шаг 5: мониторинг соединителя кадров

После создания соединителя HR и запуска сценария для отправки данных HR можно просмотреть соединитель и состояние отправки в центре соответствия требованиям Microsoft 365. Если вы планируете регулярное выполнение скрипта, вы также можете просмотреть текущее состояние после последнего запуска сценария.

1. Перейдите к разделу [https://compliance.microsoft.com](https://compliance.microsoft.com) **соединители данных** в левой панели навигации и нажмите кнопку соединители данных.

2. Перейдите на вкладку **соединители** и выберите соединитель кадров, чтобы отобразить всплывающую страницу. На этой странице представлены свойства и сведения о соединителе.

   ![Всплывающая страница соединителя HR со свойствами и состоянием](../media/HRConnectorFlyout1.png)

3. В разделе **ход выполнения** щелкните ссылку **Журнал скачивания** , чтобы открыть (или сохранить) журнал состояний для соединителя. Этот журнал содержит сведения о каждом запуске скрипта и передает данные из CSV-файла в Microsoft Cloud. 

   ![Файл журнала соединителей HR отображает числовые строки из CSV-файла, которые были отправлены](../media/HRConnectorLogFile.png)

   В этом `RecordsSaved` поле указывается число строк в CSV-файле, который был отправлен. Например, если CSV-файл содержит четыре строки, то значение этих `RecordsSaved` полей равно 4, если сценарий успешно отправил все строки в CSV-файле.

Если вы еще не запустили сценарий на шаге 4, в разделе **Последний импорт** отображается ссылка для скачивания сценария. Вы можете скачать сценарий, а затем выполнить действия, описанные в шаге 4, чтобы запустить его.

## <a name="optional-step-6-schedule-the-script-to-run-automatically"></a>Необязательно Шаг 6: Планирование автоматического запуска скрипта

Чтобы гарантировать, что последние данные о HR из вашей организации доступны для таких средств, как решение для управления рисками, рекомендуется автоматически запускать сценарий регулярно, например, раз в день. При этом также необходимо обновить данные отдела кадров в CSV-файле в соответствии с расписанием (если это не то же), чтобы оно содержало последние сведения о сотрудниках, которые покинут вашу организацию. Задача заключается в том, чтобы отправить наиболее актуальные данные о HR, чтобы соединитель кадров мог сделать его доступным для решения по управлению рисками для оценки.

Вы можете использовать приложение планировщика заданий в Windows для автоматического запуска скрипта каждый день.

1. На локальном компьютере нажмите кнопку " **Пуск** " Windows и введите **планировщик задач** .

2. Щелкните приложение **планировщика заданий** , чтобы открыть его.

3. В разделе **действия** выберите команду **создать задачу** .

4. На вкладке **Общие** введите описательное имя запланированной задачи. Например, **сценарий HR Connector** . Кроме того, можно добавить необязательное описание.

5. В разделе **Параметры безопасности** выполните следующие действия:

   1. Определите, следует ли запускать сценарий только при входе в систему или при выполнении входа в систему.
   
   1. Убедитесь, что установлен флажок **запускать с максимальными привилегиями** .

6. Перейдите на вкладку **триггеры** , нажмите кнопку **создать** , а затем выполните следующие действия:

   1. В разделе **Параметры** выберите параметр **ежедневно** , а затем выберите дату и время для первого запуска скрипта. Скрипт будет ежедневно в одно и то же время.
   
   1. В разделе **Дополнительные параметры** убедитесь, что установлен флажок **включен** .
   
   1. Нажмите кнопку **ОК** .

7. Перейдите на вкладку **действия** , нажмите кнопку **создать** , а затем выполните следующие действия:

   ![Параметры действий для создания новой запланированной задачи для сценария с соединителем для отдела кадров](../media/HRConnectorScheduleTask1.png)

   1. В раскрывающемся списке **действий** убедитесь, что выбран пункт **запустить программу** .

   1. В поле **Программа/сценарий** нажмите кнопку **Обзор** и перейдите к следующему расположению и выберите его, чтобы отобразить путь в поле: `C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe` .

   1. В поле **Добавить аргументы (необязательно)** вставьте ту же команду сценария, что была выполнена в шаге 4. Пример: `.\HRConnector.ps1 -tenantId "d5723623-11cf-4e2e-b5a5-01d1506273g9" -appId "c12823b7-b55a-4989-faba-02de41bb97c3" -appSecret "MNubVGbcQDkGCnn"  -jobId "e081f4f4-3831-48d6-7bb3-fcfab1581458" -csvFilePath "C:\Users\contosoadmin\Desktop\Data\employee_termination_data.csv"`

   1. В поле **Запуск в (необязательно)** вставьте путь к папке сценария, который был выполнен на шаге 4. Например, `C:\Users\contosoadmin\Desktop\Scripts`.

   1. Нажмите кнопку **ОК** , чтобы сохранить параметры для нового действия.

8. В окне **Создание задачи** нажмите кнопку **ОК** , чтобы сохранить запланированную задачу. Возможно, вам будет предложено ввести учетные данные учетной записи пользователя.

   Новая задача отображается в библиотеке планировщика задач.

   ![Новая задача отображается в библиотеке планировщика задач](../media/HRConnectorTaskSchedulerLibrary.png)

   Время последнего запуска сценария и его последующего запланированного запуска. Можно дважды щелкнуть задачу, чтобы изменить ее.

   Кроме того, вы можете проверить время последнего запуска сценария на всплывающей странице соответствующего соединителя кадров в центре соответствия требованиям.
