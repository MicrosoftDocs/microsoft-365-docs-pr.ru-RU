---
title: Настройка соединитетеля для импорта кадровой информации в облако правительства США
f1.keywords:
- NOCSH
ms.author: markjjo
author: markjjo
manager: laurawi
ms.date: ''
audience: Admin
ms.topic: how-to
ms.service: O365-seccomp
localization_priority: Normal
search.appverid:
- MET150
ms.collection: M365-security-compliance
ROBOTS: NOINDEX, NOFOLLOW
description: Администраторы в облаке правительства США могут настроить соединители данных для импорта данных сотрудников из системы кадровых ресурсов (HR) организации для Microsoft 365. Это позволяет использовать hr-данные в политиках управления рисками, чтобы помочь вам обнаруживать действия определенных пользователей, которые могут представлять внутреннюю угрозу для вашей организации.
ms.openlocfilehash: 16d6d72d557744e30d41795d5f8c8a17db81c6a3
ms.sourcegitcommit: 27b2b2e5c41934b918cac2c171556c45e36661bf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "50905931"
---
# <a name="set-up-a-connector-to-import-hr-data-in-us-government"></a>Настройка соединитетеля для импорта кадровой информации в правительстве США

Вы можете настроить соединители данных в центре Microsoft 365 для импорта данных кадровых ресурсов (HR) в вашу организацию правительства США. Данные, связанные с персоналом, включают дату отставку сотрудника и дату последнего дня сотрудника. Эти данные hr могут использоваться решениями майкрософт по [](insider-risk-management.md)защите информации, такими как решение по управлению рисками, чтобы защитить организацию от вредоносных действий или кражи данных внутри организации. Настройка соединителя кадров состоит из создания приложения в Azure Active Directory, которое используется для проверки подлинности соединителя, создания файлов сопоставления CSV, которые содержат ваши hr-данные, создания соединителя данных в центре соответствия требованиям, а затем запуска скрипта (на запланированной основе), которое гнает данные HR в CSV-файле в облако Microsoft. Затем соединитатель данных используется средством управления рисками для доступа к данным hr, импортируемым в Microsoft 365 организации правительства США.

## <a name="before-you-begin"></a>Прежде чем начать

- Пользователю, создаваму соединителу управления персоналом в шаге 3, должна быть назначена роль экспорта импорта почтовых ящиков в Exchange Online. По умолчанию эта роль не назначена ни одной группе ролей в Exchange Online. Вы можете добавить роль экспорта импорта почтовых ящиков в группу ролей управления организацией в Exchange Online. Или можно создать новую группу ролей, назначить роль экспортировать импорт почтовых ящиков, а затем добавить соответствующих пользователей в качестве участников. Дополнительные сведения см. в разделах [Создание](/Exchange/permissions-exo/role-groups#create-role-groups) групп ролей или [изменение](/Exchange/permissions-exo/role-groups#modify-role-groups) групп ролей в статье "Управление группами ролей в Exchange Online".

- Необходимо определить, как извлекать или экспортировать данные из hr-системы организации (на регулярной основе) и добавлять их в CSV-файл, описанный в шаге 2. Сценарий, который вы запустите в шаге 4, будет загружать данные hr в CSV-файле в облако Майкрософт.

- Пример сценария, который вы запустите в шаге 4, будет загружать hr-данные в облако Майкрософт, чтобы они могли использоваться другими средствами Майкрософт, такими как решение по управлению рисками. Этот пример сценария не поддерживается ни в одной стандартной программе поддержки Майкрософт или службе. Пример сценария приводится в виде "как есть", без каких-либо гарантий. Кроме того, корпорация Microsoft отказывается от всех подразумеваемых гарантий, включая в том числе все подразумеваемые гарантии пригодности для продажи или определенной цели. Все риски, возникающие в результате использования примера сценария и документации, берет на себя пользователь. Корпорация Майкрософт, ее штатные авторы и другие лица, принимающие участие в создании, подготовке и выпуске сценариев, ни при каких обстоятельствах не несут ответственность за какой-либо ущерб (в том числе, ущерб, вызванный потерей доходов предприятия, остановкой его работы, потерей бизнес-данных и другими материальными потерями), вызванный использованием или неспособностью использовать примеры сценариев и документацию, даже если корпорации Майкрософт известно о возможности нанесения такого ущерба.

## <a name="step-1-create-an-app-in-azure-active-directory"></a>Шаг 1. Создание приложения в Azure Active Directory

Первым шагом является создание и регистрация нового приложения в Azure Active Directory Azure AD. Приложение будет соответствовать разъему HR, который вы создаете в шаге 3. Создание этого приложения позволит Azure AD проверить подлинность hr-соединиттеля при запуске и попытках получить доступ к организации. Это приложение также будет использоваться для проверки подлинности скрипта, который вы запустите в шаге 4, чтобы загрузить свои hr-данные в облако Майкрософт. При создании этого приложения Azure AD обязательно сохраните следующую информацию. Эти значения будут использоваться в последующих действиях.

- ID приложения Azure AD (также называемый *ИД приложения* или *клиентский id)*

- Секрет приложения Azure AD (также называемый секрет *клиента)*

- Tenant Id (также называемый *ИД каталога)*

Пошаговая инструкция по созданию приложения в Azure AD см. в примере Регистрация приложения с помощью [платформа удостоверений Майкрософт.](/azure/active-directory/develop/quickstart-register-app)

## <a name="step-2-prepare-a-csv-file-with-your-hr-data"></a>Шаг 2. Подготовка CSV-файла с данными отдела кадров

Следующий шаг — создание CSV-файла, содержавшего сведения о сотрудниках, которые покинули организацию. Как поясняется в разделе Перед началом работы, необходимо определить, как создать этот CSV-файл из hr-системы организации. В следующем примере показан завершенный CSV-файл (открытый в блокноте), содержащий три необходимых параметра (столбцы). Гораздо проще изменить CSV-файл в Microsoft Excel.

```text
EmailAddress,TerminationDate,LastWorkingDate
sarad@contoso.com,2019-04-23T15:18:02.4675041+05:30,2019-04-29T15:18:02.4675041+05:30
pilarp@contoso.com,2019-04-24T09:15:49Z,2019-04-29T15:18:02.7117540
```

В первой строке или строке заглавной строки файла CSV перечислены необходимые имена столбцов. Имя, используемая в каждом загонщике столбцов, до вас (в предыдущем примере — предложения). Однако те же имена столбцов, которые  вы используете в CSV-файле, должны быть указаны при создании соединитетеля кадров в шаге 3. Не включай пробелы в имена столбцов.

В следующей таблице описывается каждый столбец в CSV-файле:

| Столбец | Описание |
|:-----|:-----|
| **EmailAddress** <br/> |Указывает адрес электронной почты уволенного сотрудника.|
| **TerminationDate** <br/> |Указывает дату официального прекращения работы этого лица в организации. Например, это может быть дата, когда сотрудник дал уведомление о выходе из организации. Эта дата может быть иной, чем дата последнего дня работы. Используйте следующий формат даты: , который `yyyy-mm-ddThh:mm:ss.nnnnnn+|-hh:mm` [является форматом даты и времени ISO 8601.](https://www.iso.org/iso-8601-date-and-time-format.html)|
|**LastWorkingDate**|Указывает последний день работы для уволенного сотрудника. Используйте следующий формат даты: , который `yyyy-mm-ddThh:mm:ss.nnnnnn+|-hh:mm` [является форматом даты и времени ISO 8601.](https://www.iso.org/iso-8601-date-and-time-format.html)|
|||

После создания CSV-файла с требуемой hr-данными храните его в той же системе, что и сценарий, который вы запустите в шаге 4. Не забудьте реализовать стратегию обновления, чтобы в CSV-файле всегда содержались самые актуальные сведения. Это гарантирует, что независимо от запуска скрипта наиболее актуальные данные о прекращении работы сотрудников будут загружены в облако Майкрософт.

## <a name="step-3-create-the-hr-connector"></a>Шаг 3. Создание соединитетеля кадров

Следующий шаг — создание соединитетеля кадров в центре Microsoft 365 соответствия требованиям. После запуска скрипта в шаге 4 создавающийся соединитетор кадров будет гнать данные hr из CSV-файла в Microsoft 365 организации. На этом этапе обязательно скопируйте ID задания, созданный при создании соединитетеля. При запуске скрипта используется ИД задания.

1. Перейдите [https://compliance.microsoft.com](https://compliance.microsoft.com) к и нажмите **соединители данных** в левом nav.

2. На странице **Соединители данных** в **отделе кадров** нажмите **кнопку Просмотр**.

3. На странице **HR** нажмите **кнопку Добавить соединителю**.

4. На странице **Учетные данные проверки подлинности** сделайте следующее и нажмите **кнопку Далее:**

   1. Введите или введите ID приложения Azure AD для приложения Azure, созданного в шаге 1.

   1. Введите имя для hr-соединиттеля.

5. На странице **Сопоставление** файлов введите имена трех столбцов (также называемых параметрами) из CSV-файла, созданного в шаге 2 в каждом из соответствующих полей. Имена не являются чувствительными к делу. Как уже объяснялось ранее, имена, которые вы введите в этих полях, должны соответствовать именам параметров в вашем CSV-файле. Например, на следующем скриншоте показаны имена параметров из примера CSV-файла, показанного в шаге 2.

   ![Имена заголовков столбцов совпадают с именами в CSV-файле](../media/HRConnectorWizard3.png)

6. На странице **Обзор** просмотрите параметры и нажмите **кнопку Готово** для создания соединитетеля.

   Отображается страница состояния, которая подтверждает, что соединитектор был создан. На этой странице содержатся две важные вещи, которые необходимо выполнить на следующем шаге, чтобы запустить пример сценария для отправки кадровой информации.

   ![Просмотр страницы с ИД задания и ссылкой на github для примера сценария](../media/HRConnector_Confirmation.png)

   1. **ID задания.** Для запуска сценария на следующем этапе вам потребуется этот ID задания. Вы можете скопировать его на этой странице или на странице вылетов соединители.
   
   1. **Ссылка на пример сценария.** Щелкните **здесь** ссылку, чтобы перейти на GitHub, чтобы получить доступ к примеру сценария (ссылка открывает новое окно). Держите это окно открытым, чтобы можно было скопировать сценарий в шаге 4. Кроме того, вы можете закладки назначения или скопировать URL-адрес, чтобы вы могли получить доступ к нему снова в шаге 4. Эта ссылка также доступна на странице вылетов соединители.

7. Нажмите **Готово**.

   Новый соединитатель отображается в списке на вкладке **Соединители.** 

8. Щелкните только что созданный отдел кадров, чтобы отобразить страницу вылетов, которая содержит свойства и другие сведения о соединителе.

   ![Страница flyout для нового соединитетеля кадров](../media/HRConnectorWizard7.png)

   Если вы еще этого не сделали, вы можете скопировать значения для **ID-задания Azure App и** **connector.** Они необходимы для запуска сценария на следующем шаге. Вы также можете скачать сценарий со страницы вылетов (или скачать его по ссылке на следующем шаге.)

   Вы также можете нажать **кнопку Изменить,** чтобы изменить ID приложения Azure или имена загона столбцов, определенные на странице **сопоставления файлов.**

## <a name="step-4-run-the-sample-script-to-upload-your-hr-data"></a>Шаг 4. Запустите пример сценария, чтобы загрузить данные hr

Последний шаг в настройке hr-соединиттеля — запуск примера скрипта, который будет загружать данные hr в CSV-файл (созданный в шаге 2) в облако Microsoft. В частности, скрипт загружает данные в соединителю управления персоналом. После запуска скрипта созданный в шаге 3 соединитатель кадров импортирует hr-данные в организацию Microsoft 365, к которой можно получить доступ с помощью других средств обеспечения соответствия требованиям, например решения по управлению рисками insider. После запуска сценария подумайте о планировании задачи, которая будет автоматически запускаться ежедневно, чтобы наиболее актуальные данные о прекращении работы сотрудников были загружены в облако Майкрософт. См. [расписание автоматического запуска скрипта.](#optional-step-6-schedule-the-script-to-run-automatically)

1. Перейдите к окну, которое осталось открытым на предыдущем шаге, чтобы GitHub веб-сайт с образцом сценария. Кроме того, откройте сайт с закладкой или используйте скопированные URL-адреса.

2. Нажмите **кнопку Raw,** чтобы отобразить сценарий в текстовом представлении.

3. Скопируйте все строки в примере сценария и сохраните их в текстовом файле.

4. При необходимости измените пример сценария для организации.

5. Сохраните текстовый файл в виде Windows PowerShell скрипта с помощью суффикса имен файла, например `.ps1` `HRConnector.ps1` .

6. Откройте командную подсказку на локальном компьютере и перейдите в каталог, в котором сохранен сценарий.

7. Запустите следующую команду, чтобы загрузить данные hr в CSV-файле в облако Майкрософт; Например:

    ```powershell
    .\HRConnector.ps1 -tenantId <tenantId> -appId <appId>  -appSecret <appSecret>  -jobId <jobId>  -csvFilePath '<csvFilePath>'
    ```

   В следующей таблице описываются параметры, которые необходимо использовать с помощью этого скрипта, и их необходимые значения. Сведения, полученные в предыдущих действиях, используются в значениях для этих параметров.

   | Параметр | Описание |
   |:-----|:-----|:-----|
   |`tenantId`|Id для Microsoft 365 организации, полученной в шаге 1. Вы также можете получить id клиента для организации на лезвии **Обзор** в центре администрирования Azure AD. Это используется для идентификации организации.|
   |`appId` |Id приложения Azure AD для приложения, созданного в Azure AD на шаге 1. Это используется Azure AD для проверки подлинности, когда сценарий пытается получить доступ к Microsoft 365 организации. |
   |`appSecret`|Секрет приложения Azure AD для приложения, созданного в Azure AD на шаге 1. Это также используется для проверки подлинности.|
   |`jobId`|ID задания для hr-соединиттеля, созданного в шаге 3. Это используется для связывать данные по персоналу, которые загружаются в облако Майкрософт, с соединитетелем кадров.|
   |`csvFilePath`|Путь к файлу CSV (хранится в той же системе, что и сценарий), созданный в шаге 2. Старайтесь избегать пробелов в пути файла; в противном случае используйте одиночные кавычка.|
   |||
   
   Вот пример синтаксиса для скрипта соединитель кадров с использованием фактических значений для каждого параметра:

   ```powershell
    .\HRConnector.ps1 -tenantId d5723623-11cf-4e2e-b5a5-01d1506273g9 -appId 29ee526e-f9a7-4e98-a682-67f41bfd643e -appSecret MNubVGbcQDkGCnn -jobId b8be4a7d-e338-43eb-a69e-c513cd458eba -csvFilePath 'C:\Users\contosoadmin\Desktop\Data\employee_termination_data.csv'
    ```

   Если загрузка будет успешной, скрипт отображает Upload **успешное** сообщение.

   > [!NOTE]
   > Если у вас возникли проблемы с выполнением [](/powershell/module/microsoft.powershell.core/about/about_execution_policies) предыдущей команды из-за политик выполнения, см. в инструкции по настройке политик выполнения политики выполнения и [Set-ExecutionPolicy.](/powershell/module/microsoft.powershell.security/set-executionpolicy)

## <a name="step-5-monitor-the-hr-connector"></a>Шаг 5. Мониторинг соединители кадров

После создания соединиттеля управления персоналом и запуска скрипта для отправки данных по персоналу можно просмотреть соединители и загрузить состояние в центре Microsoft 365 соответствия требованиям. Если вы запланировать автоматический запуск скрипта на регулярной основе, вы также можете просмотреть текущее состояние после последнего запуска сценария.

1. Перейдите [https://compliance.microsoft.com](https://compliance.microsoft.com) и щелкните **соединители данных** в левом nav.

2. Щелкните **вкладку Соединители,** а затем выберите соединителет, чтобы отобразить страницу вылетов. На этой странице содержатся свойства и сведения о соединители.

   ![Страница для вылета соединитетеля кадров со свойствами и состоянием](../media/HRConnectorFlyout1.png)

3. В **статье Progress** щелкните ссылку **Журнал** загрузки, чтобы открыть (или сохранить) журнал состояния соединиттеля. В этом журнале содержатся сведения о каждом запуске сценария и отправке данных из CSV-файла в облако Майкрософт. 

   ![Файл журнала соединителя кадров отображает строки номеров из загруженного CSV-файла](../media/HRConnectorLogFile.png)

   Поле указывает количество строк в загруженном `RecordsSaved` CSV-файле. Например, если файл CSV содержит четыре строки, то значение полей составляет 4, если сценарий успешно загрузил все строки в `RecordsSaved` CSV-файле.

Если вы еще не запускали сценарий в шаге 4, ссылка на скачивание скрипта отображается в **статье Последний импорт**. Вы можете скачать сценарий, а затем выполнить действия в шаге 4 для его запуска.

## <a name="optional-step-6-schedule-the-script-to-run-automatically"></a>(Необязательный) Шаг 6. Запланировать автоматический запуск сценария

Чтобы убедиться, что последние данные о персонале организации доступны для таких средств, как решение по управлению рисками, рекомендуется запланировать автоматический запуск скрипта, например один раз в день. Это также требует обновления данных о персонале в CSV-файле по аналогичному (если не одному) расписанию, чтобы в нем содержались последние сведения о сотрудниках, покидавших организацию. Цель заключается в том, чтобы загрузить самые актуальные данные по персоналу, чтобы соединители hr могли сделать их доступными для решения по управлению рисками.

Вы можете использовать приложение Scheduler задач в Windows, чтобы автоматически запускать сценарий каждый день.

1. На локальном компьютере нажмите кнопку Windows **и** введите **план-график задач.**

2. Щелкните **приложение Scheduler** задач, чтобы открыть его.

3. В разделе **Действия** нажмите кнопку **Создать задачу**.

4. На **вкладке General** введите описательное имя для запланированной задачи; например, **сценарий соединитетеля кадров**. Вы также можете добавить необязательное описание.

5. В **параметрах Безопасности** сделайте следующее:

   1. Определите, следует ли запускать сценарий только в том случае, если вы вошли на компьютер или запустите его при входе в систему или нет.
   
   1. Убедитесь, что **выбран почтовый** ящик Run с наивысшими привилегиями.

6. Выберите **вкладку Триггеры,** нажмите **кнопку New** и затем сделайте следующие вещи:

   1. В **Параметры** выберите параметр **Daily,** а затем выберите дату и время для первого запуска сценария. Сценарий будет каждый день в указанное время.
   
   1. В **расширенных параметрах** убедитесь, что выбран почтовый ящик **Включен.**
   
   1. Нажмите кнопку **ОК**.

7. Выберите **вкладку Действия,** **нажмите кнопку New** и затем сделайте следующие действия:

   ![Параметры действий для создания новой запланированной задачи для скрипта соединители hr](../media/HRConnectorScheduleTask1.png)

   1. В **списке "Действие"** убедитесь, что **выбрана** программа Start.

   1. В поле **Program/script** щелкните **Обзор** и перейдите к следующему расположению и выберите его таким образом, чтобы путь отображался в поле: `C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe` .

   1. В поле **Добавление аргументов (необязательный)** вклейте ту же команду скрипта, которую вы запустили в шаге 4. Пример: `.\HRConnector.ps1 -tenantId "d5723623-11cf-4e2e-b5a5-01d1506273g9" -appId "c12823b7-b55a-4989-faba-02de41bb97c3" -appSecret "MNubVGbcQDkGCnn"  -jobId "e081f4f4-3831-48d6-7bb3-fcfab1581458" -csvFilePath "C:\Users\contosoadmin\Desktop\Data\employee_termination_data.csv"`

   1. В поле **Начните (необязательно)** вложите расположение папки скрипта, который вы запустили в шаге 4. Например, `C:\Users\contosoadmin\Desktop\Scripts`.

   1. Нажмите **кнопку Ок,** чтобы сохранить параметры для нового действия.

8. В **окне Создать задачу** **щелкните Ок,** чтобы сохранить запланированную задачу. Возможно, вам будет предложено ввести учетные данные учетных данных учетных записей пользователей.

   Новая задача отображается в библиотеке планиров задач.

   ![Новая задача отображается в библиотеке планиров задач](../media/HRConnectorTaskSchedulerLibrary.png)

   При последнем запуске сценария и при следующем его запуске отображается. Вы можете дважды щелкнуть задачу, чтобы изменить ее.

   Вы также можете проверить последний раз, когда сценарий был на странице вылетов соответствующего hr-соединиттеля в центре соответствия требованиям.