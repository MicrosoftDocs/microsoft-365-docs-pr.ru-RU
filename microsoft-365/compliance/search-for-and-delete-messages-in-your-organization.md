---
title: Поиск и удаление сообщений электронной почты в вашей организации
f1.keywords:
- NOCSH
ms.author: markjjo
author: markjjo
manager: laurawi
audience: Admin
ms.topic: article
ms.service: O365-seccomp
localization_priority: Priority
ms.collection:
- Strat_O365_IP
- M365-security-compliance
search.appverid:
- MOE150
- MET150
ms.assetid: 3526fd06-b45f-445b-aed4-5ebd37b3762a
description: Используйте поиск и очистку в Центре и соответствия требованиям Microsoft 365 для удаления сообщения электронной почты из всех почтовых ящиков организации.
ms.openlocfilehash: 95683ed5dc6cce8ff109976ebb0d13215593f046
ms.sourcegitcommit: 5d8de3e9ee5f52a3eb4206f690365bb108a3247b
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/04/2021
ms.locfileid: "52770713"
---
# <a name="search-for-and-delete-email-messages"></a>Поиск и удаление сообщений электронной почты

**Эта статья для администраторов. Вы пытаетесь найти в своем почтовом ящике элементы, которые хотите удалить? См. [Поиск сообщения или элемента с помощью мгновенного поиска.](https://support.office.com/article/69748862-5976-47b9-98e8-ed179f1b9e4d)**.

С помощью функции поиска содержимого можно найти сообщение электронной почты и удалить его из всех почтовых ящиков организации. Это позволяет находить и удалять потенциально опасные сообщения, например:

- сообщения, содержащие опасные вложения или вирусы;

- фишинговые сообщения;

- сообщения, содержащие конфиденциальные данные.

> [!CAUTION]
> Поиск и очистка — это мощный инструмент, который позволяет всем пользователям с необходимыми разрешениями удалять сообщения электронной почты из почтовых ящиков организации.

## <a name="before-you-begin"></a>Подготовка

- Создавать и выполнять поиск контента могут только члены группы ролей **Менеджер по обнаружению электронных данных** и пользователи с ролью управления **Поиск соответствия**, назначенной в Центре безопасности и соответствия требованиям. Удалять сообщения могут только члены группы ролей **Управление организацией** и пользователи с ролью управления **Поиск и очистка**, назначенной в Центре безопасности и соответствия требованиям. Сведения о добавлении пользователей в группу ролей см. в статье [Назначение разрешений обнаружения электронных данных в Центре безопасности и соответствия требованиям](assign-ediscovery-permissions.md).

  > [!NOTE]
  > Группа ролей **Управление организацией** существует как в Exchange Online, так и в Центре безопасности и соответствия требованиям. Это две разные группы ролей, которые дают различные разрешения. Участие в группе **Управление организацией** в Exchange Online не предоставляет разрешений, нужных для удаления сообщений электронной почты. Если вам не назначена роль **Поиск и очистка** в Центре безопасности и соответствия требованиям (напрямую или через группу ролей, например **Управление организацией**), на шаге 3 при запуске командлета **New-ComplianceSearchAction** вы получите ошибку с сообщением "Не удается найти параметр, соответствующий имени параметра "Purge"".

- Чтобы удалить сообщения, нужно использовать PowerShell в Центре безопасности и соответствия требованиям. Сведения о том, как выполнить подключение, см. в [шаге 1](#step-1-connect-to-security--compliance-center-powershell).

- За один раз можно удалить не более 10 элементов из одного почтового ящика. Так как возможность поиска и удаления сообщений предназначена для реагирования на инциденты, это ограничение обеспечивает быстрое удаление сообщений из почтовых ящиков. Эта возможность не предназначена для очистки почтовых ящиков пользователей.

- Максимальное количество почтовых ящиков в поиске контента, в которых можно удалять элементы с помощью поиска и очистки, — 50 000. Если поиск, созданный в [шаге 2](#step-2-create-a-content-search-to-find-the-message-to-delete), содержит более 50 000 почтовых ящиков, то действие очистки, созданное в шаге 3, завершится сбоем. Поиск более 50 000 почтовых ящиков за один раз обычно может выполняться при настройке поиска для всех почтовых ящиков в вашей организации. Это ограничение применяется, даже если менее 50 000 почтовых ящиков содержат элементы, соответствующие поисковому запросу. Сведения о том, как использовать фильтры разрешений поиска для поиска и очистки элементов из более чем 50 000 почтовых ящиков см. в разделе [Дополнительные сведения](#more-information).

- Инструкции, приведенные в этой статье, можно использовать только для удаления элементов из общедоступных папок и почтовых ящиков Exchange Online. Их нельзя использовать для удаления контента с сайтов SharePoint или OneDrive для бизнеса.

- Элементы электронной почты в наборе для проверки в деле Advanced eDiscovery невозможно удалить, используя процедуры, описанные в этой статье. Причина заключается в том, что элементы в наборе для проверки хранятся в расположении хранилища Azure, а не в действующей службе. Это означает, что такие элементы не будут возвращены поиском содержимого, созданном на шаге 1. Чтобы удалить элементы в наборе для проверки, необходимо удалить дело Advanced eDiscovery, содержащее этот набор для проверки. Дополнительные сведения см. в статье [Закрытие или удаление дела Advanced eDiscovery](close-or-delete-case.md).

## <a name="step-1-connect-to-security--compliance-center-powershell"></a>Шаг 1. Подключение к PowerShell в Центре безопасности и соответствия требованиям

Первый шаг — подключение к PowerShell в Центре безопасности и соответствия требованиям вашей организации. Пошаговые инструкции см. в статье [Подключение к PowerShell в Центре безопасности и соответствия требованиям](/powershell/exchange/connect-to-scc-powershell).

## <a name="step-2-create-a-content-search-to-find-the-message-to-delete"></a>Шаг 2. Создание поиска контента для поиска сообщения, которое необходимо удалить

Второй шаг — создание и выполнение поиска контента, чтобы найти сообщение, которое необходимо удалить из почтовых ящиков организации. Создать поиск можно с помощью Центра соответствия требованиям Microsoft 365 или выполнения командлетов **New-ComplianceSearch** и **Start-ComplianceSearch** в Центре безопасности и соответствия требованиям PowerShell. Сообщения, которые соответствуют поисковому запросу, будут удалены посредством выполнения команды **New-ComplianceSearchAction -Purge** в [шаге 3](#step-3-delete-the-message). Сведения о создании поиска контента и настройке поисковых запросов см. в следующих статьях:

- [Поиск контента в Office 365](content-search.md)

- [Запросы ключевых слов и условия поиска контента](keyword-queries-and-search-conditions.md)

- [New-ComplianceSearch](/powershell/module/exchange/New-ComplianceSearch)

- [Start-ComplianceSearch](/powershell/module/exchange/Start-ComplianceSearch)

> [!NOTE]
> В расположения для поиска контента, который создается на этом этапе, нельзя включать сайты SharePoint или OneDrive для бизнеса. В поиск контента, который будет использоваться для сообщений электронной почты, можно включать только почтовые ящики и общедоступные папки. Если поиск контента будет включать сайты, при выполнении командлета **New-ComplianceSearchAction** в шаге 3 произойдет ошибка.

### <a name="tips-for-finding-messages-to-remove"></a>Советы по поиску сообщений для удаления

Цель поискового запроса — ограничить результаты поиска сообщениями, которые необходимо удалить. Ниже приведено несколько советов.

- Если вы знаете точный текст или фразу, используемую в строке темы сообщения, укажите в поисковом запросе свойство **Subject**.

- Если вы знаете точную дату (или диапазон дат) получения сообщения, укажите в поисковом запросе свойство **Received**.

- Если вы знаете, кто отправил сообщение, укажите в поисковом запросе свойство **From**.

- Просмотрите результаты поиска, чтобы убедиться, что возвращены только сообщения, которые необходимо удалить.

- Просмотрите статистику поиска (отображается в области сведений о поиске в Центре соответствия требованиям Microsoft 365 или после выполнения командлета [Get-ComplianceSearch](/powershell/module/exchange/get-compliancesearch)), чтобы узнать общее количество результатов.

Ниже приведены два примера поиска подозрительных сообщений электронной почты.

- Этот запрос возвращает сообщения, полученные пользователями 13–14 апреля 2016 г., в которых есть слова "action" и "required" в строке темы.

  ```powershell
  (Received:4/13/2016..4/14/2016) AND (Subject:'Action required')
  ```

- Этот запрос возвращает сообщения, отправленные с адреса chatsuwloginsset12345@outlook.com, которые содержат фразу "Update your account information" ("Обновите сведения об учетной записи") в строке темы.

  ```powershell
  (From:chatsuwloginsset12345@outlook.com) AND (Subject:"Update your account information")
  ```

Вот пример использования запроса для создания и запуска поиска с помощью командлетов **New-ComplianceSearch** и **Start-ComplianceSearch** для поиска во всех почтовых ящиках в организации:

```powershell
$Search=New-ComplianceSearch -Name "Remove Phishing Message" -ExchangeLocation All -ContentMatchQuery '(Received:4/13/2016..4/14/2016) AND (Subject:"Action required")'
Start-ComplianceSearch -Identity $Search.Identity
```

## <a name="step-3-delete-the-message"></a>Шаг 3. Удаление сообщения

Создав и уточнив запрос на поиск контента, который будет возвращать подлежащее удалению сообщение, и подключившись к PowerShell в Центре безопасности и соответствия требованиям, выполните командлет **New-ComplianceSearchAction**, чтобы удалить сообщение. Сообщение можно удалить с возможностью восстановления или без возможности восстановления. Сообщение, удаленное с возможностью восстановления, перемещается в папку пользователя "Элементы для восстановления" и сохраняется до истечения срока хранения удаленных элементов. Сообщения, удаленные без возможности восстановления, отмечаются для окончательного удаления из почтового ящика и будут удалены без возможности восстановления при следующей обработке почтового ящика помощником для управляемых папок. Если для почтового ящика включено восстановление отдельных элементов, окончательно удаленные элементы будут удалены без возможности восстановления после истечения срока хранения удаленных элементов. Если почтовый ящик помещен на удержание, удаленные сообщения сохраняются до истечения срока удержания элемента или до отключения удержания для почтового ящика.

Приведенная в следующем примере команда удаляет с возможностью восстановления результаты поиска, возвращенные при поиске контента по запросу "Удаление фишингового сообщения".

```powershell
New-ComplianceSearchAction -SearchName "Remove Phishing Message" -Purge -PurgeType SoftDelete
```

Чтобы жестко удалить элементы, возвращенные поиском содержимого «Удалить фишинговое сообщение», вы должны выполнить эту команду:

```powershell
New-ComplianceSearchAction -SearchName "Remove Phishing Message" -Purge -PurgeType HardDelete
```

При запуске предыдущей команды для обратимого или окончательного удаления сообщений поиск, определяемый параметром *SearchName*, является поиском контента, созданным в шаге 1.

Дополнительные сведения см. в статье [New-ComplianceSearchAction](/powershell/module/exchange/New-ComplianceSearchAction).

## <a name="more-information"></a>Дополнительные сведения

- **Как узнать состояние операции поиска и удаления?**

  Запустите командлет **Get-ComplianceSearchAction**, чтобы получить сведения о состоянии операции удаления. Объекту, который создается при выполнении командлета **New-ComplianceSearchAction**, присваивается имя в следующем формате: `<name of Content Search>_Purge`.

- **Что происходит после удаления сообщения?**

  Сообщение, удаленное с помощью команды `New-ComplianceSearchAction -Purge -PurgeType HardDelete`, перемещается в папку "Очистка", и пользователь не сможет получить к нему доступ. После перемещения сообщения в папку "Очистка" оно хранится в течение срока хранения удаленных элементов, если для почтового ящика включено восстановление отдельных элементов. (В Microsoft 365 восстановление отдельных элементов включено по умолчанию при создании почтового ящика.) После истечения срока хранения удаленных элементов сообщение помечается для окончательного удаления и удаляется из Microsoft 365 при следующей обработке почтового ящика помощником для управляемых папок.

  Если используется команда `New-ComplianceSearchAction -Purge -PurgeType SoftDelete`, сообщения перемещаются в папку "Удаления" в папке пользователя "Элементы для восстановления". Оно не удаляется сразу из Microsoft 365. Пользователь может восстановить сообщения в папке "Удаленные" в течение периода хранения удаленных элементов, настроенного для почтового ящика. После истечения этого срока (или если пользователь очищает сообщение до его истечения) сообщение перемещается в папку "Очистка" и становится недоступным для пользователя. В папке "Очистка" сообщение хранится в течение срока хранения удаленных элементов, настроенного для почтового ящика, если для почтового ящика включено восстановление отдельных элементов. (В Microsoft 365 восстановление отдельных элементов включено по умолчанию при создании почтового ящика.) После истечения срока хранения удаленных элементов сообщение помечается для окончательного удаления и удаляется из Microsoft 365 при следующей обработке почтового ящика помощником для управляемых папок.

- **Что делать, если нужно удалить сообщение из более чем 50 000 почтовых ящиков?**

  Как было сказано выше, операцию поиска и очистки можно выполнить для не более чем 50 000 почтовых ящиков (даже если менее 50 000 почтовых ящиков содержат элементы, соответствующие поисковому запросу). Если вам нужно выполнить операцию поиска и очистки для более чем 50 000 почтовых ящиков, рекомендуется создать временные фильтры разрешений для поиска, чтобы количество почтовых ящиков, участвующих в поиске, составляло меньше 50 000. Например, если в вашей организации есть почтовые ящики в разных отделах, регионах или странах, вы можете создать фильтр разрешений поиска почтовых ящиков на основе одного из таких свойств, чтобы выполнять поиск в определенной подгруппе почтовых ящиков в организации. После создания фильтра разрешений поиска можно создать поиск (описано в шаге 1), а затем удалить сообщение (описано в шаге 3). Затем вы можете изменить фильтр для поиска и очистки сообщений в другом наборе почтовых ящиков. Дополнительные сведения о создании фильтров разрешений поиска см. в статье [Настройка фильтрации разрешений для поиска содержимого](permissions-filtering-for-content-search.md).

- **Удаляются ли неиндексированные элементы, включенные в результаты поиска?**

  Нет, команда `New-ComplianceSearchAction -Purge не удаляет неиндексированные элементы.

- **Что происходит, если сообщение удаляется из почтового ящика, помещенного на удержание на месте или для судебного разбирательства, либо к нему применяется политика хранения Microsoft 365?**

  После того как сообщение будет очищено и перемещено в папку "Очистка", оно будет храниться, пока не истечет срок удержания. Если период удержания не ограничен, элементы сохраняются до прекращения удержания или изменения периода удержания.

- **Почему рабочий процесс поиска и удаления выполняется с использованием разных групп ролей в Центре безопасности и соответствия требованиям?**

  Как объяснялось ранее, выполнять поиск в почтовых ящиках могут только члены группы ролей "Менеджер по обнаружению электронных данных" и пользователи с ролью управления "Поиск соответствия". Удалять сообщения могут только члены группы ролей "Управление организацией" и пользователи с ролью "Управление поиском и очисткой". Это позволяет управлять тем, кто может выполнять поиск в почтовых ящиках организации или удалять сообщения.
