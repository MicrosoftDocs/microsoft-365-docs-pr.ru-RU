---
title: Восстановление неактивного почтового ящика
f1.keywords:
- NOCSH
ms.author: markjjo
author: markjjo
manager: laurawi
ms.date: ''
audience: Admin
ms.topic: article
ms.service: O365-seccomp
ms.collection: M365-security-compliance
localization_priority: Normal
search.appverid:
- MOE150
- MET150
ms.assetid: 97e06a7a-ef9a-4ce8-baea-18b9e20449a3
description: Узнайте, как восстановить (или объединить) содержимое неактивного почтового ящика в существующий почтовый ящик в Office 365.
ms.custom: seo-marvel-apr2020
ms.openlocfilehash: 7d13c034b83fb1e467a77966416b5395d96c339c
ms.sourcegitcommit: 3b1bd8aa1430bc9565743a446bbc27b199f30f73
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/22/2020
ms.locfileid: "48655844"
---
# <a name="restore-an-inactive-mailbox"></a>Восстановление неактивного почтового ящика

Неактивный почтовый ящик (тип удаленного почтового ящика) используется для сохранения электронной почты бывшего сотрудника после того, как он уедет из организации. Если другой сотрудник берет на себя обязанности бывшего сотрудника или этот сотрудник возвращается в организацию, вы можете предоставить содержимое неактивного почтового ящика пользователю двумя способами.

- **Восстановление неактивного почтового ящика**. Если другой сотрудник берет на себя обязанности уволенного сотрудника или другому пользователю требуется доступ к содержимому неактивного почтового ящика, вы можете восстановить содержимое неактивного почтового в существующем почтовом ящике (этот процесс также называют слиянием). Можно также восстановить архив из неактивного почтового ящика. После восстановления неактивный почтовый ящик хранится как неактивный. В этом разделе описаны процедуры восстановления неактивного почтового ящика.

- **Восстановление неактивного почтового ящика** Если бывшего сотрудника возвращается в вашу организацию, или если новый сотрудник нанят для того, чтобы взять на себя обязанности бывшего сотрудника, вы можете восстановить содержимое неактивного почтового ящика. При этом неактивный почтовый ящик преобразуется в новый ящик, который содержит элементы неактивного почтового ящика. После восстановления неактивный почтовый ящик больше не существует. Пошаговая процедура по восстановлению неактивного почтового ящика [в Office 365.](recover-an-inactive-mailbox.md)

Дополнительные [сведения о](#more-information) различиях между восстановлением и восстановлением неактивного почтового ящика см. в разделе "Дополнительные сведения" этой статьи.

> [!NOTE]
> Неактивный почтовый ящик, настроенный с автоматически расширяемым архивом, восстановить нельзя. Если необходимо восстановить данные из неактивного почтового ящика с автоматически расширяемым архивом, используйте поиск контента, чтобы экспортировать данные из почтового ящика, а затем импортировать их в другой почтовый ящик. Инструкции см. в следующих темах:
>
> - [Поиск контента](content-search.md)
> - [Экспорт результатов поиска контента](export-search-results.md)

## <a name="requirements-to-restore-an-inactive-mailbox"></a>Требования для восстановления неактивного почтового ящика

- Для восстановления неактивного почтового ящика необходимо использовать Exchange Online PowerShell. Вы не можете сделать этого в Центре администрирования Exchange (EAC). Пошаговые инструкции см. в статье [Подключение к Exchange Online с помощью удаленной оболочки PowerShell](https://docs.microsoft.com/powershell/exchange/connect-to-exchange-online-powershell).

- Чтобы получить сведения об удостоверениях неактивных почтовых ящиков в организации, запустите следующую команду в Exchange Online PowerShell.

  ```powershell
  Get-Mailbox -InactiveMailboxOnly | Format-List Name,DistinguishedName,ExchangeGuid,PrimarySmtpAddress
  ```

  Используйте полученную информацию для восстановления определенного неактивного почтового ящика.

- Дополнительные сведения о неактивных почтовых ящиках см. в сведениях о неактивных почтовых [ящиках в Office 365.](inactive-mailboxes-in-office-365.md)

## <a name="restore-inactive-mailboxes"></a>Восстановление неактивных почтовых ящиков

Используйте командлет **New-MailboxRestoreRequest** с параметрами  _SourceMailbox_ и  _TargetMailbox_, чтобы восстановить содержимое неактивного почтового ящика в существующем ящике. Дополнительные сведения об использовании данного командлета см. в статье [New-MailboxRestoreRequest](https://docs.microsoft.com/powershell/module/exchange/new-mailboxrestorerequest).

1. Создайте переменную, содержащую свойства неактивного почтового ящика.

   ```powershell
   $InactiveMailbox = Get-Mailbox -InactiveMailboxOnly -Identity <identity of inactive mailbox>
   ```

   > [!IMPORTANT]
   > В предыдущей команде используйте значение свойства **DistinguishedName** или **ExchangeGUID** для определения неактивного почтового ящика. Эти свойства уникальны для каждого почтового ящика в организации, тогда как у активного и неактивного почтового ящика может быть один и тот же основной SMTP-адрес.

2. Восстановление содержимого неактивного почтового ящика в существующем ящике. Содержимое неактивного (исходного) почтового ящика будет добавлено в соответствующие папки существующего (целевого) почтового ящика.

   ```powershell
   New-MailboxRestoreRequest -SourceMailbox $InactiveMailbox.DistinguishedName -TargetMailbox newemployee@contoso.com -AllowLegacyDNMismatch
   ```

   Кроме того, можно указать папку верхнего уровня в целевом почтовом ящике, в которую будет восстановлено содержимое неактивного почтового ящика. Если указанная целевая папка или структура папок еще не существует в целевом почтовом ящике, она будет создана во время процесса восстановления.

   Этот пример копирует элементы и вложенные папки из неактивного почтового ящика в папку "Inactive Mailbox" в структуре папок верхнего уровня в целевом почтовом ящике.

   ```powershell
   New-MailboxRestoreRequest -SourceMailbox $InactiveMailbox.DistinguishedName -TargetMailbox newemployee@contoso.com -TargetRootFolder "Inactive Mailbox" -AllowLegacyDNMismatch
   ```

## <a name="restore-the-archive-from-an-inactive-mailbox"></a>Восстановление архива из неактивного почтового ящика

Если неактивный почтовый ящик содержит архивный почтовый ящик, можно восстановить его в архивный почтовый ящик существующего ящика. Чтобы восстановить архив из неактивного почтового ящика, необходимо добавить переключатели _SourceIsArchive_ и _TargetIsArchive_ в команду, используемую для восстановления неактивного почтового ящика.

1. Создайте переменную, содержащую свойства неактивного почтового ящика.

   ```powershell
   $InactiveMailbox = Get-Mailbox -InactiveMailboxOnly -Identity <identity of inactive mailbox>
   ```

   > [!NOTE]
   > В предыдущей команде используйте значение свойства **DistinguishedName** или **ExchangeGUID** для определения неактивного почтового ящика. Эти свойства уникальны для каждого почтового ящика в организации, тогда как у активного и неактивного почтового ящика может быть один и тот же основной SMTP-адрес.

2. Восстановление содержимого архива из неактивного почтового ящика (исходного архива) в архив существующего почтового ящика (целевой архив). В этом примере содержимое из исходного архива копируется в папку с именем "Inactive Mailbox Archive" в архиве целевого почтового ящика.

   ```powershell
   New-MailboxRestoreRequest -SourceMailbox $InactiveMailbox.DistinguishedName -SourceIsArchive -TargetMailbox newemployee@contoso.com -TargetIsArchive -TargetRootFolder "Inactive Mailbox Archive" -AllowLegacyDNMismatch
   ```

## <a name="more-information"></a>Дополнительные сведения

- **В чем основное различие между возвратом и восстановление неактивного почтового ящика?** После возврата неактивного почтового ящика он, по сути, преобразуется в новый почтовый ящик, содержимое и структура папок неактивного почтового ящика сохраняются, и он связывается с новой учетной записью пользователя. После возврата неактивный почтовый ящик больше не существует, и любые изменения, внесенные в его содержимое, влияют на содержимое, который изначально удерживался в неактивном почтовом ящике. При восстановлении неактивного почтового ящика его содержимое просто копируется в другой почтовый ящик. Неактивный почтовый ящик сохраняется и остается неактивным. Любые изменения, внесенные в содержимое целевого почтового ящика, не повлияет на исходное содержимое в неактивном почтовом ящике. Поиск в неактивном почтовом ящике [](content-search.md)по-прежнему можно найти с помощью средства "Поиск контента", его содержимое можно восстановить в другой почтовый ящик или восстановить или удалить позднее.

- **Как найти неактивные почтовые ящики?** Для получения списка неактивных почтовых ящиков в организации и информации, необходимой для восстановления неактивного почтового ящика, выполните эту команду.

  ```powershell
  Get-Mailbox -InactiveMailboxOnly | Format-List Name,PrimarySMTPAddress,DistinguishedName,ExchangeGUID,LegacyExchangeDN,ArchiveStatus
  ```

- **Используйте хранение для судебного разбирательства или политику хранения Microsoft 365 для хранения неактивного содержимого почтовых ящиков.** Если вы хотите сохранить состояние неактивного почтового ящика после его восстановления, [](create-a-litigation-hold.md) можно применить к целевому почтовому ящику хранение для судебного разбирательства или применить политику хранения [Microsoft 365](retention.md) перед восстановлением неактивного почтового ящика. Это предотвратит удаление элементов из неактивного почтового ящика после их восстановления в целевом ящике.

- **Включите удержание хранения для целевого почтового ящика перед восстановлением неактивного почтового ящика.** Так как элементы почтового ящика из неактивного почтового ящика могут быть старыми, перед восстановлением неактивного почтового ящика можно активировать удержание хранения для целевого почтового ящика. При наложении на почтовый ящик удержания хранения назначенная ему политика хранения не будет обрабатываться до тех пор, пока удержание хранения не будет снято или не истечет срок хранения. Это дает владельцу целевого почтового ящика время на управление старыми сообщениями из неактивного почтового ящика. В противном случае политика хранения может удалить старые элементы (или переместить их в архивный почтовый ящик, если он включен), срок действия которых истек на основе параметров хранения, настроенных для целевого почтового ящика. Дополнительные сведения см. в подмене почтового ящика удержанием [хранения в Exchange Online.](https://docs.microsoft.com/exchange/security-and-compliance/messaging-records-management/mailbox-retention-hold)

- **Что делает параметр AllowLegacyDNMismatch?** В предыдущих примерах для восстановления неактивного почтового ящика параметр **AllowLegacyDNMismatch** использовался, чтобы разрешить восстановление неактивного почтового ящика в другой целевой почтовый ящик. В обычном сценарии восстановления цель заключается в восстановлении содержимого, при этом исходный и целевой почтовые ящики совпадают. Поэтому по умолчанию с помощью cmdlet **New-MailboxRestoreRequest** проверяется, что значение свойства **LegacyExchangeDN** в исходных и целевых почтовых ящиках одинаково. Эта позволяет предотвратить случайное восстановление исходного почтового ящика в неправильном целевом почтовом ящике. Если попытаться восстановить неактивный почтовый ящик без параметра **AllowLegacyDNMismatch**, команда может завершиться с ошибкой, если значения свойства **LegacyExchangeDN** исходного и целевого почтового ящика различаются.

- **Можно использовать другие параметры с командлетом New-MailboxRestoreRequest для реализации различных сценариев восстановления неактивных почтовых ящиков.** Например, можно выполнить эту команду, чтобы восстановить архив из неактивного почтового ящика в основном почтовом ящике целевого почтового ящика.

  ```powershell
  New-MailboxRestoreRequest -SourceMailbox <inactive mailbox> -SourceIsArchive -TargetMailbox <target mailbox> -TargetRootFolder "Inactive Mailbox Archive" -AllowLegacyDNMismatch
  ```

  Можно также восстановить неактивный основной почтовый ящик в архиве в целевом почтовом ящике, выполнив эту команду.

  ```powershell
  New-MailboxRestoreRequest -SourceMailbox <inactive mailbox> -TargetMailbox <target mailbox> -TargetIsArchive -TargetRootFolder "Inactive Mailbox" -AllowLegacyDNMismatch
  ```

- **Что делает параметр TargetRootFolder?** Как объяснялось ранее, параметр **TargetRootFolder** можно использовать, чтобы указать папку в верхней части структуры папок ( корневой папке) целевого почтового ящика, в котором требуется восстановить содержимое неактивного почтового ящика. Если этот параметр не используется, элементы неактивного почтового ящика добавляются в соответствующие папки целевого почтового ящика по умолчанию, а пользовательские папки создаются заново в корневой папке целевого ящика. На следующих рисунках показаны различия между использованием и неиспользованием параметра **TargetRootFolder**.

  **Иерархия папок в целевом почтовом ящике, если параметр TargetRootFolder не используется**

  ![Снимок экрана: не используется параметр TargetRootFolder.](../media/76a759af-f483-4d1c-8cc7-243435b5562e.png)

  **Иерархия папок в целевом почтовом ящике, если параметр TargetRootFolder используется**

  ![Снимок экрана: используется параметр TargetRootFolder.](../media/300da592-7323-48db-b8a4-07012259d113.png)
