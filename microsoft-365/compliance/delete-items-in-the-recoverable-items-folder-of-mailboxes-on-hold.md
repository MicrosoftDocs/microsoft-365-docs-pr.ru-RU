---
title: Удаление элементов в папке "Извлекаемые элементы" облачного почтового ящика в удержании
f1.keywords:
- NOCSH
ms.author: markjjo
author: markjjo
manager: laurawi
audience: Admin
ms.topic: article
ms.service: O365-seccomp
localization_priority: Normal
ms.collection:
- Strat_O365_IP
- M365-security-compliance
search.appverid:
- MOE150
- MET150
ms.assetid: a85e1c87-a48e-4715-bfa9-d5275cde67b0
description: Узнайте, как администраторы могут удалять элементы в папке "Извлекаемые элементы" пользователя для почтового ящика Exchange Online, даже если этот почтовый ящик находится на законном удержании.
ms.custom: seo-marvel-apr2020
ms.openlocfilehash: 44eccb010bf8c52172a3b7ae4e0782e5484d457d
ms.sourcegitcommit: 27b2b2e5c41934b918cac2c171556c45e36661bf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "50923305"
---
# <a name="delete-items-in-the-recoverable-items-folder-of-cloud-based-mailboxes-on-hold"></a>Удаление элементов в папке "Элементы с возможностью восстановления" облачных почтовых ящиков на удержании

Папка "Извлекаемые элементы" для почтового ящика Exchange Online существует для защиты от случайных или вредоносных удалений. Он также используется для хранения элементов, которые сохраняются и доступны с помощью функций соответствия требованиям, таких как удержания и поиск по обнаружению электронных данных. Однако в некоторых ситуациях организации могут иметь данные, которые непреднамеренно сохраняются в папке "Извлекаемые элементы", которую они должны удалить. Например, пользователь может не личные сведения отправлять или перенаправить сообщение электронной почты, содержаное конфиденциальные сведения или сведения, которые могут иметь серьезные последствия для бизнеса. Даже если сообщение окончательно удалено, оно может храниться бесконечно, так как на почтовом ящике размещено законное удержание. Этот сценарий известен как *утечка данных,* так как данные непреднамеренно разлиты в Office 365.  В таких ситуациях можно удалить элементы в папке "Извлекаемые элементы" пользователя для почтового ящика Exchange Online, даже если этот почтовый ящик находится на удержании с одной из различных функций удержания в Office 365. К таким типам удержаний относятся хранение судебных In-Place, удержание, хранение электронных данных и политики хранения, созданные в центре безопасности и соответствия требованиям в Office 365 или Microsoft 365.
  
 В этой статье объясняется, как администраторы могут удалять элементы из папки "Извлекаемые элементы" для облачных почтовых ящиков, которые находятся в удержании. Эта процедура включает отключение доступа к почтовому ящику и отключение восстановления одного элемента, отключение помощника управляемых папок от обработки почтового ящика, временное удаление удержания, удаление элементов из папки "Возвращаемые элементы", а затем восстановление почтового ящика в прежней конфигурации. Вот процесс:
  
[Шаг 1. Сбор сведений о почтовом ящике](#step-1-collect-information-about-the-mailbox)

[Шаг 2. Подготовка почтового ящика](#step-2-prepare-the-mailbox)

[Шаг 3. Удаление всех удерживает из почтового ящика](#step-3-remove-all-holds-from-the-mailbox)

[Шаг 4. Удаление удержания задержки из почтового ящика](#step-4-remove-the-delay-hold-from-the-mailbox)

[Шаг 5. Удаление элементов в папке "Извлекаемые элементы"](#step-5-delete-items-in-the-recoverable-items-folder)

[Шаг 6. Повторное повторное состояние почтового ящика в прежнем состоянии](#step-6-revert-the-mailbox-to-its-previous-state)
  
> [!CAUTION]
> Процедуры, описанные в этой статье, при этом данные будут окончательно удалены (удалены) из почтового ящика Exchange Online. Это означает, что сообщения, которые удаляются из папки "Извлекаемые элементы", не могут быть восстановлены и не будут доступны для юридических открытий или для других целей соответствия требованиям. Если вы хотите удалить сообщения из почтового ящика, помещенного на удержание в рамках судебного удержания, In-Place удержания, хранения электронных данных или политики хранения, созданной в центре безопасности и соответствия требованиям, перед удалением этого удержания обратитесь в управление записями или юридические отделы. В организации может быть политика, определяемая, имеет ли почтовый ящик приоритет в удержании или инцидент утечки данных.
  
## <a name="before-you-delete-items"></a>Перед удалением элементов

- Создавать и выполнять поиск контента могут только члены группы ролей "Диспетчер eDiscovery" и пользователи с ролью "Управление поиском соответствия". Удалять сообщения могут только члены группы ролей "Управление организацией" и пользователи с ролью "Управление поиском и очисткой". Сведения о добавлении пользователей в группу ролей см. в статье [Назначение разрешений обнаружения электронных данных в Центре безопасности и соответствия требованиям](./assign-ediscovery-permissions.md).

- Процедура, описанная в этой статье, не поддерживается для неактивных почтовых ящиков. Это потому, что нельзя повторно использовать удержание (или политику хранения) в неактивный почтовый ящик после удаления. При удалении удержания из неактивного почтового ящика он меняется на обычный электронный удаленный почтовый ящик и будет окончательно удален из организации после обработки помощником управляемых папок.

- Вы не можете выполнить эту процедуру для почтового ящика, который был назначен параметры хранения с политикой, заблокированной с помощью блокировки сохранения. Это потому, что этот блокировка предотвращает удаление или исключение почтового ящика из политики и отключение помощника управляемых папок в почтовом ящике. Дополнительные сведения о политиках блокировки для хранения см. в этой рубке [Use Preservation Lock to restrict changes to retention policies and retention label policies.](retention-preservation-lock.md)

- Если почтовый ящик не находится на удержании (или не включено восстановление одного элемента), можно удалить элементы из папки "Извлекаемые элементы". Дополнительные сведения о том, как это сделать, см. в публикации Поиск и удаление сообщений электронной [почты в организации.](./search-for-and-delete-messages-in-your-organization.md)
  
## <a name="step-1-collect-information-about-the-mailbox"></a>Шаг 1. Сбор сведений о почтовом ящике

Этот первый шаг состоит в сборе выбранных свойств из целевого почтового ящика, которые повлияют на эту процедуру. Обязательно запишите эти параметры или сохраните их в текстовом файле, так как некоторые из этих свойств будут изменяться, а затем возвращаться к исходным значениям в шаге 6 после удаления элементов из папки "Возвращаемые элементы". Вот список свойств почтовых ящиков, которые необходимо собрать.
  
- *SingleItemRecoveryEnabled*  и  *RetainDeletedItemsFor*. При необходимости вы отключит одно восстановление и увеличите период хранения удаленных элементов в шаге 3.

- *LitigationHoldEnabled* и *InPlaceHolds.* Необходимо определить все удерживает размещены на почтовом ящике, чтобы можно было временно удалить их в шаге 3. Дополнительные [сведения см.](#more-information) в разделе Дополнительные сведения о том, как определить тип удержания, которые могут быть размещены в почтовом ящике.

Кроме того, необходимо получить параметры клиентского доступа к почтовым ящикам, чтобы можно было временно отключить их, чтобы владелец (или другие пользователи) не мог получить доступ к почтовому ящику во время этой процедуры. Наконец, вы можете получить текущий размер и количество элементов в папке "Извлекаемые элементы". После удаления элементов в папке "Извлекаемые элементы" в шаге 5 вы будете использовать эти сведения для проверки удаления элементов.
  
1. [Подключение к Exchange Online PowerShell](/powershell/exchange/connect-to-exchange-online-powershell). Не забудьте использовать имя пользователя и пароль для учетной записи администратора, назначенной соответствующими ролями управления в Exchange Online.

2. Запустите следующую команду, чтобы получить сведения о восстановлении одного элемента и периоде хранения удаленных элементов.

    ```powershell
    Get-Mailbox <username> | FL SingleItemRecoveryEnabled,RetainDeletedItemsFor
    ```

   Если включено восстановление одного элемента, его необходимо отключить в шаге 2. Если период хранения удаленных элементов не установлен в течение 30 дней (максимальное значение в Exchange Online), вы можете увеличить его в шаге 2.

3. Запустите следующую команду, чтобы получить параметры доступа к почтовому ящику для почтового ящика.

    ```powershell
    Get-CASMailbox <username> | FL EwsEnabled,ActiveSyncEnabled,MAPIEnabled,OWAEnabled,ImapEnabled,PopEnabled
    ```

   Все эти методы доступа будут отключены в шаге 2.

4. Запустите следующую команду, чтобы получить сведения о политиках хранения и хранения, применяемых к почтовому ящику.

    ```powershell
    Get-Mailbox <username> | FL LitigationHoldEnabled,InPlaceHolds
    ```

   > [!TIP]
    > Если в свойстве  *InPlaceHolds*  слишком много значений и не все они отображаются, можно запустить команду, чтобы отобразить каждое значение в  `Get-Mailbox <username> | Select-Object -ExpandProperty InPlaceHolds` отдельной строке.
  
5. Запустите следующую команду, чтобы получить сведения о любых политиках хранения для всей организации. 

    ```powershell
    Get-OrganizationConfig | FL InPlaceHolds
    ```

   Если в организации есть какие-либо политики хранения по всей организации, вам придется исключить почтовый ящик из этих политик в шаге 3.

   > [!TIP]
    > Если в свойстве  *InPlaceHolds*  слишком много значений и не все они отображаются, можно запустить команду, чтобы отобразить каждое значение в  `Get-OrganizationConfig | Select-Object -ExpandProperty InPlaceHolds` отдельной строке. 
  
6. Запустите следующую команду, чтобы получить текущий размер и общее количество элементов в папках и подмостках в папке "Извлекаемые элементы" в основном почтовом ящике пользователя.

    ```powershell
    Get-MailboxFolderStatistics <username> -FolderScope RecoverableItems | FL Name,FolderAndSubfolderSize,ItemsInFolderAndSubfolders
    ```

   Если архивный почтовый ящик пользователя включен, запустите следующую команду, чтобы получить размер и общее количество элементов в папках и подмостках в папке "Извлекаемые элементы" в архивном почтовом ящике. 

    ```powershell
    Get-MailboxFolderStatistics <username> -FolderScope RecoverableItems -Archive | FL Name,FolderAndSubfolderSize,ItemsInFolderAndSubfolders
    ```

   При удалении элементов в шаге 5 можно удалить или не удалять элементы в папке "Извлекаемые элементы" в основном архивном почтовом ящике пользователя. Если для почтового ящика включено автоматическое расширение архива, элементы вспомогательного архивного почтового ящика не будут удалены.
  
## <a name="step-2-prepare-the-mailbox"></a>Шаг 2. Подготовка почтового ящика

После сбора и сохранения сведений о почтовом ящике следующим шагом является подготовка почтового ящика путем выполнения следующих задач:
  
- **Отключить клиентский доступ к почтовому** ящику, чтобы владелец почтового ящика не мог получить доступ к своему почтовому ящику и внести изменения в данные почтовых ящиков во время этой процедуры.

- **Увеличение** срока хранения удаленных элементов до 30 дней (максимальное значение в Exchange Online), чтобы элементы не удалялись из папки "Извлекаемые элементы", прежде чем удалить их в шаге 5.

- **Отключите** восстановление одного элемента, чтобы элементы не сохранялись (на протяжении периода хранения удаленных элементов) после удаления их из папки "Извлекаемые элементы" в шаге 5.

- **Отключите помощник управляемой папки,** чтобы он не обрабатывает почтовый ящик и не сохраняет элементы, которые удаляются в шаге 5.

Выполните следующие действия в Exchange Online PowerShell.
  
1. Запустите следующую команду, чтобы отключить весь клиентский доступ к почтовому ящику. Синтаксис команд предполагает, что все методы клиентского доступа включены в почтовый ящик.

    ```powershell
    Set-CASMailbox <username> -EwsEnabled $false -ActiveSyncEnabled $false -MAPIEnabled $false -OWAEnabled $false -ImapEnabled $false -PopEnabled $false
    ```

   > [!NOTE]
    > Отключение всех методов клиентского доступа к почтовому ящику может занять до 60 минут. Обратите внимание, что отключение этих методов доступа не отключит владельца почтового ящика, в который они в настоящее время подписаны. Если владелец не входил, он не сможет получить доступ к почтовому ящику после отключения этих методов доступа.
  
2. Запустите следующую команду, чтобы увеличить срок хранения удаленных элементов не более 30 дней. Это предполагает, что текущий параметр составляет менее 30 дней.

    ```powershell
    Set-Mailbox <username> -RetainDeletedItemsFor 30
    ```

3. Запустите следующую команду, чтобы отключить восстановление одного элемента.

    ```powershell
    Set-Mailbox <username> -SingleItemRecoveryEnabled $false
    ```

   > [!NOTE]
    > Отключение восстановления одного элемента может занять до 60 минут. Не удаляйте элементы в папке "Извлекаемые элементы" до окончания этого периода. 
  
4. Запустите следующую команду, чтобы не допустить обработки почтового ящика помощником управляемых папок. Как объяснялось ранее, отключить помощник управляемых папок можно только в том случае, если политика хранения с блокировкой сохранения не применяется к почтовому ящику. 

    ```powershell
    Set-Mailbox <username> -ElcProcessingDisabled $true
    ```

## <a name="step-3-remove-all-holds-from-the-mailbox"></a>Шаг 3. Удаление всех удерживает из почтового ящика

Последний шаг перед удалением элементов из папки "Извлекаемые элементы" — удаление всех удерживаемых элементов (которые были определены в шаге 1), размещенных в почтовом ящике. Все удержания должны быть удалены, чтобы элементы не сохранялись после удаления их из папки "Извлекаемые элементы". В следующих разделах содержатся сведения об удалении различных типов удерживающих данных в почтовом ящике. Дополнительные [сведения см.](#more-information) в разделе Дополнительные сведения о том, как определить тип удержания, которые могут быть размещены в почтовом ящике. Дополнительные сведения см. [в примере How to identify the type of hold placed on an Exchange Online mailbox.](identify-a-hold-on-an-exchange-online-mailbox.md)
  
> [!CAUTION]
> Как уже говорилось ранее, перед удалением удержания из почтового ящика обратитесь к управлению записями или юридическим отделам. 
  
### <a name="litigation-hold"></a>Хранение для судебного разбирательства
  
Запустите следующую команду в Exchange Online PowerShell, чтобы удалить удержание судебного разбирательства из почтового ящика.

```powershell
Set-Mailbox <username> -LitigationHoldEnabled $false
```

> [!NOTE]
> Как и отключение методов клиентского доступа и восстановления одного элемента, удаление удержания для судебного разбирательства может занять до 60 минут. Не удаляйте элементы из папки "Извлекаемые элементы" до окончания этого периода. 
  
### <a name="in-place-hold"></a>Хранение на месте
  
Запустите следующую команду в Exchange Online PowerShell, чтобы определить In-Place удержания, размещенного в почтовом ящике. Используйте GUID для удержания In-Place, который был определен в шаге 1.

```powershell
Get-MailboxSearch -InPlaceHoldIdentity <hold GUID> | FL Name
```

После определения In-Place удержания можно использовать центр администрирования Exchange (EAC) или Exchange Online PowerShell для удаления почтового ящика из удержания. Дополнительные сведения см. в статью Создание или [удаление In-Place удержания.](/exchange/security-and-compliance/create-or-remove-in-place-holds)
  
### <a name="retention-policies-applied-to-specific-mailboxes"></a>Политики хранения, применяемые к определенным почтовым ящикам
  
Запустите следующую команду в [центре & PowerShell,](/powershell/exchange/exchange-online-powershell) чтобы определить политику хранения, применяемую к почтовому ящику. Эта команда также возвращает все политики хранения разговоров Teams, применяемые к почтовому ящику. Используйте GUID (не включая префикс или префикс) для политики хранения, которую вы `mbx` `skp` идентифицировали в шаге 1.

```powershell
Get-RetentionCompliancePolicy <retention policy GUID without prefix> | FL Name
```

После определения политики хранения перейдите на страницу Хранения управления информацией в Центре обеспечения безопасности & соответствия требованиям, отредактируете политику хранения, которая была определена на предыдущем этапе, и удалите почтовый ящик из списка получателей, включенных в политику  >   хранения.
  
### <a name="organization-wide-retention-policies"></a>Политики хранения на всей организации
  
Политики хранения для всех почтовых ящиков в организации применяются для всех почтовых ящиков в рамках всей организации, exchange-wide и Teams-wide. Они применяются на уровне организации (а не на уровне почтовых ящиков) и возвращаются при запуске **cmdlet Get-OrganizationConfig** в шаге 1. Запустите следующую команду в [центре & PowerShell,](/powershell/exchange/exchange-online-powershell) чтобы определить политики хранения по всей организации. Используйте GUID (не включая префикс) для политик хранения по всей организации, которые вы  `mbx` идентифицировали в шаге 1.

```powershell
Get-RetentionCompliancePolicy <retention policy GUID without prefix> | FL Name
```

После определения политик хранения для всей организации перейдите на страницу Хранения управления информацией в Центре обеспечения безопасности & соответствия требованиям, отредактируете каждую политику хранения на всей организации, которую вы определили на предыдущем этапе, и добавьте почтовый ящик в список исключенных  >   получателей. Это позволит удалить почтовый ящик пользователя из политики хранения.

### <a name="retention-labels"></a>Метки хранения

Всякий раз, когда пользователь применяет метку, настроенную для сохранения контента или сохранения, а затем удаления контента в любой папке или элементе в почтовом ящике, свойство *ComplianceTagHoldApplied* для почтового ящика задалось true **.** В этом случае почтовый ящик считается отложенным, как если бы он был помещен в удержание судебного разбирательства или назначен политике хранения.

Чтобы просмотреть значение свойства *ComplianceTagHoldApplied,* запустите следующую команду в Exchange Online PowerShell:

```powershell
Get-Mailbox <username> |FL ComplianceTagHoldApplied
```

После того как вы определили, что почтовый ящик находится на удержании из-за применения метки хранения к папке или элементу, вы можете использовать средство поиска контента в центре безопасности и соответствия требованиям для поиска помеченных элементов с помощью условия поиска ComplianceTag. Дополнительные сведения см. в разделе "Условия поиска" в разделе Запросы по ключевым словам и условия поиска для [поиска контента.](keyword-queries-and-search-conditions.md#conditions-for-common-properties)

Дополнительные сведения о метки см. в дополнительных сведениях о политиках хранения и [метки хранения.](retention.md)

### <a name="ediscovery-holds"></a>Удержание данных, созданных с помощью обращения обнаружения электронных данных
  
Запустите следующие команды в центре [обеспечения & PowerShell,](/powershell/exchange/connect-to-scc-powershell) чтобы определить удержание, связанное с делом об обнаружении электронных данных (так называемое удержание электронных данных), примененным к почтовому ящику.  Используйте GUID (не включая префикс) для удержания  `UniH` eDiscovery, который был определен в шаге 1. Вторая команда отображает имя связанного с удержанием случая электронных обнаружений; третья команда отображает имя удержания.
  
```powershell
$CaseHold = Get-CaseHoldPolicy <hold GUID without prefix>
```

```powershell
Get-ComplianceCase $CaseHold.CaseId | FL Name
```

```powershell
$CaseHold.Name
```

После того, как вы определили имя дела об обнаружении электронных данных и удержания, перейдите на страницу **eDiscovery** \> **eDiscovery** в центре соответствия требованиям, откройте дело и удалите почтовый ящик из удержания. Дополнительные сведения об обнаружении удержаний электронных данных см. в разделе "Удержание электронных данных" в разделе Как определить тип удержания, размещенного в почтовом ящике [Exchange Online.](identify-a-hold-on-an-exchange-online-mailbox.md#ediscovery-holds)
  
## <a name="step-4-remove-the-delay-hold-from-the-mailbox"></a>Шаг 4. Удаление удержания задержки из почтового ящика

После удаления любого типа удержания из почтового ящика значение свойства *delayHoldApplied* или *DelayReleaseHoldApplied* для почтового ящика устанавливается **значение True**. Это происходит в следующий раз, когда помощник управляемой папки обрабатывает почтовый ящик и обнаруживает, что удержание было удалено. Это называется *удержанием* задержки и означает, что фактическое удаление удержания откладывается на 30 дней, чтобы предотвратить удаление данных из почтового ящика навсегда. (Цель удержания задержки заключается в том, чтобы предоставить администраторам возможность поиска или восстановления элементов почтовых ящиков, которые будут удалены после удаления удержания.)  При удержании задержки в почтовом ящике почтовый ящик по-прежнему считается удержанным на неограниченное время, как если бы почтовый ящик был на удержании судебного разбирательства. По истечении 30 дней срок задержки истекает, и Microsoft 365 будет автоматически пытаться удалить удержание задержки (установив свойство *DelayHoldApplied* или *DelayReleaseHoldApplied* **false),** чтобы удержание было удалено. Дополнительные сведения о задержке см. в разделе "Управление почтовыми ящиками в удержании задержки" в разделе Как определить тип удержания, размещенного в почтовом ящике [Exchange Online.](identify-a-hold-on-an-exchange-online-mailbox.md#managing-mailboxes-on-delay-hold)

Прежде чем удалить элементы в шаге 5, необходимо удалить удержание задержки из почтового ящика. Во-первых, определите, применяется ли удержание задержки к почтовому ящику, применив следующую команду в Exchange Online PowerShell:

```powershell
Get-Mailbox <username> | FL DelayHoldApplied,DelayReleaseHoldApplied
```

Если значение свойства *DelayHoldApplied* или *DelayReleaseHoldApplied* установлено значение **False,** задержка не помещается в почтовый ящик. Вы можете перейти к шагу 5 и удалить элементы в папке "Извлекаемые элементы".

Если значение свойства *DelayHoldApplied* или *DelayReleaseHoldApplied* установлено значение **True,** запустите одну из следующих команд, чтобы удалить удержание задержки:

```powershell
Set-Mailbox <username> -RemoveDelayHoldApplied
```

или

```powershell
Set-Mailbox <username> -RemoveDelayReleaseHoldApplied
```

Для использования параметра *RemoveDelayHoldApplied* или *RemoveDelayReleaseHoldApplied* вам должна быть назначена роль юридического удержания в Exchange Online.

## <a name="step-5-delete-items-in-the-recoverable-items-folder"></a>Шаг 5. Удаление элементов в папке "Извлекаемые элементы"

Теперь вы готовы фактически удалить элементы в папке "Извлекаемые элементы" с помощью [cmdlets New-ComplianceSearch](/powershell/module/exchange/new-compliancesearch) и [New-ComplianceSearchAction](/powershell/module/exchange/new-compliancesearchaction) в центре безопасности & PowerShell.

Для поиска элементов, расположенных в папке "Извлекаемые элементы", рекомендуется выполнить *целевые коллекции.* Это означает, что область поиска сузится только до элементов, расположенных в папке "Извлекаемые элементы". Это можно сделать, запуская сценарий в статье [Use Content Search for targeted collections.](use-content-search-for-targeted-collections.md) В этом скрипте возвращается значение свойства ID папки для всех подмостков в целевой папке "Возвращаемые элементы". Затем для возврата элементов, расположенных в этой папке, используется ИД папки в поисковом запросе.

Ниже представлен обзор процесса поиска и удаления элементов в папке "Извлекаемые элементы" пользователя:

1. Запустите сценарий целевой коллекции, который возвращает ИД папок для всех папок в почтовом ящике целевого пользователя. Скрипт подключается к Exchange Online PowerShell и security & PowerShell в том же сеансе PowerShell. Дополнительные сведения см. [в сообщении Run the script to get a list of folders for a mailbox.](use-content-search-for-targeted-collections.md#step-1-run-the-script-to-get-a-list-of-folders-for-a-mailbox-or-site)

2. Скопируйте папки для всех подмостков в папке "Извлекаемые элементы". Кроме того, можно перенаправить выход скрипта в текстовый файл.

   Вот список и описание подмастерей в папке "Извлекаемые элементы", которые можно искать и удалять из:

   - **Удаления.** Содержит элементы с мягким удалением, срок хранения удаленных элементов которых не истек. Пользователи могут восстанавливать удаленные элементы из этой подмостки с помощью средства Восстановления удаленных элементов в Outlook.

   - **Purges**: Содержит трудно удаленные элементы, срок хранения удаленных элементов которых истек. Пользователи также могут удалить элементы с помощью удаления элементов из папки "Извлекаемые элементы". Если почтовый ящик находится в удержании, элементы с жесткой удаляемой почтой сохраняются. Этот подмосток не виден конечным пользователям.

   - **DiscoveryHolds.** Содержит трудноутвердимые элементы, которые были сохранены в удержании электронных данных или политике хранения. Этот подмосток не виден конечным пользователям.

   - **SubstrateHolds.** Содержит удаленные элементы из Teams и других облачных приложений, которые были сохранены политикой хранения или другим типом удержания. Этот подмосток не виден конечным пользователям.

3. Используйте комдлет **New-ComplianceSearch** (в центре обеспечения безопасности & PowerShell) или используйте средство поиска контента в центре соответствия требованиям для создания поиска контента, возвращаемого из папки возвращаемых элементов целевого пользователя. Это можно сделать, включив папку FolderId в поисковый запрос для всех подвещений, которые необходимо искать. Например, следующий запрос возвращает все сообщения в подволдингах Purges и eDiscoveryHolds:

   ```text
   folderid:<folder ID of Purges subfolder> OR folderid:<folder ID of DiscoveryHolds subfolder>
   ```

   Дополнительные сведения и примеры выполнения поиска контента с использованием свойства ID папки см. в примере [Use a folder ID или](use-content-search-for-targeted-collections.md#step-2-use-a-folder-id-or-documentlink-to-perform-a-targeted-collection)для выполнения целевой коллекции.

   > [!NOTE]
   > Если для поиска в папке "Извлекаемые элементы" используется кодлет **New-ComplianceSearch,** для выполнения поиска обязательно используйте кодлет **Start-ComplianceSearch.**

4. После создания поиска контента и проверки того, что он возвращает элементы, которые необходимо удалить, используйте команду (в центре обеспечения безопасности & PowerShell), чтобы окончательно удалить элементы, возвращенные поиском контента, созданным на предыдущем `New-ComplianceSearchAction -Purge -PurgeType HardDelete` шаге. Например, вы можете запустить команду, аналогичную следующей команде:

   ```powershell
   New-ComplianceSearchAction -SearchName "RecoverableItems" -Purge -PurgeType HardDelete
   ```

5. При запуске предыдущей команды удаляется не более 10 элементов на почтовый ящик. Это означает, что вам может потребоваться выполнить команду несколько раз, чтобы удалить все элементы, которые необходимо удалить в папке `New-ComplianceSearchAction -Purge` "Извлекаемые элементы". Чтобы удалить дополнительные элементы, сначала необходимо удалить предыдущее действие по очистке от проверки соответствия требованиям. Вы делаете это, запуская `Remove-ComplianceSearchAction` cmdlet. Например, чтобы удалить действие очистки, которое было выполнить на предыдущем шаге, запустите следующую команду:

   ```powershell
   Remove-ComplianceSearchAction "RecoverableItems_Purge"
   ```

   После этого можно создать новое действие по очистке от поиска соответствия требованиям, чтобы удалить больше элементов. Перед созданием нового действия необходимо удалить каждое действие очистки.

   Чтобы получить список действий по поиску соответствия требованиям, можно запустить `Get-ComplianceSearchAction` этот список. Действия очистки идентифицированы `_Purge` по приложению к имени поиска.

### <a name="verify-that-items-were-deleted"></a>Убедитесь, что элементы были удалены

Чтобы убедиться в успешном удалении элементов из папки "Извлекаемые элементы" почтового ящика, используйте комдлет **Get-MailboxFolderStatistics** в Exchange Online PowerShell, чтобы проверить размер и количество элементов в папке "Извлекаемые элементы". Эти статистические данные можно сравнить с данными, собранными в шаге 1.
  
Запустите следующую команду, чтобы получить текущий размер и общее количество элементов в папках и подмостках в папке "Извлекаемые элементы" в основном почтовом ящике пользователя.
  
```powershell
Get-MailboxFolderStatistics <username> -FolderScope RecoverableItems | FL Name,FolderAndSubfolderSize,ItemsInFolderAndSubfolders
```

Запустите следующую команду, чтобы получить размер и общее количество элементов в папках и подмостках в папке "Извлекаемые элементы" в архивном почтовом ящике пользователя.

```powershell
Get-MailboxFolderStatistics <username> -FolderScope RecoverableItems -Archive | FL Name,FolderAndSubfolderSize,ItemsInFolderAndSubfolders
```

## <a name="step-6-revert-the-mailbox-to-its-previous-state"></a>Шаг 6. Повторное повторное состояние почтового ящика в прежнем состоянии

Последний шаг — вернуть почтовый ящик в предыдущую конфигурацию. Это означает сброс свойств, которые были изменены в шаге 2, и повторное повторное его удаление в шаге 3. К ним относятся:
  
- Изменение периода хранения удаленных элементов на прежнее значение. Кроме того, вы можете просто оставить этот набор до 30 дней, максимальное значение в Exchange Online.

- Повторное включение восстановления одного элемента.

- Повторное включение методов клиентского доступа, чтобы владелец может получить доступ к своему почтовому ящику.

- Повторное присвоение исключенных политик хранения и удержания.

- Повторное включение помощника управляемых папок для обработки почтового ящика.

> [!IMPORTANT]
> Рекомендуется подождать 24 часа после повторного применения политики удержания или хранения (и проверки ее на месте), прежде чем повторно включить помощника управляемых папок для обработки почтового ящика.
  
Выполните следующие действия (в указанной последовательности) в Exchange Online PowerShell.
  
1. Запустите следующую команду, чтобы изменить период хранения удаленных элементов на исходное значение. Это предполагает, что предыдущий параметр составляет менее 30 дней; например, 14 дней.

    ```powershell
    Set-Mailbox <username> -RetainDeletedItemsFor 14
    ```

2. Запустите следующую команду, чтобы повторно включить восстановление одного элемента.

    ```powershell
    Set-Mailbox <username> -SingleItemRecoveryEnabled $true
    ```

3. Запустите следующую команду, чтобы повторно включить все методы клиентского доступа к почтовому ящику.

    ```powershell
    Set-CASMailbox <username> -EwsEnabled $true -ActiveSyncEnabled $true -MAPIEnabled $true -OWAEnabled $true -ImapEnabled $true -PopEnabled $true
    ```

4. Повторное повторное удаление удерживает в шаге 3. В зависимости от типа удержания используйте одну из следующих процедур.

    **Судебное удержание**

    Запустите следующую команду, чтобы повторно включить удержание судебного разбирательства для почтового ящика.

    ```powershell
    Set-Mailbox <username> -LitigationHoldEnabled $true
    ```

    **In-Place Hold**

    Используйте EAC (или Exchange Online PowerShell), чтобы добавить почтовый ящик обратно в In-Place Удержание.

    **Политики хранения, применяемые к определенным почтовым ящикам**

    Используйте Центр & безопасности, чтобы добавить почтовый ящик обратно в политику хранения. Перейдите на страницу Хранения управления информацией в Центре & безопасности, отредактируете политику хранения и добавьте почтовый ящик обратно в список получателей, к которые применяется политика  >   хранения.

    **Политики хранения на всей организации**

    Если вы удалили политику хранения на всей организации или в Exchange, исключив ее из политики, используйте Центр соответствия требованиям & безопасности для удаления почтового ящика из списка исключенных пользователей. Перейдите на страницу Хранения управления информацией в Центре & безопасности, отредактируете политику хранения по всей организации и удалите почтовый ящик из списка исключенных  >   получателей. Это повторно привносят политику хранения в почтовый ящик пользователя.

    **дело об обнаружении электронных обнаружений**

    Используйте Центр & безопасности, чтобы добавить почтовый ящик обратно в удержание, связанное с делом об обнаружении электронных данных. Перейдите на **страницу eDiscovery**  >  **eDiscovery,** откройте дело и добавьте почтовый ящик обратно в удержание. 

5. Запустите следующую команду, чтобы помощник управляемой папки снова обработать почтовый ящик. Как уже говорилось ранее, рекомендуется подождать 24 часа после повторной проверки политики удержания или хранения (и проверки ее на месте), прежде чем снова включить помощник управляемой папки.

    ```powershell
    Set-Mailbox <username> -ElcProcessingDisabled $false
    ```

6. Чтобы убедиться, что почтовый ящик вернулся к предыдущей конфигурации, можно выполнить следующие команды, а затем сравнить параметры с настройками, собранными в шаге 1.

    ```powershell
    Get-Mailbox <username> | FL ElcProcessingDisabled,InPlaceHolds,LitigationHoldEnabled,RetainDeletedItemsFor,SingleItemRecoveryEnabled
    ```

    ```powershell
    Get-CASMailbox <username> | FL EwsEnabled,ActiveSyncEnabled,MAPIEnabled,OWAEnabled,ImapEnabled,PopEnabled
    ```

## <a name="more-information"></a>Дополнительная информация

Вот таблица, в которую описывается, как определить различные типы удержаний на основе значений в свойстве *InPlaceHolds* при запуске комлетов **Get-Mailbox** или **Get-OrganizationConfig.** Дополнительные сведения см. в [примере How to identify the type of hold placed on an Exchange Online mailbox.](identify-a-hold-on-an-exchange-online-mailbox.md)

Как уже объяснялось ранее, необходимо удалить все политики хранения и хранения из почтового ящика, прежде чем успешно удалить элементы в папке "Извлекаемые элементы".
  
| Тип удержания | Пример значения | Определение удержания |
|:-----|:-----|:-----|
|Хранение для судебного разбирательства  <br/> | `True` <br/> |Свойство  *LitigationHoldEnabled*  имеет значение  `True`.  <br/> |
|Хранение на месте  <br/> | `c0ba3ce811b6432a8751430937152491` <br/> |Свойство  *InPlaceHolds*  содержит GUID In-Place удержания, размещенного на почтовом ящике. Вы можете сказать, что это In-Place, так как GUID не начинается с префикса.  <br/> Вы можете использовать команду в Exchange Online PowerShell, чтобы получить сведения о In-Place  `Get-MailboxSearch -InPlaceHoldIdentity <hold GUID> | FL` удержания в почтовом ящике.  <br/> |
| Политики хранения в Центре & безопасности применяются к определенным почтовым ящикам  <br/> | `mbxcdbbb86ce60342489bff371876e7f224` <br/> или  <br/>  `skp127d7cf1076947929bf136b7a2a8c36f` <br/> |При запуске **комлета Get-Mailbox** свойство  *InPlaceHolds*  также содержит GUID-политики хранения, применяемые к почтовому ящику. Политики хранения можно определить, так как GUID начинается с  `mbx` префикса. Если GUID политики хранения начинается с префикса, это указывает на то, что политика хранения применяется к беседам  `skp` Skype для бизнеса.  <br/> Для идентификации политики хранения, применяемой к почтовому ящику, запустите следующую команду в центре & PowerShell: <br/> <br/>`Get-RetentionCompliancePolicy <retention policy GUID without prefix> | FL Name`<br/><br/>Не забудьте удалить префикс  `mbx` или  `skp` при выполнении этой команды.  <br/> |
|Политики хранения на всей организации в Центре & безопасности  <br/> |Нет значения  <br/> или  <br/>  `-mbxe9b52bf7ab3b46a286308ecb29624696` (указывает, что почтовый ящик исключен из политики всей организации)  <br/> |Даже если свойство  *InPlaceHolds*  пусто при запуске комлета **Get-Mailbox,** к почтовому ящику по-прежнему может применяться одна или несколько политик хранения по всей организации.  <br/> Чтобы убедиться в этом, можно запустить команду в Exchange Online PowerShell, чтобы получить список GUID-политик хранения для всей  `Get-OrganizationConfig | FL InPlaceHolds` организации. GUID для политик хранения для всей организации, применяемых к почтовым ящикам Exchange, начинается с  `mbx` префикса; например  `mbxa3056bb15562480fadb46ce523ff7b02` .  <br/> Для идентификации политики хранения в рамках всей организации, применяемой к почтовому ящику, запустите следующую команду в центре & powerShell: <br/><br/> `Get-RetentionCompliancePolicy <retention policy GUID without prefix> | FL Name`<br/><br/>Если почтовый ящик исключен из политики хранения по всей организации, GUID для политики хранения отображается в свойстве  *InPlaceHolds*  почтового ящика пользователя при запуске cmdlet **Get-Mailbox;** она определена префиксом;  `-mbx` например,  `-mbxe9b52bf7ab3b46a286308ecb29624696` <br/> |
|Удержание дела об обнаружении электронных данных в Центре & безопасности  <br/> | `UniH7d895d48-7e23-4a8d-8346-533c3beac15d` <br/> |Свойство  *InPlaceHolds*  также содержит GUID любого удержания, связанного с делом об обнаружении электронных данных в центре & безопасности, которые могут быть размещены в почтовом ящике. То, что это удержание по делу обнаружения электронных данных, можно понять по префиксу GUID  `UniH`.  <br/> Для получения сведений о случае, связанном с электронным открытием, с удержанием в почтовом ящике можно использовать & Центра обеспечения безопасности  `Get-CaseHoldPolicy` PowerShell. Например, можно запустить команду, чтобы отобразить имя удержания кейса, которое  `Get-CaseHoldPolicy <hold GUID without prefix> | FL Name` есть в почтовом ящике. Be sure to remove the  `UniH` при выполнении этой команды.  <br/><br/> Для идентификации дела об обнаружении электронных данных, с чем связан удержание в почтовом ящике, запустите следующие команды:<br/><br/>`$CaseHold = Get-CaseHoldPolicy <hold GUID without prefix>`<br/><br/>`Get-ComplianceCase $CaseHold.CaseId | FL Name`