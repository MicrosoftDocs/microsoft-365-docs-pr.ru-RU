---
title: Удаление элементов в папке "Элементы с возможностью восстановления" на удержании облачного почтового ящика
f1.keywords:
- NOCSH
ms.author: markjjo
author: markjjo
manager: laurawi
audience: Admin
ms.topic: article
ms.service: O365-seccomp
localization_priority: Normal
ms.collection:
- Strat_O365_IP
- M365-security-compliance
search.appverid:
- MOE150
- MET150
ms.assetid: a85e1c87-a48e-4715-bfa9-d5275cde67b0
description: Узнайте, как администраторы могут удалять элементы в папке пользователя "Элементы с возможностью восстановления" для почтового ящика Exchange Online, даже если этот почтовый ящик помещен на удержание по юридическим основаниям.
ms.custom: seo-marvel-apr2020
ms.openlocfilehash: c7a51a78280885a8a7aa7c65a0c04110b46ed7f0
ms.sourcegitcommit: d7975c391e03eeb96e29c1d02e77d2a1433ea67c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/05/2020
ms.locfileid: "48919959"
---
# <a name="delete-items-in-the-recoverable-items-folder-of-cloud-based-mailboxes-on-hold"></a>Удаление элементов в папке "Элементы с возможностью восстановления" облачных почтовых ящиков на удержании

Папка "Элементы с возможностью восстановления" для почтового ящика Exchange Online существует для защиты от случайного или злонамеренного удаления. Он также используется для хранения элементов, которые хранятся и доступны с помощью функций соответствия, таких как удержания и поиск eDiscovery. Однако в некоторых ситуациях у организаций могут быть данные, которые непреднамеренно сохраняются в папке "Элементы с возможностью восстановления", которую необходимо удалить. Например, пользователь может непреднаправиво отправить или переслать сообщение электронной почты, которое содержит конфиденциальную информацию или сведения, которые могут иметь серьезные бизнес-последствия. Даже если сообщение окончательно удалено, оно может храниться неопределенное время, так как к почтовому ящику было поставлено удержание по юридическим основаниям. Этот сценарий называется *утечкой данных,* так как данные непреднамеренно были выгружаются *в* Office 365. В таких ситуациях можно удалять элементы из папки пользователя "Элементы с возможностью восстановления" для почтового ящика Exchange Online, даже если этот почтовый ящик помещен на удержание с одной из функций удержания в Office 365. К таким типам удержаний относятся хранение для судебного разбирательства, In-Place удержания, удержания eDiscovery и политики хранения, созданные в Центре безопасности и соответствия требованиям в Office 365 или Microsoft 365.
  
 В этой статье объясняется, как администраторы могут удалять элементы из папки "Элементы с возможностью восстановления" для облачных почтовых ящиков, которые находятся на удержании. Эта процедура включает отключение доступа к почтовому ящику и восстановление одного элемента, отключение обработки почтового ящика помощником для управляемых папок, временное снятие удержания, удаление элементов из папки "Элементы с возможностью восстановления" и восстановление почтового ящика до предыдущей конфигурации. Вот как это происходит:
  
[Шаг 1. Сбор сведений о почтовом ящике](#step-1-collect-information-about-the-mailbox)

[Шаг 2. Подготовка почтового ящика](#step-2-prepare-the-mailbox)

[Шаг 3. Удаление всех приохивок из почтового ящика](#step-3-remove-all-holds-from-the-mailbox)

[Шаг 4. Удаление удержания задержки для почтового ящика](#step-4-remove-the-delay-hold-from-the-mailbox)

[Шаг 5. Удаление элементов в папке "Элементы с возможностью восстановления"](#step-5-delete-items-in-the-recoverable-items-folder)

[Шаг 6. Выверка почтового ящика в предыдущее состояние](#step-6-revert-the-mailbox-to-its-previous-state)
  
> [!CAUTION]
> Описанные в этой статье процедуры при окончательном удалении (удалении) данных из почтового ящика Exchange Online. Это означает, что сообщения, удаляемые из папки "Элементы с возможностью восстановления", не могут быть восстановлены и не будут доступны для юридического обнаружения или обеспечения соответствия требованиям. Если вы хотите удалить сообщения из почтового ящика, помещенного на удержание в рамках хранения для судебного разбирательства, удержания In-Place, удержания eDiscovery или политики хранения, созданной в Центре безопасности и соответствия требованиям, перед снятием удержания обратитесь к управлению записями или юридическим отделам. В вашей организации может быть политика, которая определяет, имеет ли почтовый ящик на удержании или инцидент утечки данных приоритет.
  
## <a name="before-you-delete-items"></a>Перед удалением элементов

- Создавать и выполнять поиск контента могут только члены группы ролей "Диспетчер eDiscovery" и пользователи с ролью "Управление поиском соответствия". Удалять сообщения могут только члены группы ролей "Управление организацией" и пользователи с ролью "Управление поиском и очисткой". Сведения о добавлении пользователей в группу ролей см. в статье [Назначение разрешений обнаружения электронных данных в Центре безопасности и соответствия требованиям](https://docs.microsoft.com/microsoft-365/compliance/assign-ediscovery-permissions).

- Процедура, описанная в этой статье, не поддерживается для неактивных почтовых ящиков. Это потому, что вы не можете повторно прикрепить удержание (или политику хранения) к неактивному почтовому ящику после его удаления. При удалении удержания для неактивного почтового ящика он меняется на обычный почтовый ящик с возможностью мягкого удаления и будет окончательно удален из организации после его обработки помощником для управляемых папок.

- Эту процедуру нельзя выполнить для почтового ящика, для который были назначены параметры хранения с политикой, заблокированной с помощью блокировки хранения. Это происходит потому, что эта блокировка предотвращает удаление или исключение почтового ящика из политики и отключение помощника для управляемых папок в почтовом ящике. Дополнительные сведения о блокировке политик хранения см. в этой теме, чтобы ограничить изменения в политиках хранения и политиках [меток хранения.](retention-preservation-lock.md)

- Если почтовый ящик не помещен на удержание (или восстановление одного элемента не включено), вы можете удалить элементы из папки "Элементы с возможностью восстановления". Дополнительные сведения о том, как это сделать, см. в поиске и удалении сообщений электронной почты [в организации.](https://docs.microsoft.com/microsoft-365/compliance/search-for-and-delete-messages-in-your-organization)
  
## <a name="step-1-collect-information-about-the-mailbox"></a>Шаг 1. Сбор сведений о почтовом ящике

Сначала необходимо собрать выбранные свойства из целевого почтового ящика, которые повлияют на эту процедуру. Обязательно запишите эти параметры или сохраните их в текстовом файле, так как вы измените некоторые из этих свойств, а затем восстановите исходные значения на шаге 6 после удаления элементов из папки "Элементы с возможностью восстановления". Вот список свойств почтового ящика, которые необходимо собрать.
  
- *SingleItemRecoveryEnabled*  и  *RetainDeletedItemsFor*. При необходимости вы отключим одно восстановление и увеличите срок хранения удаленных элементов в шаге 3.

- *LitigationHoldEnabled* и *InPlaceHolds.* Необходимо определить все приостановки для почтового ящика, чтобы можно было временно удалить их в шаге 3. Советы [по идентификации](#more-information) типа удержания, которое может быть помещено в почтовый ящик, см. в разделе "Дополнительные сведения".

Кроме того, необходимо получить параметры клиентского доступа к почтовым ящикам, чтобы их можно было временно отключить, чтобы владелец (или другие пользователи) не мог получить доступ к почтовому ящику во время этой процедуры. Наконец, можно получить текущий размер и количество элементов в папке "Элементы с восстановления". После удаления элементов в папке "Элементы с возможностью восстановления" на шаге 5 эти сведения используются для проверки удаления элементов.
  
1. [Подключение к PowerShell для Exchange Online](https://go.microsoft.com/fwlink/?linkid=396554). Обязательно используйте имя пользователя и пароль для учетной записи администратора, которая назначена соответствующим ролям управления в Exchange Online.

2. Чтобы получить сведения о восстановлении одного элемента и периоде хранения удаленных элементов, запустите следующую команду.

    ```powershell
    Get-Mailbox <username> | FL SingleItemRecoveryEnabled,RetainDeletedItemsFor
    ```

   Если восстановление отдельного элемента включено, его необходимо отключить на шаге 2. Если период хранения удаленных элементов не установлен в течение 30 дней (максимальное значение в Exchange Online), вы можете увеличить его на шаге 2.

3. Чтобы получить параметры доступа к почтовому ящику, запустите следующую команду.

    ```powershell
    Get-CASMailbox <username> | FL EwsEnabled,ActiveSyncEnabled,MAPIEnabled,OWAEnabled,ImapEnabled,PopEnabled
    ```

   Все эти методы доступа будут отключены на шаге 2.

4. Чтобы получить сведения о политиках удержания и хранения, примененных к почтовому ящику, запустите следующую команду.

    ```powershell
    Get-Mailbox <username> | FL LitigationHoldEnabled,InPlaceHolds
    ```

   > [!TIP]
    > Если в свойстве  *InPlaceHolds*  слишком много значений и отображаются не все из них, можно выполнить команду, чтобы отобразить каждое значение в  `Get-Mailbox <username> | Select-Object -ExpandProperty InPlaceHolds` отдельной строке.
  
5. Чтобы получить сведения о политиках хранения для всей организации, запустите следующую команду. 

    ```powershell
    Get-OrganizationConfig | FL InPlaceHolds
    ```

   Если в организации есть какие-либо политики хранения для всей организации, вам придется исключить почтовый ящик из этих политик на шаге 3.

   > [!TIP]
    > Если в свойстве  *InPlaceHolds*  слишком много значений и отображаются не все из них, можно выполнить команду, чтобы отобразить каждое значение в  `Get-OrganizationConfig | Select-Object -ExpandProperty InPlaceHolds` отдельной строке. 
  
6. Чтобы получить текущий размер и общее количество элементов в папках и вложенных папках в папке "Элементы с возможностью восстановления" основного почтового ящика пользователя, запустите следующую команду.

    ```powershell
    Get-MailboxFolderStatistics <username> -FolderScope RecoverableItems | FL Name,FolderAndSubfolderSize,ItemsInFolderAndSubfolders
    ```

   Если архивный почтовый ящик пользователя включен, запустите следующую команду, чтобы получить размер и общее количество элементов в папках и вложенных папках в папке "Элементы с возможностью восстановления" в архивном почтовом ящике. 

    ```powershell
    Get-MailboxFolderStatistics <username> -FolderScope RecoverableItems -Archive | FL Name,FolderAndSubfolderSize,ItemsInFolderAndSubfolders
    ```

   При удалении элементов на шаге 5 вы можете удалить или не удалять элементы в папке "Элементы с возможностью восстановления" основного архивного почтового ящика пользователя. Если для почтового ящика включено автоматическое расширение архива, элементы вспомогательного архивного почтового ящика не удаляются.
  
## <a name="step-2-prepare-the-mailbox"></a>Шаг 2. Подготовка почтового ящика

После сбора и сохранения сведений о почтовом ящике необходимо подготовить почтовый ящик, выполв следующие задачи:
  
- **Отключать клиентский доступ** к почтовому ящику, чтобы владелец почтового ящика не мог получить доступ к своему почтовому ящику и внести изменения в данные почтового ящика во время этой процедуры.

-  Повысьте срок хранения удаленных элементов до 30 дней (максимальное значение в Exchange Online), чтобы элементы не удалялись из папки "Элементы с возможностью восстановления", прежде чем вы сможете удалить их на шаге 5.

- **Отключите** восстановление одного элемента, чтобы элементы не сохранялись (в течение периода хранения удаленных элементов) после их удаления из папки "Элементы с возможностью восстановления" на шаге 5.

- **Отключите помощник для** управляемых папок, чтобы он не обработал почтовый ящик и не сохранял элементы, которые вы удалили на шаге 5.

Выполните следующие действия в Exchange Online PowerShell.
  
1. Чтобы отключить весь клиентский доступ к почтовому ящику, запустите следующую команду. Синтаксис команды предполагает, что для почтового ящика включены все методы клиентского доступа.

    ```powershell
    Set-CASMailbox <username> -EwsEnabled $false -ActiveSyncEnabled $false -MAPIEnabled $false -OWAEnabled $false -ImapEnabled $false -PopEnabled $false
    ```

   > [!NOTE]
    > Отключение всех методов клиентского доступа к почтовому ящику может занять до 60 минут. Обратите внимание, что отключение этих методов доступа не отключает владельца почтового ящика, в который он в данный момент входил. Если владелец не вошел, он не сможет получить доступ к своему почтовому ящику после отключения этих методов доступа.
  
2. Чтобы увеличить срок хранения удаленных элементов до 30 дней, запустите следующую команду. Это предполагает, что текущий параметр меньше 30 дней.

    ```powershell
    Set-Mailbox <username> -RetainDeletedItemsFor 30
    ```

3. Чтобы отключить восстановление одного элемента, запустите следующую команду.

    ```powershell
    Set-Mailbox <username> -SingleItemRecoveryEnabled $false
    ```

   > [!NOTE]
    > Отключение восстановления одного элемента может занять до 60 минут. Не удаляйте элементы в папке "Элементы с возможностью восстановления" до окончания этого периода. 
  
4. Чтобы предотвратить обработку почтового ящика помощником для управляемых папок, запустите следующую команду. Как объяснялось ранее, помощник для управляемых папок можно отключить, только если к почтовому ящику не применена политика хранения с блокировкой хранения. 

    ```powershell
    Set-Mailbox <username> -ElcProcessingDisabled $true
    ```

## <a name="step-3-remove-all-holds-from-the-mailbox"></a>Шаг 3. Удаление всех приохивок из почтового ящика

Последним шагом перед удалением элементов из папки "Элементы с возможностью восстановления" является удаление всех приодержки (которые вы определили на шаге 1), размещенные на почтовом ящике. Все удержания необходимо удалить, чтобы элементы не сохранялись после удаления их из папки "Элементы с возможностью восстановления". В следующих разделах содержатся сведения об удалении различных типов снятия с почтового ящика. Советы [по идентификации](#more-information) типа удержания, которое может быть помещено в почтовый ящик, см. в разделе "Дополнительные сведения". Дополнительные сведения см. в сведениях о том, как определить тип удержания для [почтового ящика Exchange Online.](identify-a-hold-on-an-exchange-online-mailbox.md)
  
> [!CAUTION]
> Как было сказано ранее, перед снятием удержания с почтового ящика обратитесь к управлению записями или юридическим отделам. 
  
### <a name="litigation-hold"></a>Хранение для судебного разбирательства
  
Чтобы удалить удержание для судебного разбирательства для почтового ящика, запустите следующую команду в Exchange Online PowerShell.

```powershell
Set-Mailbox <username> -LitigationHoldEnabled $false
```

> [!NOTE]
> Как и отключение методов клиентского доступа и восстановления одного элемента, удаление удержания для судебного разбирательства может занять до 60 минут. Не удаляйте элементы из папки "Элементы с возможностью восстановления" до окончания этого периода. 
  
### <a name="in-place-hold"></a>Хранение на месте
  
Чтобы определить удержание In-Place почтового ящика, в Exchange Online PowerShell запустите следующую команду. Используйте GUID для удержания In-Place, которое вы определили в шаге 1.

```powershell
Get-MailboxSearch -InPlaceHoldIdentity <hold GUID> | FL Name
```

После определения In-Place удержания вы можете удалить почтовый ящик из удержания с помощью Центра администрирования Exchange (EAC) или Exchange Online PowerShell. Дополнительные сведения см. в [этой](https://go.microsoft.com/fwlink/?linkid=852668)In-Place.
  
### <a name="retention-policies-applied-to-specific-mailboxes"></a>Политики хранения, применяемые к определенным почтовым ящикам
  
Чтобы определить политику хранения, применяемую к [почтовому ящику, & PowerShell](https://go.microsoft.com/fwlink/?linkid=627084) в Центре безопасности и соответствия требованиям, запустите следующую команду. Эта команда также возвращает все политики хранения бесед Teams, примененные к почтовому ящику. Используйте GUID (без префикса или префикса) для политики хранения, которую `mbx` `skp` вы определили в шаге 1.

```powershell
Get-RetentionCompliancePolicy <retention policy GUID without prefix> | FL Name
```

После определения политики хранения перейдите на страницу "Хранение управления сведениями" в Центре безопасности и & соответствия требованиям, отредактируете политику хранения, которая была определена на предыдущем шаге, и удалите почтовый ящик из списка получателей, включенных в политику  >   хранения.
  
### <a name="organization-wide-retention-policies"></a>Политики хранения для всей организации
  
Политики хранения для всей организации, Exchange и Teams применяются к каждому почтовому ящику в организации. Они применяются на уровне организации (а не на уровне почтового ящика) и возвращаются при запуске в шаге 1 для **get-OrganizationConfig.** Чтобы определить политики хранения для [всей организации, & PowerShell](https://go.microsoft.com/fwlink/?linkid=627084) в Центре безопасности и соответствия требованиям, запустите следующую команду. Используйте GUID (без префикса) для политик хранения на всей организации, которые вы  `mbx` определили в шаге 1.

```powershell
Get-RetentionCompliancePolicy <retention policy GUID without prefix> | FL Name
```

После определения политик хранения для всей организации перейдите на страницу "Хранение управления сведениями" в Центре безопасности и & соответствия требованиям, отредактируете каждую политику хранения на всей организации, которую вы определили на предыдущем шаге, и добавьте почтовый ящик в список исключенных  >   получателей. Это позволит удалить почтовый ящик пользователя из политики хранения.

### <a name="retention-labels"></a>Метки хранения

Всякий раз, когда пользователь применяет метку, настроенную для сохранения содержимого или сохранения и удаления содержимого в любой папке или элементе в почтовом ящике, свойству *complianceTagHoldApplied* почтового ящика задается **true.** В этом случае почтовый ящик считается на удержании, как если бы он был помещен на хранение для судебного разбирательства или назначен политике хранения.

Чтобы просмотреть значение свойства *ComplianceTagHoldApplied,* в Exchange Online PowerShell запустите следующую команду:

```powershell
Get-Mailbox <username> |FL ComplianceTagHoldApplied
```

После того как вы определили, что почтовый ящик находится на удержании из-за применения метки хранения к папке или элементу, вы можете использовать средство "Поиск контента" в Центре безопасности и соответствия требованиям для поиска помеченных элементов с помощью условия поиска ComplianceTag. Дополнительные сведения см. в разделе "Условия поиска" в разделе "Запросы по ключевым словам и условия поиска [контента".](keyword-queries-and-search-conditions.md#conditions-for-common-properties)

Дополнительные сведения о метах см. в дополнительных сведениях о политиках [хранения и метах хранения.](retention.md)

### <a name="ediscovery-holds"></a>Удержание данных, созданных с помощью обращения обнаружения электронных данных
  
Чтобы определить удержание, связанное с делом eDiscovery (удержание *eDiscovery),* примененным к почтовому ящику, в [PowerShell](https://docs.microsoft.com/powershell/exchange/connect-to-scc-powershell) Центра безопасности и соответствия требованиям, запустите следующие команды в Центре безопасности и соответствия требованиям. & Используйте GUID (не включая префикс) для удержания  `UniH` eDiscovery, которое вы определили в шаге 1. Вторая команда отображает имя дела eDiscovery, с чем связано удержание; Третья команда отображает имя удержания.
  
```powershell
$CaseHold = Get-CaseHoldPolicy <hold GUID without prefix>
```

```powershell
Get-ComplianceCase $CaseHold.CaseId | FL Name
```

```powershell
$CaseHold.Name
```

После того как вы определили имя дела eDiscovery и удержание, перейдите на страницу **eDiscovery** \> **eDiscovery** в Центре соответствия требованиям, откройте дело и удалите почтовый ящик из удержания. Дополнительные сведения об определении удержаний при обнаружении электронных данных см. в разделе "Удержание при обнаружении электронных данных" статьи "Определение типа удержания для почтового ящика [Exchange Online".](identify-a-hold-on-an-exchange-online-mailbox.md#ediscovery-holds)
  
## <a name="step-4-remove-the-delay-hold-from-the-mailbox"></a>Шаг 4. Удаление удержания задержки для почтового ящика

После удаления любого типа удержания из почтового ящика для свойства *delayHoldApplied* или *DelayReleaseHoldApplied почтового* ящика устанавливается значение **True.** Это происходит, когда помощник для управляемых папок в следующий раз обрабатывает почтовый ящик и обнаруживает, что удержание было удалено. Это называется  удержанием задержки и означает, что фактическое удаление удержания откладывается на 30 дней, чтобы данные не удалялись из почтового ящика безвозвращенно. (Отсрочка удержания предназначена для того, чтобы дать администраторам возможность искать или восстанавливать элементы почтового ящика, которые будут удалены после снятия удержания.)  Если для почтового ящика заложено удержание с задержкой, он по-прежнему считается на удержании в течение неограниченного срока, как если бы почтовый ящик был помещен на удержание для судебного разбирательства. По истечении 30 дней срок удержания истекает, и Microsoft 365 автоматически попытается удалить удержание задержки (задав для свойства *DelayHoldApplied* или *DelayReleaseHoldApplied* свойство **False),** чтобы удержание было удалено. Дополнительные сведения о удержании задержки см. в разделе "Управление почтовыми ящиками при удержании задержки" в разделе "Определение типа удержания для почтового ящика [Exchange Online".](identify-a-hold-on-an-exchange-online-mailbox.md#managing-mailboxes-on-delay-hold)

Перед удалением элементов на шаге 5 необходимо удалить удержание задержки для почтового ящика. Сначала определите, применено ли удержание задержки к почтовому ящику, вы можете с помощью следующей команды в Exchange Online PowerShell:

```powershell
Get-Mailbox <username> | FL DelayHoldApplied,DelayReleaseHoldApplied
```

Если для свойства *DelayHoldApplied* или *DelayReleaseHoldApplied* установлено значение **False,** для почтового ящика не было установлено удержание задержки. Вы можете перейти к шагу 5 и удалить элементы в папке "Элементы с возможностью восстановления".

Если для свойства *DelayHoldApplied* или *DelayReleaseHoldApplied* установлено значение **True,** запустите одну из следующих команд, чтобы удалить удержание задержки:

```powershell
Set-Mailbox <username> -RemoveDelayHoldApplied
```

или

```powershell
Set-Mailbox <username> -RemoveDelayReleaseHoldApplied
```

Для использования параметра *RemoveDelayHoldApplied* или *RemoveDelayReleaseHoldApplied* вам должна быть назначена роль удержания по юридическим основаниям в Exchange Online.

## <a name="step-5-delete-items-in-the-recoverable-items-folder"></a>Шаг 5. Удаление элементов в папке "Элементы с возможностью восстановления"

Теперь вы готовы к полному удалите элементы в папке "Элементы с [](https://docs.microsoft.com/powershell/module/exchange/new-compliancesearchaction) возможностью восстановления" с помощью новых и новых пунктов соответствия требованиям в PowerShell Центра безопасности & соответствия требованиям. [](https://docs.microsoft.com/powershell/module/exchange/new-compliancesearch)

Для поиска элементов, расположенных в папке "Элементы с возможностью восстановления", рекомендуется выполнить целевую *коллекцию.* Это означает, что область поиска сужается только до элементов, расположенных в папке "Элементы с возможностью восстановления". Для этого можно воспользоваться сценарием в статье "Использование поиска контента [для целевых](use-content-search-for-targeted-collections.md) коллекций". Этот сценарий возвращает значение свойства ИД папки для всех вложенных папок в целевой папке "Элементы с восстановления". Затем с помощью ИД папки в поисковом запросе возвращаются элементы, расположенные в этой папке.

Ниже представлен обзор процесса поиска и удаления элементов в папке "Элементы с возможностью восстановления" пользователя.

1. Запустите сценарий целевой коллекции, который возвращает ИД всех папок в почтовом ящике целевого пользователя. Сценарий подключается к Exchange Online PowerShell и PowerShell & безопасности и соответствия требованиям PowerShell в одном сеансе PowerShell. Дополнительные сведения см. в сценарии запуска, чтобы получить список папок [для почтового ящика.](use-content-search-for-targeted-collections.md#step-1-run-the-script-to-get-a-list-of-folders-for-a-mailbox-or-site)

2. Скопируйте ИД всех вложенных папок в папке "Элементы с восстановления". Кроме того, вы можете перенаправить выходные данные сценария в текстовый файл.

   Вот список и описание вложенных папок в папке "Элементы с возможностью восстановления", в которые можно искать и удалять элементы:

   - **Удаления:** содержит элементы, срок хранения удаленных элементов которых еще не истек. Пользователи могут восстанавливать элементы из этой вданной ветви с помощью средства восстановления удаленных элементов в Outlook.

   - **Очистка:** содержит элементы, срок хранения удаленных элементов которых истек. Пользователи также могут жестко удалять элементы, удаляя их из папки "Элементы с возможностью восстановления". Если почтовый ящик находится на удержании, неутвердимые элементы сохраняются. Эта ветвь не видна конечным пользователям.

   - **DiscoveryHolds**: содержит неуратно удаленные элементы, которые были сохранены удержанием обнаружения электронных данных или политикой хранения. Эта ветвь не видна конечным пользователям.

   - **SubstrateHolds**: содержит элементы, удаленные из Teams и других облачных приложений, которые были сохранены политикой хранения или другим типом удержания. Эта ветвь не видна конечным пользователям.

3. Используйте **cmdlet New-ComplianceSearch** & (в PowerShell Центра безопасности и соответствия требованиям) или используйте средство поиска контента в Центре соответствия требованиям, чтобы создать поиск контента, который возвращает элементы из папки целевого пользователя "Элементы с возможностью восстановления". Это можно сделать, включив FolderId в поисковый запрос для всех вложенных папок, которые нужно найти. Например, следующий запрос возвращает все сообщения во владок Purges и eDiscoveryHolds:

   ```text
   folderid:<folder ID of Purges subfolder> OR folderid:<folder ID of DiscoveryHolds subfolder>
   ```

   Дополнительные сведения и примеры выполнения поиска контента с использованием свойства "ИД папки" см. в примере использования ИД папки или выполнения [целевой коллекции.](use-content-search-for-targeted-collections.md#step-2-use-a-folder-id-or-documentlink-to-perform-a-targeted-collection)

   > [!NOTE]
   > Если для поиска в папке "Элементы с возможностью восстановления" используется cmdlet **New-ComplianceSearch,** обязательно используйте для запуска поиска с помощью **start-ComplianceSearch.**

4. После создания поиска контента и проверки того, что он возвращает элементы, которые необходимо удалить, используйте команду `New-ComplianceSearchAction -Purge -PurgeType HardDelete` & (в PowerShell Центра безопасности и соответствия требованиям), чтобы окончательно удалить элементы, возвращенные в результате поиска контента, созданного на предыдущем шаге. Например, можно выполнить команду, аналогичную следующей:

   ```powershell
   New-ComplianceSearchAction -SearchName "RecoverableItems" -Purge -PurgeType HardDelete
   ```

5. При запуске предыдущей команды удаляется не более 10 элементов на почтовый ящик. Это означает, что может потребоваться выполнить команду несколько раз, чтобы удалить все элементы, которые нужно удалить в папке "Элементы с возможностью `New-ComplianceSearchAction -Purge` восстановления". Чтобы удалить дополнительные элементы, сначала необходимо удалить предыдущее действие по очистке поиска соответствия. Это можно сделать с помощью `Remove-ComplianceSearchAction` запуска этого cmdlet. Например, чтобы удалить действие очистки, которое было выполнить на предыдущем шаге, запустите следующую команду:

   ```powershell
   Remove-ComplianceSearchAction "RecoverableItems_Purge"
   ```

   После этого можно создать новое действие очистки поиска соответствия для удаления дополнительных элементов. Перед созданием нового действия необходимо удалить каждое действие очистки.

   Чтобы получить список действий поиска для обеспечения соответствия требованиям, вы можете запустить `Get-ComplianceSearchAction` его. Действия очистки идентифицированы `_Purge` по имени поиска.

### <a name="verify-that-items-were-deleted"></a>Проверка удаления элементов

Чтобы убедиться, что вы успешно удалили элементы из папки "Элементы с возможностью восстановления" почтового ящика, проверьте размер и количество элементов в папке "Элементы с возможностью восстановления" с помощью cmdlet **Get-MailboxFolderStatistics** в Exchange Online PowerShell. Вы можете сравнить эти статистические данные с статистикой, собранной на шаге 1.
  
Чтобы получить текущий размер и общее количество элементов в папках и вложенных папках в папке "Элементы с возможностью восстановления" основного почтового ящика пользователя, запустите следующую команду.
  
```powershell
Get-MailboxFolderStatistics <username> -FolderScope RecoverableItems | FL Name,FolderAndSubfolderSize,ItemsInFolderAndSubfolders
```

Чтобы получить размер и общее количество элементов в папках и вложенных папках в папке "Элементы с возможностью восстановления" в архивном почтовом ящике пользователя, запустите следующую команду.

```powershell
Get-MailboxFolderStatistics <username> -FolderScope RecoverableItems -Archive | FL Name,FolderAndSubfolderSize,ItemsInFolderAndSubfolders
```

## <a name="step-6-revert-the-mailbox-to-its-previous-state"></a>Шаг 6. Выверка почтового ящика в предыдущее состояние

Последний шаг — вернуть почтовый ящик к предыдущей конфигурации. Это означает сброс свойств, которые были изменены на шаге 2, и повторное присвоение исключенных в шаге 3 удерживания. К ним относятся:
  
- Изменение периода хранения удаленных элементов на предыдущее значение. Кроме того, можно просто оставить для этого значения значение 30 дней ( максимальное значение в Exchange Online).

- Повторное включение восстановления одного элемента.

- Повторное включение методов клиентского доступа, чтобы владелец могли получить доступ к своему почтовому ящику.

- Повторное присвоение политик удержаний и хранения, которые вы удалили.

- Повторное включение помощника для управляемых папок для обработки почтового ящика.

> [!IMPORTANT]
> Рекомендуется подождать 24 часа после повторного применения политики удержания или хранения (и проверки ее на месте), прежде чем повторно включить помощник для управляемых папок для обработки почтового ящика.
  
Выполните следующие действия (в указанной последовательности) в Exchange Online PowerShell.
  
1. Чтобы вернуть исходное значение периода хранения удаленных элементов, запустите следующую команду. Это предполагает, что предыдущий параметр составляет менее 30 дней; например, 14 дней.

    ```powershell
    Set-Mailbox <username> -RetainDeletedItemsFor 14
    ```

2. Чтобы повторно включить восстановление одного элемента, запустите следующую команду.

    ```powershell
    Set-Mailbox <username> -SingleItemRecoveryEnabled $true
    ```

3. Чтобы повторно включить все методы клиентского доступа к почтовому ящику, запустите следующую команду.

    ```powershell
    Set-CASMailbox <username> -EwsEnabled $true -ActiveSyncEnabled $true -MAPIEnabled $true -OWAEnabled $true -ImapEnabled $true -PopEnabled $true
    ```

4. Повторно примещать удерживает, которые вы удалили в шаге 3. В зависимости от типа удержания используйте одну из следующих процедур.

    **Судебное удержание**

    Чтобы повторно включить удержание для судебного разбирательства для почтового ящика, запустите следующую команду.

    ```powershell
    Set-Mailbox <username> -LitigationHoldEnabled $true
    ```

    **In-Place Hold**

    Используйте EAC (или Exchange Online PowerShell) для добавления почтового ящика в режим удержания In-Place.

    **Политики хранения, применяемые к определенным почтовым ящикам**

    Используйте Центр безопасности & соответствия требованиям, чтобы добавить почтовый ящик обратно в политику хранения. Перейдите на страницу "Хранение управления сведениями" в Центре безопасности & соответствия требованиям, отредактируете политику хранения и добавьте почтовый ящик обратно в список получателей, к которые применяется политика  >   хранения.

    **Политики хранения для всей организации**

    Если вы удалили политику хранения для всей организации или Exchange, исключив ее из политики, используйте Центр безопасности и соответствия требованиям & для удаления почтового ящика из списка исключенных пользователей. Перейдите на страницу "Хранение управления сведениями" в Центре безопасности & соответствия требованиям, отредактируете политику хранения для всей организации и удалите почтовый ящик из списка  >   исключенных получателей. Это позволит повторно прикрепить политику хранения к почтовому ящику пользователя.

    **Дела eDiscovery**

    С помощью Центра & соответствия требованиям добавьте к почтовому ящику удержание, связанное с делом eDiscovery. Перейдите на **страницу eDiscovery**  >  **eDiscovery,** откройте дело и добавьте почтовый ящик обратно в удержание. 

5. Чтобы разрешить помощнику для управляемых папок повторно обработать почтовый ящик, запустите следующую команду. Как было сказано ранее, рекомендуется подождать 24 часа после повторного охранения или политики хранения (и проверки ее на месте), прежде чем снова включить помощник для управляемых папок.

    ```powershell
    Set-Mailbox <username> -ElcProcessingDisabled $false
    ```

6. Чтобы убедиться, что почтовый ящик был снова отправлен в предыдущую конфигурацию, можно выполнить следующие команды, а затем сравнить параметры с настройками, собранными на шаге 1.

    ```powershell
    Get-Mailbox <username> | FL ElcProcessingDisabled,InPlaceHolds,LitigationHoldEnabled,RetainDeletedItemsFor,SingleItemRecoveryEnabled
    ```

    ```powershell
    Get-CASMailbox <username> | FL EwsEnabled,ActiveSyncEnabled,MAPIEnabled,OWAEnabled,ImapEnabled,PopEnabled
    ```

## <a name="more-information"></a>Дополнительные сведения

В таблице ниже описано, как определить различные типы удержаний на основе значений в свойстве *InPlaceHolds* при запускелетов **Get-Mailbox** или **Get-OrganizationConfig.** Дополнительные сведения см. в описании типа удержания для почтового [ящика Exchange Online.](identify-a-hold-on-an-exchange-online-mailbox.md)

Как объяснялось ранее, необходимо удалить все политики удержания и хранения из почтового ящика, чтобы успешно удалить элементы в папке "Элементы с возможностью восстановления".
  
| Тип удержания | Пример значения | Определение удержания |
|:-----|:-----|:-----|
|Хранение для судебного разбирательства  <br/> | `True` <br/> |Свойство  *LitigationHoldEnabled*  имеет значение  `True`.  <br/> |
|Хранение на месте  <br/> | `c0ba3ce811b6432a8751430937152491` <br/> |Свойство  *InPlaceHolds*  содержит GUID In-Place удержания, которое помещено в почтовый ящик. Вы можете сказать, что это In-Place, так как GUID не начинается с префикса.  <br/> Вы можете использовать команду в Exchange Online PowerShell, чтобы получить сведения о In-Place  `Get-MailboxSearch -InPlaceHoldIdentity <hold GUID> | FL` удержания для почтового ящика.  <br/> |
| Политики хранения в Центре безопасности & соответствия требованиям, применяемые к определенным почтовым ящикам  <br/> | `mbxcdbbb86ce60342489bff371876e7f224` <br/> или  <br/>  `skp127d7cf1076947929bf136b7a2a8c36f` <br/> |При запуске **cmdlet Get-Mailbox** свойство  *InPlaceHolds*  также содержит КОДЫ ПОЛИТИК хранения, применяемых к почтовому ящику. Политики хранения можно определить, так как GUID начинается с  `mbx` префикса. Если GUID политики хранения начинается с префикса, это означает, что политика хранения применяется к беседам  `skp` Skype для бизнеса.  <br/> Для идентификации политики хранения, применяемой к почтовому ящику, в PowerShell Центра безопасности & запустите следующую команду: <br/> <br/>`Get-RetentionCompliancePolicy <retention policy GUID without prefix> | FL Name`<br/><br/>Не забудьте удалить префикс  `mbx` или  `skp` при выполнении этой команды.  <br/> |
|Политики хранения для всей организации в Центре безопасности & соответствия требованиям  <br/> |Нет значения  <br/> или  <br/>  `-mbxe9b52bf7ab3b46a286308ecb29624696` (указывает, что почтовый ящик исключен из политики всей организации)  <br/> |Даже если свойство  *InPlaceHolds*  пустое при запуске **cmdlet Get-Mailbox,** к почтовому ящику может применяться одна или несколько политик хранения для всей организации.  <br/> Чтобы проверить это, можно выполнить команду в Exchange Online PowerShell, чтобы получить список GUID для политик хранения на всей  `Get-OrganizationConfig | FL InPlaceHolds` организации. GUID политик хранения для всей организации, применяемых к почтовым ящикам Exchange, начинается с префикса, например  `mbx`  `mbxa3056bb15562480fadb46ce523ff7b02` .  <br/> Для идентификации политики хранения на всей организации, применяемой к почтовому ящику &, в PowerShell Центра безопасности и соответствия требованиям запустите следующую команду: <br/><br/> `Get-RetentionCompliancePolicy <retention policy GUID without prefix> | FL Name`<br/><br/>Если почтовый ящик исключен из политики хранения для всей организации, GUID для политики хранения отображается в свойстве  *InPlaceHolds*  почтового ящика пользователя при запуске cmdlet **Get-Mailbox;** он определен префиксом;  `-mbx` например,  `-mbxe9b52bf7ab3b46a286308ecb29624696` <br/> |
|Удержание дела eDiscovery в Центре безопасности & соответствия требованиям  <br/> | `UniH7d895d48-7e23-4a8d-8346-533c3beac15d` <br/> |Свойство  *InPlaceHolds*  также содержит GUID любого удержания, связанного с делом eDiscovery в Центре безопасности & соответствия требованиям, которые могут быть помещены в почтовый ящик. То, что это удержание по делу обнаружения электронных данных, можно понять по префиксу GUID  `UniH`.  <br/> Вы можете использовать этот & PowerShell в Центре безопасности и соответствия требованиям, чтобы получить сведения о деле eDiscovery, с чем связано удержание почтового  `Get-CaseHoldPolicy` ящика. Например, можно выполнить команду, чтобы отобразить имя удержания дела в  `Get-CaseHoldPolicy <hold GUID without prefix> | FL Name` почтовом ящике. Be sure to remove the  `UniH` при выполнении этой команды.  <br/><br/> Для идентификации дела eDiscovery, с которое связано удержание почтового ящика, запустите следующие команды:<br/><br/>`$CaseHold = Get-CaseHoldPolicy <hold GUID without prefix>`<br/><br/>`Get-ComplianceCase $CaseHold.CaseId | FL Name`
