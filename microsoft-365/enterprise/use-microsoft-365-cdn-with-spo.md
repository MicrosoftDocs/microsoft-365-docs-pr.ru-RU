---
title: Использование сети доставки содержимого (CDN) Office 365 с SharePoint Online
ms.author: kvice
author: kelleyvice-msft
manager: laurawi
ms.date: 2/19/2020
audience: ITPro
ms.topic: article
ms.service: o365-administration
localization_priority: Normal
ms.collection:
- Ent_O365
- SPO_Content
f1.keywords:
- CSH
ms.custom:
- Adm_O365
- seo-marvel-apr2020
search.appverid:
- MET150
- SPO160
ms.assetid: bebb285f-1d54-4f79-90a5-94985afc6af8
description: Узнайте, как использовать сеть доставки содержимого (CDN) Office 365 для ускорения доставки активов SharePoint Online.
ms.openlocfilehash: 0ef7922f4e8881065f97a5fdeb4f21242c2b6467
ms.sourcegitcommit: 79065e72c0799064e9055022393113dfcf40eb4b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/14/2020
ms.locfileid: "46692979"
---
# <a name="use-the-office-365-content-delivery-network-cdn-with-sharepoint-online"></a>Использование сети доставки содержимого Office 365 с SharePoint Online

Вы можете использовать встроенную сеть доставки содержимого (CDN) Office 365 для размещения статических ресурсов, чтобы повысить производительность страниц SharePoint Online. Сеть CDN Office 365 повышает производительность путем кэширования статических ресурсов ближе к браузерам, которые их запрашивают, что повышает скорость скачиваний и снижает задержку. Кроме того, в сети CDN Office 365 используется [протокол HTTP/2](https://en.wikipedia.org/wiki/HTTP/2) для улучшения сжатия и конвейерной передачи данных по протоколу HTTP. Служба CDN Office 365 входит в состав подписки на SharePoint Online.

> [!NOTE]
> Сеть CDN Office 365 доступна только клиентам в облачной **среде** . Клиенты в облаках США, Китая и Германии в настоящее время не поддерживают CDN Office 365.

Сети доставки содержимого Office 365 состоит из нескольких сетей CDN, позволяющих размещать статические ресурсы в нескольких расположениях или _источниках_ и использовать их из глобальных высокоскоростных сетей. В зависимости от типа содержимого, которое необходимо разместить в сети CDN Office 365, можно добавить **общедоступные** источники, **закрытые** источники или оба варианта. В этой статье описывается [способ определения того, является ли источник общедоступным или частным](use-microsoft-365-cdn-with-spo.md#CDNOriginChoosePublicPrivate) для дополнительной информации о различиях между общедоступными и частными происхождениями.

![Концептуальная схема CDN для Office 365](../media/O365-CDN/o365-cdn-flow-transparent.svg "Концептуальная схема CDN для Office 365")

Если вы уже знакомы с тем, как работает сети CDN, вам нужно выполнить лишь несколько действий, чтобы включить CDN Office 365 для клиента. В этом разделе описывается, как это сделать. Сведения о том, как приступить к размещению статических ресурсов, можно узнать в статье.

> [!TIP]
> Существуют другие размещенные в Майкрософт сети CDN, которые можно использовать с Office 365 для специализированных сценариев использования, но не рассматриваются в этом разделе, так как они выходят за границы области CDN Office 365. Для получения дополнительных сведений обратитесь к разделу [Microsoft сети CDN](content-delivery-networks.md#other-microsoft-cdns).

 **Перейдите обратно к [планированию сети и настройке производительности для Office 365](https://aka.ms/tune).**

## <a name="overview-of-working-with-the-office-365-cdn-in-sharepoint-online"></a>Общие сведения о работе с CDN Office 365 в SharePoint Online

Чтобы настроить CDN Office 365 для Организации, выполните следующие основные действия.

+ [Планирование развертывания сети CDN Office 365](use-microsoft-365-cdn-with-spo.md#plan-for-deployment-of-the-office-365-cdn)

  + [Определите, какие статические ресурсы необходимо разместить в сети CDN](use-microsoft-365-cdn-with-spo.md#CDNAssets).
  + [Определите, где вы хотите хранить ресурсы](use-microsoft-365-cdn-with-spo.md#CDNStoreAssets). Это расположение может быть сайтом, библиотекой или папкой SharePoint и называется _источником_.
  + [Выберите, должен ли каждый источник быть общедоступным или частным](use-microsoft-365-cdn-with-spo.md#CDNOriginChoosePublicPrivate). Вы можете добавить несколько начальных версий для общедоступных и частных типов.

+ Установка и настройка сети CDN с помощью PowerShell или CLI в SharePoint Online

  + [Установка и настройка сети CDN с помощью командной консоли SharePoint Online](use-microsoft-365-cdn-with-spo.md#CDNSetupinPShell)
  + [Установка и настройка сети CDN с помощью PnP PowerShell](use-microsoft-365-cdn-with-spo.md#CDNSetupinPnPPosh)
  + [Установка и настройка сети CDN с помощью интерфейса командной строки Office 365](use-microsoft-365-cdn-with-spo.md#CDNSetupinCLI)

  После выполнения этого действия будут выполнены следующие действия:

  + Включена сеть CDN для Организации.
  + Добавлены источники, идентифицирующие каждый источник как общедоступный или частный.

После завершения установки вы сможете [управлять CDN Office 365](use-microsoft-365-cdn-with-spo.md#CDNManage) по времени, выполнив следующие действия:
  
+ Добавление, обновление и удаление активов
+ Добавление и удаление источников
+ Настройка политик CDN
+ При необходимости отключение сети CDN

Наконец, ознакомьтесь с разделом [использование ресурсов CDN](use-microsoft-365-cdn-with-spo.md#using-your-cdn-assets) для получения сведений о доступе к ресурсам CDN как из общедоступных, так и из частных источников.

Рекомендации по устранению распространенных проблем приведены [в разделе Устранение неполадок в сети CDN Office 365](use-microsoft-365-cdn-with-spo.md#CDNTroubleshooting) .

## <a name="plan-for-deployment-of-the-office-365-cdn"></a>Планирование развертывания сети CDN Office 365

Перед развертыванием сети CDN Office 365 для клиента Office 365 необходимо учесть следующие факторы в процессе планирования.

  + [Определение статических ресурсов, которые необходимо разместить в сети CDN](use-microsoft-365-cdn-with-spo.md#CDNAssets)
  + [Определение места хранения активов](use-microsoft-365-cdn-with-spo.md#CDNStoreAssets)
  + [Выберите, должен ли каждый источник быть общедоступным или частным](use-microsoft-365-cdn-with-spo.md#CDNOriginChoosePublicPrivate)

<a name="CDNAssets"> </a>
### <a name="determine-which-static-assets-you-want-to-host-on-the-cdn"></a>Определение статических ресурсов, которые необходимо разместить в сети CDN

Как правило, сети CDN наиболее эффективны для хостинга _статических ресурсов_или ресурсов, которые не меняются очень часто. Хорошее правило для параметра Thumb — определить файлы, которые удовлетворяют некоторым или всем указанным ниже условиям.

+ Статические файлы, встроенные в страницу (например, сценарии и изображения), которые могут значительно повлиять на время загрузки страницы.
+ Большие файлы, такие как исполняемые файлы и файлы установки
+ Библиотеки ресурсов, поддерживающие код на стороне клиента

Например, небольшие файлы, которые часто запрашиваются как изображения и сценарии, могут значительно повысить производительность визуализации сайта и постепенно уменьшить нагрузку на сайты SharePoint Online при добавлении их в источник CDN. Большие файлы, такие как исполняемые файлы установки, можно скачать из сети CDN, что повлияет на производительность и последующее снижение нагрузки на сайте SharePoint Online, даже если они не обращаются к ним часто.

Повышение производительности для отдельных файлов зависит от многих факторов, включая расстояние от клиента до ближайшей конечной точки CDN, временные условия локальной сети и т. д. Многие статические файлы довольно малы, и их можно скачать из Office 365 менее чем через секунду. Однако веб-страница может содержать множество внедренных файлов с накопительным временем загрузки в несколько секунд. Обслуживание этих файлов из сети CDN может значительно снизить общее время загрузки страницы. Узнайте, [какой выигрыш в производительности обеспечивает сеть CDN?](content-delivery-networks.md#what-performance-gains-does-a-cdn-provide) в качестве примера.

<a name="CDNStoreAssets"> </a>
### <a name="determine-where-you-want-to-store-your-assets"></a>Определение места хранения активов

CDN извлекает ресурсы из расположения, называемого _источником_. Источником может быть сайт SharePoint, Библиотека документов или папка, доступ к которым можно получить по URL-адресу. При указании источников для организации вы можете обеспечить высокую гибкость. Например, вы можете указать несколько источников или один источник, где будут размещаться все ресурсы CDN. Вы можете использовать как общедоступные, так и частные источники для Организации. В большинстве организаций будет выбрана комбинация этих двух интерфейсов.

Вы можете создать новый контейнер для таких источников, как папки или библиотеки документов, а также добавить файлы, которые необходимо сделать доступными из сети CDN. Это хороший подход, если у вас есть определенный набор ресурсов, который должен быть доступен из сети CDN, и необходимо ограничить набор ресурсов CDN только теми файлами, которые находятся в контейнере.

Вы также можете настроить существующее семейство веб-сайтов, сайт, библиотеку или папку в качестве источника, что сделает все подходящие ресурсы в контейнере доступными из сети CDN. Перед добавлением существующего контейнера в качестве источника необходимо убедиться, что вы осведомлены о его содержимом и разрешениях, чтобы случайно не предоставить ресурсы для анонимного доступа или неавторизованных пользователей.

Вы можете определить _политики CDN_ , чтобы исключить контент из источников CDN. Политики CDN исключают ресурсы в общедоступных или закрытых источниках с помощью таких атрибутов, как _Тип файла_ и _классификация сайтов_, и применяются ко всем источникам кднтипе (частных или общедоступных), заданным в политике. Например, если вы добавляете частный источник, состоящий из сайта, который содержит несколько дочерних сайтов, можно определить политику, чтобы исключить сайты, помеченные как **конфиденциальные** , чтобы содержимое с сайтов с такой классификацией не было доставлено из сети CDN. Политика будет применяться к содержимому _всех_ частных источников, добавленных в CDN.
  
Имейте в виду, что чем больше происхождений, тем выше влияние на время, которое использует служба CDN для обработки запросов. Мы рекомендуем ограничить количество происхождений максимально возможной.
  
<a name="CDNOriginChoosePublicPrivate"> </a>
### <a name="choose-whether-each-origin-should-be-public-or-private"></a>Выберите, должен ли каждый источник быть общедоступным или частным

При определении источника необходимо указать, следует ли сделать его _общедоступным_ или _частным_. Доступ к ресурсам CDN в общедоступных источниках анонимен, а содержимое CDN в частных источниках защищено динамически создаваемыми маркерами для повышения безопасности. Независимо от того, какой вариант выбран, корпорация Майкрософт выполняет всю тяжелую тяжелую работы, когда речь идет об администрировании самой сети CDN. Вы также можете изменить свое предположение позже, после того как вы настроили сеть CDN и определили происхождение.

Общедоступные и частные параметры обеспечивают одинаковый выигрыш в производительности, но каждый из них имеет уникальные атрибуты и преимущества.

**Общедоступные источники в** сети CDN Office 365 доступны анонимно, а размещенные ресурсы доступны всем пользователям, у которых есть URL-адрес актива. Так как доступ к содержимому в общедоступных источниках является анонимным, следует использовать их только для кэширования неконфиденциального общего содержимого, например файлов JavaScript, скриптов, значков и изображений.

**Частные** источники в сети CDN Office 365 предоставляют доступ к пользовательскому контенту, например библиотекам документов SharePoint Online, сайтам и собственным изображениям. Доступ к содержимому в частных источниках обеспечивается динамически созданными маркерами, поэтому доступ к ним могут получать только пользователи с разрешениями на исходную библиотеку документов или место хранения. Частные источники в сети CDN Office 365 можно использовать только для контента SharePoint Online, и доступ к ресурсам в частных источниках можно получить через перенаправление из клиента SharePoint Online.

Дополнительные сведения о доступе CDN к активам в частном источнике работают при [использовании ресурсов в частных источниках](use-microsoft-365-cdn-with-spo.md#using-assets-in-private-origins).

#### <a name="attributes-and-advantages-of-hosting-assets-in-public-origins"></a>Атрибуты и преимущества хостинга активов в общедоступных источниках
  
+ Ресурсы, предоставляемые из общедоступного источника, доступны всем анонимно.
    > [!IMPORTANT]
    > Никогда не следует размещать ресурсы, содержащие сведения о пользователях, или которые считаются конфиденциальными в Организации в общедоступном источнике.
+ Если удалить ресурс из общедоступного источника, он может оставаться доступным в кэше до 30 дней. Однако ссылки на ресурс в сети CDN станут недействительными в течение 15 минут.
+ При размещении таблиц стилей (CSS-файлов) в общедоступном источнике можно использовать в коде относительные пути и URI. Это означает, что вы можете ссылаться на расположение фоновых изображений и других объектов относительно расположения ресурса, который вызывает его.
+ Вы можете жестко задать URL-адрес общедоступного источника, но это не рекомендуется. Это связано с тем, что если сеть CDN станет недоступна, то URL-адрес не будет автоматически указывать на вашу организацию в SharePoint Online, что может привести к неработоспособности ссылок и другим ошибкам.
+ Для общедоступных источников используются типы файлов по умолчанию: CSS, EOT, GIF, ICO, JPEG, JPG, JS, Map, PNG, SVG, ttf, WOFF и woff2. Вы можете указать дополнительные типы файлов.
+ Вы можете настроить политику, чтобы исключить ресурсы, которые были определены классификациями сайтов, которые вы указали. Например, вы можете исключать все ресурсы, отмеченные как "конфиденциальные" или "с ограниченным доступом", даже если они относятся к разрешенным типам файлов и находятся в общедоступном источнике.

#### <a name="attributes-and-advantages-of-hosting-assets-in-private-origins"></a>Атрибуты и преимущества хостинга активов в частных источниках

+ Частные источники можно использовать только для ресурсов SharePoint Online.
+ Пользователи могут получать доступ к ресурсам из частного источника, только если у них есть разрешения на доступ к контейнеру. Анонимный доступ к таким ресурсам запрещен.
+ Ресурсы в частных источниках должны ссылаться на клиента SharePoint Online. Прямой доступ к ресурсам частной сети CDN не работает.
+ При удалении актива из частного источника ресурс может продолжать быть доступен в течение часа из кэша; Однако мы сделаете ссылки на ресурс в сети CDN недействительными в течение 15 минут после удаления актива.
+ По умолчанию для частных источников включены типы файлов GIF, ICO, JPEG, JPG, JS и PNG. Вы можете указать дополнительные типы файлов.
+ Как и в случае с общедоступными источниками, вы можете настроить политику, чтобы исключить ресурсы, идентифицированные с помощью классификаций сайтов, которые вы указали, даже если вы используете подстановочные знаки, чтобы включить все ресурсы в папке или библиотеке документов.

Дополнительные сведения об использовании сети CDN Office 365, основных концепций CDN и других сети CDN, которые можно использовать в клиенте Office 365, можно найти в статье [Доставка содержимого](content-delivery-networks.md).

### <a name="default-cdn-origins"></a>Источники CDN по умолчанию

Если вы не укажете иное, Office 365 настроит некоторые источники по умолчанию при включении сети CDN Office 365. Если вы изначально не хотите предоставлять их, вы можете добавить эти источники после завершения установки. Если вы не знакомы с последствиями для пропуска настройки источников по умолчанию и по этой причине, необходимо разрешить их создание при включении сети CDN.
  
Источники частной сети CDN по умолчанию:
  
+ \*/усерфото.аспкс
+ \*/ситеассетс

Источники общедоступной сети CDN по умолчанию:
  
+ \*/мастерпаже
+ \*Библиотека/Style Library
+ \*/клиентсидеассетс

> [!NOTE]
> _клиентсидеассетс_ — это общедоступный источник, добавленный в службу CDN Office 365 за декабрь 2017. Этот источник должен присутствовать, чтобы решения SharePoint Framework в сети CDN работали. Если вы включили CDN Office 365 до 2017 декабря, или если вы пропустили настройку источников по умолчанию при включении сети CDN, вы можете добавить этот источник вручную. Дополнительные сведения см. в статье [Моя клиентская веб-часть или решение SharePoint Framework не работает](use-microsoft-365-cdn-with-spo.md#my-client-side-web-part-or-sharepoint-framework-solution-isnt-working).

<a name="CDNSetupinPShell"> </a>
## <a name="set-up-and-configure-the-office-365-cdn-by-using-the-sharepoint-online-management-shell"></a>Установка и настройка сети CDN Office 365 с помощью командной консоли SharePoint Online

Процедуры, описанные в этом разделе, требуют использования командной консоли SharePoint Online для подключения к SharePoint Online. Инструкции см. в статье [Connect to SharePoint Online PowerShell](https://docs.microsoft.com/powershell/sharepoint/sharepoint-online/connect-sharepoint-online?view=sharepoint-ps).

Выполните указанные ниже действия, чтобы настроить и настроить сеть CDN для размещения ресурсов в SharePoint Online с помощью командной консоли SharePoint Online.

<details>
  <summary>Щелкните, чтобы развернуть</summary>

### <a name="enable-your-organization-to-use-the-office-365-cdn"></a>Предоставление Организации разрешения на использование сети CDN Office 365

Перед внесением изменений в параметры CDN клиента необходимо получить текущее состояние конфигурации частной сети CDN в клиенте Office 365. Подключитесь к клиенту с помощью командной консоли SharePoint Online:

``` powershell
Connect-SPOService -Url https://contoso-admin.sharepoint.com
```

Теперь используйте командлет **Get – SPOTenantCdnEnabled** для получения параметров состояния CDN из клиента:

``` powershell
Get-SPOTenantCdnEnabled -CdnType <Public | Private>
```

Состояние сети CDN для указанного Кднтипе будет выведено на экран.

Используйте командлет **Set – SPOTenantCdnEnabled** , чтобы разрешить Организации использовать CDN Office 365. Вы можете разрешить Организации использовать общедоступные источники, частные источники или и то, и другое одновременно. Кроме того, можно настроить CDN для пропуска настройки источников по умолчанию при включении. Вы всегда можете добавить эти источники позже, как описано в этом разделе.
  
В Windows PowerShell для SharePoint Online:

``` powershell
Set-SPOTenantCdnEnabled -CdnType <Public | Private | Both> -Enable $true
```

Например, чтобы разрешить в Организации использование общедоступных и частных источников, введите следующую команду:

``` powershell
Set-SPOTenantCdnEnabled -CdnType Both -Enable $true
```

Чтобы разрешить в Организации использование общедоступных и частных источников, но пропустить настройку по умолчанию, введите следующую команду:

``` powershell
Set-SPOTenantCdnEnabled -CdnType Both -Enable $true -NoDefaultOrigins
```

Сведения [об источниках](use-microsoft-365-cdn-with-spo.md#default-cdn-origins) , подготовленных по умолчанию при включении сети cdn Office 365, и потенциальном влиянии на пропуск настройки источников по умолчанию см.

Чтобы разрешить в Организации использование общедоступных источников, введите следующую команду:

``` powershell
Set-SPOTenantCdnEnabled -CdnType Public -Enable $true
```

Чтобы разрешить Организации использовать частные источники, введите следующую команду:

``` powershell
Set-SPOTenantCdnEnabled -CdnType Private -Enable $true
```

Дополнительные сведения об этом командлете приведены в разделе [Set – SPOTenantCdnEnabled](https://technet.microsoft.com/library/mt790765.aspx).

<a name="Office365CDNforSPOFileType"> </a>
### <a name="change-the-list-of-file-types-to-include-in-the-office-365-cdn-optional"></a>Изменение списка типов файлов, включаемых в CDN Office 365 (необязательно)

> [!TIP]
> При определении типов файлов с помощью командлета **Set – SPOTenantCdnPolicy** , заданный в текущий момент список перезаписывается. Если вы хотите добавить в список дополнительные типы файлов, сначала воспользуйтесь командлетом, чтобы узнать, какие типы файлов уже разрешены и включить их в список вместе с новыми.
  
Используйте командлет **Set – SPOTenantCdnPolicy** , чтобы определить статические типы файлов, которые могут размещаться в сети CDN, а также в общедоступных и частных источниках. По умолчанию разрешены типы стандартных активов, например CSS, GIF, JPG и JS.

В Windows PowerShell для SharePoint Online:

``` powershell
Set-SPOTenantCdnPolicy -CdnType <Public | Private> -PolicyType IncludeFileExtensions -PolicyValue "<Comma-separated list of file types >"
```

Например, чтобы разрешить сети CDN размещать файлы CSS и PNG, необходимо ввести следующую команду:

``` powershell
Set-SPOTenantCdnPolicy -CdnType Private -PolicyType IncludeFileExtensions -PolicyValue "CSS,PNG"
```

Чтобы узнать, какие типы файлов в данный момент разрешены в сети CDN, используйте командлет **Get – SPOTenantCdnPolicies** :

``` powershell
Get-SPOTenantCdnPolicies -CdnType <Public | Private>
```

Дополнительные сведения об этих командлетах приведены в статье [Set/SPOTenantCdnPolicy](https://technet.microsoft.com/library/mt800839.aspx) и [Get – SPOTenantCdnPolicies](https://technet.microsoft.com/library/mt800838.aspx).

<a name="Office365CDNforSPOSiteClassification"> </a>
### <a name="change-the-list-of-site-classifications-you-want-to-exclude-from-the-office-365-cdn-optional"></a>Изменение списка классификаций сайтов, которые требуется исключить из сети CDN Office 365 (необязательно)

> [!TIP]
> При исключении классификаций сайтов с помощью командлета **Set-SPOTenantCdnPolicy** заданный в текущий момент список перезаписывается. Если требуется исключить дополнительные классификации сайтов, используйте командлет сначала, чтобы узнать, какие классификации уже исключены, а затем добавить их вместе с новыми.

Чтобы исключить классификации сайтов, которые не должны быть доступны в сети CDN, используйте командлет **Set-SPOTenantCdnPolicy**. По умолчанию не исключаются никакие классификации сайтов.

В Windows PowerShell для SharePoint Online:

``` powershell
Set-SPOTenantCdnPolicy -CdnType <Public | Private> -PolicyType ExcludeRestrictedSiteClassifications  -PolicyValue "<Comma-separated list of site classifications >"
```

Чтобы узнать, какие классификации сайтов в настоящее время ограничены, используйте командлет **Get-SPOTenantCdnPolicies** :

``` powershell
Get-SPOTenantCdnPolicies -CdnType <Public | Private>
```

Возвращаемые свойства: _инклудефиликстенсионс_, _ексклудерестриктедситеклассификатионс_ и _ексклудеифноскриптдисаблед_.

Свойство _инклудефиликстенсионс_ содержит список расширений файлов, которые будут обслуживаться из сети CDN.

> [!NOTE]
> Расширения файлов по умолчанию отличаются от общедоступных и закрытых.

Свойство _ексклудерестриктедситеклассификатионс_ содержит классификации сайтов, которые необходимо исключить из сети CDN. Например, вы можете исключить сайты, помеченные как **конфиденциальные** , чтобы контент с сайтов, к которым применяется эта классификация, не был обслужен из сети CDN.

Свойство _ексклудеифноскриптдисаблед_ исключает содержимое из сети CDN на основе параметров атрибута _PostScript_ уровня сайта. По умолчанию _атрибуту_ InAttribute присвоено значение **Enabled** для _современных_ сайтов и **отключено** для _классических_ сайтов. Это зависит от параметров клиента.

Дополнительные сведения об этих командлетах приведены в статье [Set/SPOTenantCdnPolicy](https://technet.microsoft.com/library/mt800839.aspx) и [Get – SPOTenantCdnPolicies](https://technet.microsoft.com/library/mt800838.aspx).

<a name="Office365CDNforSPOOriginPosh"> </a>
### <a name="add-an-origin-for-your-assets"></a>Добавление источника для ресурсов

Используйте командлет **Add – SPOTenantCdnOrigin** , чтобы определить источник. Вы можете определить несколько источников. Источник — это URL-адрес, указывающий на библиотеку или папку в SharePoint, содержащую ресурсы, которые требуется размещать в сети CDN.
  
> [!IMPORTANT]
> Никогда не следует размещать ресурсы, содержащие сведения о пользователях, или которые считаются конфиденциальными в Организации в общедоступном источнике.

``` powershell
Add-SPOTenantCdnOrigin -CdnType <Public | Private> -OriginUrl <path>
```

Значение _path_ — это относительный путь к библиотеке или папке, в которой содержатся ресурсы. Помимо относительных путей, можно использовать подстановочные знаки. Источники поддерживают подстановочные знаки, добавленные к URL-адресу. Это позволяет создавать источники, охватывающие несколько сайтов. Например, чтобы включить все ресурсы в папку masterpages для всех сайтов в качестве общедоступного источника в сети CDN, введите следующую команду:

``` powershell
Add-SPOTenantCdnOrigin -CdnType Public -OriginUrl */masterpage
```

+ Модификатор подстановочного знака * **/** можно использовать только в начале пути и будет соответствовать всем сегментам URL-адресов по указанному URL-адресу.
+ Путь может указывает на библиотеку документов, папку или сайт. Например, путь _*/site1_ будет сопоставлен всем библиотекам документов на сайте.

Вы можете добавить источник с определенным относительным путем. Вы не можете добавить источник, используя полный путь.

В этом примере показано, как добавить частный источник библиотеки ситеассетс на определенном сайте:

``` powershell
Add-SPOTenantCdnOrigin -CdnType Private -OriginUrl sites/site1/siteassets
```

В этом примере показано, как добавить в библиотеку активов сайта семейства веб-сайтов частный источник папки _folder1_ :

``` powershell
Add-SPOTenantCdnOrigin -CdnType Private -OriginUrl sites/test/siteassets/folder1
```

Если путь содержит пробелы, можно либо заключить путь в двойные кавычки, либо заменить пространство на URL-кодирование %20. В приведенных ниже примерах добавляется частный источник папки " _Папка 1_ " в библиотеке активов сайта семейства веб-сайтов:

``` powershell
Add-SPOTenantCdnOrigin -CdnType Private -OriginUrl sites/test/siteassets/folder%201
```

``` powershell
Add-SPOTenantCdnOrigin -CdnType Private -OriginUrl "sites/test/siteassets/folder 1"
```

Дополнительные сведения об этой команде и ее синтаксисе можно найти в статье [Add/SPOTenantCdnOrigin](https://technet.microsoft.com/library/mt790772.aspx).

> [!NOTE]
> В закрытых источниках ресурсы, к которым предоставлен общий доступ из источника, должны иметь основную версию, которая будет опубликована, прежде чем к ним можно будет получить доступ из сети CDN.
  
После выполнения команды система синхронизирует конфигурацию в центре обработки данных. Это может занять до 15 минут.

<a name="ExamplePublicOrigin"> </a>
### <a name="example-configure-a-public-origin-for-your-master-pages-and-for-your-style-library-for-sharepoint-online"></a>Пример: настройка общедоступного источника для главных страниц и библиотеки стилей для SharePoint Online

Обычно эти источники настраиваются по умолчанию при включении сети CDN Office 365. Тем не менее, если вы хотите включить их вручную, выполните указанные ниже действия.
  
+ Используйте командлет **Add – SPOTenantCdnOrigin** , чтобы определить библиотеку стилей в качестве общедоступного источника.

``` powershell
  Add-SPOTenantCdnOrigin -CdnType Public -OriginUrl */style%20library
  ```

+ Используйте командлет **Add – SPOTenantCdnOrigin** , чтобы определить главные страницы в качестве общедоступного источника.

``` powershell
  Add-SPOTenantCdnOrigin -CdnType Public -OriginUrl */masterpage
  ```

Дополнительные сведения об этой команде и ее синтаксисе можно найти в статье [Add/SPOTenantCdnOrigin](https://technet.microsoft.com/library/mt790772.aspx).

После выполнения команды система синхронизирует конфигурацию в центре обработки данных. Это может занять до 15 минут.

<a name="ExamplePrivateOrigin"> </a>
### <a name="example-configure-a-private-origin-for-your-site-assets-site-pages-and-publishing-images-for-sharepoint-online"></a>Пример: Настройка частного источника для ресурсов сайта, страниц сайта и образов публикации для SharePoint Online

+ Используйте командлет **Add-SPOTenantCdnOrigin** , чтобы определить папку ресурсов сайта в качестве частного источника.

``` powershell
  Add-SPOTenantCdnOrigin -CdnType Private -OriginUrl */siteassets
  ```

+ Используйте командлет **Add-SPOTenantCdnOrigin** , чтобы определить папку страниц сайта в качестве частного источника.

``` powershell
  Add-SPOTenantCdnOrigin -CdnType Private -OriginUrl */sitepages
  ```

+ Используйте командлет **Add – SPOTenantCdnOrigin** , чтобы определить папку "изображения публикации" в качестве частного источника.

``` powershell
  Add-SPOTenantCdnOrigin -CdnType Private -OriginUrl */publishingimages
  ```

Дополнительные сведения об этой команде и ее синтаксисе можно найти в статье [Add/SPOTenantCdnOrigin](https://technet.microsoft.com/library/mt790772.aspx).

После выполнения команды система синхронизирует конфигурацию в центре обработки данных. Это может занять до 15 минут.

<a name="ExamplePrivateOriginSiteCollection"> </a>
### <a name="example-configure-a-private-origin-for-a-site-collection-for-sharepoint-online"></a>Пример: Настройка частного источника для семейства веб-сайтов для SharePoint Online

Используйте командлет **Add-SPOTenantCdnOrigin** для определения семейства веб-сайтов в качестве частного источника. Например:

``` powershell
Add-SPOTenantCdnOrigin -CdnType Private -OriginUrl sites/site1/siteassets
```

Дополнительные сведения об этой команде и ее синтаксисе можно найти в статье [Add/SPOTenantCdnOrigin](https://technet.microsoft.com/library/mt790772.aspx).
  
После выполнения команды система синхронизирует конфигурацию в центре обработки данных. Вы можете увидеть _ожидающее_ сообщение о конфигурации, которое ожидается, когда клиент SharePoint Online подключается к службе CDN. Это может занять до 15 минут.

<a name="CDNManage"> </a>
### <a name="manage-the-office-365-cdn"></a>Управление CDN Office 365

После настройки сети CDN можно внести изменения в конфигурацию при обновлении содержимого или при необходимости изменения, как описано в этом разделе.
  
<a name="Office365CDNforSPOaddremoveasset"> </a>
#### <a name="add-update-or-remove-assets-from-the-office-365-cdn"></a>Добавление, обновление и удаление ресурсов из сети CDN Office 365

После завершения настройки вы можете добавить новые ресурсы, а также обновлять или удалять существующие ресурсы в любое время. Внесите изменения в ресурсы в папке или библиотеке SharePoint, которую вы определили в качестве источника. Если вы добавите новый ресурс, он будет доступен в CDN немедленно. Тем не менее, если вы обновите актив, новая копия будет распространена и станет доступной в сети CDN до 15 минут.
  
Если необходимо извлечь расположение источника, можно использовать командлет **Get – SPOTenantCdnOrigins** . Сведения о том, как использовать этот командлет, можно найти в статье [Get – SPOTenantCdnOrigins](https://technet.microsoft.com/library/mt790770.aspx).

<a name="Office365CDNforSPORemoveOriginPosh"> </a>
#### <a name="remove-an-origin-from-the-office-365-cdn"></a>Удаление источника из сети CDN Office 365

Вы можете запретить доступ к папке или библиотеке SharePoint, идентифицированным в качестве источника. Для этого используйте командлет **Remove – SPOTenantCdnOrigin** .

``` powershell
Remove-SPOTenantCdnOrigin -OriginUrl <path> -CdnType <Public | Private | Both>
```

Сведения о том, как использовать этот командлет, можно найти в статье [Remove – SPOTenantCdnOrigin](https://technet.microsoft.com/library/mt790761.aspx).

<a name="Office365CDNforSPOModifyOrigin"> </a>
#### <a name="modify-an-origin-in-the-office-365-cdn"></a>Изменение источника в сети CDN Office 365

Вы не можете изменить созданный вами источник. Вместо этого удалите источник, а затем добавьте новый. Для получения дополнительных сведений обратитесь [к разделу Удаление источника из сети CDN Office 365](use-microsoft-365-cdn-with-spo.md#Office365CDNforSPORemoveOriginPosh) и [Добавление источника для ресурсов](use-microsoft-365-cdn-with-spo.md#Office365CDNforSPOOriginPosh).

<a name="Office365CDNforSPODisable"> </a>
#### <a name="disable-the-office-365-cdn"></a>Отключение сети CDN Office 365

Используйте командлет **Set – SPOTenantCdnEnabled** для отключения сети CDN для Организации. Если для сети CDN включены как общедоступные, так и частные источники, необходимо дважды выполнить командлет, как показано в следующих примерах.
  
Чтобы отключить использование общедоступных источников в сети CDN, введите следующую команду:

``` powershell
Set-SPOTenantCdnEnabled -CdnType Public -Enable $false
```

Чтобы отключить использование частных источников в сети CDN, введите следующую команду:

``` powershell
Set-SPOTenantCdnEnabled -CdnType Private -Enable $false
```

Дополнительные сведения об этом командлете приведены в разделе [Set – SPOTenantCdnEnabled](https://technet.microsoft.com/library/mt790765.aspx).

</details>

<a name="CDNSetupinPnPPosh"> </a>
## <a name="set-up-and-configure-the-office-365-cdn-by-using-pnp-powershell"></a>Установка и настройка сети CDN Office 365 с помощью PowerShell с помощью PnP

Процедуры, описанные в этом разделе, требуют использования PnP PowerShell для подключения к SharePoint Online. Инструкции приведены в разделе [Начало работы с помощью PnP PowerShell](https://github.com/SharePoint/PnP-PowerShell#getting-started).

Выполните указанные ниже действия, чтобы настроить и настроить сеть CDN для размещения ресурсов в SharePoint Online с помощью PnP PowerShell.

<details>
  <summary>Щелкните, чтобы развернуть</summary>

### <a name="enable-your-organization-to-use-the-office-365-cdn"></a>Предоставление Организации разрешения на использование сети CDN Office 365

Перед внесением изменений в параметры CDN клиента необходимо получить текущее состояние конфигурации частной сети CDN в клиенте Office 365. Подключитесь к клиенту с помощью PnP PowerShell:

``` powershell
Connect-PnPOnline -Url https://contoso-admin.sharepoint.com -UseWebLogin
```

Теперь используйте командлет **Get – пнптенанткдненаблед** для получения параметров состояния CDN из клиента:

``` powershell
Get-PnPTenantCdnEnabled -CdnType <Public | Private>
```

Состояние сети CDN для указанного Кднтипе будет выведено на экран.

Используйте командлет **Set – пнптенанткдненаблед** , чтобы разрешить Организации использовать CDN Office 365. Вы можете разрешить Организации использовать общедоступные источники, частные источники или и то, и другое. Кроме того, можно настроить CDN для пропуска настройки источников по умолчанию при включении. Вы всегда можете добавить эти источники позже, как описано в этом разделе.
  
В PowerShell с поддержкой PnP:

``` powershell
Set-PnPTenantCdnEnabled -CdnType <Public | Private | Both> -Enable $true
```

Например, чтобы разрешить в Организации использование общедоступных и частных источников, введите следующую команду:

``` powershell
Set-PnPTenantCdnEnabled -CdnType Both -Enable $true
```

Чтобы разрешить в Организации использование общедоступных и частных источников, но пропустить настройку по умолчанию, введите следующую команду:

``` powershell
Set-PnPTenantCdnEnabled -CdnType Both -Enable $true -NoDefaultOrigins
```

Сведения [об источниках](use-microsoft-365-cdn-with-spo.md#default-cdn-origins) , подготовленных по умолчанию при включении сети cdn Office 365, и потенциальном влиянии на пропуск настройки источников по умолчанию см.

Чтобы разрешить в Организации использование общедоступных источников, введите следующую команду:

``` powershell
Set-PnPTenantCdnEnabled -CdnType Public -Enable $true
```

Чтобы разрешить Организации использовать частные источники, введите следующую команду:

``` powershell
Set-PnPTenantCdnEnabled -CdnType Private -Enable $true
```

Дополнительные сведения об этом командлете приведены в разделе [Set – пнптенанткдненаблед](https://docs.microsoft.com/powershell/module/sharepoint-pnp/set-pnptenantcdnenabled).

<a name="Office365CDNforPnPPoshFileType"> </a>
### <a name="change-the-list-of-file-types-to-include-in-the-office-365-cdn-optional"></a>Изменение списка типов файлов, включаемых в CDN Office 365 (необязательно)

> [!TIP]
> При определении типов файлов с помощью командлета **Set – пнптенанткднполици** , заданный в текущий момент список перезаписывается. Если вы хотите добавить в список дополнительные типы файлов, сначала воспользуйтесь командлетом, чтобы узнать, какие типы файлов уже разрешены и включить их в список вместе с новыми.
  
Используйте командлет **Set – пнптенанткднполици** , чтобы определить статические типы файлов, которые могут размещаться в сети CDN, а также в общедоступных и частных источниках. По умолчанию разрешены типы стандартных активов, например CSS, GIF, JPG и JS.

В PowerShell с поддержкой PnP:

``` powershell
Set-PnPTenantCdnPolicy -CdnType <Public | Private> -PolicyType IncludeFileExtensions -PolicyValue "<Comma-separated list of file types >"
```

Например, чтобы разрешить сети CDN размещать файлы CSS и PNG, необходимо ввести следующую команду:

``` powershell
Set-PnPTenantCdnPolicy -CdnType Private -PolicyType IncludeFileExtensions -PolicyValue "CSS,PNG"
```

Чтобы узнать, какие типы файлов в данный момент разрешены в сети CDN, используйте командлет **Get – пнптенанткднполиЦиес** :

``` powershell
Get-PnPTenantCdnPolicies -CdnType <Public | Private>
```

Дополнительные сведения об этих командлетах приведены в статье [Set/пнптенанткднполици](https://docs.microsoft.com/powershell/module/sharepoint-pnp/set-pnptenantcdnpolicy) и [Get – пнптенанткднполиЦиес](https://docs.microsoft.com/powershell/module/sharepoint-pnp/get-pnptenantcdnpolicies).

<a name="Office365CDNforPnPPoshSiteClassification"> </a>
### <a name="change-the-list-of-site-classifications-you-want-to-exclude-from-the-office-365-cdn-optional"></a>Изменение списка классификаций сайтов, которые требуется исключить из сети CDN Office 365 (необязательно)

> [!TIP]
> При исключении классификаций сайтов с помощью командлета **Set-пнптенанткднполици** заданный в текущий момент список перезаписывается. Если требуется исключить дополнительные классификации сайтов, используйте командлет сначала, чтобы узнать, какие классификации уже исключены, а затем добавить их вместе с новыми.

Используйте командлет **Set-пнптенанткднполици** , чтобы исключить классификации сайтов, которые не нужно сделать доступными в сети CDN. По умолчанию не исключаются никакие классификации сайтов.

В PowerShell с поддержкой PnP:

``` powershell
Set-PnPTenantCdnPolicy -CdnType <Public | Private> -PolicyType ExcludeRestrictedSiteClassifications  -PolicyValue "<Comma-separated list of site classifications>"
```

Чтобы узнать, какие классификации сайтов в настоящее время ограничены, используйте командлет **Get-пнптенанткднполиЦиес** :

``` powershell
Get-PnPTenantCdnPolicies -CdnType <Public | Private>
```

Возвращаемые свойства: _инклудефиликстенсионс_, _ексклудерестриктедситеклассификатионс_ и _ексклудеифноскриптдисаблед_.

Свойство _инклудефиликстенсионс_ содержит список расширений файлов, которые будут обслуживаться из сети CDN.

> [!NOTE]
> Расширения файлов по умолчанию отличаются от общедоступных и закрытых.

Свойство _ексклудерестриктедситеклассификатионс_ содержит классификации сайтов, которые необходимо исключить из сети CDN. Например, вы можете исключить сайты, помеченные как **конфиденциальные** , чтобы контент с сайтов, к которым применяется эта классификация, не был обслужен из сети CDN.

Свойство _ексклудеифноскриптдисаблед_ исключает содержимое из сети CDN на основе параметров атрибута _PostScript_ уровня сайта. По умолчанию _атрибуту_ InAttribute присвоено значение **Enabled** для _современных_ сайтов и **отключено** для _классических_ сайтов. Это зависит от параметров клиента.

Дополнительные сведения об этих командлетах приведены в статье [Set/пнптенанткднполици](https://docs.microsoft.com/powershell/module/sharepoint-pnp/set-pnptenantcdnpolicy) и [Get – пнптенанткднполиЦиес](https://docs.microsoft.com/powershell/module/sharepoint-pnp/get-pnptenantcdnpolicies).

<a name="Office365CDNforSPOOriginPnPPosh"> </a>
### <a name="add-an-origin-for-your-assets"></a>Добавление источника для ресурсов

Используйте командлет **Add – пнптенанткдноригин** , чтобы определить источник. Вы можете определить несколько источников. Источник — это URL-адрес, указывающий на библиотеку или папку в SharePoint, содержащую ресурсы, которые требуется размещать в сети CDN.
  
> [!IMPORTANT]
> Никогда не следует размещать ресурсы, содержащие сведения о пользователях, или которые считаются конфиденциальными в Организации в общедоступном источнике.

``` powershell
Add-PnPTenantCdnOrigin -CdnType <Public | Private> -OriginUrl <path>
```

Значение _path_ — это относительный путь к библиотеке или папке, в которой содержатся ресурсы. Помимо относительных путей, можно использовать подстановочные знаки. Источники поддерживают подстановочные знаки, добавленные к URL-адресу. Это позволяет создавать источники, охватывающие несколько сайтов. Например, чтобы включить все ресурсы в папку masterpages для всех сайтов в качестве общедоступного источника в сети CDN, введите следующую команду:

``` powershell
Add-PnPTenantCdnOrigin -CdnType Public -OriginUrl */masterpage
```

+ Модификатор подстановочного знака * **/** можно использовать только в начале пути и будет соответствовать всем сегментам URL-адресов по указанному URL-адресу.
+ Путь может указывает на библиотеку документов, папку или сайт. Например, путь _*/site1_ будет сопоставлен всем библиотекам документов на сайте.

Вы можете добавить источник с определенным относительным путем. Вы не можете добавить источник, используя полный путь.

В этом примере показано, как добавить частный источник библиотеки активов сайта на определенном сайте:

``` powershell
Add-PnPTenantCdnOrigin -CdnType Private -OriginUrl sites/site1/siteassets
```

В этом примере показано, как добавить в библиотеку активов сайта семейства веб-сайтов частный источник папки _folder1_ :

``` powershell
Add-PnPTenantCdnOrigin -CdnType Private -OriginUrl sites/test/siteassets/folder1
```

Если путь содержит пробелы, можно либо заключить путь в двойные кавычки, либо заменить пространство на URL-кодирование %20. В приведенных ниже примерах добавляется частный источник папки " _Папка 1_ " в библиотеке активов сайта семейства веб-сайтов:

``` powershell
Add-PnPTenantCdnOrigin -CdnType Private -OriginUrl sites/test/siteassets/folder%201
```

``` powershell
Add-PnPTenantCdnOrigin -CdnType Private -OriginUrl "sites/test/siteassets/folder 1"
```

Дополнительные сведения об этой команде и ее синтаксисе можно найти в статье [Add/пнптенанткдноригин](https://docs.microsoft.com/powershell/module/sharepoint-pnp/add-pnptenantcdnorigin).

> [!NOTE]
> В закрытых источниках ресурсы, к которым предоставлен общий доступ из источника, должны иметь основную версию, которая будет опубликована, прежде чем к ним можно будет получить доступ из сети CDN.
  
После выполнения команды система синхронизирует конфигурацию в центре обработки данных. Это может занять до 15 минут.

<a name="ExamplePublicOriginPnPPosh"> </a>
### <a name="example-configure-a-public-origin-for-your-master-pages-and-for-your-style-library-for-sharepoint-online"></a>Пример: настройка общедоступного источника для главных страниц и библиотеки стилей для SharePoint Online

Обычно эти источники настраиваются по умолчанию при включении сети CDN Office 365. Тем не менее, если вы хотите включить их вручную, выполните указанные ниже действия.
  
+ Используйте командлет **Add – пнптенанткдноригин** , чтобы определить библиотеку стилей в качестве общедоступного источника.

``` powershell
  Add-PnPTenantCdnOrigin -CdnType Public -OriginUrl */style%20library
  ```

+ Используйте командлет **Add – пнптенанткдноригин** , чтобы определить главные страницы в качестве общедоступного источника.

``` powershell
  Add-PnPTenantCdnOrigin -CdnType Public -OriginUrl */masterpage
  ```

Дополнительные сведения об этой команде и ее синтаксисе можно найти в статье [Add/пнптенанткдноригин](https://docs.microsoft.com/powershell/module/sharepoint-pnp/add-pnptenantcdnorigin).

После выполнения команды система синхронизирует конфигурацию в центре обработки данных. Это может занять до 15 минут.

<a name="ExamplePrivateOriginPnPPosh"> </a>
### <a name="example-configure-a-private-origin-for-your-site-assets-site-pages-and-publishing-images-for-sharepoint-online"></a>Пример: Настройка частного источника для ресурсов сайта, страниц сайта и образов публикации для SharePoint Online

+ Используйте командлет **Add-пнптенанткдноригин** , чтобы определить папку ресурсов сайта в качестве частного источника.

``` powershell
  Add-PnPTenantCdnOrigin -CdnType Private -OriginUrl */siteassets
  ```

+ Используйте командлет **Add-пнптенанткдноригин** , чтобы определить папку страниц сайта в качестве частного источника.

``` powershell
  Add-PnPTenantCdnOrigin -CdnType Private -OriginUrl */sitepages
  ```

+ Используйте командлет **Add – пнптенанткдноригин** , чтобы определить папку "изображения публикации" в качестве частного источника.

``` powershell
  Add-PnPTenantCdnOrigin -CdnType Private -OriginUrl */publishingimages
  ```

Дополнительные сведения об этой команде и ее синтаксисе можно найти в статье [Add/пнптенанткдноригин](https://docs.microsoft.com/powershell/module/sharepoint-pnp/add-pnptenantcdnorigin).

После выполнения команды система синхронизирует конфигурацию в центре обработки данных. Это может занять до 15 минут.

<a name="ExamplePrivateOriginSiteCollectionPnPPosh"> </a>
### <a name="example-configure-a-private-origin-for-a-site-collection-for-sharepoint-online"></a>Пример: Настройка частного источника для семейства веб-сайтов для SharePoint Online

Используйте командлет **Add-пнптенанткдноригин** для определения семейства веб-сайтов в качестве частного источника. Например:

``` powershell
Add-PnPTenantCdnOrigin -CdnType Private -OriginUrl sites/site1/siteassets
```

Дополнительные сведения об этой команде и ее синтаксисе можно найти в статье [Add/пнптенанткдноригин](https://docs.microsoft.com/powershell/module/sharepoint-pnp/add-pnptenantcdnorigin).
  
После выполнения команды система синхронизирует конфигурацию в центре обработки данных. Вы можете увидеть _ожидающее_ сообщение о конфигурации, которое ожидается, когда клиент SharePoint Online подключается к службе CDN. Это может занять до 15 минут.

<a name="CDNManagePnPPosh"> </a>
### <a name="manage-the-office-365-cdn"></a>Управление CDN Office 365

После настройки сети CDN можно внести изменения в конфигурацию при обновлении содержимого или при необходимости изменения, как описано в этом разделе.
  
<a name="Office365CDNforSPOaddremoveassetPnPPosh"> </a>
#### <a name="add-update-or-remove-assets-from-the-office-365-cdn"></a>Добавление, обновление и удаление ресурсов из сети CDN Office 365

После завершения настройки вы можете добавить новые ресурсы, а также обновлять или удалять существующие ресурсы в любое время. Внесите изменения в ресурсы в папке или библиотеке SharePoint, которую вы определили в качестве источника. Если вы добавите новый ресурс, он будет доступен в CDN немедленно. Тем не менее, если вы обновите актив, новая копия будет распространена и станет доступной в сети CDN до 15 минут.
  
Если необходимо извлечь расположение источника, можно использовать командлет **Get – пнптенанткдноригин** . Сведения о том, как использовать этот командлет, можно найти в статье [Get – пнптенанткдноригин](https://docs.microsoft.com/powershell/module/sharepoint-pnp/get-pnptenantcdnorigin).

<a name="Office365CDNforSPORemoveOriginPnPPosh"> </a>
#### <a name="remove-an-origin-from-the-office-365-cdn"></a>Удаление источника из сети CDN Office 365

Вы можете запретить доступ к папке или библиотеке SharePoint, идентифицированным в качестве источника. Для этого используйте командлет **Remove – пнптенанткдноригин** .

``` powershell
Remove-PnPTenantCdnOrigin -OriginUrl <path> -CdnType <Public | Private | Both>
```

Сведения о том, как использовать этот командлет, можно найти в статье [Remove – пнптенанткдноригин](https://docs.microsoft.com/powershell/module/sharepoint-pnp/remove-pnptenantcdnorigin).

<a name="Office365CDNforSPOModifyOriginPnPPosh"> </a>
#### <a name="modify-an-origin-in-the-office-365-cdn"></a>Изменение источника в сети CDN Office 365

Вы не можете изменить созданный вами источник. Вместо этого удалите источник, а затем добавьте новый. Для получения дополнительных сведений обратитесь [к разделу Удаление источника из сети CDN Office 365](use-microsoft-365-cdn-with-spo.md#Office365CDNforSPORemoveOriginPnPPosh) и [Добавление источника для ресурсов](use-microsoft-365-cdn-with-spo.md#Office365CDNforSPOOriginPnPPosh).

<a name="Office365CDNforSPODisable"> </a>
#### <a name="disable-the-office-365-cdn"></a>Отключение сети CDN Office 365

Используйте командлет **Set – пнптенанткдненаблед** для отключения сети CDN для Организации. Если для сети CDN включены как общедоступные, так и частные источники, необходимо дважды выполнить командлет, как показано в следующих примерах.
  
Чтобы отключить использование общедоступных источников в сети CDN, введите следующую команду:

``` powershell
Set-PnPTenantCdnEnabled -CdnType Public -Enable $false
```

Чтобы отключить использование частных источников в сети CDN, введите следующую команду:

``` powershell
Set-PnPTenantCdnEnabled -CdnType Private -Enable $false
```

Дополнительные сведения об этом командлете приведены в разделе [Set – пнптенанткдненаблед](https://docs.microsoft.com/powershell/module/sharepoint-pnp/set-pnptenantcdnenabled).

</details>

<a name="CDNSetupinCLI"> </a>
## <a name="set-up-and-configure-the-office-365-cdn-using-the-office-365-cli"></a>Установка и настройка сети CDN Office 365 с помощью интерфейса командной строки Office 365:

Процедуры, описанные в этом разделе, требуют установки [Office 365 CLI](https://aka.ms/o365cli). Затем подключитесь к клиенту Office 365 с помощью команды [Login](https://pnp.github.io/office365-cli/cmd/login/) .

Выполните указанные ниже действия, чтобы настроить и настроить сеть CDN для размещения ресурсов в SharePoint Online с помощью интерфейса CLI для Office 365.

<details>
  <summary>Щелкните, чтобы развернуть</summary>

### <a name="enable-the-office-365-cdn"></a>Включение сети CDN Office 365

Вы можете управлять состоянием сети CDN Office 365 в клиенте с помощью команды [spo cdn set](https://pnp.github.io/office365-cli/cmd/spo/cdn/cdn-set/).

Чтобы включить в клиенте общедоступную сеть CDN Office 365, выполните следующую команду:

```sh
spo cdn set --type Public --enabled true
```

Чтобы включить Office 365 для SharePoint CDN, выполните следующие действия:

```sh
spo cdn set --type Private --enabled true
```

#### <a name="view-the-current-status-of-the-office-365-cdn"></a>Просмотр текущего состояния сети CDN Office 365

Чтобы проверить, включена или отключена ли определенная сеть CDN для Office 365, используйте команду [SPO CDN Get](https://pnp.github.io/office365-cli/cmd/spo/cdn/cdn-get/) .

Чтобы проверить, включена ли общедоступная сеть CDN Office 365, выполните следующую команду:

```sh
spo cdn get --type Public
```

### <a name="view-the-office-365-cdn-origins"></a>Просмотр источников сети CDN Office 365

Чтобы просмотреть список настроенных в данный момент общедоступных источников CDN Office 365, выполните следующую команду:

```sh
spo cdn origin list --type Public
```

Для получения сведений об источниках, подготовленных по умолчанию при включении сети CDN Office 365, просмотрите [источники CDN по умолчанию](use-microsoft-365-cdn-with-spo.md#default-cdn-origins) .

### <a name="add-an-office-365-cdn-origin"></a>Добавление источника CDN Office 365

> [!IMPORTANT]
> Никогда не следует помещать ресурсы, которые считаются конфиденциальными в Организации, в библиотеке документов SharePoint, настроенной в качестве общедоступного источника.

Чтобы определить источник CDN, используйте команду [spo cdn origin add](https://pnp.github.io/office365-cli/cmd/spo/cdn/cdn-origin-add/). Вы можете определить несколько источников. Источник — это URL-адрес, указывающий на библиотеку или папку в SharePoint, содержащую ресурсы, которые требуется размещать в сети CDN.

```sh
spo cdn origin add --type [Public | Private] --origin <path>
```

Где `path` — это относительный путь к папке, содержащей ресурсы. Помимо относительных путей, можно использовать подстановочные знаки.

Чтобы включить все ресурсы в **коллекцию главных страниц** для всех сайтов в качестве общедоступного источника, выполните следующие действия:

```sh
spo cdn origin add --type Public --origin */masterpage
```

Чтобы настроить частный источник для определенного семейства веб-сайтов, выполните следующую команду:

```sh
spo cdn origin add --type Private --origin sites/site1/siteassets
```

> [!NOTE]
> После добавления источника CDN может понадобиться до 15 минут, чтобы получить файлы через службу CDN. Вы можете проверить, включен ли тот или иной источник, с помощью команды [spo cdn origin list](https://pnp.github.io/office365-cli/cmd/spo/cdn/cdn-origin-list/).

### <a name="remove-an-office-365-cdn-origin"></a>Удаление источника CDN Office 365

Чтобы удалить источник CDN для указанного типа CDN, используйте команду [spo cdn origin remove](https://pnp.github.io/office365-cli/cmd/spo/cdn/cdn-origin-remove/).

Чтобы удалить общедоступный источник из конфигурации CDN, выполните следующие действия:

```sh
spo cdn origin remove --type Public --origin */masterpage
```

> [!NOTE]
> Удаление источника CDN не влияет на файлы, хранящиеся в библиотеке документов, соответствующей этому источнику. Если эти ресурсы упоминаются с помощью URL-адреса SharePoint, SharePoint автоматически переключится обратно на исходный URL-адрес, указывающий на библиотеку документов. Тем не менее, если у вас есть ссылки на ресурсы с помощью URL-адреса общедоступной сети CDN, то удаление источника приведет к разрыву связи и потребуется вручную изменить их.

### <a name="modify-an-office-365-cdn-origin"></a>Изменение источника CDN Office 365

Изменить имеющийся источник CDN невозможно. Вместо этого следует удалить определенный ранее источник CDN с помощью команды `spo cdn origin remove` и добавить новый с помощью команды `spo cdn origin add`.

### <a name="change-the-types-of-files-to-include-in-the-office-365-cdn"></a>Изменение типов файлов, включаемых в CDN Office 365

По умолчанию в сети CDN включены следующие типы файлов: _CSS, EOT, GIF, ICO, JPEG, JPG, JS, Map, PNG, SVG, ttf, WOFF и woff2_. Если требуется включить в сеть CDN дополнительные типы файлов, вы можете изменить конфигурацию CDN с помощью команды [spo cdn policy set](https://pnp.github.io/office365-cli/cmd/spo/cdn/cdn-policy-set/).

> [!NOTE]
> При изменении списка типов файлов перезаписывается текущий список. Если требуется включить дополнительные типы файлов, сперва используйте команду [spo cdn policy list](https://pnp.github.io/office365-cli/cmd/spo/cdn/cdn-origin-list/), чтобы узнать, какие типы файлов настроены в текущий момент.

Чтобы добавить тип файла _JSON_ в список по умолчанию типов файлов, включенных в общедоступную сеть CDN, выполните:

```sh
spo cdn policy set --type Public --policy IncludeFileExtensions --value "CSS,EOT,GIF,ICO,JPEG,JPG,JS,MAP,PNG,SVG,TTF,WOFF,JSON"
```

### <a name="change-the-list-of-site-classifications-you-want-to-exclude-from-the-office-365-cdn"></a>Изменение списка классификаций сайтов, которые требуется исключить из сети CDN Office 365

Чтобы исключить классификации сайтов, которые не должны быть доступны в сети CDN, используйте команду [spo cdn policy set](https://pnp.github.io/office365-cli/cmd/spo/cdn/cdn-policy-set/). По умолчанию не исключаются никакие классификации сайтов.

> [!NOTE]
> При изменении списка исключаемых классификаций сайтов перезаписывается текущий список. Если требуется исключить дополнительные классификации сайтов, сперва используйте команду [spo cdn policy list](https://pnp.github.io/office365-cli/cmd/spo/cdn/cdn-policy-list/), чтобы узнать, какие классификации настроены в текущий момент.

Чтобы исключить сайты, классифицированные как _HBI_ , из общедоступной сети CDN, выполните

```sh
spo cdn policy set --type Public --policy ExcludeRestrictedSiteClassifications --value "HBI"
```

### <a name="disable-the-office-365-cdn"></a>Отключение сети CDN Office 365

Чтобы отключить сеть CDN Office 365, используйте команду `spo cdn set`. Пример:

```sh
spo cdn set --type Public --enabled false
```

</details>

## <a name="using-your-cdn-assets"></a>Использование ресурсов CDN

Теперь, когда вы включили CDN и настроенные источники и политики, вы можете приступить к использованию ресурсов CDN.

В этом разделе вы узнаете, как использовать URL-адреса CDN в страницах и контенте SharePoint, чтобы SharePoint перенаправлял запросы ресурсов в общедоступных и частных источниках сети CDN.

+ [Обновление ссылок на ресурсы CDN](use-microsoft-365-cdn-with-spo.md#updating-links-to-cdn-assets)
+ [Использование ресурсов в общедоступных источниках](use-microsoft-365-cdn-with-spo.md#using-assets-in-public-origins)
+ [Использование ресурсов в частных источниках](use-microsoft-365-cdn-with-spo.md#using-assets-in-private-origins)

Сведения о том, как использовать сеть CDN для размещения клиентских веб-частей, можно найти в разделе [Host The Client Web Part of Office 365 CDN (Hello World, часть 4)](https://docs.microsoft.com/sharepoint/dev/spfx/web-parts/get-started/hosting-webpart-from-office-365-cdn).

> [!NOTE]
> Если добавить папку _клиентсидеассетс_ в список источников **частной** сети CDN, пользовательские веб-части, размещаемые в CDN, не будут отображаться. Файлы, используемые веб-частями SPFX, могут использовать только общедоступную сеть CDN, а папка Клиентсидеассетс — это источник, используемый по умолчанию для общедоступной сети CDN. 

### <a name="updating-links-to-cdn-assets"></a>Обновление ссылок на ресурсы CDN

Чтобы использовать ресурсы, добавленные в источник, просто обновите ссылки на исходный файл, указав путь к файлу в источнике.

+ Отредактируйте страницу или контент, содержащие ссылки на ресурсы, добавленные в источник. Вы также можете использовать один из следующих методов для глобального поиска и замены ссылок на сайте ввод сайта или семейства веб-сайтов, если необходимо обновить ссылку на данный ресурс везде, где он отображается.
+ Для каждой ссылки на ресурс в источнике Замените путь на путь к файлу в источнике CDN. Можно использовать относительные пути.
+ Сохраните страницу или контент.

Например, рассмотрим изображение _/сите/ситеассетс/имажес/image.png_, скопированное в папку библиотеки документов _/Сите/CDN_origins/публик/_. Чтобы использовать ресурс CDN, замените исходный путь к расположению файла изображения, указав путь к источнику, чтобы создать новый URL-адрес _/сите/CDN_origins/публик/image.png_.

Если вы хотите использовать полный URL-адрес для ресурса вместо относительного пути, создайте ссылку следующим образом:

`https://<TenantHostName>.sharepoint.com/sites/site/CDN_origins/public/image.png`

> [!NOTE]
> Как правило, не следует жестко кодировать URL-адреса непосредственно для ресурсов в сети CDN. Однако при необходимости можно вручную создавать URL-адреса для ресурсов в общедоступных источниках. Дополнительные сведения см. в статье [URL-адреса CDN хардкодинг для общедоступных ресурсов](use-microsoft-365-cdn-with-spo.md#hardcoding-cdn-urls-for-public-assets).

Чтобы узнать, как проверить, что ресурсы обслуживаются из сети CDN, посмотрите, [как подтвердить, что активы обслуживаются в сети CDN?](use-microsoft-365-cdn-with-spo.md#CDNConfirm) в разделе [Устранение неполадок в разделе CDN Office 365](use-microsoft-365-cdn-with-spo.md#CDNTroubleshooting) .

### <a name="using-assets-in-public-origins"></a>Использование ресурсов в общедоступных источниках

**Функция публикации** в SharePoint Online автоматически перезаписывает URL-адреса ресурсов, хранящихся в общедоступных источниках, в их ЭКВИВАЛЕНТы CDN, чтобы ресурсы направляются из службы CDN, а не из SharePoint.

Если ваш источник находится на сайте с включенным компонентом публикации, а ресурсы, которые вы хотите отгрузить в CDN, находятся в одной из следующих категорий, SharePoint автоматически перепишет URL-адреса для ресурсов в источнике при условии, что актив не был исключен политикой CDN.

Ниже представлен обзор ссылок, которые автоматически заменяет функция публикации в SharePoint.

+ URL-адреса IMG-, LINK- и CSS-файлов в HTML-откликах классической страницы публикации.
  + Это относится и к изображениям, добавленным авторами в HTML-содержимом страницы.
+ URL-адреса изображений в веб-части "Слайд-шоу библиотеки рисунков".
+ Поля изображений в результатах работы REST API SPList (RenderListDataAsStream).
  + Используйте новое свойство _имажефиелдстотриревритетокднурлс_ , чтобы предоставить список полей, разделенных запятыми.
  + Поддерживает поля гиперссылок и поля PublishingImage
+ Представления изображений SharePoint

На следующей схеме показан рабочий процесс, когда SharePoint получает запрос на страницу, содержащую ресурсы из общедоступного источника.

![Схема рабочего процесса: получение ресурсов CDN Office 365 из общедоступного источника](../media/O365-CDN/o365-cdn-public-steps-transparent.svg "Рабочий процесс: получение ресурсов CDN Office 365 из общедоступного источника")

> [!TIP]
> Если вы хотите отключить автоматическое переопределение определенных URL-адресов на странице, вы можете извлечь страницу и добавить параметр строки запроса **? Ноауторевритес = true** до конца каждой ссылки, которую необходимо отключить.

#### <a name="hardcoding-cdn-urls-for-public-assets"></a>URL-адреса CDN хардкодинг для общедоступных активов

Если функция _публикации_ не включена для общедоступного источника, или актив не является одним из типов связей, поддерживаемых функцией автоматического перезаписи службы CDN, можно вручную создать URL-адреса для расположения в сети CDN и использовать эти URL-адреса в контенте.

> [!NOTE]
> Невозможно жестко кодировать URL-адреса CDN в ресурсы в частном источнике, так как необходимый маркер доступа, который образует последний раздел URL-адреса, создается во время запроса ресурса.

Для ресурсов общедоступной сети CDN формат URL-адреса будет выглядеть следующим образом:

``` html
https://publiccdn.sharepointonline.com/<TenantHostName>/sites/site/library/asset.png
```

Замените **тенансостнаме** на имя вашего клиента. Пример.

``` html
https://publiccdn.sharepointonline.com/contoso.sharepoint.com/sites/site/library/asset.png
```

### <a name="using-assets-in-private-origins"></a>Использование ресурсов в частных источниках

Для использования ресурсов в частных источниках не требуется дополнительная настройка. SharePoint Online автоматически перезаписывает URL-адреса для ресурсов в частных источниках, поэтому запросы для этих ресурсов будут всегда обслуживаться из сети CDN. Вы не можете вручную создавать URL-адреса для ресурсов CDN в частных источниках, так как эти URL-адреса содержат маркеры, которые должны автоматически создаваться SharePoint Online при запросе ресурса.

Доступ к ресурсам в частных источниках защищен динамически создаваемыми маркерами на основе разрешений пользователя на происхождение, а также предостережений, описанных в следующих разделах. Пользователи должны иметь по крайней мере доступ на **Чтение** к источникам сети CDN для отображения контента.

На следующей схеме показан рабочий процесс, когда SharePoint получает запрос на страницу, содержащую ресурсы из частного источника.

![Схема рабочего процесса: получение ресурсов CDN Office 365 из частного источника](../media/O365-CDN/o365-cdn-private-steps-transparent.svg "Рабочий процесс: получение ресурсов CDN Office 365 из частного источника")

#### <a name="token-based-authorization-in-private-origins"></a>Авторизация на основе маркеров в частных источниках

Доступ к ресурсам в частных источниках в сети CDN Office 365 предоставляется маркерами, созданными SharePoint Online. Пользователи, которые уже имеют разрешение на доступ к папке или библиотеке, назначенным источником, автоматически получают маркеры, позволяющие пользователю получить доступ к файлу на основе их уровня разрешений. Эти маркеры доступа действительны в течение 30 – 90 минут после их создания для предотвращения атак с повторением маркеров.

После создания маркера доступа SharePoint Online возвращает пользовательский URI для клиента, содержащего два параметра авторизации _EAT_ (маркер авторизации пограничного сервера) и _ОАТ_ (маркер авторизации источника). Структура каждого маркера _< ' время истечения срока действия в формате эпохи ' >__< ' Secure Signature ' >_. Например:

``` html
https://privatecdn.sharepointonline.com/contoso.sharepoint.com/sites/site1/library1/folder1/image1.jpg?eat=1486154359_cc59042c5c55c90b26a2775323c7c8112718431228fe84d568a3795a63912840&oat=1486154359_7d73c2e3ba4b7b1f97242332900616db0d4ffb04312
```

> [!NOTE]
> Любой пользователь, имеющий право на получение маркера, может получить доступ к ресурсу в сети CDN. Однако URL-адреса, содержащие эти маркеры доступа, разделяются только по протоколу HTTPS, поэтому до истечения срока действия маркера пользователь не будет иметь доступ к URL-адресу явным образом, он будет недоступен для неавторизованных пользователей.

#### <a name="item-level-permissions-are-not-supported-for-assets-in-private-origins"></a>Разрешения на уровне элементов не поддерживаются для ресурсов в частных источниках

Важно отметить, что SharePoint Online не поддерживает разрешения на уровне элементов для ресурсов в частных источниках. Например, для файла, расположенного в `https://contoso.sharepoint.com/sites/site1/library1/folder1/image1.jpg` , пользователи имеют эффективный доступ к файлу с учетом следующих условий:

|User  |Разрешения  |Эффективный доступ  |
|---------|---------|---------|
|Пользователь 1     |Имеет доступ к Folder1         |Может получать доступ к image1.jpg из сети CDN         |
|Пользователь 2     |Не имеет доступа к Folder1         |Не удается получить доступ к image1.jpg из сети CDN         |
|Пользователь 3     |Не имеет доступа к Folder1, но ему предоставлено явное разрешение на доступ к image1.jpg в SharePoint Online         |Может получать доступ к ресурсу image1.jpg непосредственно из SharePoint Online, но не из сети CDN.         |
|Пользователь 4     |Имеет доступ к Folder1, но ему явно запрещен доступ к image1.jpg в SharePoint Online         |Не удается получить доступ к ресурсу из SharePoint Online, но он может получить доступ к ресурсу из CDN, несмотря на запрет доступа к файлу в SharePoint Online         |

<a name="CDNTroubleshooting"> </a>
## <a name="troubleshooting-the-office-365-cdn"></a>Устранение неполадок в сети CDN Office 365

<a name="CDNConfirm"> </a>
### <a name="how-do-i-confirm-that-assets-are-being-served-by-the-cdn"></a>Как убедиться, что активы обслуживаются в сети CDN?

Когда вы добавили ссылки на ресурсы CDN на страницу, вы можете убедиться, что актив обслуживается из сети CDN, перейдя на страницу, щелкнув изображение правой кнопкой мыши после того, как оно отрисовывается и просматривает URL-адрес изображения.

Кроме того, с помощью средств разработчика браузера можно просматривать URL-адрес каждого ресурса на странице или использовать средство трассировки сети стороннего производителя.

> [!NOTE]
> Если вы используете сетевое средство, например Fiddler, чтобы протестировать ресурсы за предельным отображением ресурса на странице SharePoint, необходимо вручную добавить заголовок ссылки "ссылка": `https://yourdomain.sharepoint.com` "на запрос GET, где URL-адрес — это корневой URL-адрес клиента SharePoint Online.

Вы не можете проверить URL-адреса CDN непосредственно в веб-браузере, так как у вас должны быть ссылки из SharePoint Online. Тем не менее, если вы добавите URL-адрес ресурса CDN на страницу SharePoint, а затем открыли страницу в браузере, на странице появится ресурс CDN, отображаемый на странице.

Для получения дополнительных сведений об использовании средств разработчика в браузере Microsoft Edge обратитесь к разделу [Инструменты разработчика Microsoft Edge](https://docs.microsoft.com/microsoft-edge/devtools-guide).

Для просмотра коротких видеороликов, размещенных в статье [шаблоны и методики разработки на YouTube](https://aka.ms/sppnp-videos) , демонстрирующие, как проверить работу сети CDN, ознакомьтесь со статьей [Проверка использования сети CDN и обеспечение оптимального сетевого подключения](https://www.youtube.com/watch?v=ClCtBAtGjE8&list=PLR9nK3mnD-OWMfr1BA9mr5oCw2aJXw4WA&index=5).

### <a name="why-are-assets-from-a-new-origin-unavailable"></a>Почему ресурсы из нового источника недоступны?
Ресурсы в новых источниках сразу не будут доступны для использования, так как они занимают время для распространения в сети CDN и для загрузки активов из источника в хранилище CDN. Время, необходимое для доступа к ресурсам в сети CDN, зависит от количества ресурсов и размера файлов.

### <a name="my-client-side-web-part-or-sharepoint-framework-solution-isnt-working"></a>Клиентская веб-часть или решение SharePoint Framework не работают

Когда вы включаете CDN Office 365 для общедоступных источников, служба CDN автоматически создает следующие начальные значения по умолчанию:

+ */МАСТЕРПАЖЕ
+ * БИБЛИОТЕКА/STYLE LIBRARY
+ */КЛИЕНТСИДЕАССЕТС

Если источник */клиентсидеассетс отсутствует, решения SharePoint Framework завершатся неуспешно, и предупреждения или сообщения об ошибках не создаются. Этот источник может отсутствовать из-за того, что для сети CDN включен параметр _-нодефаулторигинс_ , для которого задано значение **$true**или удалено удаление источника вручную.

Вы можете проверить, какие источники имеются в наличии с помощью следующей команды PowerShell:

``` powershell
Get-SPOTenantCdnOrigins -CdnType Public
```

Вы также можете проверить наличие Office 365 CLI:

``` powershell
spo cdn origin list
```

Чтобы добавить источник в PowerShell, выполните следующие действия:

``` powershell
Add-SPOTenantCdnOrigin -CdnType Public -OriginUrl */CLIENTSIDEASSETS
```

Чтобы добавить источник в Office 365 CLI:

``` powershell
spo cdn origin add --origin */CLIENTSIDEASSETS
```

### <a name="what-powershell-modules-and-cli-shells-do-i-need-to-work-with-the-office-365-cdn"></a>Какие модули PowerShell и оболочки CLI необходимо использовать для работы с CDN Office 365?

Вы можете работать с CDN Office 365 с помощью модуля PowerShell **SharePoint Online Management Shell** или **Office 365 CLI**.

+ [Начало работы с командной консолью SharePoint Online](https://docs.microsoft.com/powershell/sharepoint/sharepoint-online/connect-sharepoint-online?view=sharepoint-ps)
+ [Установка Office 365 CLI](https://pnp.github.io/office365-cli/user-guide/installing-cli/)

## <a name="see-also"></a>См. также

[Сети доставки содержимого](https://aka.ms/o365cdns)

[Планирование сети и настройка производительности для Office 365](https://aka.ms/tune)

[Ряды производительности SharePoint — серия видеороликов Office 365 CDN](https://www.youtube.com/playlist?list=PLR9nK3mnD-OWMfr1BA9mr5oCw2aJXw4WA)
