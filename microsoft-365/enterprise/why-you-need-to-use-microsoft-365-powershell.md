---
title: Зачем использовать PowerShell для Microsoft 365
ms.author: josephd
author: JoeDavies-MSFT
manager: laurawi
ms.date: 07/17/2020
audience: ITPro
ms.topic: overview
ms.service: o365-administration
localization_priority: Normal
ms.collection: Ent_O365
f1.keywords:
- CSH
ms.custom: ''
ms.assetid: b3209b1a-40c7-4ede-8e78-8a88bb2adc8a
description: Сводка. Понять, почему необходимо использовать PowerShell для управления Microsoft 365, в некоторых случаях более эффективно и в других случаях по необходимости.
ms.openlocfilehash: cbbceddc98bebaed030f4cff2f183d473d716df6
ms.sourcegitcommit: 4886457c0d4248407bddec56425dba50bb60d9c4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/03/2021
ms.locfileid: "53288471"
---
# <a name="why-you-need-to-use-powershell-for-microsoft-365"></a>Зачем использовать PowerShell для Microsoft 365

*Эта статья относится к Microsoft 365 корпоративный и Office 365 корпоративный.*

С помощью Центр администрирования Microsoft 365 вы можете управлять учетными записями Microsoft 365 и лицензиями. Вы также можете управлять Microsoft 365 службами, такими как Exchange Online, Teams и SharePoint Online. Если вместо этого использовать PowerShell для управления этими службами, вы можете использовать языковую среду командной строки и сценариев для скорости, автоматизации и дополнительных возможностей.

В этой статье показано, как использовать PowerShell для управления Microsoft 365:

- Раскройте дополнительные сведения, которые вы не видите в Центр администрирования Microsoft 365

- Настройка функций и параметров возможна только с помощью PowerShell

- Сделайте массовые операции

- Фильтрация данных

- Печать или сохранение данных

- Управление между службами

Помните, что PowerShell для Microsoft 365 — это набор модулей для Windows PowerShell, которая является командной средой для Windows и платформ. Эта среда создает язык командной оболочки, который можно расширить с помощью дополнительных модулей. Это позволяет выполнять простые или сложные команды или сценарии. Например, после установки модулей PowerShell для Microsoft 365 и подключения к подписке Microsoft 365 вы можете выполнить следующую команду, чтобы перечислить все почтовые ящики пользователей для Microsoft Exchange Online:

```powershell
Get-Mailbox
```

Список почтовых ящиков можно также получить с помощью Центр администрирования Microsoft 365, но пересчитать элементы во всех списках для всех сайтов для всех веб-приложений непросто.

PowerShell для Microsoft 365 предназначена для управления Microsoft 365, а не для замены Центр администрирования Microsoft 365. Администраторы должны иметь возможность использовать PowerShell для Microsoft 365, так как существуют некоторые процедуры конфигурации, которые можно сделать только с помощью PowerShell для Microsoft 365 команд. В этих случаях необходимо знать, как:

- Установите PowerShell для Microsoft 365 модулей (только один раз для каждого компьютера администратора).

- Подключение подписку Microsoft 365 (один раз для каждого сеанса PowerShell).

- Сбор сведений, необходимых для запуска необходимой powerShell для Microsoft 365 команд.

- Запустите PowerShell для Microsoft 365 команд.

После получения этих базовых навыков не нужно перечислять пользователей почтовых ящиков с помощью команды **Get-Mailbox.** Вам также не нужно понимать, как создать новую команду, как указанная ранее команда, чтобы подсчитать все элементы во всех списках для всех сайтов для всех веб-приложений. Корпорация Майкрософт и сообщество администраторов могут помочь вам в таких задачах при необходимости.

## <a name="powershell-for-microsoft-365-can-reveal-information-that-you-cant-see-with-the-microsoft-365-admin-center"></a>PowerShell для Microsoft 365 может раскрывать сведения, которые вы не можете увидеть с помощью Центр администрирования Microsoft 365

В Центр администрирования Microsoft 365 отображается много полезной информации. Но в нем не отображаются все возможные сведения, Microsoft 365 о пользователях, лицензиях, почтовых ящиках и сайтах. Вот пример для пользователей *и* групп в Центр администрирования Microsoft 365.

![Пример отображения пользователей и групп в Центр администрирования Microsoft 365.](../media/o365-powershell-users-and-groups.png)

В этом представлении содержится необходимая во многих случаях информация. Тем не менее, есть моменты, когда вам нужно больше. Например, Microsoft 365 лицензирование (и Microsoft 365, доступные пользователю) частично зависит от географического расположения пользователя. Политики и функции, которые можно распространить на пользователя, который живет в США, могут быть не теми, которые можно распространить на пользователя в Индии или Бельгии. Выполните следующие действия в Центр администрирования Microsoft 365, чтобы определить географическое расположение пользователя:

1. Дважды щелкните **отображаемое имя** пользователя.

2. В области отображения свойств пользователя выберите **сведения.**

3. В дисплее сведений выберите **дополнительные сведения.**

4. Прокрутите, пока не найдете **заголовки Страна или регион:**

     ![Пример сведений о регионе для пользователя в Центр администрирования Microsoft 365.](../media/o365-powershell-usage-location.png)

5. Запишите отображаемое имя и местонахождение пользователя на лист бумаги или скопируйте и вставьте их в Блокнот.

Эту процедуру необходимо повторить для каждого пользователя. Если у вас много пользователей, этот процесс может быть утомительным. С помощью PowerShell для Microsoft 365 вы можете отобразить эти сведения для всех пользователей, используя следующую команду:

```powershell
Get-AzureADUser | Select DisplayName, UsageLocation
```


>[!Note]
>PowerShell Core не поддерживает модуль Microsoft Azure Active Directory для Windows PowerShell и командлетов с *Msol* в их имени. Вы должны запустить эти комлеты из Windows PowerShell.
>

Вот пример результатов.

```powershell
DisplayName                               UsageLocation
-----------                               -------------
Bonnie Kearney                            GB
Fabrice Canel                             BR
Brian Johnson (TAILSPIN)                  US
Anne Wallace                              US
Alex Darrow                               US
David Longmuir                            BR
```

Интерпретация этой команды PowerShell: получите всех пользователей в текущей подписке Microsoft 365 **(Get-AzureADUser),** но отобразить только имя и расположение для каждого пользователя **(Выберите DisplayName, UseLocation).**

Так как PowerShell для Microsoft 365 поддерживает язык командной оболочки, можно дополнительно управлять сведениями, полученными командой **Get-AzureADUser.** Например, может быть, вы хотите сортировать этих пользователей по их расположению, сгруппировать всех бразильских пользователей, всех пользователей Соединенных Штатов вместе и так далее. Вот команда:

```powershell
Get-AzureADUser | Select DisplayName, UsageLocation | Sort UsageLocation, DisplayName
```

Вот пример результатов.

```powershell
DisplayName                                 UsageLocation
-----------                                 -------------
David Longmuir                              BR
Fabrice Canel                               BR
Bonnie Kearney                              GB
Alex Darrow                                 US
Anne Wallace                                US
Brian Johnson (TAILSPIN)                    US
```

Интерпретация этой команды PowerShell: получите всех пользователей в текущей подписке Microsoft 365, но отобразить имя и расположение для каждого пользователя и сортировать их сначала по расположению, а затем по имени **(Sort UseLocation, DisplayName).**

Можно также использовать дополнительную фильтрацию. Например, если нужно просмотреть сведения о пользователях, находящихся в Бразилии, используйте следующую команду:

```powershell
Get-AzureADUser | Where {$_.UsageLocation -eq "BR"} | Select DisplayName, UsageLocation
```

Вот пример результатов.

```powershell
DisplayName                                           UsageLocation
-----------                                           -------------
David Longmuir                                        BR
Fabrice Canel                                         BR
```

Интерпретация этой команды PowerShell: получите всех пользователей в текущей подписке Microsoft 365, расположение которой Бразилия (**Where {$ \_ . UseLocation -eq "BR"} и** затем отображает имя и расположение для каждого пользователя.

 **Примечание о больших доменах**

Если у вас есть большой домен с десятками тысяч пользователей, некоторые примеры, которые мы показывем в этой статье, могут привести к регулирование. В зависимости от таких факторов, как вычислительная мощность и доступная пропускная способность сети, вы можете одновременно пытаться сделать слишком много. Крупные организации могут разделить некоторые из этих операций PowerShell на две команды.

Например, следующая команда возвращает все учетные записи пользователей и показывает имя и расположение для каждой из них:

```powershell
Get-AzureADUser | Select DisplayName, UsageLocation
```

Она отлично подходит для небольших доменов. Но в крупной организации эту операцию можно разделить на две команды: одну команду для хранения сведений об учетной записи пользователя в переменной, а другую для отображения необходимых сведений. Пример:

```powershell
$x = Get-AzureADUser
$x | Select DisplayName, UsageLocation
```

Интерпретация этого набора команд PowerShell:
1. Получите всех пользователей текущего Microsoft 365 и храните сведения в переменной с именем $x **($x = Get-AzureADUser).**
1.  Отображение содержимого переменной *$x,* но только имя и расположение для **каждого пользователя ($x | Выберите DisplayName, UseLocation**).

## <a name="microsoft-365-has-features-that-you-can-only-configure-with-powershell-for-microsoft-365"></a>Microsoft 365 функции, которые можно настроить только в PowerShell для Microsoft 365

Эта Центр администрирования Microsoft 365 предназначена для обеспечения доступа к общим полезным административным задачам, которые применяются к большинству сред. Другими словами, Центр администрирования Microsoft 365 был разработан таким образом, чтобы типичный администратор может выполнять наиболее распространенные задачи управления. Но есть некоторые задачи, которые не могут быть сделаны в центре администрирования.

Например, центр администрирования Skype для бизнеса Online предоставляет несколько вариантов создания настраиваемого приглашения на собрания:

![Пример отображения настраиваемых приглашений на собрание в Центре администрирования Skype для бизнеса Online.](../media/o365-powershell-meeting-invitation.png)

С помощью указанных ниже параметров приглашения на собрания можно сделать более персонализированными и профессиональными. Но параметров конфигурации собраний больше, чем просто создание настраиваемого приглашения на собрания. Например, по умолчанию собрания позволяют:

- анонимным пользователям автоматически присоединяться к каждому собранию;

- участникам записывать собрание;

- обозначать всех пользователей из вашей организации докладчиками при их присоединении к собранию.

Эти параметры недоступны в центре администрирования Skype для бизнеса Online. Вы можете управлять ими из PowerShell для Microsoft 365. Вот команда, которая отключает эти три параметра:

```powershell
Set-CsMeetingConfiguration -AdmitAnonymousUsersByDefault $False -AllowConferenceRecording $False -DesignateAsPresenter "None"
```

> [!NOTE]
> Чтобы выполнить эту команду, необходимо установить [модуль Skype для бизнеса PowerShell.](https://www.microsoft.com/download/details.aspx?id=39366)

Интерпретация этой команды PowerShell:

1. В настройках для новых собраний Skype для бизнеса Online **(Set-CsMeetingConfiguration)** отключить доступ анонимных пользователей к автоматическому входу на собрания **(-AdmitAnonymousUsersByDefault $False).**
2.  Отключение возможности для участников записывать собрания **(-AllowConferenceRecording $False).**
3. Не назначайте всех пользователей из вашей организации в качестве презентеров **(-DesignateAsPresenter "None").**

Чтобы восстановить эти параметры по умолчанию (включить параметры), запустите эту команду:

```powershell
Set-CsMeetingConfiguration -AdmitAnonymousUsersByDefault $True -AllowConferenceRecording $True -DesignateAsPresenter "Company"
```

Существуют и другие аналогичные сценарии, поэтому администраторы должны знать, как запускать PowerShell для Microsoft 365 команд.

## <a name="powershell-for-microsoft-365-is-great-for-bulk-operations"></a>PowerShell для Microsoft 365 отлично подходит для массовых операций

Visual interfaces like the Центр администрирования Microsoft 365 are most valuable when you have a single operation to do. Например, если требуется отключить одну учетную запись пользователя, можно использовать центр администрирования для быстрого обнаружения и очистки почтового ящика. Это может быть проще, чем выполнение аналогичной операции в PowerShell.

Но если в большом наборе других вещей необходимо изменить многое или некоторые выбранные вещи, Центр администрирования Microsoft 365 может оказаться не самым лучшим средством. Например, скажите, что необходимо изменить префикс на тысячах номеров телефонов или удалить определенного пользователя *Кена Myer* со всех SharePoint веб-сайтов. Как это сделать в Центр администрирования Microsoft 365?

В последнем примере скажем, что у вас несколько SharePoint веб-сайтов, и вы не знаете, какие из них Кен Мейер является членом. Вам нужно будет начать с Центр администрирования Microsoft 365, а затем выполнить эту процедуру для каждого сайта:

1. Выберите **URL-адрес** сайта.

2. В поле **свойства коллекции веб-сайтов** выберите ссылку **Адрес** веб-сайта для открытия сайта.

3. На сайте выберите **Share**.

4. В **диалоговом** окне Share выберите ссылку, на которую будут показаны все пользователи, у которых есть разрешения на сайт:

     ![Пример просмотра участников сайта SharePoint Online в Центре администрирования SharePoint Online](../media/o365-powershell-view-permissions.png)

5. В **диалоговом окне "Общий** доступ" выберите **Расширенный**.

6. Прокрутите список пользователей, найдите и выберите Кена Myer (если у него есть разрешения на сайт), а затем выберите **Remove User Permissions**.

Это займет много *времени* для нескольких сотен сайтов.

Альтернативой является запуск следующей команды в PowerShell для Microsoft 365, чтобы удалить Кена Myer со всех сайтов:

```powershell
Get-SPOSite | ForEach {Remove-SPOUser -Site $_.Url -LoginName "kenmyer@litwareinc.com"}
```

> [!NOTE]
> Эта команда требует установки модуля [SharePoint PowerShell.](/powershell/sharepoint/sharepoint-online/connect-sharepoint-online)

Интерпретация этой команды PowerShell: получить все SharePoint сайты в текущей подписке Microsoft 365 **(Get-SPOSite)** и для каждого сайта удалить Кена Мейера из списка пользователей, которые могут получить к нему доступ **(ForEach {Remove-SPOUser-Site $ \_ . . URL-LoginName "kenmyer \@ litwareinc.com"}**).

Мы Microsoft 365 удалить Кена Мейера с каждого сайта, включая те, к кому он не имеет доступа. Таким образом, в результатах будут показываться ошибки для тех сайтов, к которые он не имеет доступа. Мы можем использовать дополнительное условие в этой команде, чтобы удалить Кена Мейера только с сайтов, на которые он входит в список входа. Но ошибки, которые возвращаются, не причиняют вреда самим сайтам. Эта команда может занять несколько минут для запуска сотен сайтов, а не часов работы Центр администрирования Microsoft 365.

Вот еще один пример массовой операции. Используйте эту команду, чтобы добавить *Бонни Kearney*, новый администратор SharePoint, на все сайты в организации:

```powershell
Get-SPOSite | ForEach {Add-SPOUser -Site $_.Url -LoginName "bkearney@litwareinc.com" -Group "Members"}
```

Интерпретация этой команды PowerShell: Получите все SharePoint сайтов в текущей подписке Microsoft 365 и для каждого сайта разрешить доступ Бонни Kearney, добавив свое имя входа в группу членов сайта (**ForEach {Add-SPOUser-Site $ \_ . URL-LoginName "bkearney \@ litwareinc.com" -Group "Members"}**).

## <a name="powershell-for-microsoft-365-is-great-at-filtering-data"></a>PowerShell для Microsoft 365 отлично подходит для фильтрации данных

В Центр администрирования Microsoft 365 содержится несколько способов фильтрации данных, чтобы легко найти целевой подмножество данных. Например, Exchange упрощает фильтрацию практически любого свойства почтового ящика пользователя. Например, вот список почтовых ящиков для всех пользователей, которые живут в городе Блумингтон:

![Пример с расширенным поиском в Центр администрирования Microsoft 365 списка почтовых ящиков для всех пользователей, которые живут в городе Блумингтон.](../media/o365-powershell-advanced-search.png)

Центр администрирования Exchange также позволяет сочетать критерии фильтрации. Например, вы можете найти почтовые ящики для всех людей, которые живут в Блумингтоне и работают в финансовом отделе.

Но есть ограничения для того, что можно сделать в центре администрирования Exchange администратора. Например, не так просто найти почтовые ящики людей, которые  живут в Блумингтоне или Сан-Диего, или почтовые ящики для всех людей, которые не живут в Блумингтоне.

Вы можете использовать следующую команду PowerShell для Microsoft 365, чтобы получить список почтовых ящиков для всех людей, которые живут в Блумингтоне или Сан-Диего:

```powershell
Get-User | Where {$_.RecipientTypeDetails -eq "UserMailbox&quot; -and ($_.City -eq &quot;San Diego&quot; -or $_.City -eq &quot;Bloomington")} | Select DisplayName, City
```

Вот пример результатов.

```powershell
DisplayName                              City
-----------                              ----
Alex Darrow                              San Diego
Bonnie Kearney                           San Diego
Julian Isla                              Bloomington
Rob Young                                Bloomington
```

Интерпретация этой команды PowerShell: получите всех пользователей в текущей подписке Microsoft 365, у которых есть почтовый ящик в городе Сан-Диего или Блумингтоне (**Where {$ \_ . RecipientTypeDetails -eq "UserMailbox" и ($ \_ . City-eq "San Diego" или \_ $. City-eq "Bloomington")}** и затем отобразить имя и город для каждого **(Выберите DisplayName, City).**

И вот команда перечислить все почтовые ящики для людей, которые живут в любом месте, кроме Bloomington:

```powershell
Get-User | Where {$_.RecipientTypeDetails -eq "UserMailbox" -and $_.City -ne "Bloomington"} | Select DisplayName, City
```

Вот пример результатов.

```powershell
DisplayName                               City
-----------                               ----
MOD Administrator                         Redmond
Alex Darrow                               San Diego
Allie Bellew                              Bellevue
Anne Wallace                              Louisville
Aziz Hassouneh                            Cairo
Belinda Newman                            Charlotte
Bonnie Kearney                            San Diego
David Longmuir                            Waukesha
Denis Dehenne                             Birmingham
Garret Vargas                             Seattle
Garth Fort                                Tulsa
Janet Schorr                              Bellevue
```

Интерпретация этой команды PowerShell: получите всех пользователей в текущей подписке Microsoft 365, у которых почтовый ящик не расположен в городе Блумингтон **(Where {$ \_ . RecipientTypeDetails -eq "UserMailbox" и $ \_ . City -ne "Bloomington"}**, а затем отобразить имя и город для каждого.

### <a name="use-wildcards"></a>Использование подкардов

Кроме того, в фильтрах PowerShell можно использовать символы под диктовки, чтобы соответствовать части имени. Например, предположим, что вы ищете учетную запись пользователя. Все, что вы можете помнить, это то, что имя пользователя было *Андерсон* или, может *быть, Хендерсон* или *Йоргенсон*.

Вы можете отследить этого пользователя в Центр администрирования Microsoft 365 с помощью средства поиска и проведения трех различных поисков:

- *Андерсон*  ;

- *Хендерсон*  ;

- *Йоргенсон*  .

Так как все три этих имени заканчиваются в "сыне", можно сказать PowerShell, чтобы отображались все пользователи, имя которых заканчивается в "сыне". Вот команда:

```powershell
Get-User -Filter '{LastName -like "*son"}'
```

Интерпретация этой команды PowerShell: получите всех пользователей в текущей подписке Microsoft 365, но используйте фильтр, который перечислены только те пользователи, чьи фамилии заканчиваются в "son"**(-Filter '{LastName-like \* "son"}"**). \*Подстройки для любого набора символов, которые являются буквами в фамилии пользователя.

## <a name="powershell-for-microsoft-365-makes-it-easy-to-print-or-save-data"></a>PowerShell для Microsoft 365 упрощает печать или сохранение данных

В Центр администрирования Microsoft 365 позволяет просматривать списки данных. Вот пример центра администрирования Skype для бизнеса Online, отображающий список пользователей, включенных для Skype для бизнеса Online:

![Пример Центра администрирования Skype для бизнеса Online со списком пользователей, для которых включен Skype для бизнеса Online.](../media/o365-powershell-lync-users.png)

Чтобы сохранить эти сведения в файле, необходимо вклеить их в документ или Microsoft Excel таблицу. В любом случае может потребоваться дополнительное форматирование. Кроме того, Центр администрирования Microsoft 365 не предоставляет способ непосредственно распечатать отображаемую список.

К счастью, с помощью PowerShell можно не только отобразить список, но и сохранить его в файле, который можно легко импортировать в Excel. Вот пример команды для сохранения данных пользователей Skype для бизнеса Online в файле с разделенными запятой значениями (CSV), который можно легко импортировать в качестве таблицы в Excel таблице:

```powershell
Get-CsOnlineUser | Select DisplayName, UserPrincipalName, UsageLocation | Export-Csv -Path "C:\Logs\SfBUsers.csv" -NoTypeInformation
```

Вот пример результатов.

![Пример таблицы, импортируемой в Excel таблицу для данных пользователей Skype для бизнеса Online, сохраненных в файле значений, разделенных запятой.](../media/o365-powershell-data-in-excel.png)

Интерпретация этой команды PowerShell: получите все Skype для бизнеса пользователей в текущей подписке Microsoft 365 **(Get-CsOnlineUser);** получение только имени пользователя, upN и расположения **(Select DisplayName, UserPrincipalName, UseLocation);** а затем сохраните эти сведения в CSV-файле C: \\ \\ LogsSfBUsers.csv **(Export-Csv-Path "C: \\ Logs \\SfBUsers.csv" -NoTypeInformation**).

Вы также можете использовать параметры для сохранения этого списка в качестве XML-файла или htmL-страницы. На самом деле с помощью дополнительных команд PowerShell можно сохранить его непосредственно в виде Excel, с любым пользовательским форматированием.

Вы также можете отправить вывод команды PowerShell, которая отображает список непосредственно на принтере по умолчанию в Windows. Вот пример команды:

```powershell
Get-CsOnlineUser | Select DisplayName, UserPrincipalName, UsageLocation | Out-Printer
```

Ниже показано, как будет выглядеть напечатанный документ.

![Пример печатного документа, который был выходной командой PowerShell, отправленной непосредственно на принтер по умолчанию в Windows.](../media/o365-powershell-printed-data.png)

Интерпретация этой команды PowerShell: получите все Skype для бизнеса пользователей в текущем Microsoft 365 подписке; получение только имени пользователя, upN и расположения; а затем отправьте эти сведения на принтер Windows по умолчанию **(Out-Printer).**

Печатный документ имеет тот же простой формат, что и дисплей в окне командной окне PowerShell. Чтобы получить твердую копию, просто добавьте **| Вне принтера** до конца команды.

## <a name="powershell-for-microsoft-365-lets-you-manage-across-server-products"></a>PowerShell для Microsoft 365 позволяет управлять через серверные продукты

Компоненты, составляющие Microsoft 365, предназначены для совместной работы. Например, предположим, что в Microsoft 365 добавлен новый пользователь и указаны такие сведения, как отдел пользователя и номер телефона. Эти сведения будут доступны при доступе к данным пользователя в любой из Microsoft 365: Skype для бизнеса Online, Exchange или SharePoint.

Это общие сведения, распространяющиеся на набор продуктов. Сведения, характерные для продукта, например сведения о Exchange почтовом ящике пользователя, обычно недоступны в наборе. Например, сведения о включенном или не включенном почтовом ящике пользователя доступны только в центре администрирования Exchange администратора.

Предположим, вы хотите создать отчет со следующим сведениями обо всех пользователях:

- краткое имя пользователя;

- Лицензируется ли пользователь для Microsoft 365

- включен ли почтовый ящик Exchange пользователя;

- включено ли для пользователя приложение Skype для бизнеса Online.

Вы не можете легко создать такой отчет в Центр администрирования Microsoft 365. Вместо этого необходимо создать отдельный документ для хранения информации, например Excel таблицы. Затем получите все имена пользователей и сведения о лицензировании из Центр администрирования Microsoft 365, получите сведения о почтовых ящиках из центра администрирования Exchange, получите сведения Skype для бизнеса Online из центра администрирования Skype для бизнеса Online, а затем объединяйте эти сведения.

Альтернативой является использование скрипта PowerShell для компиляции отчета для вас.

Следующий сценарий примера более сложный, чем команды, которые вы видели до сих пор в этой статье. Но он показывает потенциал использования PowerShell для создания представлений информации, которые трудно получить в противном случае. Ниже показан сценарий для компиляции и отображения списка, который необходим:

```powershell
$x = Get-AzureADUser

foreach ($i in $x)
    {
      $y = Get-Mailbox -Identity $i.UserPrincipalName
      $i | Add-Member -MemberType NoteProperty -Name IsMailboxEnabled -Value $y.IsMailboxEnabled

      $y = Get-CsOnlineUser -Identity $i.UserPrincipalName
      $i | Add-Member -MemberType NoteProperty -Name EnabledForSfB -Value $y.Enabled
    }

$x | Select DisplayName, IsLicensed, IsMailboxEnabled, EnabledforSfB
```

Вот пример результатов.

```powershell
DisplayName             IsLicensed   IsMailboxEnabled   EnabledForSfB
-----------             ----------   ----------------   --------------
Bonnie Kearney          True         True               True
Fabrice Canel           True         True               True
Brian Johnson           False        True               False
Anne Wallace            True         True               True
Alex Darrow             True         True               True
David Longmuir          True         True               True
Katy Jordan             False        True               False
Molly Dempsey           False        True               False
```

Интерпретация этого сценария PowerShell:

1. Получите всех пользователей текущего Microsoft 365 и храните сведения в переменной с именем *$x* **($x = Get-AzureADUser).**
1. Запустите цикл, который выполняется над всеми пользователями в переменной $x ($i **в $x).**
1. Определите переменную *с именем $y* и храните в ней сведения о почтовом ящике пользователя **($y = Get-Mailbox-Identity $i.UserPrincipalName).**
1. Добавьте новое свойство к сведениям пользователей с именем *IsMailBoxEnabled.* Установите значение свойства IsMailBoxEnabled почтового ящика пользователя **($i | Add-Member-MemberType NoteProperty -Name IsMailboxEnabled -Value $y.IsMailboxEnabled**).
1. Определите переменную *с именем $y* и храните в ней сведения Skype для бизнеса Online **($y = Get-CsOnlineUser-Identity $i.UserPrincipalName).**
1. Добавьте новое свойство к сведениям пользователей с именем *EnabledForSfB.* Установите его для значения свойства Включенная информация Skype для бизнеса Online пользователя **($i | Add-Member-MemberType NoteProperty-Name EnabledForSfB-Value $y.Enabled).**
1. Отобразить список пользователей, но включить только их имя, лицензированы ли они, и два новых свойства, которые указывают, включен ли их почтовый ящик и включен ли он для Skype для бизнеса Online (**$x | Выберите DisplayName, IsLicensed, IsMailboxEnabled, EnabledforSfB).**

## <a name="see-also"></a>См. также

[Начало работы с PowerShell для Microsoft 365](getting-started-with-microsoft-365-powershell.md)

[Управление учетными записями пользователей Microsoft 365, лицензиями и группами с помощью PowerShell](manage-user-accounts-and-licenses-with-microsoft-365-powershell.md)

[Использование Windows PowerShell для создания отчетов в Microsoft 365](use-windows-powershell-to-create-reports-in-microsoft-365.md)