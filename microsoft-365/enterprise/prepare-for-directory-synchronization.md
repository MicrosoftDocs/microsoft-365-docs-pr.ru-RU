---
title: Подготовка к синхронизации каталогов с Microsoft 365
ms.author: josephd
author: JoeDavies-MSFT
manager: laurawi
ms.date: 09/30/2020
audience: Admin
ms.topic: article
ms.service: o365-administration
localization_priority: Normal
f1.keywords:
- CSH
ms.custom:
- Adm_O365
- O365p_AddUsersWithDirSync
- O365M_AddUsersWithDirSync
- O365E_HRCSetupAADConnectAboutLM617031
- O365E_AddUsersWithDirSync
ms.collection:
- Ent_O365
- M365-identity-device-management
search.appverid:
- MET150
- MOP150
- MOE150
- MBS150
ms.assetid: 01920974-9e6f-4331-a370-13aea4e82b3e
description: В этой статье описано, как подготовить пользователей к работе с Microsoft 365, используя синхронизацию службы каталогов и долгосрочные преимущества использования этого метода.
ms.openlocfilehash: e49cc4472b47320650d8a0ca90395b69ae5b6df7
ms.sourcegitcommit: bdf65d48b20f0f428162c39ee997accfa84f4e5d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/20/2020
ms.locfileid: "49371628"
---
# <a name="prepare-for-directory-synchronization-to-microsoft-365"></a>Подготовка к синхронизации каталогов с Microsoft 365

*Эта статья относится к Microsoft 365 корпоративный и Office 365 корпоративный.*

Преимущества для гибридных удостоверений и синхронизации каталогов в Организации включают:

- Сокращение количества программ администрирования в Организации
- Необязательное включение сценария единого входа
- Автоматизация изменений учетных записей в Microsoft 365

Более подробную информацию о преимуществах синхронизации службы каталогов можно узнать в статье [Гибридная идентификация с помощью Azure Active Directory (Azure AD)](https://go.microsoft.com/fwlink/p/?LinkId=525398) и [гибридного удостоверения для Microsoft 365](plan-for-directory-synchronization.md).

Однако для синхронизации службы каталогов требуется планирование и подготовка, чтобы убедиться, что доменные службы Active Directory (AD DS) синхронизируются с клиентом Azure AD вашей подписки на Microsoft 365 с использованием минимума ошибок.

Чтобы получить наилучшие результаты, выполните указанные ниже действия.

## <a name="1-directory-cleanup-tasks"></a>1. задачи очистки каталога

Перед синхронизацией доменных служб Active Directory с клиентом Azure AD необходимо очистить службу AD DS.

> [!IMPORTANT]
> Если вы не выполняете очистку доменных служб Active Directory перед синхронизацией, это может привести к значительному негативному снижению процесса развертывания. Может потребоваться несколько дней или даже недель, чтобы пройти цикл синхронизации службы каталогов, выявить ошибки и повторную синхронизацию.

В доменных службах Active Directory выполните следующие задачи очистки для каждой учетной записи пользователя, которой будет назначена лицензия Microsoft 365:

1. Убедитесь, что в атрибуте **proxyAddresses** допустимый и уникальный адрес электронной почты.

2. Удалите все повторяющиеся значения в атрибуте **proxyAddresses** .

3. Если это возможно, убедитесь, что допустимое и уникальное значение атрибута **userPrincipalName** в объекте **пользователя** пользователя. Для достижения наилучшего качества синхронизации убедитесь, что имя участника-службы доменных служб Active Directory соответствует имени участника-пользователя Azure AD. Если у пользователя нет значения атрибута **userPrincipalName** , то объект **пользователя** должен содержать допустимое и уникальное значение для атрибута **SamAccountName** . Удалите все повторяющиеся значения в атрибуте **userPrincipalName** .

4. Для оптимального использования глобального списка адресов (GAL) необходимо убедиться в правильности сведений в следующих атрибутах учетной записи пользователя доменных служб Active Directory:

   - givenName
   - surname
   - displayName
   - должность;
   - Отдел
   - Кабинет
   - рабочий телефон;
   - мобильный телефон;
   - номер факса;
   - адрес;
   - Город
   - регион или область;
   - почтовый индекс;
   - страна или регион.

## <a name="2-directory-object-and-attribute-preparation"></a>2. Подготовка объекта каталога и атрибута

Для успешного выполнения синхронизации каталогов между доменными службами Active Directory и Microsoft 365 необходимо, чтобы атрибуты доменных служб Active Directory были правильно подготовлены. Например, необходимо убедиться, что определенные символы не используются в определенных атрибутах, которые синхронизируются с средой Microsoft 365. Непредусмотренные символы не приводят к сбою синхронизации службы каталогов, но могут возвращать предупреждение. Недопустимые символы приведут к сбою синхронизации службы каталогов.

Синхронизация службы каталогов также завершится с ошибками, если некоторые пользователи доменных служб Active Directory имеют один или несколько повторяющихся атрибутов. Каждый пользователь должен иметь уникальные атрибуты.

Ниже перечислены атрибуты, которые необходимо подготовить.

- **displayName**

  - Если атрибут существует в объекте пользователя, он будет синхронизирован с Microsoft 365.
  - Если этот атрибут существует в объекте пользователя, для него должно быть задано значение. То есть атрибут не должен быть пустым.
  - Максимальное число символов: 256

- **givenName**

  - Если атрибут существует в объекте пользователя, он будет синхронизирован с Microsoft 365, но Microsoft 365 не требует и не использует его.
  - Максимальное число символов: 64

- **mail**

  - Значение атрибута должно быть уникальным в пределах каталога.

    > [!NOTE]
    > Если имеются повторяющиеся значения, первый пользователь со значением синхронизируется. Последующие пользователи не будут отображаться в Microsoft 365. Необходимо изменить значение в Microsoft 365 или изменить оба значения в доменных СЛУЖБах Active Directory, чтобы оба пользователя отображались в Microsoft 365.

- **mailNickname** (псевдоним Exchange)

  - Значение атрибута не может начинаться с точки (.).
  - Значение атрибута должно быть уникальным в пределах каталога.

    > [!NOTE]
    > Символ подчеркивания ("_") в синхронизированном имени указывает на то, что исходное значение этого атрибута содержит недопустимые символы. Дополнительные сведения об этом атрибуте приведены в разделе [атрибут псевдонима Exchange](https://docs.microsoft.com/powershell/module/exchange/set-mailbox).
    >

- **proxyAddresses**

  - Атрибут с несколькими значениями
  - Максимальное число символов на значение: 256
  - Значение атрибута не должно содержать пробел.
  - Значение атрибута должно быть уникальным в пределах каталога.
  - Недопустимые символы: \< \> ();, [] "'

    Обратите внимание, что недопустимые символы применяются к символам, которые следует за разделителем типов и ":", так как SMTP:User@contso.com разрешен, а SMTP:user:M@contoso.com — нет.

    > [!IMPORTANT]
    > Все SMTP-адреса должны соответствовать стандартам обмена сообщениями электронной почты. Удалите повторяющиеся или нежелательные адреса, если они существуют.

- **sAMAccountName**

  - Максимальное число символов: 20
  - Значение атрибута должно быть уникальным в пределах каталога.
  - Недопустимые символы: [\ "|,/: \< \> + =;? \* ']
  - Если пользователь имеет недопустимый атрибут **SamAccountName** , но имеет допустимый атрибут **userPrincipalName** , учетная запись пользователя создается в Microsoft 365.
  - Если и **SamAccountName** , и **userPrincipalName** являются недопустимыми, необходимо обновить атрибут **userPrincipalName** доменных служб Active Directory.

- **СН** (фамилия)

  - Если атрибут существует в объекте пользователя, он будет синхронизирован с Microsoft 365, но Microsoft 365 не требует и не использует его.

- **targetAddress**

    Необходимо, чтобы атрибут **targetAddress** (например, SMTP:Tom@contoso.com), заполненный для пользователя, отображался в глобальном списке адресов Microsoft 365. В сценариях миграции сторонней системы обмена сообщениями необходимо расширение схемы Microsoft 365 для AD DS. Расширение схемы Microsoft 365 также будет добавлять другие атрибуты для управления объектами Microsoft 365, заполненными с помощью средства синхронизации каталогов из доменных служб Active Directory. Например, вы добавите атрибут **msExchHideFromAddressLists** для управления скрытыми почтовыми ящиками или группами рассылки.

  - Максимальное число символов: 256
  - Значение атрибута не должно содержать пробел.
  - Значение атрибута должно быть уникальным в пределах каталога.
  - Недопустимые символы: \ \< \> ();, [] "
  - Все SMTP-адреса должны соответствовать стандартам обмена сообщениями электронной почты.

- **userPrincipalName**

  - Атрибут **userPrincipalName** должен быть в формате для входа в Интернет, где за именем пользователя следуют знак "@" и доменное имя: например, user@contoso.com. Все SMTP-адреса должны соответствовать стандартам обмена сообщениями электронной почты.
  - Максимальное число символов для атрибута **userPrincipalName** — 113. Определенное количество символов допускаются до и после знака "@" (@), как показано ниже.
  - Максимальное число символов для имени пользователя, которое находится перед знаком (@): 64
  - Максимальное число символов для доменного имени после знака "@": 48
  - Недопустимые символы: \% &amp; \* +/=? { } | \< \> ( ) ; : , [ ] "
  - Допустимые символы: A – Z, A-z, 0 – 9, ". - _ ! # ^ ~
  - Буквы с диакритическими знаками, например умлауты, диакритические знаки и тильды, являются недопустимыми.
  - В каждом значении **userPrincipalName** необходимо указать символ @.
  - Символ "@" не может быть первым символом в каждом значении **userPrincipalName**.
  - Имя пользователя не может заканчиваться точкой (.), амперсандом ( &amp; ), пробелом или знаком @.
  - Имя пользователя не может содержать пробелы.
  - Необходимо использовать маршрутизируемые домены; Например, нельзя использовать локальные или внутренние домены.
  - Символы кодировки Юникод преобразуются в символы подчеркивания.
  - **userPrincipalName** не может содержать дублирующиеся значения в каталоге.

## <a name="3-prepare-the-userprincipalname-attribute"></a>3. Подготовка атрибута userPrincipalName

Служба Active Directory позволяет конечным пользователям в Организации входить в каталог с помощью **SamAccountName** или **userPrincipalName**. Аналогичным образом пользователи могут войти в Microsoft 365 с помощью имени участника-пользователя (UPN) своей рабочей или учебной учетной записи. Синхронизация службы каталогов пытается создать новых пользователей в Azure Active Directory с использованием того же имени участника-пользователя, что и в доменных СЛУЖБах Active Directory. Имя участника-пользователя отформатировано как адрес электронной почты.

В Microsoft 365 UPN является атрибутом по умолчанию, который используется для создания адреса электронной почты. Вы можете легко получить **userPrincipalName** (в AD DS и в Azure AD), а основной адрес электронной почты в **proxyAddresses** задан с разными значениями. Если заданы разные значения, могут быть неудобства для администраторов и конечных пользователей.

Лучше всего выравнивать эти атрибуты, чтобы избежать путаницы. Чтобы удовлетворить требования единого входа с помощью служб федерации Active Directory (AD FS) 2,0, необходимо убедиться, что имена участников-пользователей в Azure Active Directory и доменные службы Active Directory совпадают и используют допустимое пространство имен доменов.

## <a name="4-add-an-alternative-upn-suffix-to-ad-ds"></a>4. Добавление альтернативного суффикса UPN в доменные службы Active Directory

Может потребоваться добавить альтернативный суффикс имени участника-пользователя для связи учетных данных организации пользователя с средой Microsoft 365. Суффикс UPN — это часть имени участника-пользователя, расположенная справа от символа @. UPN-имена, которые используются для единого входа, могут содержать буквы, цифры, точки, дефисы и подчеркивания, другие символы запрещены.

Дополнительные сведения о том, как добавить альтернативный суффикс UPN в Active Directory, можно найти в статье [Подготовка к синхронизации службы каталогов]( https://go.microsoft.com/fwlink/p/?LinkId=525430).

## <a name="5-match-the-ad-ds-upn-with-the-microsoft-365-upn"></a>5. Сопоставьте имя участника-службы доменных служб Active Directory с именем участника-пользователя Microsoft 365.

Если вы уже настроили синхронизацию службы каталогов, имя участника-пользователя для Microsoft 365 может отличаться от имени участника-пользователя доменных служб Active Directory AD, которое определено в доменных службах Active Directory. Это может произойти, если пользователю была назначена лицензия до проверки домена. Чтобы устранить эту проблему, используйте [PowerShell для исправления повторяющегося имени участника](https://go.microsoft.com/fwlink/p/?LinkId=396730) -пользователя и обновления имени участника-пользователя Microsoft 365, чтобы убедиться, что имя участника-пользователя Microsoft соответствует корпоративному имени пользователя и домену. Если вы обновляете имя участника-пользователя в доменных СЛУЖБах Active Directory и хотите, чтобы он выполнял синхронизацию с удостоверением Azure Active Directory, необходимо удалить лицензию пользователя в Microsoft 365 перед внесением изменений в AD DS.

Кроме того, Узнайте [, как подготовить домен, не поддерживающий маршрутизацию (например, локальный домен), для синхронизации службы каталогов](prepare-a-non-routable-domain-for-directory-synchronization.md).

## <a name="next-steps"></a>Дальнейшие действия

Если вы выполнили шаги с 1 по 5, ознакомьтесь с разделом [Настройка синхронизации службы каталогов](set-up-directory-synchronization.md).
