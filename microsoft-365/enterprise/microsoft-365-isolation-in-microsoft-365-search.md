---
title: Изоляция клиента в поиске Microsoft 365
ms.author: robmazz
author: robmazz
manager: laurawi
audience: ITPro
ms.topic: article
ms.service: O365-seccomp
localization_priority: Normal
search.appverid:
- MET150
ms.collection:
- Strat_O365_IP
- M365-security-compliance
f1.keywords:
- NOCSH
description: В этой статье найдите объяснение работы изоляции клиента для раздельного хранения данных клиента в Microsoft 365 Search.
ms.custom: seo-marvel-apr2020
ms.openlocfilehash: 3416afdeceaa7000b516ec89b4a2a1e59d8708d0
ms.sourcegitcommit: c029834c8a914b4e072de847fc4c3a3dde7790c5
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/02/2020
ms.locfileid: "47332404"
---
# <a name="tenant-isolation-in-microsoft-365-search"></a><span data-ttu-id="78a40-103">Изоляция клиента в поиске Microsoft 365</span><span class="sxs-lookup"><span data-stu-id="78a40-103">Tenant Isolation in Microsoft 365 Search</span></span>

<span data-ttu-id="78a40-104">SharePoint Поиск в Интернете использует модель разделения клиента, которая уравновешивания эффективности общих структур данных с защитой от утечки информации между арендаторами.</span><span class="sxs-lookup"><span data-stu-id="78a40-104">SharePoint Online search uses a tenant separation model that balances the efficiency of shared data structures with protection against information leaking between tenants.</span></span> <span data-ttu-id="78a40-105">С помощью этой модели мы не мешаем функциям поиска:</span><span class="sxs-lookup"><span data-stu-id="78a40-105">With this model, we prevent the Search features from:</span></span>

- <span data-ttu-id="78a40-106">Возвращение результатов запроса, содержащих документы от других клиентов</span><span class="sxs-lookup"><span data-stu-id="78a40-106">Returning query results that contain documents from other tenants</span></span>
- <span data-ttu-id="78a40-107">Анализ достаточной информации в запросе приводит к выводу, что опытный пользователь может сделать вывод о других клиентах.</span><span class="sxs-lookup"><span data-stu-id="78a40-107">Exposing sufficient information in query results that a skilled user could infer information about other tenants</span></span>
- <span data-ttu-id="78a40-108">Отображение схемы или параметров другого клиента</span><span class="sxs-lookup"><span data-stu-id="78a40-108">Showing schema or settings from another tenant</span></span>
- <span data-ttu-id="78a40-109">Смешивание сведений об обработке аналитики между арендаторами или хранилищем приводит к неправильному клиенту</span><span class="sxs-lookup"><span data-stu-id="78a40-109">Mixing analytics processing information between tenants or store results in the wrong tenant</span></span>
- <span data-ttu-id="78a40-110">Использование записей словарей от другого клиента</span><span class="sxs-lookup"><span data-stu-id="78a40-110">Using dictionary entries from another tenant</span></span>

<span data-ttu-id="78a40-111">Для каждого типа данных клиента мы используем один или несколько уровней защиты в коде для предотвращения случайной утечки информации.</span><span class="sxs-lookup"><span data-stu-id="78a40-111">For each type of tenant data, we use one or more layers of protection in the code to prevent accidental leaking of information.</span></span> <span data-ttu-id="78a40-112">Наиболее важные данные обладает самыми слоями защиты, чтобы убедиться, что один дефект не приведет к фактической или предполагаемой утечке информации.</span><span class="sxs-lookup"><span data-stu-id="78a40-112">The most critical data has the most layers of protection to make sure that a single defect doesn't result in actual or perceived information leakage.</span></span>

## <a name="tenant-separation-for-the-search-index"></a><span data-ttu-id="78a40-113">Разделение клиента для индекса поиска</span><span class="sxs-lookup"><span data-stu-id="78a40-113">Tenant Separation for the Search Index</span></span>

<span data-ttu-id="78a40-114">Индекс поиска хранится на диске на серверах, на которые размещены компоненты индекса, а клиенты делятся файлами индекса.</span><span class="sxs-lookup"><span data-stu-id="78a40-114">The search index is stored on disk in the servers hosting the index components and the tenants share the index files.</span></span> <span data-ttu-id="78a40-115">Индексные документы клиента видны только для запросов для этого клиента.</span><span class="sxs-lookup"><span data-stu-id="78a40-115">A tenant's indexed documents are visible only for queries for that tenant.</span></span> <span data-ttu-id="78a40-116">Три независимых механизма предотвращают утечку информации:</span><span class="sxs-lookup"><span data-stu-id="78a40-116">Three independent mechanisms prevent information leakage:</span></span>

- <span data-ttu-id="78a40-117">Фильтрация ID клиента</span><span class="sxs-lookup"><span data-stu-id="78a40-117">Tenant ID filtering</span></span>
- <span data-ttu-id="78a40-118">Префикс терминов tenant ID</span><span class="sxs-lookup"><span data-stu-id="78a40-118">Tenant ID term prefixing</span></span>
- <span data-ttu-id="78a40-119">Проверки ACL</span><span class="sxs-lookup"><span data-stu-id="78a40-119">ACL checks</span></span>

<span data-ttu-id="78a40-120">Все три механизма должны были бы не возвращать документы неправильному клиенту.</span><span class="sxs-lookup"><span data-stu-id="78a40-120">All three mechanisms would have to fail for Search to return documents to the wrong tenant.</span></span>

## <a name="tenant-id-filtering-and-tenant-id-term-prefixing"></a><span data-ttu-id="78a40-121">Фильтрация ID клиента и префикс терминов tenant ID</span><span class="sxs-lookup"><span data-stu-id="78a40-121">Tenant ID Filtering and Tenant ID Term Prefixing</span></span>

<span data-ttu-id="78a40-122">Поиск префиксирует каждый термин, который индексируется в полно текстовом индексе с ИД клиента.</span><span class="sxs-lookup"><span data-stu-id="78a40-122">Search prefixes every term that is indexed in the full-text index with the tenant ID.</span></span> <span data-ttu-id="78a40-123">Например, при индексации термина *"foo"* для клиента с ИД *"123",* запись в полно текстовом индексе является *"123foo".*</span><span class="sxs-lookup"><span data-stu-id="78a40-123">For example, when the term "*foo*" is indexed for a tenant with an ID of "*123*", the entry in the full-text index is "*123foo.*"</span></span>

<span data-ttu-id="78a40-124">Каждый запрос преобразуется для включаемого ID клиента с помощью процесса фильтрации ID клиента.</span><span class="sxs-lookup"><span data-stu-id="78a40-124">Every query is converted to include the tenant ID using a process called tenant ID filtering.</span></span> <span data-ttu-id="78a40-125">Например, запрос *"foo"* преобразуется в "<*guid*>. *foo* AND *tenantID*:<*guid*>", <*guid*> представляет клиента, который выполняет запрос.</span><span class="sxs-lookup"><span data-stu-id="78a40-125">For example, the query "*foo*" is converted to "<*guid*>.*foo* AND *tenantID*:<*guid*>", where <*guid*> represents the tenant performing the query.</span></span> <span data-ttu-id="78a40-126">Преобразование запроса происходит в каждом узле индекса, и ни запрос, ни обработка контента не могут повлиять на него.</span><span class="sxs-lookup"><span data-stu-id="78a40-126">This query conversion occurs within each index node and neither query nor content processing can influence it.</span></span> <span data-ttu-id="78a40-127">Так как идентификация клиента добавляется к каждому запросу, частота термина в других клиентах не может быть высвечена, если посмотреть на лучший рейтинг совпадений в одном клиенте.</span><span class="sxs-lookup"><span data-stu-id="78a40-127">Because the tenant ID is added to every query, the frequency of a term in other tenants can't be inferred by looking at best match ranking in one tenant.</span></span>

<span data-ttu-id="78a40-128">Префикс терминов tenant ID происходит только в полно текстовом индексе.</span><span class="sxs-lookup"><span data-stu-id="78a40-128">Tenant ID term prefixing occurs only in the full-text index.</span></span> <span data-ttu-id="78a40-129">Выполнимые поиски, такие как *"title:foo",* перейдите к синтетическому индексу поиска, где термины не префиксироваться по ID клиента.</span><span class="sxs-lookup"><span data-stu-id="78a40-129">Fielded searches, such as "*title:foo*", go to a synthetic search index where terms aren't prefixed by tenant ID.</span></span> <span data-ttu-id="78a40-130">Вместо этого выполняется префикс полевых поисков с именем поля.</span><span class="sxs-lookup"><span data-stu-id="78a40-130">Instead, fielded searches are prefixed with the field name.</span></span> <span data-ttu-id="78a40-131">Например, запрос *"title:foo"* преобразуется в *"fields.title:foo и fields.tenantID*:<*guid*>".</span><span class="sxs-lookup"><span data-stu-id="78a40-131">For example, the query "*title:foo*" is converted to "*fields.title:foo AND fields.tenantID*:<*guid*>."</span></span> <span data-ttu-id="78a40-132">Так как частота термина не влияет на ранжирование попаданий в синтетическом индексе поиска, нет необходимости в разделении клиента с помощью префиксирования терминов.</span><span class="sxs-lookup"><span data-stu-id="78a40-132">Because the frequency of a term doesn't influence ranking of hits in the synthetic search index, there's no need for tenant separation by term prefixing.</span></span> <span data-ttu-id="78a40-133">Для поля поиска типа *"title:foo"* разделение контента клиента зависит от фильтрации ID клиента путем преобразования запроса.</span><span class="sxs-lookup"><span data-stu-id="78a40-133">For a fielded search like "*title:foo*", tenant content separation depends on tenant ID filtering by query conversion.</span></span>

## <a name="document-access-control-list-checks"></a><span data-ttu-id="78a40-134">Проверка списка управления доступом к документам</span><span class="sxs-lookup"><span data-stu-id="78a40-134">Document Access Control List Checks</span></span>

<span data-ttu-id="78a40-135">Поиск контролирует доступ к документам с помощью acLs, сохраненных в индексе поиска.</span><span class="sxs-lookup"><span data-stu-id="78a40-135">Search controls access to documents through ACLs that are saved in the search index.</span></span> <span data-ttu-id="78a40-136">Каждый элемент индексироваться с набором терминов в специальном поле ACL.</span><span class="sxs-lookup"><span data-stu-id="78a40-136">Every item is indexed with a set of terms in a special ACL field.</span></span> <span data-ttu-id="78a40-137">Поле ACL содержит один термин для группы или пользователя, который может просматривать документ.</span><span class="sxs-lookup"><span data-stu-id="78a40-137">The ACL field contains one term per group or user that can view the document.</span></span> <span data-ttu-id="78a40-138">Каждый запрос дополняется списком терминов записи управления доступом (ACE), по одному для каждой группы, к которой принадлежит авторификация пользователя.</span><span class="sxs-lookup"><span data-stu-id="78a40-138">Every query is augmented with a list of access control entry (ACE) terms, one for each group to which the authenticated user belongs.</span></span>

<span data-ttu-id="78a40-139">Например, запрос типа "<*guid*>. *Foo AND tenantID*:<*guid*>" становится: "<*guid*>. *foo И tenantID*:<*guid* >  *AND* *(docACL:* < *ace1* >  *OR docACL*:<*ace2* >  *OR docACL*:<*ace3* >  *...*)"</span><span class="sxs-lookup"><span data-stu-id="78a40-139">For example, a query like "<*guid*>.*foo AND tenantID*:<*guid*>" becomes: "<*guid*>.*foo AND tenantID*:<*guid*> *AND* (*docACL:*<*ace1*> *OR docACL*:<*ace2*> *OR docACL*:<*ace3*> *...*)"</span></span>

<span data-ttu-id="78a40-140">Так как идентификаторы пользователей и групп и, следовательно, acEs уникальны, это обеспечивает дополнительный уровень безопасности между арендаторами для документов, которые видны только некоторым пользователям.</span><span class="sxs-lookup"><span data-stu-id="78a40-140">Because user and group identifiers and hence ACEs are unique, this provides an extra level of security between tenants for documents that are only visible to some users.</span></span> <span data-ttu-id="78a40-141">То же самое касается специального ACE "Все, кроме внешних пользователей", который предоставляет доступ к обычным пользователям в клиенте.</span><span class="sxs-lookup"><span data-stu-id="78a40-141">The same is the case for the special "Everyone except external users" ACE that grants access to regular users in the tenant.</span></span> <span data-ttu-id="78a40-142">Но так как acEs для "Все" одинаковы для всех клиентов, разделение клиента для общедоступных документов зависит от фильтрации ID клиента.</span><span class="sxs-lookup"><span data-stu-id="78a40-142">But since ACEs for "Everyone" are the same for all tenants, tenant separation for public documents depends on tenant ID filtering.</span></span> <span data-ttu-id="78a40-143">Поддержка acEs также поддерживается.</span><span class="sxs-lookup"><span data-stu-id="78a40-143">Deny ACEs are also supported.</span></span> <span data-ttu-id="78a40-144">В дополнении запроса добавляется пункт, который удаляет документ из результатов при совпадении с ACE отказа.</span><span class="sxs-lookup"><span data-stu-id="78a40-144">The query augmentation adds a clause that removes a document from the result when there is a match with a deny ACE.</span></span>

<span data-ttu-id="78a40-145">В Exchange Online поиске индекс разделяется на ID почтовых ящиков для почтовых ящиков отдельных пользователей вместо ID клиента (подписки), как в SharePoint Online.</span><span class="sxs-lookup"><span data-stu-id="78a40-145">In Exchange Online search, the index is partitioned on mailbox ID for individual user's mailboxes instead of tenant ID (subscription ID) as in SharePoint Online.</span></span> <span data-ttu-id="78a40-146">Механизм раздела такой же, как SharePoint Online, но фильтрации ACL не существует.</span><span class="sxs-lookup"><span data-stu-id="78a40-146">The partitioning mechanism is the same as SharePoint Online, but there is no ACL filtering.</span></span>
